  [1m[36m (119.1ms)[0m  [1mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL) ENGINE=InnoDB[0m
  [1m[35m (252.9ms)[0m  CREATE UNIQUE INDEX `unique_schema_migrations`  ON `schema_migrations` (`version`) 
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
Migrating to InitSchema (20140824130901)
  [1m[35m (148.3ms)[0m  CREATE TABLE `acquirer_org` (`id` int(11) auto_increment PRIMARY KEY, `acquirer_name` varchar(255), `acquirer_code` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (175.5ms)[0m  [1mCREATE TABLE `activity_logs` (`id` int(11) auto_increment PRIMARY KEY, `user_name` varchar(255), `ip_address` varchar(255), `action` varchar(255), `note` varchar(255), `object` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (132.7ms)[0m  CREATE TABLE `card_bins` (`id` int(11) auto_increment PRIMARY KEY, `card_code` varchar(255), `bank_name` varchar(255), `length` int(11), `bank_bin` varchar(255), `organization` int(11), `card_type` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (137.6ms)[0m  [1mCREATE  INDEX `index_card_bins_on_bank_bin` USING btree ON `card_bins` (`bank_bin`) [0m
  [1m[35m (144.8ms)[0m  CREATE  INDEX `index_card_bins_on_bank_name` USING btree ON `card_bins` (`bank_name`) 
  [1m[36m (153.5ms)[0m  [1mCREATE TABLE `configurations` (`id` int(11) auto_increment PRIMARY KEY, `key` varchar(255), `value` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (164.6ms)[0m  CREATE TABLE `credit_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_type` varchar(255), `name` varchar(255), `address` varchar(255), `mobile` varchar(255), `external_id` varchar(255) NOT NULL, `total_credit` int(11) DEFAULT 0 NOT NULL, `usable_credit` int(11) DEFAULT 0 NOT NULL, `locked_credit` int(11) DEFAULT 0 NOT NULL, `cashed_credit` int(11) DEFAULT 0 NOT NULL, `referer_credit` int(11) DEFAULT 0 NOT NULL, `referee_credit` int(11) DEFAULT 0 NOT NULL, `consumption_credit` int(11) DEFAULT 0 NOT NULL, `consumption_times` int(11) DEFAULT 0 NOT NULL, `referer_account_id` int(11), `lock_version` int(11), `status` int(11) DEFAULT 1 NOT NULL, `created_at` datetime, `updated_at` datetime, `tag` varchar(255)) ENGINE=InnoDB
  [1m[36m (158.2ms)[0m  [1mCREATE UNIQUE INDEX `credit_account_external_id` USING btree ON `credit_accounts` (`external_id`) [0m
  [1m[35m (156.7ms)[0m  CREATE UNIQUE INDEX `index_credit_accounts_on_mobile` USING btree ON `credit_accounts` (`mobile`) 
  [1m[36m (167.0ms)[0m  [1mCREATE  INDEX `index_credit_accounts_on_tag` USING btree ON `credit_accounts` (`tag`) [0m
  [1m[35m (152.3ms)[0m  CREATE TABLE `credit_cashing_applications` (`id` int(11) auto_increment PRIMARY KEY, `bank_card` varchar(255), `bank_name` varchar(255), `real_name` varchar(255), `amount` int(11), `status` int(11) DEFAULT 101 NOT NULL, `comment` varchar(255), `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (169.3ms)[0m  [1mCREATE  INDEX `fk_cashing_application_credit_accounts` USING btree ON `credit_cashing_applications` (`credit_account_id`) [0m
  [1m[35m (152.0ms)[0m  CREATE TABLE `marketing_rules` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `rule_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB
  [1m[36m (165.3ms)[0m  [1mCREATE TABLE `marketing_rules_payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `marketing_rule_id` int(11), `payment_plan_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (148.2ms)[0m  CREATE  INDEX `index_marketing_rules_payment_plans_on_marketing_rule_id` USING btree ON `marketing_rules_payment_plans` (`marketing_rule_id`) 
  [1m[36m (145.8ms)[0m  [1mCREATE  INDEX `index_marketing_rules_payment_plans_on_payment_plan_id` USING btree ON `marketing_rules_payment_plans` (`payment_plan_id`) [0m
  [1m[35m (151.4ms)[0m  CREATE TABLE `member_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `member_group_id` int(11), `member_group_type` varchar(255), `credit_account_id` int(11)) ENGINE=InnoDB
  [1m[36m (179.5ms)[0m  [1mCREATE  INDEX `index_member_ships_on_credit_account_id` USING btree ON `member_ships` (`credit_account_id`) [0m
  [1m[35m (158.4ms)[0m  CREATE  INDEX `index_member_ships_on_member_group_id_and_member_group_type` USING btree ON `member_ships` (`member_group_id`, `member_group_type`) 
  [1m[36m (162.7ms)[0m  [1mCREATE TABLE `merchant_group_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `merchant_group_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (170.3ms)[0m  CREATE  INDEX `index_merchant_group_ships_on_merchant_group_id` USING btree ON `merchant_group_ships` (`merchant_group_id`) 
  [1m[36m (155.2ms)[0m  [1mCREATE  INDEX `index_merchant_group_ships_on_merchant_store_id` USING btree ON `merchant_group_ships` (`merchant_store_id`) [0m
  [1m[35m (175.6ms)[0m  CREATE TABLE `merchant_groups` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255), `display_name` varchar(255)) ENGINE=InnoDB
  [1m[36m (168.8ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_groups_on_name` USING btree ON `merchant_groups` (`name`) [0m
  [1m[35m (140.7ms)[0m  CREATE TABLE `merchant_stores` (`id` int(11) auto_increment PRIMARY KEY, `name` varchar(255) NOT NULL, `merchant_number` varchar(255) NOT NULL, `license_name` varchar(255), `license_num` varchar(255), `license_expire_date` varchar(255), `tax_number` varchar(255), `organization_code` varchar(255), `legal_person` varchar(255), `legal_person_ic` varchar(255), `register_address` varchar(255), `real_address` varchar(255), `business_scope` varchar(255), `real_business_scope` varchar(255), `contract_num` varchar(255), `contract_active_date` datetime, `contractor` varchar(255), `file_num` varchar(255), `finance_contact_name` varchar(255), `finance_contact_phone` varchar(255), `public_account_name` varchar(255), `public_account_num` varchar(255), `public_account_bank` varchar(255), `clearance_account_name` varchar(255), `clearance_account_num` varchar(255), `clearance_account_bank` varchar(255), `deploy_contact_name` varchar(255), `deploy_contact_phone` varchar(255), `status` varchar(255), `standard_rate` decimal(12,9) NOT NULL, `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime, `accquire_org_id` int(11), `tag` varchar(255), `accept_global_voucher` tinyint(1) NOT NULL, `accept_own_voucher` tinyint(1) DEFAULT 0 NOT NULL, `notification_mobile` varchar(255)) ENGINE=InnoDB
  [1m[36m (190.7ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_stores_on_merchant_number` USING btree ON `merchant_stores` (`merchant_number`) [0m
  [1m[35m (145.6ms)[0m  CREATE  INDEX `index_merchant_stores_on_tag` USING btree ON `merchant_stores` (`tag`) 
  [1m[36m (164.0ms)[0m  [1mCREATE TABLE `payment_media` (`id` int(11) auto_increment PRIMARY KEY, `media_type` varchar(255), `media_num` varchar(255), `card_type` varchar(255), `bank_name` varchar(255), `cashing_card` tinyint(1) DEFAULT 0 NOT NULL, `credit_account_id` int(11), `credit_earned` int(11) DEFAULT 0 NOT NULL, `lock_version` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (168.7ms)[0m  CREATE  INDEX `fk_payment_media_accounts` USING btree ON `payment_media` (`credit_account_id`) 
  [1m[36m (167.4ms)[0m  [1mCREATE UNIQUE INDEX `media_num` USING btree ON `payment_media` (`media_num`, `media_type`) [0m
  [1m[35m (163.9ms)[0m  CREATE TABLE `payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `plan_type` varchar(255), `merchant_rate` decimal(12,9), `customer_rate` decimal(12,9), `referer_rate` decimal(12,9), `discount_amount` int(11), `discount_rate` decimal(12,9), `card_bin_id` int(11), `merchant_store_id` int(11), `created_at` datetime, `updated_at` datetime, `status` int(11) DEFAULT 0 NOT NULL, `valid_from` datetime, `valid_till` datetime, `discount_type` varchar(255), `bank_name` varchar(255), `minimal_money_amount` int(11) DEFAULT 0 NOT NULL, `voucher_status` int(11), `user_tag` varchar(255), `user_type` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (169.6ms)[0m  [1mCREATE  INDEX `fk_store_payment_plan` USING btree ON `payment_plans` (`merchant_store_id`) [0m
  [1m[35m (298.3ms)[0m  CREATE TABLE `platform_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_name` varchar(255) NOT NULL, `access_key` varchar(255) NOT NULL, `access_target` varchar(255) NOT NULL, `remark` varchar(255), `created_at` datetime, `updated_at` datetime, `status` varchar(255)) ENGINE=InnoDB
  [1m[36m (170.0ms)[0m  [1mCREATE UNIQUE INDEX `platform_account_account_name` USING btree ON `platform_accounts` (`account_name`) [0m
  [1m[35m (162.7ms)[0m  CREATE TABLE `post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `marketing_rule_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `voucher_count` int(11)) ENGINE=InnoDB
  [1m[36m (166.1ms)[0m  [1mCREATE TABLE `sequence_numbers` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `number` varchar(255), `used` tinyint(1) DEFAULT 0 NOT NULL, `sequence_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (158.9ms)[0m  CREATE UNIQUE INDEX `index_sequence_numbers_on_number_and_sequence_id` USING btree ON `sequence_numbers` (`number`, `sequence_id`) 
  [1m[36m (164.3ms)[0m  [1mCREATE TABLE `sequences` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (175.7ms)[0m  CREATE TABLE `system_users` (`id` int(11) auto_increment PRIMARY KEY, `real_name` varchar(255), `name` varchar(255), `password_digest` varchar(255), `role_name` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (154.4ms)[0m  [1mCREATE TABLE `transaction_archives` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` varchar(255), `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (155.0ms)[0m  CREATE TABLE `transaction_logs` (`id` int(11) NOT NULL, `log_type` int(11), `transaction_datetime` datetime NOT NULL, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `credit_delta` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `terminal_num` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `sequence_number` varchar(255), `merchant_amount` int(11), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `status` int(11) NOT NULL, `ref_id` varchar(255), `internal_seq_num` int(11) DEFAULT 0 NOT NULL, `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `checked` int(11) DEFAULT 0 NOT NULL, `voucher_used_count` int(11) DEFAULT 0 NOT NULL, `voucher_deducted_amount` int(11) DEFAULT 0 NOT NULL, `referer_external_id` varchar(255), `referer_mobile` varchar(255), `referer_id` int(11), `credit_account_external_id` varchar(255)) ENGINE=InnoDB
  [1m[36m (148.3ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_acquirer_code` USING btree ON `transaction_logs` (`acquirer_code`) [0m
  [1m[35m (189.9ms)[0m  CREATE  INDEX `index_transaction_logs_on_credit_account_id` USING btree ON `transaction_logs` (`credit_account_id`) 
  [1m[36m (201.9ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_num` USING btree ON `transaction_logs` (`merchant_num`) [0m
  [1m[35m (177.8ms)[0m  CREATE  INDEX `index_transaction_logs_on_merchant_store_id` USING btree ON `transaction_logs` (`merchant_store_id`) 
  [1m[36m (177.3ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_tag` USING btree ON `transaction_logs` (`merchant_tag`) [0m
  [1m[35m (178.6ms)[0m  CREATE UNIQUE INDEX `unique_log` USING btree ON `transaction_logs` (`ref_id`, `internal_seq_num`, `status`, `transaction_datetime`) 
  [1m[36m (167.4ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_ref_id` USING btree ON `transaction_logs` (`ref_id`) [0m
  [1m[35m (178.3ms)[0m  CREATE  INDEX `index_transaction_logs_on_terminal_num` USING btree ON `transaction_logs` (`terminal_num`) 
  [1m[36m (176.7ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_transaction_datetime` USING btree ON `transaction_logs` (`transaction_datetime`) [0m
  [1m[35m (222.8ms)[0m  CREATE  INDEX `index_transaction_logs_on_user_tag` USING btree ON `transaction_logs` (`user_tag`) 
  [1m[36m (187.2ms)[0m  [1mCREATE TABLE `transaction_post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `payment_plan_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB[0m
  [1m[35m (189.9ms)[0m  CREATE  INDEX `index_transaction_post_actions_on_payment_plan_id` USING btree ON `transaction_post_actions` (`payment_plan_id`) 
  [1m[36m (167.9ms)[0m  [1mCREATE  INDEX `index_transaction_post_actions_on_voucher_meta_id` USING btree ON `transaction_post_actions` (`voucher_meta_id`) [0m
  [1m[35m (176.7ms)[0m  CREATE TABLE `transactions` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` datetime, `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB
  [1m[36m (180.0ms)[0m  [1mCREATE  INDEX `index_transactions_on_ref_id` USING btree ON `transactions` (`ref_id`) [0m
  [1m[35m (151.2ms)[0m  CREATE TABLE `voucher_meta` (`id` int(11) auto_increment PRIMARY KEY, `valid_from` datetime, `valid_till` datetime, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `initial_amount` int(11) DEFAULT -1 NOT NULL, `amount_left` int(11) DEFAULT -1 NOT NULL, `denomination` int(11), `limit_per_account` int(11) DEFAULT -1 NOT NULL, `aliases` varchar(255) NOT NULL, `code` varchar(255) NOT NULL, `remark` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `merchant_group_id` int(11), `merchant_store_id` int(11), `applicable_type` int(11), `sequence_id` int(11), `money_condition` int(11) DEFAULT 0 NOT NULL, `issued_count` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (310.9ms)[0m  [1mCREATE UNIQUE INDEX `index_voucher_meta_on_aliases` USING btree ON `voucher_meta` (`aliases`) [0m
  [1m[35m (451.9ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_code` USING btree ON `voucher_meta` (`code`) 
  [1m[36m (474.5ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_issuer_identifier` USING btree ON `voucher_meta` (`issuer_identifier`) [0m
  [1m[35m (177.9ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_sequence_id` USING btree ON `voucher_meta` (`sequence_id`) 
  [1m[36m (200.8ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_settler_identifier` USING btree ON `voucher_meta` (`settler_identifier`) [0m
  [1m[35m (162.3ms)[0m  CREATE TABLE `voucher_stores` (`id` int(11) auto_increment PRIMARY KEY, `merchant_store_id` int(11), `voucher_meta_id` int(11)) ENGINE=InnoDB
  [1m[36m (214.1ms)[0m  [1mCREATE  INDEX `index_voucher_stores_on_merchant_store_id` USING btree ON `voucher_stores` (`merchant_store_id`) [0m
  [1m[35m (232.3ms)[0m  CREATE  INDEX `index_voucher_stores_on_voucher_meta_id` USING btree ON `voucher_stores` (`voucher_meta_id`) 
  [1m[36m (226.1ms)[0m  [1mCREATE TABLE `voucher_transaction_logs` (`id` int(11) NOT NULL, `mobile` varchar(255), `credit_account_id` int(11), `transaction_type` varchar(255), `transaction_datetime` datetime NOT NULL, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `denomination` int(11), `deducted_amount` int(11), `voucher_meta_code` varchar(255), `voucher_unique_id` varchar(255), `ref_id` varchar(255), `primary_transaction_ref_id` varchar(255), `issue_event` varchar(255), `merchant_name` varchar(255), `merchant_store_id` int(11), `merchant_num` varchar(255), `created_at` datetime, `updated_at` datetime, `checked` int(11) DEFAULT 0 NOT NULL, `voucher_sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (200.2ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_credit_account_id` USING btree ON `voucher_transaction_logs` (`credit_account_id`) 
  [1m[36m (168.4ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_issuer_identifier` USING btree ON `voucher_transaction_logs` (`issuer_identifier`) [0m
  [1m[35m (166.5ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_merchant_store_id` USING btree ON `voucher_transaction_logs` (`merchant_store_id`) 
  [1m[36m (178.5ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_primary_transaction_ref_id` USING btree ON `voucher_transaction_logs` (`primary_transaction_ref_id`) [0m
  [1m[35m (216.4ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_ref_id` USING btree ON `voucher_transaction_logs` (`ref_id`) 
  [1m[36m (578.2ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_settler_identifier` USING btree ON `voucher_transaction_logs` (`settler_identifier`) [0m
  [1m[35m (524.8ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_voucher_unique_id` USING btree ON `voucher_transaction_logs` (`voucher_unique_id`) 
  [1m[36m (235.5ms)[0m  [1mCREATE TABLE `vouchers` (`id` int(11) auto_increment PRIMARY KEY, `credit_account_id` int(11), `voucher_meta_id` int(11), `unique_id` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `used_datetime` datetime, `sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (190.7ms)[0m  CREATE  INDEX `index_vouchers_on_credit_account_id` USING btree ON `vouchers` (`credit_account_id`) 
  [1m[36m (156.6ms)[0m  [1mCREATE UNIQUE INDEX `index_vouchers_on_sequence_number_and_voucher_meta_id` USING btree ON `vouchers` (`sequence_number`, `voucher_meta_id`) [0m
  [1m[35m (177.5ms)[0m  CREATE UNIQUE INDEX `index_vouchers_on_unique_id` USING btree ON `vouchers` (`unique_id`) 
  [1m[36m (179.7ms)[0m  [1mCREATE  INDEX `index_vouchers_on_voucher_meta_id` USING btree ON `vouchers` (`voucher_meta_id`) [0m
  [1m[35m (176.7ms)[0m  ALTER TABLE `credit_cashing_applications` ADD CONSTRAINT `fk_cashing_application_credit_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE
  [1m[36m (188.5ms)[0m  [1mALTER TABLE `payment_media` ADD CONSTRAINT `fk_payment_media_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE[0m
  [1m[35m (180.6ms)[0m  ALTER TABLE `payment_plans` ADD CONSTRAINT `fk_store_payment_plan` FOREIGN KEY (`merchant_store_id`) REFERENCES `merchant_stores`(id) ON DELETE CASCADE
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20140824130901')
  [1m[36m (0.5ms)[0m  [1mCOMMIT[0m
Migrating to CreateTransactionLogPartitions (20140824130902)
  [1m[35m (180.8ms)[0m  alter table transaction_logs add primary key(id, transaction_datetime);
  [1m[36m (312.4ms)[0m  [1m        ALTER TABLE transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );
[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `schema_migrations` (`version`) VALUES ('20140824130902')[0m
  [1m[35m (0.6ms)[0m  COMMIT
Migrating to CreateVoucherTransactionLogPartitions (20140824130903)
  [1m[36m (181.2ms)[0m  [1malter table voucher_transaction_logs add primary key(id, transaction_datetime);[0m
  [1m[35m (291.3ms)[0m          ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20140824130903')
  [1m[36m (0.5ms)[0m  [1mCOMMIT[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT `schema_migrations`.* FROM `schema_migrations`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'acquirer_org'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `acquirer_org`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'activity_logs'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `activity_logs`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'card_bins'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `card_bins`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'configurations'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `configurations`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'credit_accounts'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `credit_accounts`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'credit_cashing_applications'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `credit_cashing_applications`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'marketing_rules'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `marketing_rules`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'marketing_rules_payment_plans'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `marketing_rules_payment_plans`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'member_ships'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `member_ships`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'merchant_group_ships'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `merchant_group_ships`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'merchant_groups'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `merchant_groups`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'merchant_stores'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `merchant_stores`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'payment_media'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `payment_media`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'payment_plans'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `payment_plans`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'platform_accounts'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `platform_accounts`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'post_actions'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `post_actions`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'sequence_numbers'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `sequence_numbers`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'sequences'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `sequences`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'system_users'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `system_users`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transaction_archives'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `transaction_archives`
  [1m[36m (2.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transaction_logs'
        [0m
  [1m[35m (1.4ms)[0m  SHOW CREATE TABLE `transaction_logs`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transaction_post_actions'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `transaction_post_actions`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transactions'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `transactions`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'voucher_meta'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `voucher_meta`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'voucher_stores'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `voucher_stores`
  [1m[36m (1.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'voucher_transaction_logs'
        [0m
  [1m[35m (2.1ms)[0m  SHOW CREATE TABLE `voucher_transaction_logs`
  [1m[36m (0.4ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'vouchers'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `vouchers`
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (15.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (16.2ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 3
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 4
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 5
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 5
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (11.4ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 6
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 7
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 7
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 8
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.3ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 9
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 10
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 10
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 11
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 12
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (23.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 13
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 13
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 14
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mConfiguration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 15
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mConfiguration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-24 06:17:21', 19, 1, '2014-08-24 06:17:21')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-24 06:17:21', 19, 1, '2014-08-24 06:17:21')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-24 06:17:21', 19, 1, '2014-08-24 06:17:21')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-24 06:17:22', 19, 0, '2014-08-24 06:17:22')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-24 06:17:34', 19, 1, '2014-08-24 06:17:34')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-24 06:17:34', 19, 1, '2014-08-24 06:17:34')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-24 06:17:34', 19, 0, '2014-08-24 06:17:34')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (51.5ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.4ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (16.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-24 06:17:34', 19, 1, '2014-08-24 06:17:34')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-24 06:23:02', 19, 1, '2014-08-24 06:23:02')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-24 06:23:02', 19, 1, '2014-08-24 06:23:02')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-24 06:23:02', 19, 0, '2014-08-24 06:23:02')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (0.2ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.2ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (38.7ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (43.9ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-24 07:16:45', '2014-08-24 07:16:45')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (21.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-24 07:20:09', '2014-08-24 07:20:09', 'cangjingkong')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-24 07:20:17', '2014-08-24 07:20:17', 'tester')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (113.1ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:29:47', '1261d7df949dcee9160615d69a12d3f3', 0, '123456', 'test', '2014-08-24 07:29:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.4ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:30:16', '5ec00867337a951b089d51460b48e8e5', 0, '123456', 'test', '2014-08-24 07:30:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (41.7ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:30:16', 2, 0, '1234567812345678', 'bank_card', '2014-08-24 07:30:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (22.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 2  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 1 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (2.3ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-24 07:30:16', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 1 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 1 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-24 07:30:16', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 1 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (15.3ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:30:28', '20b2b3815e706a2e874b4bc660abafc1', 0, '123456', 'test', '2014-08-24 07:30:28')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:30:28', 3, 0, '1234567812345678', 'bank_card', '2014-08-24 07:30:28')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (51.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 3[0m
  [1m[35m (17.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:30:28', '2b6a4b4bdfb2b9d05c01fb4dd1b266d5', 0, '123456', 'test', '2014-08-24 07:30:28')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:30:28', 4, 0, '1234567812345678', 'bank_card', '2014-08-24 07:30:28')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 4  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 3 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-24 07:30:28', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 3 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 3 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mUPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-24 07:30:28', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 3 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.1ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:30:28', '0a2ae4671ad9aebcd95aaef231aeb313', 0, '123456', 'test', '2014-08-24 07:30:28')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:31:39', '50fd070ea765602da418614683bd79fb', 0, '123456', 'test', '2014-08-24 07:31:39')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:31:39', 6, 0, '1234567812345678', 'bank_card', '2014-08-24 07:31:39')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 6[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 6
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 6  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:33:37', 'd156e52f17a600f037edf1ad6b64daec', 0, '123456', 'test', '2014-08-24 07:33:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:33:37', 7, 0, '1234567812345678', 'bank_card', '2014-08-24 07:33:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 7  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 5 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-24 07:33:37', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 5 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 5 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-24 07:33:37', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 5 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (14.0ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:33:43', 'dcb617ff8b47c7c152ef67e7544137a9', 0, '123456', 'test', '2014-08-24 07:33:43')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:33:43', 8, 0, '1234567812345678', 'bank_card', '2014-08-24 07:33:43')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 8  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 6 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-24 07:33:43', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 6 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 6 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-24 07:33:43', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 6 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:33:43', '96330d5e43d0c7b5e9c21bf133414f5f', 0, '123456', 'test', '2014-08-24 07:33:43')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:33:43', 9, 0, '1234567812345678', 'bank_card', '2014-08-24 07:33:43')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 9[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 9
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 9  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:33:43', '69916088b75e4d352988d516c08a81b3', 0, '123456', 'test', '2014-08-24 07:33:43')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:35:39', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-24 07:35:39', '1976-01-01 00:00:00', '2024-08-24 07:35:39', 0)
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:35:39', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-24 07:35:39', '1976-01-01 00:00:00', '2024-08-24 07:35:39', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 16
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 17
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 17
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (25.0ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-24 07:39:12', 'b9f2af6e6c90c779f4cfb1ffbeaa94f2', 0, '123456', 'test', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-24 07:39:12', '4d0bc1759aa5491221c066041a8d1fcc', 0, '12345611', '2014-08-24 07:39:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 07:39:12', 'a6f7c008ef57d212b170bd778a49826a', 0, '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-24 07:39:12', '9d0fd1657061a966b1421c9c174ad464', 0, '123456', 'test', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-24 07:39:12', '128af6635c3343a8ad1b332726a9e348', 0, '123456', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (15.0ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 15) LIMIT 1[0m
  [1m[35m (0.3ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 15 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 15) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 15 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 07:39:12', 'aa3733c886fac7d80b27e16e9861e25d', 0, '123456', 'test', '2014-08-24 07:39:12', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 16) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 16 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 16 LIMIT 1[0m
  [1m[35m (19.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 07:39:12', '5ae46f770d14fcb179115a88dff9dff1', 0, '123456', 'test', '2014-08-24 07:39:12', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 17) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 17 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 17) LIMIT 1[0m
  [1m[35m (0.4ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 17 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 17 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 07:39:12', 'aeb67a79b4873072f3147cd544169288', 0, '123456', 'test', '2014-08-24 07:39:12', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 18) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 18 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 18) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-24 07:39:12', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 18 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 18 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:39:12', '0eb496456ce453e8f057b8b0879d3ffd', 0, '123456', 'test', '2014-08-24 07:39:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 19
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 19, 0, '1111111111111111111111', 'bank_card', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 19[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:39:12', '7cbe4c6d8403c36aac425bfd9bcd1f29', 0, '123456', 'test', '2014-08-24 07:39:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 20, 0, '1111111111111111111110', 'bank_card', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 20, 0, '1111111111111111111111', 'bank_card', '2014-08-24 07:39:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 20, 0, '1111111111111111111112', 'bank_card', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 20, 0, '1111111111111111111113', 'bank_card', '2014-08-24 07:39:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 20, 0, '1111111111111111111114', 'bank_card', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 07:39:12', '2fe036b368e806738fef1ef017a56b4b', 0, '123456', 'test', '2014-08-24 07:39:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 21
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 07:39:12', 21, 0, '1111111111111111111111', 'bank_card', '2014-08-24 07:39:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 21[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:41:05', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 07:41:05', '2014-08-24 07:42:05', '2014-08-24 07:51:05', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (77.4ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 07:41:05') AND (valid_till >= '2014-08-24 07:41:05')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 07:41:05' or valid_till < '2014-08-24 07:41:05')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (16.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:41:05', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 07:41:05', '1976-01-01 00:00:00', '2014-08-24 07:40:05', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 07:41:05') AND (valid_till >= '2014-08-24 07:41:05')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 07:41:05' or valid_till < '2014-08-24 07:41:05')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:41:05', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 07:41:05', '2014-08-24 07:40:05', '2014-08-24 07:42:05', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 07:41:05') AND (valid_till >= '2014-08-24 07:41:05')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 07:41:05' or valid_till < '2014-08-24 07:41:05')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:41:05', 0.05, 0.1, 'credit_back', 0.03, '2014-08-24 07:41:05', '1976-01-01 00:00:00', '2024-08-24 07:41:05', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`
  [1m[36mPay::CreditBack Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 07:41:05') AND (valid_till >= '2014-08-24 07:41:05')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 07:41:05' or valid_till < '2014-08-24 07:41:05')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:41:05', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 07:41:05', '1976-01-01 00:00:00', '2024-08-24 07:41:05', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 07:41:05') AND (valid_till >= '2014-08-24 07:41:05')
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 07:41:05' or valid_till < '2014-08-24 07:41:05')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 07:43:23', '111', 'test', 0.01, 'editing', '2014-08-24 07:43:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 07:43:23', 'ab3299f452d9d6122c80d955cb552753', 0, '2014-08-24 07:43:23')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 1) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 22, `updated_at` = '2014-08-24 07:43:23' WHERE `merchant_stores`.`id` = 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:43:23', 0.05, 0.1, 1, 'credit_back', 0.03, 1, '2014-08-24 07:43:23', '2014-08-24 07:42:23', '2014-08-24 07:44:23', 0)[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (16.8ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 07:44:03', '111', 'test', 0.01, 'editing', '2014-08-24 07:44:03')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 07:44:03', '6485842f73e5bd5bd77708f1db14d033', 0, '2014-08-24 07:44:03')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 2) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 23, `updated_at` = '2014-08-24 07:44:03' WHERE `merchant_stores`.`id` = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:44:03', 0.05, 0.1, 2, 'credit_back', 0.03, 1, '2014-08-24 07:44:03', '2014-08-24 07:43:03', '2014-08-24 07:45:03', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 2 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 07:45:10', '111', 'test', 0.01, 'editing', '2014-08-24 07:45:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 07:45:10', 'dd68f34513420f8540bcef1ac10b472f', 0, '2014-08-24 07:45:10')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 24, `updated_at` = '2014-08-24 07:45:10' WHERE `merchant_stores`.`id` = 3
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 07:45:10', 0.05, 0.1, 3, 'credit_back', 0.03, 1, '2014-08-24 07:45:10', '2014-08-24 07:44:10', '2014-08-24 07:46:10', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-24 07:45:10', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-24 07:45:10' WHERE `merchant_stores`.`id` = 3
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-24 07:45:10', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-24 07:45:10' WHERE `merchant_stores`.`id` = 3[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-24 07:45:10', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-24 07:45:10' WHERE `merchant_stores`.`id` = 3
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-24 07:45:10', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 3 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-24 07:45:10' WHERE `merchant_stores`.`id` = 3[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 3 LIMIT 1
  [1m[36m (19.2ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-24 07:49:39', '8449e1297dc4143b86252dedc48b6482', 'credit_back', '2014-08-24 07:49:39', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 07:52:12', 'ceef34c016cf2d16dbec80131ce1033f', 0, '123456', 'test', '2014-08-24 07:52:12', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 25[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 07:52:12', 25, 0, '111111111111111111111', 'bank_card', '2014-08-24 07:52:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 25  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 15 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 07:52:12', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 15 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 25 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 07:52:12', 25, 'test', '2014-08-24 07:52:12')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 25) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 07:52:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 25 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.1ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 25 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 25) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-24 07:52:12', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 25 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-24 07:52:12' WHERE `credit_cashing_applications`.`id` = 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 25 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count[0m
  [1m[35m (17.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 07:52:12', '4dea26cf1821e0303decde457bd0d67f', 0, '123456', 'test', '2014-08-24 07:52:12', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 26
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 07:52:12', 26, 0, '111111111111111111111', 'bank_card', '2014-08-24 07:52:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 26  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 16 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 07:52:12', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 16 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 26 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 07:52:12', 26, 'test', '2014-08-24 07:52:12')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 26) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 07:52:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 26 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 26 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 26) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-24 07:52:12', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 26 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-24 07:52:12' WHERE `credit_cashing_applications`.`id` = 2[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-24 07:52:12', 26, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'df033d0ca1a6f068335125cd58510aa8', 0, '2014-08-24 07:52:12', 'credit_cashing', '2014-08-24 07:52:12')
Mysql2::Error: Field 'id' doesn't have a default value: INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-24 07:52:12', 26, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'df033d0ca1a6f068335125cd58510aa8', 0, '2014-08-24 07:52:12', 'credit_cashing', '2014-08-24 07:52:12')
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (235.0ms)[0m  [1mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL) ENGINE=InnoDB[0m
  [1m[35m (251.6ms)[0m  CREATE UNIQUE INDEX `unique_schema_migrations`  ON `schema_migrations` (`version`) 
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
Migrating to InitSchema (20140824130901)
  [1m[35m (116.9ms)[0m  CREATE TABLE `acquirer_org` (`id` int(11) auto_increment PRIMARY KEY, `acquirer_name` varchar(255), `acquirer_code` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (164.6ms)[0m  [1mCREATE TABLE `activity_logs` (`id` int(11) auto_increment PRIMARY KEY, `user_name` varchar(255), `ip_address` varchar(255), `action` varchar(255), `note` varchar(255), `object` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (155.1ms)[0m  CREATE TABLE `card_bins` (`id` int(11) auto_increment PRIMARY KEY, `card_code` varchar(255), `bank_name` varchar(255), `length` int(11), `bank_bin` varchar(255), `organization` int(11), `card_type` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (194.8ms)[0m  [1mCREATE  INDEX `index_card_bins_on_bank_bin` USING btree ON `card_bins` (`bank_bin`) [0m
  [1m[35m (133.9ms)[0m  CREATE  INDEX `index_card_bins_on_bank_name` USING btree ON `card_bins` (`bank_name`) 
  [1m[36m (184.4ms)[0m  [1mCREATE TABLE `configurations` (`id` int(11) auto_increment PRIMARY KEY, `key` varchar(255), `value` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (176.7ms)[0m  CREATE TABLE `credit_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_type` varchar(255), `name` varchar(255), `address` varchar(255), `mobile` varchar(255), `external_id` varchar(255) NOT NULL, `total_credit` int(11) DEFAULT 0 NOT NULL, `usable_credit` int(11) DEFAULT 0 NOT NULL, `locked_credit` int(11) DEFAULT 0 NOT NULL, `cashed_credit` int(11) DEFAULT 0 NOT NULL, `referer_credit` int(11) DEFAULT 0 NOT NULL, `referee_credit` int(11) DEFAULT 0 NOT NULL, `consumption_credit` int(11) DEFAULT 0 NOT NULL, `consumption_times` int(11) DEFAULT 0 NOT NULL, `referer_account_id` int(11), `lock_version` int(11), `status` int(11) DEFAULT 1 NOT NULL, `created_at` datetime, `updated_at` datetime, `tag` varchar(255)) ENGINE=InnoDB
  [1m[36m (148.1ms)[0m  [1mCREATE UNIQUE INDEX `credit_account_external_id` USING btree ON `credit_accounts` (`external_id`) [0m
  [1m[35m (191.4ms)[0m  CREATE UNIQUE INDEX `index_credit_accounts_on_mobile` USING btree ON `credit_accounts` (`mobile`) 
  [1m[36m (224.7ms)[0m  [1mCREATE  INDEX `index_credit_accounts_on_tag` USING btree ON `credit_accounts` (`tag`) [0m
  [1m[35m (159.6ms)[0m  CREATE TABLE `credit_cashing_applications` (`id` int(11) auto_increment PRIMARY KEY, `bank_card` varchar(255), `bank_name` varchar(255), `real_name` varchar(255), `amount` int(11), `status` int(11) DEFAULT 101 NOT NULL, `comment` varchar(255), `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (179.1ms)[0m  [1mCREATE  INDEX `fk_cashing_application_credit_accounts` USING btree ON `credit_cashing_applications` (`credit_account_id`) [0m
  [1m[35m (168.1ms)[0m  CREATE TABLE `marketing_rules` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `rule_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB
  [1m[36m (183.6ms)[0m  [1mCREATE TABLE `marketing_rules_payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `marketing_rule_id` int(11), `payment_plan_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (158.5ms)[0m  CREATE  INDEX `index_marketing_rules_payment_plans_on_marketing_rule_id` USING btree ON `marketing_rules_payment_plans` (`marketing_rule_id`) 
  [1m[36m (156.4ms)[0m  [1mCREATE  INDEX `index_marketing_rules_payment_plans_on_payment_plan_id` USING btree ON `marketing_rules_payment_plans` (`payment_plan_id`) [0m
  [1m[35m (175.9ms)[0m  CREATE TABLE `member_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `member_group_id` int(11), `member_group_type` varchar(255), `credit_account_id` int(11)) ENGINE=InnoDB
  [1m[36m (180.1ms)[0m  [1mCREATE  INDEX `index_member_ships_on_credit_account_id` USING btree ON `member_ships` (`credit_account_id`) [0m
  [1m[35m (145.5ms)[0m  CREATE  INDEX `index_member_ships_on_member_group_id_and_member_group_type` USING btree ON `member_ships` (`member_group_id`, `member_group_type`) 
  [1m[36m (185.4ms)[0m  [1mCREATE TABLE `merchant_group_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `merchant_group_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (168.5ms)[0m  CREATE  INDEX `index_merchant_group_ships_on_merchant_group_id` USING btree ON `merchant_group_ships` (`merchant_group_id`) 
  [1m[36m (146.8ms)[0m  [1mCREATE  INDEX `index_merchant_group_ships_on_merchant_store_id` USING btree ON `merchant_group_ships` (`merchant_store_id`) [0m
  [1m[35m (151.0ms)[0m  CREATE TABLE `merchant_groups` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255), `display_name` varchar(255)) ENGINE=InnoDB
  [1m[36m (169.8ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_groups_on_name` USING btree ON `merchant_groups` (`name`) [0m
  [1m[35m (191.1ms)[0m  CREATE TABLE `merchant_stores` (`id` int(11) auto_increment PRIMARY KEY, `name` varchar(255) NOT NULL, `merchant_number` varchar(255) NOT NULL, `license_name` varchar(255), `license_num` varchar(255), `license_expire_date` varchar(255), `tax_number` varchar(255), `organization_code` varchar(255), `legal_person` varchar(255), `legal_person_ic` varchar(255), `register_address` varchar(255), `real_address` varchar(255), `business_scope` varchar(255), `real_business_scope` varchar(255), `contract_num` varchar(255), `contract_active_date` datetime, `contractor` varchar(255), `file_num` varchar(255), `finance_contact_name` varchar(255), `finance_contact_phone` varchar(255), `public_account_name` varchar(255), `public_account_num` varchar(255), `public_account_bank` varchar(255), `clearance_account_name` varchar(255), `clearance_account_num` varchar(255), `clearance_account_bank` varchar(255), `deploy_contact_name` varchar(255), `deploy_contact_phone` varchar(255), `status` varchar(255), `standard_rate` decimal(12,9) NOT NULL, `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime, `accquire_org_id` int(11), `tag` varchar(255), `accept_global_voucher` tinyint(1) NOT NULL, `accept_own_voucher` tinyint(1) DEFAULT 0 NOT NULL, `notification_mobile` varchar(255)) ENGINE=InnoDB
  [1m[36m (196.0ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_stores_on_merchant_number` USING btree ON `merchant_stores` (`merchant_number`) [0m
  [1m[35m (156.3ms)[0m  CREATE  INDEX `index_merchant_stores_on_tag` USING btree ON `merchant_stores` (`tag`) 
  [1m[36m (185.1ms)[0m  [1mCREATE TABLE `payment_media` (`id` int(11) auto_increment PRIMARY KEY, `media_type` varchar(255), `media_num` varchar(255), `card_type` varchar(255), `bank_name` varchar(255), `cashing_card` tinyint(1) DEFAULT 0 NOT NULL, `credit_account_id` int(11), `credit_earned` int(11) DEFAULT 0 NOT NULL, `lock_version` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (193.2ms)[0m  CREATE  INDEX `fk_payment_media_accounts` USING btree ON `payment_media` (`credit_account_id`) 
  [1m[36m (156.8ms)[0m  [1mCREATE UNIQUE INDEX `media_num` USING btree ON `payment_media` (`media_num`, `media_type`) [0m
  [1m[35m (163.0ms)[0m  CREATE TABLE `payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `plan_type` varchar(255), `merchant_rate` decimal(12,9), `customer_rate` decimal(12,9), `referer_rate` decimal(12,9), `discount_amount` int(11), `discount_rate` decimal(12,9), `card_bin_id` int(11), `merchant_store_id` int(11), `created_at` datetime, `updated_at` datetime, `status` int(11) DEFAULT 0 NOT NULL, `valid_from` datetime, `valid_till` datetime, `discount_type` varchar(255), `bank_name` varchar(255), `minimal_money_amount` int(11) DEFAULT 0 NOT NULL, `voucher_status` int(11), `user_tag` varchar(255), `user_type` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (168.0ms)[0m  [1mCREATE  INDEX `fk_store_payment_plan` USING btree ON `payment_plans` (`merchant_store_id`) [0m
  [1m[35m (141.8ms)[0m  CREATE TABLE `platform_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_name` varchar(255) NOT NULL, `access_key` varchar(255) NOT NULL, `access_target` varchar(255) NOT NULL, `remark` varchar(255), `created_at` datetime, `updated_at` datetime, `status` varchar(255)) ENGINE=InnoDB
  [1m[36m (190.6ms)[0m  [1mCREATE UNIQUE INDEX `platform_account_account_name` USING btree ON `platform_accounts` (`account_name`) [0m
  [1m[35m (153.2ms)[0m  CREATE TABLE `post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `marketing_rule_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `voucher_count` int(11)) ENGINE=InnoDB
  [1m[36m (175.6ms)[0m  [1mCREATE TABLE `sequence_numbers` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `number` varchar(255), `used` tinyint(1) DEFAULT 0 NOT NULL, `sequence_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (159.4ms)[0m  CREATE UNIQUE INDEX `index_sequence_numbers_on_number_and_sequence_id` USING btree ON `sequence_numbers` (`number`, `sequence_id`) 
  [1m[36m (163.3ms)[0m  [1mCREATE TABLE `sequences` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (188.2ms)[0m  CREATE TABLE `system_users` (`id` int(11) auto_increment PRIMARY KEY, `real_name` varchar(255), `name` varchar(255), `password_digest` varchar(255), `role_name` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (154.3ms)[0m  [1mCREATE TABLE `transaction_archives` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` varchar(255), `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (153.7ms)[0m  CREATE TABLE `transaction_logs` (`id` int(11) auto_increment PRIMARY KEY, `log_type` int(11), `transaction_datetime` datetime NOT NULL, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `credit_delta` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `terminal_num` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `sequence_number` varchar(255), `merchant_amount` int(11), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `status` int(11) NOT NULL, `ref_id` varchar(255), `internal_seq_num` int(11) DEFAULT 0 NOT NULL, `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `checked` int(11) DEFAULT 0 NOT NULL, `voucher_used_count` int(11) DEFAULT 0 NOT NULL, `voucher_deducted_amount` int(11) DEFAULT 0 NOT NULL, `referer_external_id` varchar(255), `referer_mobile` varchar(255), `referer_id` int(11), `credit_account_external_id` varchar(255)) ENGINE=InnoDB
  [1m[36m (159.8ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_acquirer_code` USING btree ON `transaction_logs` (`acquirer_code`) [0m
  [1m[35m (191.8ms)[0m  CREATE  INDEX `index_transaction_logs_on_credit_account_id` USING btree ON `transaction_logs` (`credit_account_id`) 
  [1m[36m (210.7ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_num` USING btree ON `transaction_logs` (`merchant_num`) [0m
  [1m[35m (266.0ms)[0m  CREATE  INDEX `index_transaction_logs_on_merchant_store_id` USING btree ON `transaction_logs` (`merchant_store_id`) 
  [1m[36m (229.4ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_tag` USING btree ON `transaction_logs` (`merchant_tag`) [0m
  [1m[35m (193.2ms)[0m  CREATE UNIQUE INDEX `unique_log` USING btree ON `transaction_logs` (`ref_id`, `internal_seq_num`, `status`, `transaction_datetime`) 
  [1m[36m (212.3ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_ref_id` USING btree ON `transaction_logs` (`ref_id`) [0m
  [1m[35m (199.9ms)[0m  CREATE  INDEX `index_transaction_logs_on_terminal_num` USING btree ON `transaction_logs` (`terminal_num`) 
  [1m[36m (188.1ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_transaction_datetime` USING btree ON `transaction_logs` (`transaction_datetime`) [0m
  [1m[35m (201.1ms)[0m  CREATE  INDEX `index_transaction_logs_on_user_tag` USING btree ON `transaction_logs` (`user_tag`) 
  [1m[36m (184.7ms)[0m  [1mCREATE TABLE `transaction_post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `payment_plan_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB[0m
  [1m[35m (207.5ms)[0m  CREATE  INDEX `index_transaction_post_actions_on_payment_plan_id` USING btree ON `transaction_post_actions` (`payment_plan_id`) 
  [1m[36m (153.2ms)[0m  [1mCREATE  INDEX `index_transaction_post_actions_on_voucher_meta_id` USING btree ON `transaction_post_actions` (`voucher_meta_id`) [0m
  [1m[35m (173.7ms)[0m  CREATE TABLE `transactions` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` datetime, `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB
  [1m[36m (350.6ms)[0m  [1mCREATE  INDEX `index_transactions_on_ref_id` USING btree ON `transactions` (`ref_id`) [0m
  [1m[35m (471.0ms)[0m  CREATE TABLE `voucher_meta` (`id` int(11) auto_increment PRIMARY KEY, `valid_from` datetime, `valid_till` datetime, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `initial_amount` int(11) DEFAULT -1 NOT NULL, `amount_left` int(11) DEFAULT -1 NOT NULL, `denomination` int(11), `limit_per_account` int(11) DEFAULT -1 NOT NULL, `aliases` varchar(255) NOT NULL, `code` varchar(255) NOT NULL, `remark` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `merchant_group_id` int(11), `merchant_store_id` int(11), `applicable_type` int(11), `sequence_id` int(11), `money_condition` int(11) DEFAULT 0 NOT NULL, `issued_count` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (268.8ms)[0m  [1mCREATE UNIQUE INDEX `index_voucher_meta_on_aliases` USING btree ON `voucher_meta` (`aliases`) [0m
  [1m[35m (179.8ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_code` USING btree ON `voucher_meta` (`code`) 
  [1m[36m (211.2ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_issuer_identifier` USING btree ON `voucher_meta` (`issuer_identifier`) [0m
  [1m[35m (222.3ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_sequence_id` USING btree ON `voucher_meta` (`sequence_id`) 
  [1m[36m (177.8ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_settler_identifier` USING btree ON `voucher_meta` (`settler_identifier`) [0m
  [1m[35m (185.8ms)[0m  CREATE TABLE `voucher_stores` (`id` int(11) auto_increment PRIMARY KEY, `merchant_store_id` int(11), `voucher_meta_id` int(11)) ENGINE=InnoDB
  [1m[36m (180.3ms)[0m  [1mCREATE  INDEX `index_voucher_stores_on_merchant_store_id` USING btree ON `voucher_stores` (`merchant_store_id`) [0m
  [1m[35m (168.4ms)[0m  CREATE  INDEX `index_voucher_stores_on_voucher_meta_id` USING btree ON `voucher_stores` (`voucher_meta_id`) 
  [1m[36m (185.6ms)[0m  [1mCREATE TABLE `voucher_transaction_logs` (`id` int(11) auto_increment PRIMARY KEY, `mobile` varchar(255), `credit_account_id` int(11), `transaction_type` varchar(255), `transaction_datetime` datetime NOT NULL, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `denomination` int(11), `deducted_amount` int(11), `voucher_meta_code` varchar(255), `voucher_unique_id` varchar(255), `ref_id` varchar(255), `primary_transaction_ref_id` varchar(255), `issue_event` varchar(255), `merchant_name` varchar(255), `merchant_store_id` int(11), `merchant_num` varchar(255), `created_at` datetime, `updated_at` datetime, `checked` int(11) DEFAULT 0 NOT NULL, `voucher_sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (190.2ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_credit_account_id` USING btree ON `voucher_transaction_logs` (`credit_account_id`) 
  [1m[36m (242.6ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_issuer_identifier` USING btree ON `voucher_transaction_logs` (`issuer_identifier`) [0m
  [1m[35m (249.2ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_merchant_store_id` USING btree ON `voucher_transaction_logs` (`merchant_store_id`) 
  [1m[36m (267.5ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_primary_transaction_ref_id` USING btree ON `voucher_transaction_logs` (`primary_transaction_ref_id`) [0m
  [1m[35m (247.8ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_ref_id` USING btree ON `voucher_transaction_logs` (`ref_id`) 
  [1m[36m (311.5ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_settler_identifier` USING btree ON `voucher_transaction_logs` (`settler_identifier`) [0m
  [1m[35m (297.3ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_voucher_unique_id` USING btree ON `voucher_transaction_logs` (`voucher_unique_id`) 
  [1m[36m (266.2ms)[0m  [1mCREATE TABLE `vouchers` (`id` int(11) auto_increment PRIMARY KEY, `credit_account_id` int(11), `voucher_meta_id` int(11), `unique_id` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `used_datetime` datetime, `sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (506.9ms)[0m  CREATE  INDEX `index_vouchers_on_credit_account_id` USING btree ON `vouchers` (`credit_account_id`) 
  [1m[36m (186.8ms)[0m  [1mCREATE UNIQUE INDEX `index_vouchers_on_sequence_number_and_voucher_meta_id` USING btree ON `vouchers` (`sequence_number`, `voucher_meta_id`) [0m
  [1m[35m (253.6ms)[0m  CREATE UNIQUE INDEX `index_vouchers_on_unique_id` USING btree ON `vouchers` (`unique_id`) 
  [1m[36m (188.4ms)[0m  [1mCREATE  INDEX `index_vouchers_on_voucher_meta_id` USING btree ON `vouchers` (`voucher_meta_id`) [0m
  [1m[35m (201.0ms)[0m  ALTER TABLE `credit_cashing_applications` ADD CONSTRAINT `fk_cashing_application_credit_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE
  [1m[36m (178.4ms)[0m  [1mALTER TABLE `payment_media` ADD CONSTRAINT `fk_payment_media_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE[0m
  [1m[35m (165.7ms)[0m  ALTER TABLE `payment_plans` ADD CONSTRAINT `fk_store_payment_plan` FOREIGN KEY (`merchant_store_id`) REFERENCES `merchant_stores`(id) ON DELETE CASCADE
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20140824130901')
  [1m[36m (0.5ms)[0m  [1mCOMMIT[0m
Migrating to CreateTransactionLogPartitions (20140824130902)
  [1m[35m (181.9ms)[0m  alter table transaction_logs drop primary key, add primary key(id, transaction_datetime);
  [1m[36m (366.0ms)[0m  [1m        ALTER TABLE transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );
[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `schema_migrations` (`version`) VALUES ('20140824130902')[0m
  [1m[35m (0.5ms)[0m  COMMIT
Migrating to CreateVoucherTransactionLogPartitions (20140824130903)
  [1m[36m (277.8ms)[0m  [1malter table transaction_logs drop primary key, add primary key(id, transaction_datetime)[0m
  [1m[35m (221.4ms)[0m          ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

Mysql2::Error: A PRIMARY KEY must include all columns in the table's partitioning function:         ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
Migrating to CreateVoucherTransactionLogPartitions (20140824130903)
  [1m[35m (117.0ms)[0m  alter table transaction_logs drop primary key, add primary key(id, transaction_datetime)
  [1m[36m (368.3ms)[0m  [1m        ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );
[0m
Mysql2::Error: A PRIMARY KEY must include all columns in the table's partitioning function:         ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
Migrating to CreateVoucherTransactionLogPartitions (20140824130903)
  [1m[35m (116.4ms)[0m  alter table transaction_logs drop primary key, add primary key(id, transaction_datetime);
  [1m[36m (251.3ms)[0m  [1m        ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );
[0m
Mysql2::Error: A PRIMARY KEY must include all columns in the table's partitioning function:         ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

  [1m[36m (113.1ms)[0m  [1mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL) ENGINE=InnoDB[0m
  [1m[35m (392.0ms)[0m  CREATE UNIQUE INDEX `unique_schema_migrations`  ON `schema_migrations` (`version`) 
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
Migrating to InitSchema (20140824130901)
  [1m[35m (148.5ms)[0m  CREATE TABLE `acquirer_org` (`id` int(11) auto_increment PRIMARY KEY, `acquirer_name` varchar(255), `acquirer_code` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (176.6ms)[0m  [1mCREATE TABLE `activity_logs` (`id` int(11) auto_increment PRIMARY KEY, `user_name` varchar(255), `ip_address` varchar(255), `action` varchar(255), `note` varchar(255), `object` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (154.8ms)[0m  CREATE TABLE `card_bins` (`id` int(11) auto_increment PRIMARY KEY, `card_code` varchar(255), `bank_name` varchar(255), `length` int(11), `bank_bin` varchar(255), `organization` int(11), `card_type` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (147.5ms)[0m  [1mCREATE  INDEX `index_card_bins_on_bank_bin` USING btree ON `card_bins` (`bank_bin`) [0m
  [1m[35m (145.5ms)[0m  CREATE  INDEX `index_card_bins_on_bank_name` USING btree ON `card_bins` (`bank_name`) 
  [1m[36m (186.3ms)[0m  [1mCREATE TABLE `configurations` (`id` int(11) auto_increment PRIMARY KEY, `key` varchar(255), `value` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (177.3ms)[0m  CREATE TABLE `credit_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_type` varchar(255), `name` varchar(255), `address` varchar(255), `mobile` varchar(255), `external_id` varchar(255) NOT NULL, `total_credit` int(11) DEFAULT 0 NOT NULL, `usable_credit` int(11) DEFAULT 0 NOT NULL, `locked_credit` int(11) DEFAULT 0 NOT NULL, `cashed_credit` int(11) DEFAULT 0 NOT NULL, `referer_credit` int(11) DEFAULT 0 NOT NULL, `referee_credit` int(11) DEFAULT 0 NOT NULL, `consumption_credit` int(11) DEFAULT 0 NOT NULL, `consumption_times` int(11) DEFAULT 0 NOT NULL, `referer_account_id` int(11), `lock_version` int(11), `status` int(11) DEFAULT 1 NOT NULL, `created_at` datetime, `updated_at` datetime, `tag` varchar(255)) ENGINE=InnoDB
  [1m[36m (158.9ms)[0m  [1mCREATE UNIQUE INDEX `credit_account_external_id` USING btree ON `credit_accounts` (`external_id`) [0m
  [1m[35m (189.5ms)[0m  CREATE UNIQUE INDEX `index_credit_accounts_on_mobile` USING btree ON `credit_accounts` (`mobile`) 
  [1m[36m (188.8ms)[0m  [1mCREATE  INDEX `index_credit_accounts_on_tag` USING btree ON `credit_accounts` (`tag`) [0m
  [1m[35m (174.7ms)[0m  CREATE TABLE `credit_cashing_applications` (`id` int(11) auto_increment PRIMARY KEY, `bank_card` varchar(255), `bank_name` varchar(255), `real_name` varchar(255), `amount` int(11), `status` int(11) DEFAULT 101 NOT NULL, `comment` varchar(255), `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (179.6ms)[0m  [1mCREATE  INDEX `fk_cashing_application_credit_accounts` USING btree ON `credit_cashing_applications` (`credit_account_id`) [0m
  [1m[35m (216.5ms)[0m  CREATE TABLE `marketing_rules` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `rule_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB
  [1m[36m (169.1ms)[0m  [1mCREATE TABLE `marketing_rules_payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `marketing_rule_id` int(11), `payment_plan_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (181.3ms)[0m  CREATE  INDEX `index_marketing_rules_payment_plans_on_marketing_rule_id` USING btree ON `marketing_rules_payment_plans` (`marketing_rule_id`) 
  [1m[36m (145.1ms)[0m  [1mCREATE  INDEX `index_marketing_rules_payment_plans_on_payment_plan_id` USING btree ON `marketing_rules_payment_plans` (`payment_plan_id`) [0m
  [1m[35m (162.7ms)[0m  CREATE TABLE `member_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `member_group_id` int(11), `member_group_type` varchar(255), `credit_account_id` int(11)) ENGINE=InnoDB
  [1m[36m (168.8ms)[0m  [1mCREATE  INDEX `index_member_ships_on_credit_account_id` USING btree ON `member_ships` (`credit_account_id`) [0m
  [1m[35m (145.1ms)[0m  CREATE  INDEX `index_member_ships_on_member_group_id_and_member_group_type` USING btree ON `member_ships` (`member_group_id`, `member_group_type`) 
  [1m[36m (176.9ms)[0m  [1mCREATE TABLE `merchant_group_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `merchant_group_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (179.1ms)[0m  CREATE  INDEX `index_merchant_group_ships_on_merchant_group_id` USING btree ON `merchant_group_ships` (`merchant_group_id`) 
  [1m[36m (167.7ms)[0m  [1mCREATE  INDEX `index_merchant_group_ships_on_merchant_store_id` USING btree ON `merchant_group_ships` (`merchant_store_id`) [0m
  [1m[35m (175.5ms)[0m  CREATE TABLE `merchant_groups` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255), `display_name` varchar(255)) ENGINE=InnoDB
  [1m[36m (169.3ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_groups_on_name` USING btree ON `merchant_groups` (`name`) [0m
  [1m[35m (151.5ms)[0m  CREATE TABLE `merchant_stores` (`id` int(11) auto_increment PRIMARY KEY, `name` varchar(255) NOT NULL, `merchant_number` varchar(255) NOT NULL, `license_name` varchar(255), `license_num` varchar(255), `license_expire_date` varchar(255), `tax_number` varchar(255), `organization_code` varchar(255), `legal_person` varchar(255), `legal_person_ic` varchar(255), `register_address` varchar(255), `real_address` varchar(255), `business_scope` varchar(255), `real_business_scope` varchar(255), `contract_num` varchar(255), `contract_active_date` datetime, `contractor` varchar(255), `file_num` varchar(255), `finance_contact_name` varchar(255), `finance_contact_phone` varchar(255), `public_account_name` varchar(255), `public_account_num` varchar(255), `public_account_bank` varchar(255), `clearance_account_name` varchar(255), `clearance_account_num` varchar(255), `clearance_account_bank` varchar(255), `deploy_contact_name` varchar(255), `deploy_contact_phone` varchar(255), `status` varchar(255), `standard_rate` decimal(12,9) NOT NULL, `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime, `accquire_org_id` int(11), `tag` varchar(255), `accept_global_voucher` tinyint(1) NOT NULL, `accept_own_voucher` tinyint(1) DEFAULT 0 NOT NULL, `notification_mobile` varchar(255)) ENGINE=InnoDB
  [1m[36m (158.3ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_stores_on_merchant_number` USING btree ON `merchant_stores` (`merchant_number`) [0m
  [1m[35m (155.7ms)[0m  CREATE  INDEX `index_merchant_stores_on_tag` USING btree ON `merchant_stores` (`tag`) 
  [1m[36m (153.3ms)[0m  [1mCREATE TABLE `payment_media` (`id` int(11) auto_increment PRIMARY KEY, `media_type` varchar(255), `media_num` varchar(255), `card_type` varchar(255), `bank_name` varchar(255), `cashing_card` tinyint(1) DEFAULT 0 NOT NULL, `credit_account_id` int(11), `credit_earned` int(11) DEFAULT 0 NOT NULL, `lock_version` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (167.3ms)[0m  CREATE  INDEX `fk_payment_media_accounts` USING btree ON `payment_media` (`credit_account_id`) 
  [1m[36m (146.7ms)[0m  [1mCREATE UNIQUE INDEX `media_num` USING btree ON `payment_media` (`media_num`, `media_type`) [0m
  [1m[35m (162.8ms)[0m  CREATE TABLE `payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `plan_type` varchar(255), `merchant_rate` decimal(12,9), `customer_rate` decimal(12,9), `referer_rate` decimal(12,9), `discount_amount` int(11), `discount_rate` decimal(12,9), `card_bin_id` int(11), `merchant_store_id` int(11), `created_at` datetime, `updated_at` datetime, `status` int(11) DEFAULT 0 NOT NULL, `valid_from` datetime, `valid_till` datetime, `discount_type` varchar(255), `bank_name` varchar(255), `minimal_money_amount` int(11) DEFAULT 0 NOT NULL, `voucher_status` int(11), `user_tag` varchar(255), `user_type` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (192.0ms)[0m  [1mCREATE  INDEX `fk_store_payment_plan` USING btree ON `payment_plans` (`merchant_store_id`) [0m
  [1m[35m (153.8ms)[0m  CREATE TABLE `platform_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_name` varchar(255) NOT NULL, `access_key` varchar(255) NOT NULL, `access_target` varchar(255) NOT NULL, `remark` varchar(255), `created_at` datetime, `updated_at` datetime, `status` varchar(255)) ENGINE=InnoDB
  [1m[36m (179.9ms)[0m  [1mCREATE UNIQUE INDEX `platform_account_account_name` USING btree ON `platform_accounts` (`account_name`) [0m
  [1m[35m (205.3ms)[0m  CREATE TABLE `post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `marketing_rule_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `voucher_count` int(11)) ENGINE=InnoDB
  [1m[36m (179.9ms)[0m  [1mCREATE TABLE `sequence_numbers` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `number` varchar(255), `used` tinyint(1) DEFAULT 0 NOT NULL, `sequence_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (192.1ms)[0m  CREATE UNIQUE INDEX `index_sequence_numbers_on_number_and_sequence_id` USING btree ON `sequence_numbers` (`number`, `sequence_id`) 
  [1m[36m (163.0ms)[0m  [1mCREATE TABLE `sequences` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (165.6ms)[0m  CREATE TABLE `system_users` (`id` int(11) auto_increment PRIMARY KEY, `real_name` varchar(255), `name` varchar(255), `password_digest` varchar(255), `role_name` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (154.9ms)[0m  [1mCREATE TABLE `transaction_archives` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` varchar(255), `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (143.0ms)[0m  CREATE TABLE `transaction_logs` (`id` int(11) auto_increment PRIMARY KEY, `log_type` int(11), `transaction_datetime` datetime NOT NULL, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `credit_delta` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `terminal_num` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `sequence_number` varchar(255), `merchant_amount` int(11), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `status` int(11) NOT NULL, `ref_id` varchar(255), `internal_seq_num` int(11) DEFAULT 0 NOT NULL, `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `checked` int(11) DEFAULT 0 NOT NULL, `voucher_used_count` int(11) DEFAULT 0 NOT NULL, `voucher_deducted_amount` int(11) DEFAULT 0 NOT NULL, `referer_external_id` varchar(255), `referer_mobile` varchar(255), `referer_id` int(11), `credit_account_external_id` varchar(255)) ENGINE=InnoDB
  [1m[36m (169.2ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_acquirer_code` USING btree ON `transaction_logs` (`acquirer_code`) [0m
  [1m[35m (209.3ms)[0m  CREATE  INDEX `index_transaction_logs_on_credit_account_id` USING btree ON `transaction_logs` (`credit_account_id`) 
  [1m[36m (275.6ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_num` USING btree ON `transaction_logs` (`merchant_num`) [0m
  [1m[35m (198.6ms)[0m  CREATE  INDEX `index_transaction_logs_on_merchant_store_id` USING btree ON `transaction_logs` (`merchant_store_id`) 
  [1m[36m (178.0ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_tag` USING btree ON `transaction_logs` (`merchant_tag`) [0m
  [1m[35m (177.5ms)[0m  CREATE UNIQUE INDEX `unique_log` USING btree ON `transaction_logs` (`ref_id`, `internal_seq_num`, `status`, `transaction_datetime`) 
  [1m[36m (179.9ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_ref_id` USING btree ON `transaction_logs` (`ref_id`) [0m
  [1m[35m (165.0ms)[0m  CREATE  INDEX `index_transaction_logs_on_terminal_num` USING btree ON `transaction_logs` (`terminal_num`) 
  [1m[36m (189.1ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_transaction_datetime` USING btree ON `transaction_logs` (`transaction_datetime`) [0m
  [1m[35m (188.6ms)[0m  CREATE  INDEX `index_transaction_logs_on_user_tag` USING btree ON `transaction_logs` (`user_tag`) 
  [1m[36m (186.6ms)[0m  [1mCREATE TABLE `transaction_post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `payment_plan_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB[0m
  [1m[35m (190.1ms)[0m  CREATE  INDEX `index_transaction_post_actions_on_payment_plan_id` USING btree ON `transaction_post_actions` (`payment_plan_id`) 
  [1m[36m (168.4ms)[0m  [1mCREATE  INDEX `index_transaction_post_actions_on_voucher_meta_id` USING btree ON `transaction_post_actions` (`voucher_meta_id`) [0m
  [1m[35m (225.3ms)[0m  CREATE TABLE `transactions` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` datetime, `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB
  [1m[36m (479.7ms)[0m  [1mCREATE  INDEX `index_transactions_on_ref_id` USING btree ON `transactions` (`ref_id`) [0m
  [1m[35m (437.2ms)[0m  CREATE TABLE `voucher_meta` (`id` int(11) auto_increment PRIMARY KEY, `valid_from` datetime, `valid_till` datetime, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `initial_amount` int(11) DEFAULT -1 NOT NULL, `amount_left` int(11) DEFAULT -1 NOT NULL, `denomination` int(11), `limit_per_account` int(11) DEFAULT -1 NOT NULL, `aliases` varchar(255) NOT NULL, `code` varchar(255) NOT NULL, `remark` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `merchant_group_id` int(11), `merchant_store_id` int(11), `applicable_type` int(11), `sequence_id` int(11), `money_condition` int(11) DEFAULT 0 NOT NULL, `issued_count` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (224.7ms)[0m  [1mCREATE UNIQUE INDEX `index_voucher_meta_on_aliases` USING btree ON `voucher_meta` (`aliases`) [0m
  [1m[35m (449.3ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_code` USING btree ON `voucher_meta` (`code`) 
  [1m[36m (653.0ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_issuer_identifier` USING btree ON `voucher_meta` (`issuer_identifier`) [0m
  [1m[35m (158.6ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_sequence_id` USING btree ON `voucher_meta` (`sequence_id`) 
  [1m[36m (216.9ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_settler_identifier` USING btree ON `voucher_meta` (`settler_identifier`) [0m
  [1m[35m (179.1ms)[0m  CREATE TABLE `voucher_stores` (`id` int(11) auto_increment PRIMARY KEY, `merchant_store_id` int(11), `voucher_meta_id` int(11)) ENGINE=InnoDB
  [1m[36m (215.2ms)[0m  [1mCREATE  INDEX `index_voucher_stores_on_merchant_store_id` USING btree ON `voucher_stores` (`merchant_store_id`) [0m
  [1m[35m (177.4ms)[0m  CREATE  INDEX `index_voucher_stores_on_voucher_meta_id` USING btree ON `voucher_stores` (`voucher_meta_id`) 
  [1m[36m (187.1ms)[0m  [1mCREATE TABLE `voucher_transaction_logs` (`id` int(11) auto_increment PRIMARY KEY, `mobile` varchar(255), `credit_account_id` int(11), `transaction_type` varchar(255), `transaction_datetime` datetime NOT NULL, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `denomination` int(11), `deducted_amount` int(11), `voucher_meta_code` varchar(255), `voucher_unique_id` varchar(255), `ref_id` varchar(255), `primary_transaction_ref_id` varchar(255), `issue_event` varchar(255), `merchant_name` varchar(255), `merchant_store_id` int(11), `merchant_num` varchar(255), `created_at` datetime, `updated_at` datetime, `checked` int(11) DEFAULT 0 NOT NULL, `voucher_sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (213.8ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_credit_account_id` USING btree ON `voucher_transaction_logs` (`credit_account_id`) 
  [1m[36m (179.1ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_issuer_identifier` USING btree ON `voucher_transaction_logs` (`issuer_identifier`) [0m
  [1m[35m (187.8ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_merchant_store_id` USING btree ON `voucher_transaction_logs` (`merchant_store_id`) 
  [1m[36m (189.7ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_primary_transaction_ref_id` USING btree ON `voucher_transaction_logs` (`primary_transaction_ref_id`) [0m
  [1m[35m (200.7ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_ref_id` USING btree ON `voucher_transaction_logs` (`ref_id`) 
  [1m[36m (177.9ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_settler_identifier` USING btree ON `voucher_transaction_logs` (`settler_identifier`) [0m
  [1m[35m (222.0ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_voucher_unique_id` USING btree ON `voucher_transaction_logs` (`voucher_unique_id`) 
  [1m[36m (188.3ms)[0m  [1mCREATE TABLE `vouchers` (`id` int(11) auto_increment PRIMARY KEY, `credit_account_id` int(11), `voucher_meta_id` int(11), `unique_id` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `used_datetime` datetime, `sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (222.7ms)[0m  CREATE  INDEX `index_vouchers_on_credit_account_id` USING btree ON `vouchers` (`credit_account_id`) 
  [1m[36m (202.3ms)[0m  [1mCREATE UNIQUE INDEX `index_vouchers_on_sequence_number_and_voucher_meta_id` USING btree ON `vouchers` (`sequence_number`, `voucher_meta_id`) [0m
  [1m[35m (188.9ms)[0m  CREATE UNIQUE INDEX `index_vouchers_on_unique_id` USING btree ON `vouchers` (`unique_id`) 
  [1m[36m (200.3ms)[0m  [1mCREATE  INDEX `index_vouchers_on_voucher_meta_id` USING btree ON `vouchers` (`voucher_meta_id`) [0m
  [1m[35m (199.6ms)[0m  ALTER TABLE `credit_cashing_applications` ADD CONSTRAINT `fk_cashing_application_credit_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE
  [1m[36m (210.5ms)[0m  [1mALTER TABLE `payment_media` ADD CONSTRAINT `fk_payment_media_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE[0m
  [1m[35m (207.2ms)[0m  ALTER TABLE `payment_plans` ADD CONSTRAINT `fk_store_payment_plan` FOREIGN KEY (`merchant_store_id`) REFERENCES `merchant_stores`(id) ON DELETE CASCADE
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20140824130901')
  [1m[36m (0.4ms)[0m  [1mCOMMIT[0m
Migrating to CreateTransactionLogPartitions (20140824130902)
  [1m[35m (227.6ms)[0m  alter table transaction_logs drop primary key, add primary key(id, transaction_datetime);
  [1m[36m (346.1ms)[0m  [1m        ALTER TABLE transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );
[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `schema_migrations` (`version`) VALUES ('20140824130902')[0m
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to CreateVoucherTransactionLogPartitions (20140824130903)
  [1m[36m (211.0ms)[0m  [1malter table transaction_logs drop primary key, add primary key(id, transaction_datetime);[0m
  [1m[35m (165.1ms)[0m          ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

Mysql2::Error: A PRIMARY KEY must include all columns in the table's partitioning function:         ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

  [1m[36m (483.3ms)[0m  [1mCREATE TABLE `schema_migrations` (`version` varchar(255) NOT NULL) ENGINE=InnoDB[0m
  [1m[35m (317.7ms)[0m  CREATE UNIQUE INDEX `unique_schema_migrations`  ON `schema_migrations` (`version`) 
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
Migrating to InitSchema (20140824130901)
  [1m[35m (178.3ms)[0m  CREATE TABLE `acquirer_org` (`id` int(11) auto_increment PRIMARY KEY, `acquirer_name` varchar(255), `acquirer_code` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (165.4ms)[0m  [1mCREATE TABLE `activity_logs` (`id` int(11) auto_increment PRIMARY KEY, `user_name` varchar(255), `ip_address` varchar(255), `action` varchar(255), `note` varchar(255), `object` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (155.0ms)[0m  CREATE TABLE `card_bins` (`id` int(11) auto_increment PRIMARY KEY, `card_code` varchar(255), `bank_name` varchar(255), `length` int(11), `bank_bin` varchar(255), `organization` int(11), `card_type` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (171.8ms)[0m  [1mCREATE  INDEX `index_card_bins_on_bank_bin` USING btree ON `card_bins` (`bank_bin`) [0m
  [1m[35m (155.5ms)[0m  CREATE  INDEX `index_card_bins_on_bank_name` USING btree ON `card_bins` (`bank_name`) 
  [1m[36m (174.2ms)[0m  [1mCREATE TABLE `configurations` (`id` int(11) auto_increment PRIMARY KEY, `key` varchar(255), `value` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (175.8ms)[0m  CREATE TABLE `credit_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_type` varchar(255), `name` varchar(255), `address` varchar(255), `mobile` varchar(255), `external_id` varchar(255) NOT NULL, `total_credit` int(11) DEFAULT 0 NOT NULL, `usable_credit` int(11) DEFAULT 0 NOT NULL, `locked_credit` int(11) DEFAULT 0 NOT NULL, `cashed_credit` int(11) DEFAULT 0 NOT NULL, `referer_credit` int(11) DEFAULT 0 NOT NULL, `referee_credit` int(11) DEFAULT 0 NOT NULL, `consumption_credit` int(11) DEFAULT 0 NOT NULL, `consumption_times` int(11) DEFAULT 0 NOT NULL, `referer_account_id` int(11), `lock_version` int(11), `status` int(11) DEFAULT 1 NOT NULL, `created_at` datetime, `updated_at` datetime, `tag` varchar(255)) ENGINE=InnoDB
  [1m[36m (158.2ms)[0m  [1mCREATE UNIQUE INDEX `credit_account_external_id` USING btree ON `credit_accounts` (`external_id`) [0m
  [1m[35m (169.0ms)[0m  CREATE UNIQUE INDEX `index_credit_accounts_on_mobile` USING btree ON `credit_accounts` (`mobile`) 
  [1m[36m (187.9ms)[0m  [1mCREATE  INDEX `index_credit_accounts_on_tag` USING btree ON `credit_accounts` (`tag`) [0m
  [1m[35m (186.2ms)[0m  CREATE TABLE `credit_cashing_applications` (`id` int(11) auto_increment PRIMARY KEY, `bank_card` varchar(255), `bank_name` varchar(255), `real_name` varchar(255), `amount` int(11), `status` int(11) DEFAULT 101 NOT NULL, `comment` varchar(255), `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (190.9ms)[0m  [1mCREATE  INDEX `fk_cashing_application_credit_accounts` USING btree ON `credit_cashing_applications` (`credit_account_id`) [0m
  [1m[35m (165.7ms)[0m  CREATE TABLE `marketing_rules` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `rule_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB
  [1m[36m (187.3ms)[0m  [1mCREATE TABLE `marketing_rules_payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `marketing_rule_id` int(11), `payment_plan_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (159.8ms)[0m  CREATE  INDEX `index_marketing_rules_payment_plans_on_marketing_rule_id` USING btree ON `marketing_rules_payment_plans` (`marketing_rule_id`) 
  [1m[36m (155.2ms)[0m  [1mCREATE  INDEX `index_marketing_rules_payment_plans_on_payment_plan_id` USING btree ON `marketing_rules_payment_plans` (`payment_plan_id`) [0m
  [1m[35m (218.7ms)[0m  CREATE TABLE `member_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `member_group_id` int(11), `member_group_type` varchar(255), `credit_account_id` int(11)) ENGINE=InnoDB
  [1m[36m (192.8ms)[0m  [1mCREATE  INDEX `index_member_ships_on_credit_account_id` USING btree ON `member_ships` (`credit_account_id`) [0m
  [1m[35m (211.0ms)[0m  CREATE  INDEX `index_member_ships_on_member_group_id_and_member_group_type` USING btree ON `member_ships` (`member_group_id`, `member_group_type`) 
  [1m[36m (174.9ms)[0m  [1mCREATE TABLE `merchant_group_ships` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `merchant_store_id` int(11), `merchant_group_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (179.4ms)[0m  CREATE  INDEX `index_merchant_group_ships_on_merchant_group_id` USING btree ON `merchant_group_ships` (`merchant_group_id`) 
  [1m[36m (156.3ms)[0m  [1mCREATE  INDEX `index_merchant_group_ships_on_merchant_store_id` USING btree ON `merchant_group_ships` (`merchant_store_id`) [0m
  [1m[35m (186.1ms)[0m  CREATE TABLE `merchant_groups` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255), `display_name` varchar(255)) ENGINE=InnoDB
  [1m[36m (180.0ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_groups_on_name` USING btree ON `merchant_groups` (`name`) [0m
  [1m[35m (167.5ms)[0m  CREATE TABLE `merchant_stores` (`id` int(11) auto_increment PRIMARY KEY, `name` varchar(255) NOT NULL, `merchant_number` varchar(255) NOT NULL, `license_name` varchar(255), `license_num` varchar(255), `license_expire_date` varchar(255), `tax_number` varchar(255), `organization_code` varchar(255), `legal_person` varchar(255), `legal_person_ic` varchar(255), `register_address` varchar(255), `real_address` varchar(255), `business_scope` varchar(255), `real_business_scope` varchar(255), `contract_num` varchar(255), `contract_active_date` datetime, `contractor` varchar(255), `file_num` varchar(255), `finance_contact_name` varchar(255), `finance_contact_phone` varchar(255), `public_account_name` varchar(255), `public_account_num` varchar(255), `public_account_bank` varchar(255), `clearance_account_name` varchar(255), `clearance_account_num` varchar(255), `clearance_account_bank` varchar(255), `deploy_contact_name` varchar(255), `deploy_contact_phone` varchar(255), `status` varchar(255), `standard_rate` decimal(12,9) NOT NULL, `credit_account_id` int(11), `created_at` datetime, `updated_at` datetime, `accquire_org_id` int(11), `tag` varchar(255), `accept_global_voucher` tinyint(1) NOT NULL, `accept_own_voucher` tinyint(1) DEFAULT 0 NOT NULL, `notification_mobile` varchar(255)) ENGINE=InnoDB
  [1m[36m (188.7ms)[0m  [1mCREATE UNIQUE INDEX `index_merchant_stores_on_merchant_number` USING btree ON `merchant_stores` (`merchant_number`) [0m
  [1m[35m (190.3ms)[0m  CREATE  INDEX `index_merchant_stores_on_tag` USING btree ON `merchant_stores` (`tag`) 
  [1m[36m (207.8ms)[0m  [1mCREATE TABLE `payment_media` (`id` int(11) auto_increment PRIMARY KEY, `media_type` varchar(255), `media_num` varchar(255), `card_type` varchar(255), `bank_name` varchar(255), `cashing_card` tinyint(1) DEFAULT 0 NOT NULL, `credit_account_id` int(11), `credit_earned` int(11) DEFAULT 0 NOT NULL, `lock_version` int(11), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB[0m
  [1m[35m (202.2ms)[0m  CREATE  INDEX `fk_payment_media_accounts` USING btree ON `payment_media` (`credit_account_id`) 
  [1m[36m (168.3ms)[0m  [1mCREATE UNIQUE INDEX `media_num` USING btree ON `payment_media` (`media_num`, `media_type`) [0m
  [1m[35m (195.7ms)[0m  CREATE TABLE `payment_plans` (`id` int(11) auto_increment PRIMARY KEY, `plan_type` varchar(255), `merchant_rate` decimal(12,9), `customer_rate` decimal(12,9), `referer_rate` decimal(12,9), `discount_amount` int(11), `discount_rate` decimal(12,9), `card_bin_id` int(11), `merchant_store_id` int(11), `created_at` datetime, `updated_at` datetime, `status` int(11) DEFAULT 0 NOT NULL, `valid_from` datetime, `valid_till` datetime, `discount_type` varchar(255), `bank_name` varchar(255), `minimal_money_amount` int(11) DEFAULT 0 NOT NULL, `voucher_status` int(11), `user_tag` varchar(255), `user_type` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (201.9ms)[0m  [1mCREATE  INDEX `fk_store_payment_plan` USING btree ON `payment_plans` (`merchant_store_id`) [0m
  [1m[35m (164.6ms)[0m  CREATE TABLE `platform_accounts` (`id` int(11) auto_increment PRIMARY KEY, `account_name` varchar(255) NOT NULL, `access_key` varchar(255) NOT NULL, `access_target` varchar(255) NOT NULL, `remark` varchar(255), `created_at` datetime, `updated_at` datetime, `status` varchar(255)) ENGINE=InnoDB
  [1m[36m (209.9ms)[0m  [1mCREATE UNIQUE INDEX `platform_account_account_name` USING btree ON `platform_accounts` (`account_name`) [0m
  [1m[35m (178.6ms)[0m  CREATE TABLE `post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `marketing_rule_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `voucher_count` int(11)) ENGINE=InnoDB
  [1m[36m (187.5ms)[0m  [1mCREATE TABLE `sequence_numbers` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `number` varchar(255), `used` tinyint(1) DEFAULT 0 NOT NULL, `sequence_id` int(11)) ENGINE=InnoDB[0m
  [1m[35m (147.8ms)[0m  CREATE UNIQUE INDEX `index_sequence_numbers_on_number_and_sequence_id` USING btree ON `sequence_numbers` (`number`, `sequence_id`) 
  [1m[36m (154.7ms)[0m  [1mCREATE TABLE `sequences` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `name` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (198.2ms)[0m  CREATE TABLE `system_users` (`id` int(11) auto_increment PRIMARY KEY, `real_name` varchar(255), `name` varchar(255), `password_digest` varchar(255), `role_name` varchar(255), `created_at` datetime, `updated_at` datetime) ENGINE=InnoDB
  [1m[36m (154.4ms)[0m  [1mCREATE TABLE `transaction_archives` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime NOT NULL, `updated_at` datetime NOT NULL, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` varchar(255), `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (154.9ms)[0m  CREATE TABLE `transaction_logs` (`id` int(11) auto_increment PRIMARY KEY, `log_type` int(11), `transaction_datetime` datetime NOT NULL, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `credit_delta` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `terminal_num` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `sequence_number` varchar(255), `merchant_amount` int(11), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `status` int(11) NOT NULL, `ref_id` varchar(255), `internal_seq_num` int(11) DEFAULT 0 NOT NULL, `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `checked` int(11) DEFAULT 0 NOT NULL, `voucher_used_count` int(11) DEFAULT 0 NOT NULL, `voucher_deducted_amount` int(11) DEFAULT 0 NOT NULL, `referer_external_id` varchar(255), `referer_mobile` varchar(255), `referer_id` int(11), `credit_account_external_id` varchar(255)) ENGINE=InnoDB
  [1m[36m (158.9ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_acquirer_code` USING btree ON `transaction_logs` (`acquirer_code`) [0m
  [1m[35m (167.5ms)[0m  CREATE  INDEX `index_transaction_logs_on_credit_account_id` USING btree ON `transaction_logs` (`credit_account_id`) 
  [1m[36m (200.9ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_num` USING btree ON `transaction_logs` (`merchant_num`) [0m
  [1m[35m (188.8ms)[0m  CREATE  INDEX `index_transaction_logs_on_merchant_store_id` USING btree ON `transaction_logs` (`merchant_store_id`) 
  [1m[36m (241.8ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_merchant_tag` USING btree ON `transaction_logs` (`merchant_tag`) [0m
  [1m[35m (215.9ms)[0m  CREATE UNIQUE INDEX `unique_log` USING btree ON `transaction_logs` (`ref_id`, `internal_seq_num`, `status`, `transaction_datetime`) 
  [1m[36m (199.8ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_ref_id` USING btree ON `transaction_logs` (`ref_id`) [0m
  [1m[35m (219.0ms)[0m  CREATE  INDEX `index_transaction_logs_on_terminal_num` USING btree ON `transaction_logs` (`terminal_num`) 
  [1m[36m (180.2ms)[0m  [1mCREATE  INDEX `index_transaction_logs_on_transaction_datetime` USING btree ON `transaction_logs` (`transaction_datetime`) [0m
  [1m[35m (201.5ms)[0m  CREATE  INDEX `index_transaction_logs_on_user_tag` USING btree ON `transaction_logs` (`user_tag`) 
  [1m[36m (197.2ms)[0m  [1mCREATE TABLE `transaction_post_actions` (`id` int(11) auto_increment PRIMARY KEY, `created_at` datetime, `updated_at` datetime, `payment_plan_id` int(11), `voucher_meta_id` int(11), `action_type` varchar(255), `money_condition` int(11), `accumulated_money_condition` int(11), `accumulated_consumption_time_condition` int(11), `valid_from` datetime, `valid_till` datetime, `status` int(11)) ENGINE=InnoDB[0m
  [1m[35m (243.7ms)[0m  CREATE  INDEX `index_transaction_post_actions_on_payment_plan_id` USING btree ON `transaction_post_actions` (`payment_plan_id`) 
  [1m[36m (459.1ms)[0m  [1mCREATE  INDEX `index_transaction_post_actions_on_voucher_meta_id` USING btree ON `transaction_post_actions` (`voucher_meta_id`) [0m
  [1m[35m (566.7ms)[0m  CREATE TABLE `transactions` (`id` int(11) auto_increment PRIMARY KEY, `transaction_type` varchar(255), `money_amount` int(11), `actual_money_amount` int(11), `payment_plan_id` int(11), `credit_account_id` int(11), `merchant_store_id` int(11), `consumer_credit` int(11), `referer_credit` int(11), `mobile` varchar(255), `customer_name` varchar(255), `merchant_name` varchar(255), `media_num` varchar(255), `media_type` varchar(255), `created_at` datetime, `updated_at` datetime, `merchant_num` varchar(255), `plan_type` varchar(255), `matched_bank` varchar(255), `ref_id` varchar(255), `confirmed` tinyint(1) DEFAULT 0 NOT NULL, `sequence_num` varchar(255), `transaction_datetime` datetime, `terminal_num` varchar(255), `merchant_amount` int(11), `status` int(11), `reason` varchar(255), `roll_back_ref` varchar(255), `acquirer_code` varchar(255), `merchant_tag` varchar(255), `user_tag` varchar(255), `merchant_rate` decimal(12,9), `voucher_info` varchar(255)) ENGINE=InnoDB
  [1m[36m (448.6ms)[0m  [1mCREATE  INDEX `index_transactions_on_ref_id` USING btree ON `transactions` (`ref_id`) [0m
  [1m[35m (553.9ms)[0m  CREATE TABLE `voucher_meta` (`id` int(11) auto_increment PRIMARY KEY, `valid_from` datetime, `valid_till` datetime, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `initial_amount` int(11) DEFAULT -1 NOT NULL, `amount_left` int(11) DEFAULT -1 NOT NULL, `denomination` int(11), `limit_per_account` int(11) DEFAULT -1 NOT NULL, `aliases` varchar(255) NOT NULL, `code` varchar(255) NOT NULL, `remark` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `merchant_group_id` int(11), `merchant_store_id` int(11), `applicable_type` int(11), `sequence_id` int(11), `money_condition` int(11) DEFAULT 0 NOT NULL, `issued_count` int(11) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (494.1ms)[0m  [1mCREATE UNIQUE INDEX `index_voucher_meta_on_aliases` USING btree ON `voucher_meta` (`aliases`) [0m
  [1m[35m (276.0ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_code` USING btree ON `voucher_meta` (`code`) 
  [1m[36m (189.3ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_issuer_identifier` USING btree ON `voucher_meta` (`issuer_identifier`) [0m
  [1m[35m (189.2ms)[0m  CREATE UNIQUE INDEX `index_voucher_meta_on_sequence_id` USING btree ON `voucher_meta` (`sequence_id`) 
  [1m[36m (210.1ms)[0m  [1mCREATE  INDEX `index_voucher_meta_on_settler_identifier` USING btree ON `voucher_meta` (`settler_identifier`) [0m
  [1m[35m (221.6ms)[0m  CREATE TABLE `voucher_stores` (`id` int(11) auto_increment PRIMARY KEY, `merchant_store_id` int(11), `voucher_meta_id` int(11)) ENGINE=InnoDB
  [1m[36m (222.6ms)[0m  [1mCREATE  INDEX `index_voucher_stores_on_merchant_store_id` USING btree ON `voucher_stores` (`merchant_store_id`) [0m
  [1m[35m (179.8ms)[0m  CREATE  INDEX `index_voucher_stores_on_voucher_meta_id` USING btree ON `voucher_stores` (`voucher_meta_id`) 
  [1m[36m (218.2ms)[0m  [1mCREATE TABLE `voucher_transaction_logs` (`id` int(11) auto_increment PRIMARY KEY, `mobile` varchar(255), `credit_account_id` int(11), `transaction_type` varchar(255), `transaction_datetime` datetime NOT NULL, `issuer_identifier` varchar(255), `issuer_name` varchar(255), `issuer_type` int(11), `settler_identifier` varchar(255), `settler_name` varchar(255), `settler_type` int(11), `denomination` int(11), `deducted_amount` int(11), `voucher_meta_code` varchar(255), `voucher_unique_id` varchar(255), `ref_id` varchar(255), `primary_transaction_ref_id` varchar(255), `issue_event` varchar(255), `merchant_name` varchar(255), `merchant_store_id` int(11), `merchant_num` varchar(255), `created_at` datetime, `updated_at` datetime, `checked` int(11) DEFAULT 0 NOT NULL, `voucher_sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (201.6ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_credit_account_id` USING btree ON `voucher_transaction_logs` (`credit_account_id`) 
  [1m[36m (170.0ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_issuer_identifier` USING btree ON `voucher_transaction_logs` (`issuer_identifier`) [0m
  [1m[35m (199.6ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_merchant_store_id` USING btree ON `voucher_transaction_logs` (`merchant_store_id`) 
  [1m[36m (202.7ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_primary_transaction_ref_id` USING btree ON `voucher_transaction_logs` (`primary_transaction_ref_id`) [0m
  [1m[35m (200.0ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_ref_id` USING btree ON `voucher_transaction_logs` (`ref_id`) 
  [1m[36m (188.1ms)[0m  [1mCREATE  INDEX `index_voucher_transaction_logs_on_settler_identifier` USING btree ON `voucher_transaction_logs` (`settler_identifier`) [0m
  [1m[35m (199.7ms)[0m  CREATE  INDEX `index_voucher_transaction_logs_on_voucher_unique_id` USING btree ON `voucher_transaction_logs` (`voucher_unique_id`) 
  [1m[36m (185.6ms)[0m  [1mCREATE TABLE `vouchers` (`id` int(11) auto_increment PRIMARY KEY, `credit_account_id` int(11), `voucher_meta_id` int(11), `unique_id` varchar(255), `status` int(11), `created_at` datetime, `updated_at` datetime, `used_datetime` datetime, `sequence_number` varchar(255)) ENGINE=InnoDB[0m
  [1m[35m (201.4ms)[0m  CREATE  INDEX `index_vouchers_on_credit_account_id` USING btree ON `vouchers` (`credit_account_id`) 
  [1m[36m (168.1ms)[0m  [1mCREATE UNIQUE INDEX `index_vouchers_on_sequence_number_and_voucher_meta_id` USING btree ON `vouchers` (`sequence_number`, `voucher_meta_id`) [0m
  [1m[35m (199.6ms)[0m  CREATE UNIQUE INDEX `index_vouchers_on_unique_id` USING btree ON `vouchers` (`unique_id`) 
  [1m[36m (219.5ms)[0m  [1mCREATE  INDEX `index_vouchers_on_voucher_meta_id` USING btree ON `vouchers` (`voucher_meta_id`) [0m
  [1m[35m (202.5ms)[0m  ALTER TABLE `credit_cashing_applications` ADD CONSTRAINT `fk_cashing_application_credit_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE
  [1m[36m (187.7ms)[0m  [1mALTER TABLE `payment_media` ADD CONSTRAINT `fk_payment_media_accounts` FOREIGN KEY (`credit_account_id`) REFERENCES `credit_accounts`(id) ON DELETE CASCADE[0m
  [1m[35m (190.6ms)[0m  ALTER TABLE `payment_plans` ADD CONSTRAINT `fk_store_payment_plan` FOREIGN KEY (`merchant_store_id`) REFERENCES `merchant_stores`(id) ON DELETE CASCADE
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20140824130901')
  [1m[36m (0.4ms)[0m  [1mCOMMIT[0m
Migrating to CreateTransactionLogPartitions (20140824130902)
  [1m[35m (194.9ms)[0m  alter table transaction_logs drop primary key, add primary key(id, transaction_datetime);
  [1m[36m (304.6ms)[0m  [1m        ALTER TABLE transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );
[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `schema_migrations` (`version`) VALUES ('20140824130902')[0m
  [1m[35m (0.4ms)[0m  COMMIT
Migrating to CreateVoucherTransactionLogPartitions (20140824130903)
  [1m[36m (212.9ms)[0m  [1malter table voucher_transaction_logs drop primary key, add primary key(id, transaction_datetime);[0m
  [1m[35m (335.6ms)[0m          ALTER TABLE voucher_transaction_logs PARTITION BY RANGE COLUMNS (transaction_datetime)(
           PARTITION p8 VALUES LESS THAN ('2014-08-01'),
           PARTITION p9 VALUES LESS THAN ('2014-09-01'),
           PARTITION p10 VALUES LESS THAN ('2014-10-01'),
           PARTITION p11 VALUES LESS THAN ('2014-11-01'),
           PARTITION p12 VALUES LESS THAN ('2014-12-01'),
           PARTITION p13 VALUES LESS THAN ('2015-01-01'),
           PARTITION p14 VALUES LESS THAN ('2015-02-01'),
           PARTITION p15 VALUES LESS THAN ('2015-03-01'),
           PARTITION p16 VALUES LESS THAN ('2015-04-01'),
           PARTITION p17 VALUES LESS THAN ('2015-05-01'),
           PARTITION p18 VALUES LESS THAN ('2015-06-01'),
           PARTITION p19 VALUES LESS THAN ('2015-07-01'),
           PARTITION p20 VALUES LESS THAN ('2015-08-01'),
           PARTITION p21 VALUES LESS THAN ('2015-09-01'),
           PARTITION p22 VALUES LESS THAN ('2015-10-01'),
           PARTITION p23 VALUES LESS THAN ('2015-11-01'),
           PARTITION p24 VALUES LESS THAN ('2015-12-01'),
           PARTITION p25 VALUES LESS THAN ('2016-01-01'),
           PARTITION p26 VALUES LESS THAN ('2016-02-01'),
           PARTITION p27 VALUES LESS THAN ('2016-03-01'),
           PARTITION p28 VALUES LESS THAN ('2016-04-01'),
           PARTITION p29 VALUES LESS THAN ('2016-05-01'),
           PARTITION p30 VALUES LESS THAN ('2016-06-01'),
           PARTITION p31 VALUES LESS THAN ('2016-07-01'),
           PARTITION p32 VALUES LESS THAN ('2016-08-01'),
           PARTITION p33 VALUES LESS THAN ('2016-09-01'),
           PARTITION p34 VALUES LESS THAN ('2016-10-01'),
           PARTITION p35 VALUES LESS THAN ('2016-11-01'),
           PARTITION p36 VALUES LESS THAN ('2016-12-01'),
           PARTITION p37 VALUES LESS THAN ('2017-01-01'),
           PARTITION p38 VALUES LESS THAN ('2017-02-01'),
           PARTITION p39 VALUES LESS THAN ('2017-03-01'),
           PARTITION p40 VALUES LESS THAN ('2017-04-01'),
           PARTITION p41 VALUES LESS THAN ('2017-05-01'),
           PARTITION p42 VALUES LESS THAN ('2017-06-01'),
           PARTITION p43 VALUES LESS THAN ('2017-07-01'),
           PARTITION p44 VALUES LESS THAN ('2017-08-01'),
           PARTITION p45 VALUES LESS THAN ('2017-09-01'),
           PARTITION p46 VALUES LESS THAN ('2017-10-01'),
           PARTITION p47 VALUES LESS THAN ('2017-11-01'),
           PARTITION p48 VALUES LESS THAN ('2017-12-01'),
           PARTITION p49 VALUES LESS THAN MAXVALUE
        );

  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20140824130903')
  [1m[36m (0.5ms)[0m  [1mCOMMIT[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.3ms)[0m  SELECT `schema_migrations`.* FROM `schema_migrations`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'acquirer_org'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `acquirer_org`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'activity_logs'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `activity_logs`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'card_bins'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `card_bins`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'configurations'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `configurations`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'credit_accounts'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `credit_accounts`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'credit_cashing_applications'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `credit_cashing_applications`
  [1m[36m (0.5ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'marketing_rules'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `marketing_rules`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'marketing_rules_payment_plans'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `marketing_rules_payment_plans`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'member_ships'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `member_ships`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'merchant_group_ships'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `merchant_group_ships`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'merchant_groups'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `merchant_groups`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'merchant_stores'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `merchant_stores`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'payment_media'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `payment_media`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'payment_plans'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `payment_plans`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'platform_accounts'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `platform_accounts`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'post_actions'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `post_actions`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'sequence_numbers'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `sequence_numbers`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'sequences'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `sequences`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'system_users'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `system_users`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transaction_archives'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `transaction_archives`
  [1m[36m (2.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transaction_logs'
        [0m
  [1m[35m (1.5ms)[0m  SHOW CREATE TABLE `transaction_logs`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transaction_post_actions'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `transaction_post_actions`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'transactions'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `transactions`
  [1m[36m (0.2ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'voucher_meta'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `voucher_meta`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'voucher_stores'
        [0m
  [1m[35m (0.2ms)[0m  SHOW CREATE TABLE `voucher_stores`
  [1m[36m (1.6ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'voucher_transaction_logs'
        [0m
  [1m[35m (1.7ms)[0m  SHOW CREATE TABLE `voucher_transaction_logs`
  [1m[36m (0.3ms)[0m  [1m
          SELECT fk.referenced_table_name as 'to_table'
                ,fk.referenced_column_name as 'primary_key'
                ,fk.column_name as 'column'
                ,fk.constraint_name as 'name'
          FROM information_schema.key_column_usage fk
          WHERE fk.referenced_column_name is not null
            AND fk.table_schema = 'core_system_test'
            AND fk.table_name = 'vouchers'
        [0m
  [1m[35m (0.1ms)[0m  SHOW CREATE TABLE `vouchers`
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:03:21', 'ed1b3469adb20089475dec4e10e9984b', 0, '123456', 'test', '2014-08-24 08:03:21', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:03:22', 1, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:03:22')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 1 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:03:22', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 1 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 1 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:03:22', 1, 'test', '2014-08-24 08:03:22')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 1) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:03:22', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 1 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 1 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 1) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-24 08:03:22', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 1 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-24 08:03:22' WHERE `credit_cashing_applications`.`id` = 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-24 08:03:22', 1, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', '6cbda375a94f83cedb2d5163edc61758', 0, '2014-08-24 08:03:22', 'credit_cashing', '2014-08-24 08:03:22')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 1 LIMIT 1[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (20.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'fa5f3c31f4193aa7997055e7ef163e59', 0, '123456', 'test', '2014-08-24 08:06:01', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 2 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'e697e85457150b2fffea4195ba12f0f0', 0, '123456', 'test', '2014-08-24 08:06:01', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 3
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:06:01', 3, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 3 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '9f27c250729f3e0fd26936a43e621427', 0, '123456', 'test', '2014-08-24 08:06:01', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 4
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:06:01', 4, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 4  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 3 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:06:01', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 3 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 4 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:06:01', 4, 'test', '2014-08-24 08:06:01')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 4) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:06:01', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 4 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 4  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 4  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (23.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'fc903ae883f2806c4f0d85f60a744eb2', 0, '123456', 'test', '2014-08-24 08:06:01', 8000)
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 5
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:06:01', 5, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 5  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 4 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:06:01', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 4 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 5 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '0d3f229538012d200a6d586f1c1f42bb', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'f034109d50cfa73b69aac82a1681d869', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '6b39d596ee9050b6161c6aeeacd4ce9b', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'dff955648fbefd0622bdb92d51e43b85', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'fed5d5083d7efd991014209bc772bb71', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'c2330e46a94c8d3a6250e76f19e5472f', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '157c6a5b00328fa584730ec62728731e', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'cbdb3a8273a75fb4025780041d5c77a2', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '09bbdd447c46585b48564f2b7ec5c1a3', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', 'dfa3dca5dd305598189cb95100324944', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '13ac5cee8539c27afa4edf0defb8c766', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:06:01', '9800760d410335370b19cc6f6038ca87', 0, '123456', 'test', '2014-08-24 08:06:01')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'bbc208a92a5af8548db4c143c8622844', 0, '123456', 'test', '2014-08-24 08:07:47', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 18 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '03dd8b341caf38ee1b079a81555175fe', 0, '123456', 'test', '2014-08-24 08:07:47', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 19
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:07:47', 19, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 19 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'a389cff0ff7f098ad5ef6cf1e918fb45', 0, '123456', 'test', '2014-08-24 08:07:47', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:07:47', 20, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 6 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:07:47', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 6 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:07:47', 20, 'test', '2014-08-24 08:07:47')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 20) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:07:47', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 20 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 20  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '45ab448dc0a38e8e5418119156a115bc', 0, '123456', 'test', '2014-08-24 08:07:47', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 21
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:07:47', 21, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 21  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 7 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:07:47', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 7 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 21 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (17.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '4364682814e4d591b5a9f9714ab46b58', 0, '123456', 'test', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747385', 1, 0, 'fb4d286d706303c4bbf558328c0f4898', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747388', 0, '80210f032f07de2c811d29ab6c033e16', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747390', 2, 0, 'c3df2fa9a94115e09ca9a993d913fc90', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'fb4d286d706303c4bbf558328c0f4898'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 1 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:07:47', 1, '14e83f2f03793f594cb876d7c1db457c', '2014-08-24 08:07:47', 1)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 22, `updated_at` = '2014-08-24 08:07:47' WHERE `vouchers`.`id` = 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 22) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '0029fa82241fb050fd93a740726db821', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747426', 1, 0, '3dc52c37215dfb19648b62da237f6ef8', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747428', 0, '51e18e01f5f8927ea88e4d5a7a301088', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747431', 2, 0, '4a8f9e7c054e8ce47eb59488069618b8', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:07:47', '2f641337770e2ed7f99af038a733ae4e', 0, '1234561', 'test1', '2014-08-24 08:07:47', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '4a8f9e7c054e8ce47eb59488069618b8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 6 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 23 AND `vouchers`.`voucher_meta_id` = 6
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 6[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:07:47', 1, 'cfc8f50a29342f0facd07105e4ffccd5', '2014-08-24 08:07:47', 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 23, `updated_at` = '2014-08-24 08:07:47' WHERE `vouchers`.`id` = 2[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 23) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'e08860c6561298118ff799ee3b9c64a0', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747450', 1, 0, '03372dd28d16953e213a173b1cf163e3', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747452', 0, 'e2d3e53123a3a298b6776ba3ef63cdf6', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747455', 2, 0, '6e9900c14f195e31f0b200eb37dd788c', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6e9900c14f195e31f0b200eb37dd788c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 9 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 25 AND `vouchers`.`voucher_meta_id` = 9
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 9[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:07:47', 1, '8636bc2783d73b93d0a20755d0bf3100', '2014-08-24 08:07:47', 9)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 25, `updated_at` = '2014-08-24 08:07:47' WHERE `vouchers`.`id` = 3[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 25) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '48c3773bef03d4815f89bfacca8ae79e', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747471', 1, 0, '03416ba37d9f92100a2d2bf35b01b341', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747473', 0, 'fe5896b33ba55e7918d2949192417cc1', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747475', 2, 0, 'f35dcaa537dde1434c1ebdf2cd7c1a00', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 10
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '03416ba37d9f92100a2d2bf35b01b341'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '741f5081e371299536c4c97d6a06bbe8', 0, '123456', 'test', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747485', 1, 0, '5622cfd7590d2f45af8bed27dd58b9d7', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747487', 0, '3fe0e0d23ed5926e1240b8efe72ef9c8', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747489', 2, 0, '5dab1139e82df6d732df1c4435fed094', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '3fe0e0d23ed5926e1240b8efe72ef9c8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 14 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 14[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:07:47', 1, 'a61b7274ae18ea912e7452f4c13564a5', '2014-08-24 08:07:47', 14)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 27, `updated_at` = '2014-08-24 08:07:47' WHERE `vouchers`.`id` = 4[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 27) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (30.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'c1957144f76575470c2c88c469fbda78', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747535', 1, 0, 'cad500559bfe2ad6f0a3763b0224574a', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747538', 0, 'b411f7a5c408f586b03d37be224d6e64', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747540', 2, 0, '001c6c136505edee9c7c1473cc515058', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 16 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 16[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:07:47', 1, '54f7a3dc8164ea48180f613d10ffd795', '2014-08-24 08:07:47', 16)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 28, `updated_at` = '2014-08-24 08:07:47' WHERE `vouchers`.`id` = 5[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 28) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'fe14801d0e1ccc5f4edc29a914d5f9eb', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747554', 1, 0, '399380f1ff84746872f057d7597129c2', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747557', 0, '736e2311953eb33c073b4dcb92486fb8', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747558', 2, 0, 'e4c3ff2d374505bdfc70b3bc5acc63d0', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '399380f1ff84746872f057d7597129c2'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 19 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:07:47' WHERE `voucher_meta`.`id` = 19
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:07:47', 1, '38d977c95801eba152af8ed3c3c797e5', '2014-08-24 08:07:47', 19)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 29, `updated_at` = '2014-08-24 08:07:47' WHERE `vouchers`.`id` = 6
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 29) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '0217a7a7d773390f69c366c74a42d008', 0, '123456', 'test', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747576', 1, 0, 'b82dc45c0bf3ae5fb1961b31779eca06', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747578', 0, '97441b1378ee752225b840c4250fe42e', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747581', 2, 0, '3c97b24b3d268a9f5066d9b1d8ade5e1', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', '61c9c9190dc437c43c4be9b321392941', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747589', 1, 0, '91e2a033ba9286ce3844c7efbf64baed', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747591', 0, '4084fd93d8ddfd68956608518247c7c0', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747593', 2, 0, 'c7ffa1a1ff546ff05ad4ea666426720b', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:07:47', '111', 'test', 0.01, 'editing', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:07:47', 'e8b3a34331246d94294cac9f713b0b18', 0, '2014-08-24 08:07:47')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 1) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 32, `updated_at` = '2014-08-24 08:07:47' WHERE `merchant_stores`.`id` = 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'e151f107587f089da0bf0ab374de4afc', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747646', 1, 0, '6795041a619edcb3e571cc6282a6700d', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747649', 0, 'e520a24e694d67b0dede33351d21ad8e', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747652', 2, 0, '0b881b7b7aa9c158379a3d0d34bf2aeb', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:07:47', '111', 'test', 0.01, 'editing', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:07:47', '43515a0b21d2f87d9dc592e6d50e6c1a', 0, '2014-08-24 08:07:47')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 2) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 34, `updated_at` = '2014-08-24 08:07:47' WHERE `merchant_stores`.`id` = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'a66e91339c2cd4e51d2c022248392365', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747668', 1, 0, '35ba92bfb3e873321d59dba8fd700933', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747670', 0, '1a6f2123f465f519156f370cb20a2335', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747672', 2, 0, 'cb9c5f5ca5499fe4fc592f25c3a9280d', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:07:47', '111', 'test', 0.01, 'editing', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:07:47', 'a79bbcf6b64e187bd17b42cae1863a8d', 0, '2014-08-24 08:07:47')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 3) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 36, `updated_at` = '2014-08-24 08:07:47' WHERE `merchant_stores`.`id` = 3
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:07:47', 'b7e25d7a0e81d499fa9813cbbf48deed', 0, '123456', 'test', '2014-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747690', 1, 0, '6b73743c4ec2476acdab5997a58f401e', '2014-08-24 08:07:47', 1, 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747692', 0, '17a390d1ab2df4c5ac53035ced0a2270', '2014-08-24 08:07:47', 0, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160747694', 2, 0, '0914050d2945fc3cf51f5a20e18a6b09', '2014-08-24 08:07:47', 2, 0, 1, 0, 1, '2014-08-24 08:07:47', '2014-08-24 08:07:47', '2024-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:07:47', '111', 'test', 0.01, 'editing', '2014-08-24 08:07:47')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:07:47', 'cd03a0e822b3fc43f4373a18e7e55e66', 0, '2014-08-24 08:07:47')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 4) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 38, `updated_at` = '2014-08-24 08:07:47' WHERE `merchant_stores`.`id` = 4
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:08:58', '8886c76291f4b19d8388c8b46a2a10b3', 0, '123456', 'test', '2014-08-24 08:08:58', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 39 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (4.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:08:58', '40c1b0647187cad67ccaadd2cfbf9f0e', 0, '123456', 'test', '2014-08-24 08:08:58', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 40
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:08:58', 40, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:08:58')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 40 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (83.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:08:58', '1696755319117795fd8a334f09a3357c', 0, '123456', 'test', '2014-08-24 08:08:58', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 41
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:08:58', 41, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:08:58')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 41  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 9 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:08:58', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 9 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 41 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:08:58', 41, 'test', '2014-08-24 08:08:58')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 41) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:08:58', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 41 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 41  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 41  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:08:58', '275ce2c2acb2e54fbaf84c84309709ee', 0, '123456', 'test', '2014-08-24 08:08:58', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 42
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:08:58', 42, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:08:58')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 42  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 10 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:08:58', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 10 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 42 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (123.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '2cd1a5e2f8b24688a50b2637a698e42a', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859104', 1, 0, 'b95f240a3362f3cc331c9641b0dcacc4', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859107', 0, 'b094683929505ae53eb6a226657b6a36', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859109', 2, 0, '0386c6aeceeea9d14c5066208de3226d', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'b95f240a3362f3cc331c9641b0dcacc4'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 37 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 37[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, 'a0c9144668ec8daa60b06c3db841f4ab', '2014-08-24 08:08:59', 37)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 43, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 7[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 43) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 43, 'system', 0, '123456', '7082e46471923febb05d31baa8af5c3e', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'b95f240a3362f3cc331c9641b0dcacc4', 'a0c9144668ec8daa60b06c3db841f4ab')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'b95f240a3362f3cc331c9641b0dcacc4'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 37 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (30.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '0bab9163d0cd7dfb2a9c7ab6ce0d5d9d', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859195', 1, 0, 'ab36f013bae583c81042199d5cfc99b1', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859198', 0, '464a72c6e064301a308c646455c899e4', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859200', 2, 0, '88cfdc1cd9b796d691a814ffa97f9203', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 40 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 40
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, '5d5fd110e28b8b44626cf46971f28add', '2014-08-24 08:08:59', 40)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 44, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 8
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 44) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 44, 'system', 0, '123456', '0dd68556bf19455e29535af53132bb5d', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'ab36f013bae583c81042199d5cfc99b1', '5d5fd110e28b8b44626cf46971f28add')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 44
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 44  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (40)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 40 LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '5e62d87bd9a4d8d0e57f6ae7acfae37d', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859220', 1, 0, '683ad5c997c95338421488ed3436db5f', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859222', 0, 'd891edc751e7e2c026ffc929e6dd5560', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859224', 2, 0, '4620669eae2f6dc729717d06456ea321', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd891edc751e7e2c026ffc929e6dd5560'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 44 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 44[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, '98e3c790fa58ac90d486d9d01138e59f', '2014-08-24 08:08:59', 44)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 45, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 9[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 45) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 45, 'system', 0, '123456', '249b76ae94fd2f998cfde55a23239f2a', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'd891edc751e7e2c026ffc929e6dd5560', '98e3c790fa58ac90d486d9d01138e59f')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd891edc751e7e2c026ffc929e6dd5560'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 44 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 44
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, '47e91e8b8a999ca9403fbfb0cd874809', '2014-08-24 08:08:59', 44)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 45, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 10
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 45) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 45, 'system', 0, '123456', 'a11a408e1addb6c23229c12972215364', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'd891edc751e7e2c026ffc929e6dd5560', '47e91e8b8a999ca9403fbfb0cd874809')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd891edc751e7e2c026ffc929e6dd5560'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 44 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 44[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, '61a170d07196445759ec37994ba05cfe', '2014-08-24 08:08:59', 44)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 45, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 11[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 45) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 45, 'system', 0, '123456', 'f2c80dd2a957e46b2b779dea2696a67e', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'd891edc751e7e2c026ffc929e6dd5560', '61a170d07196445759ec37994ba05cfe')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 45[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 44 LIMIT 1
  [1m[36m (31.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '10b3caa574a4ea0f811c1037125d9b6d', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859289', 1, 0, 'a01ab52216a265378dbe91cc06ed6512', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859291', 0, '026a8afdaa296b49f9d0d2bf4f9ca644', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859293', 2, 0, '9470c01afe256eed112aa1570867f2de', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'a01ab52216a265378dbe91cc06ed6512'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 46 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 46[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, '45456b27637bc15a31bce8faa3caff7d', '2014-08-24 08:08:59', 46)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 46, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 12[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 46) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 46, 'system', 0, '123456', 'c5bf759657672c19ce786cda557cc95e', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'a01ab52216a265378dbe91cc06ed6512', '45456b27637bc15a31bce8faa3caff7d')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 46[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 46  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (46)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 46 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '7cf1c7d332db14bd9a219788429585e2', 0, '123456', 'test', '2014-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859313', 1, 0, '998dcab445c950f5a9b886bb95d6e4f8', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859315', 0, '5d5ff2aea5342e611d4713e531e93221', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859318', 2, 0, 'f497443183d84ed96a873a1eee49a115', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 49
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '998dcab445c950f5a9b886bb95d6e4f8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', 'a66d67c62568709c58c4cbb7f9ea7bb9', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859327', 1, 0, '029412d663e6d9f8e72adc7bc36ea316', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859329', 0, '42e0137cc083e2024c58e93632acd3bc', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859331', 2, 0, 'c0f5a341746981cc00f401e1de431f36', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'c0f5a341746981cc00f401e1de431f36'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 54 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 48 AND `vouchers`.`voucher_meta_id` = 54[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 54
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, 'a649359dfbc95091293f3f7945081beb', '2014-08-24 08:08:59', 54)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 48, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 13
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 48) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 48, 'system', 0, '123456', 'd825b1ed94c3ce8ed935ec1dd6531f9a', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', 'c0f5a341746981cc00f401e1de431f36', 'a649359dfbc95091293f3f7945081beb')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'c0f5a341746981cc00f401e1de431f36'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 54 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 48 AND `vouchers`.`voucher_meta_id` = 54[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', 'c3c373c52da153f20ce455bcf69c8a64', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859350', 1, 0, '8d16d20664fb32ed4a1f2bd4e70d58d0', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859352', 0, 'cfa07f94d59a38aa97f808d1497066d6', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859354', 2, 0, '05fe3f47594e06afe33828a73a0504b4', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:08:59', 'd0658065f618a8cc6216fa242b127a6c', 0, '1234561', 'test1', '2014-08-24 08:08:59', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '05fe3f47594e06afe33828a73a0504b4'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 57 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 49 AND `vouchers`.`voucher_meta_id` = 57[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 57
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, 'c6f80880b98c59251a0a343c5bc12086', '2014-08-24 08:08:59', 57)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 49, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 14
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 49) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 49, 'system', 0, '123456', '44c9fa703faa16bd7d2aa59d311a1923', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', '05fe3f47594e06afe33828a73a0504b4', 'c6f80880b98c59251a0a343c5bc12086')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '05fe3f47594e06afe33828a73a0504b4'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 57 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 50 AND `vouchers`.`voucher_meta_id` = 57[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-24 08:08:59' WHERE `voucher_meta`.`id` = 57
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:08:59', 1, 'be1599f3e3acec243d7e8331d9b419e0', '2014-08-24 08:08:59', 57)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 50, `updated_at` = '2014-08-24 08:08:59' WHERE `vouchers`.`id` = 15
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 50) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:08:59', 50, 'system', 0, '1234561', '7fb05be8f55284b2be280c28f2a01b15', 0, '2014-08-24 08:08:59', 'issue', '2014-08-24 08:08:59', '05fe3f47594e06afe33828a73a0504b4', 'be1599f3e3acec243d7e8331d9b419e0')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 49
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 50[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', 'ae102156b2684124a57bc2e7235e6f30', 0, '123456', 'test', '2014-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859385', 1, 0, 'd426ac21d7d01cafd0d06fd744de6ab6', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859387', 0, 'f7499218095eb843ed17151b459ec5e3', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859389', 2, 0, '8ac7f1fe8d99d8f23cd24ed16f047f78', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '9f749ba64849a2074bcb840d6960f4d6', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859397', 1, 0, '38623943898a89e9137eafd5f3b439cf', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859400', 0, '294925dce55cafe60845719732c32767', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859402', 2, 0, 'a16513a9404a65e7b23bf25bf9582b26', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:08:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:08:59', 'd67ec2389cf3758c835b8885bed47c2b', 0, '2014-08-24 08:08:59')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 5) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 53, `updated_at` = '2014-08-24 08:08:59' WHERE `merchant_stores`.`id` = 5[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', '5b5f07df5ca4a3fc72b622fc187ea5e7', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859454', 1, 0, 'fa379044372a6a000ecb5e4b2a90dc9e', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859457', 0, 'a3abc006ddf9f77b034bb204c02cabaa', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859459', 2, 0, '1b53b477cce598b903641a891ba25127', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:08:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:08:59', '706af3d35284d870830610b7c58ef29b', 0, '2014-08-24 08:08:59')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 6) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 55, `updated_at` = '2014-08-24 08:08:59' WHERE `merchant_stores`.`id` = 6[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', 'd99ffa481496ea6920c6585c63a0f5f2', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859474', 1, 0, 'feb6dcf2440f01b1090feb8c2c6c91c0', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859477', 0, '0a6608f5d4c8b10df3654bc0583559ea', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859479', 2, 0, '3a99c25b903d33d14a94b2c2ad191965', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:08:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:08:59', 'f0b76c438551dfc4285b986b8132c88f', 0, '2014-08-24 08:08:59')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 7) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 57, `updated_at` = '2014-08-24 08:08:59' WHERE `merchant_stores`.`id` = 7[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:08:59', 'd0de1f8a6906c049acfef64773e54622', 0, '123456', 'test', '2014-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859493', 1, 0, 'c08274e3ad2255bb3ce8334d25b4bb37', '2014-08-24 08:08:59', 1, 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859496', 0, '2356cde9ff84189ccebb5e74cce56ccf', '2014-08-24 08:08:59', 0, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160859498', 2, 0, 'cf5e11aa1870b78deb98cfb93c207b09', '2014-08-24 08:08:59', 2, 0, 1, 0, 1, '2014-08-24 08:08:59', '2014-08-24 08:08:59', '2024-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:08:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:08:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:08:59', '3003672af43e2dcb8ca91022eacd43d5', 0, '2014-08-24 08:08:59')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 8) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 59, `updated_at` = '2014-08-24 08:08:59' WHERE `merchant_stores`.`id` = 8[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:23', '090c22013d75716df0d277d0103aa66e', 0, '123456', 'test', '2014-08-24 08:09:23', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 60 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:23', '5f72dcfcd54cf99176559dbf5e3f4aa2', 0, '123456', 'test', '2014-08-24 08:09:23', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 61
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:09:23', 61, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:09:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 61 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (18.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:23', '33f5fffb048ce2e828534ace66efdeb1', 0, '123456', 'test', '2014-08-24 08:09:23', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 62
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:09:23', 62, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:09:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 62  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 12 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:09:23', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 12 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 62 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:09:23', 62, 'test', '2014-08-24 08:09:23')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 62) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:09:23', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 62 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 62  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 62  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:23', 'da0c4599f55199d5ceab9a22748e8a91', 0, '123456', 'test', '2014-08-24 08:09:23', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 63
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:09:23', 63, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:09:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 63  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 13 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:09:23', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 13 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 63 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:23', '48b203b5c9b3ffc386017f52b05a389b', 0, '123456', 'test', '2014-08-24 08:09:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160923940', 1, 0, '79ff9172f7b020a9ee3be9d3613454b0', '2014-08-24 08:09:23', 1, 0, 0, 1, '2014-08-24 08:09:23', '2014-08-24 08:09:23', '2024-08-24 08:09:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160923943', 0, 'e4766e6318ba4da6df0bb230dd336b61', '2014-08-24 08:09:23', 0, 0, 1, '2014-08-24 08:09:23', '2014-08-24 08:09:23', '2024-08-24 08:09:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160923945', 2, 0, '72cf0f24db6a087a97bd2f548b05f6ca', '2014-08-24 08:09:23', 2, 0, 1, 0, 1, '2014-08-24 08:09:23', '2014-08-24 08:09:23', '2024-08-24 08:09:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '79ff9172f7b020a9ee3be9d3613454b0'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 73 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:23' WHERE `voucher_meta`.`id` = 73[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:23', 1, 'e5ea381370faa51693770e50170c79ac', '2014-08-24 08:09:23', 73)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 64, `updated_at` = '2014-08-24 08:09:23' WHERE `vouchers`.`id` = 16[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 64) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:23', 64, 'system', 0, '123456', 'af655343e09d50aec426991e82e88f3d', 0, '2014-08-24 08:09:23', 'issue', '2014-08-24 08:09:23', '79ff9172f7b020a9ee3be9d3613454b0', 'e5ea381370faa51693770e50170c79ac')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '79ff9172f7b020a9ee3be9d3613454b0'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 73 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:23', '2ea41027b59527f0ab2e872e00a20982', 0, '123456', 'test', '2014-08-24 08:09:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160923997', 1, 0, '60085621362ded274d846fa6fee74e21', '2014-08-24 08:09:23', 1, 0, 0, 1, '2014-08-24 08:09:23', '2014-08-24 08:09:23', '2024-08-24 08:09:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924000', 0, '74880da392906c1f9137e4623f6e6d06', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924002', 2, 0, '221e091a022b1963c56ddf12c6ad6654', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '74880da392906c1f9137e4623f6e6d06'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 77 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 77[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, 'ad7060f64bc9c27c6fc7bd88b0aa2fbf', '2014-08-24 08:09:24', 77)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 65, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 17[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 65) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 65, 'system', 0, '123456', 'e1025734fed8b9c15046a5c2a94e85dd', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '74880da392906c1f9137e4623f6e6d06', 'ad7060f64bc9c27c6fc7bd88b0aa2fbf')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '74880da392906c1f9137e4623f6e6d06'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 77 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 77
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, 'fe797ab1feeb8185505ec64878feef3f', '2014-08-24 08:09:24', 77)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 65, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 18
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 65) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 65, 'system', 0, '123456', 'ee75db50dcddfa6ddb23f360676acc21', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '74880da392906c1f9137e4623f6e6d06', 'fe797ab1feeb8185505ec64878feef3f')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '74880da392906c1f9137e4623f6e6d06'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 77 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 77[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, '23b2ce44b6739efa728a0305d397a378', '2014-08-24 08:09:24', 77)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 65, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 19[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 65) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 65, 'system', 0, '123456', 'ec49fd11f10dd73eedadbab7ef3bc29d', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '74880da392906c1f9137e4623f6e6d06', '23b2ce44b6739efa728a0305d397a378')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 65[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 77 LIMIT 1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', 'a4adf1cca7e5c1dac3dafca371175c5c', 0, '123456', 'test', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924036', 1, 0, 'd7013997b45e87c41dc10779d3282293', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924038', 0, 'c5f80508511b98863f8622a4ba9e434d', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924040', 2, 0, '87cf83467723f86ed3a000f1a48a81d4', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd7013997b45e87c41dc10779d3282293'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 79 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 79[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, '3f94bb9a2e18cb1b0721f73ec0c2b281', '2014-08-24 08:09:24', 79)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 66, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 20[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 66) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 66, 'system', 0, '123456', 'c2aecd03da909c7a6458ae7dcca5fcba', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', 'd7013997b45e87c41dc10779d3282293', '3f94bb9a2e18cb1b0721f73ec0c2b281')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 66[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 66  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (79)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 79 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', '123b1bd7f1d0ff65506b8f1eb09b9ea5', 0, '123456', 'test', '2014-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924061', 1, 0, 'e5bb6ae71da5bd48c104230aee99bf9c', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924064', 0, '8f3dfec5073824a21611f0fc1f6a0e0b', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924066', 2, 0, '4399814fca60ca41727eca44a2031c0c', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:09:24', '8ce072fcb9810d9b89bfce7339aadc58', 0, '1234561', 'test1', '2014-08-24 08:09:24', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '4399814fca60ca41727eca44a2031c0c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 84 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 67 AND `vouchers`.`voucher_meta_id` = 84
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 84[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, 'd6131e1a2729952ff56abbb9a81955fc', '2014-08-24 08:09:24', 84)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 67, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 21[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 67) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 67, 'system', 0, '123456', '24ba5f383502e05830474de8dd3471b9', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '4399814fca60ca41727eca44a2031c0c', 'd6131e1a2729952ff56abbb9a81955fc')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '4399814fca60ca41727eca44a2031c0c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 84 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 68 AND `vouchers`.`voucher_meta_id` = 84
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 84[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, 'c836b6b61817bbacfb295f6e0a6cebb0', '2014-08-24 08:09:24', 84)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 68, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 22[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 68) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 68, 'system', 0, '1234561', '902eebe7eb7f4e7cb6023752c2ce5dc7', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '4399814fca60ca41727eca44a2031c0c', 'c836b6b61817bbacfb295f6e0a6cebb0')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 67[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 68
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', 'e951a6e2ae83fb27d09cf711d0499474', 0, '123456', 'test', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924098', 1, 0, '4fa95e043f281a1c8e9113f87109f3bb', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924100', 0, '8351de222907c03d00cf083f076b4fb2', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924102', 2, 0, 'eee3184ab487d71a190beb286710bdf2', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 85 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 85
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, 'f3b1c81d8948f6908dda225585ef2c4a', '2014-08-24 08:09:24', 85)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 69, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 23
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 69) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 69, 'system', 0, '123456', '6b7470ed2806b68619677d601406c402', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '4fa95e043f281a1c8e9113f87109f3bb', 'f3b1c81d8948f6908dda225585ef2c4a')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 69
  [1m[36mTrade::VoucherTransactionLog Load (0.5ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 69  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (85)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 85 LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', '775413549400164185bb793940155976', 0, '123456', 'test', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924123', 1, 0, 'a2f6f1b7070496a2a2897515b56767fd', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924125', 0, '45c0afae7ee94f508c5a82d68216772b', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924127', 2, 0, '2659f15f249d7161a5e5a85bf40515de', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '2659f15f249d7161a5e5a85bf40515de'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 90 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 70 AND `vouchers`.`voucher_meta_id` = 90[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 90
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', 1, '0800d39a6defe86bb76942028f5e3667', '2014-08-24 08:09:24', 90)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 70, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 24
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 70) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 70, 'system', 0, '123456', '42a858ce09ac49dae5d99c21cc7dd44d', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', '2659f15f249d7161a5e5a85bf40515de', '0800d39a6defe86bb76942028f5e3667')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '2659f15f249d7161a5e5a85bf40515de'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 90 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 70 AND `vouchers`.`voucher_meta_id` = 90[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', '20d0f33879c0442122736c05a825b9ba', 0, '123456', 'test', '2014-08-24 08:09:24')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924147', 1, 0, 'a3987c5dec021795054cb19ea61c6edf', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924150', 0, '9aa85cc74b3f0149f71df79f3cfd92f8', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924152', 2, 0, 'e3cd16c8af2c6797311f619310f02bc6', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 91[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'a3987c5dec021795054cb19ea61c6edf'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', '94db7ef36d6d449410fcb5219b28c7f3', 0, '123456', 'test', '2014-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924162', 1, 0, '0dc8b55b1711a4d0692c1c09e9baf4c1', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924165', 0, 'eb8b8abc45efb76a3470f349c0ca00da', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924167', 2, 0, 'e7b972ae1e1f7b90b9a164e68c26dd76', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:09:24', '2014-08-24 08:09:24')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:09:24', '1234', 1, '2014-08-24 08:09:24')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:09:24', '1235', 1, '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924186', 0, 'e70a665fa86a6de02c391a347982fe9d', '2014-08-24 08:09:24', 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 97 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 97
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 1 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 1 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 1 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:09:24', `used` = 1 WHERE `sequence_numbers`.`id` = 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', '1234', 1, '62a4cabb3a2316b336b2f3c60302e0f9', '2014-08-24 08:09:24', 97)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 72, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 25
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 72) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 72, 'system', 0, '123456', '0f7c429203b2972a43a90ae2a94d60e1', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', 'e70a665fa86a6de02c391a347982fe9d', '1234', '62a4cabb3a2316b336b2f3c60302e0f9')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 97 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 97[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 1 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 1 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 1 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:09:24', `used` = 1 WHERE `sequence_numbers`.`id` = 2[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:24', '1235', 1, 'f54a7d48a6fd297cb78acaa2b4b59a5f', '2014-08-24 08:09:24', 97)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 72, `updated_at` = '2014-08-24 08:09:24' WHERE `vouchers`.`id` = 26[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 72) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:24', 72, 'system', 0, '123456', '38e274e1aa749b681791b3d5bf45046f', 0, '2014-08-24 08:09:24', 'issue', '2014-08-24 08:09:24', 'e70a665fa86a6de02c391a347982fe9d', '1235', 'f54a7d48a6fd297cb78acaa2b4b59a5f')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 97 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:09:24' WHERE `voucher_meta`.`id` = 97[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 1 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 1 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 1 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', 'ae2b52c6ef634be14b2fdd36a5c18630', 0, '123456', 'test', '2014-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924220', 1, 0, 'a8585bbec9d8aa87a7c7f71a7e62052c', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924222', 0, '1bdd9e0412827d0f187d937c7d93826b', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924224', 2, 0, 'face310e4ee67ef0e04686020c611679', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:24', '3864eccbe9956103f096617ba416d0e5', 0, '2014-08-24 08:09:24')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 9) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 74, `updated_at` = '2014-08-24 08:09:24' WHERE `merchant_stores`.`id` = 9
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', 'c4301ccca26502b2e248bfe2abcf1d95', 0, '123456', 'test', '2014-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924280', 1, 0, 'f09ded3c7c6971410867cc7dc6d8ee97', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924282', 0, 'd7d3121a281f81f3d63c1c89459358b2', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924284', 2, 0, 'fc6f355f7857f6cc4bc7338818013fb8', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:24', '0d777daf75f9bac7e1ad52a493ff9f2e', 0, '2014-08-24 08:09:24')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 10) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 76, `updated_at` = '2014-08-24 08:09:24' WHERE `merchant_stores`.`id` = 10
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', '41ef7fb7220479d6f64001dae57b65e3', 0, '123456', 'test', '2014-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924299', 1, 0, '13e393ed4188cf7baded96efb84cf7b5', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924302', 0, '0d2037790e5fc85eb487c132e77a4cab', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924304', 2, 0, 'fb29f9938cccf863ee317bed25aa3e9c', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:24', 'd5f6f8640328912e87839a9e7e8936c5', 0, '2014-08-24 08:09:24')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 11) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 78, `updated_at` = '2014-08-24 08:09:24' WHERE `merchant_stores`.`id` = 11
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:24', '898273cdf9d6350a50c896870b7fd693', 0, '123456', 'test', '2014-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924320', 1, 0, 'ebfb8aafb1d6f2535effb241e1159c60', '2014-08-24 08:09:24', 1, 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924322', 0, 'c89ee0a5b7992034a465eb2391c06caa', '2014-08-24 08:09:24', 0, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160924325', 2, 0, '24ec000a7f7a1eedb819003ebdecbf7a', '2014-08-24 08:09:24', 2, 0, 1, 0, 1, '2014-08-24 08:09:24', '2014-08-24 08:09:24', '2024-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:24', '7f65246094454621580649063f0214bd', 0, '2014-08-24 08:09:24')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 12) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 80, `updated_at` = '2014-08-24 08:09:24' WHERE `merchant_stores`.`id` = 12
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:48', '0f181173ae8ed4a6bd85beff863036cc', 0, '123456', 'test', '2014-08-24 08:09:48')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160948938', 1, 0, '8e533a40d86531ed9171c61053296b8a', '2014-08-24 08:09:48', 1, 0, 0, 1, '2014-08-24 08:09:48', '2014-08-24 08:09:48', '2024-08-24 08:09:48')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160948940', 0, 'bd1acb7061a0c56a8dd50a0e02eb3df8', '2014-08-24 08:09:48', 0, 0, 1, '2014-08-24 08:09:48', '2014-08-24 08:09:48', '2024-08-24 08:09:48')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160948942', 2, 0, '6d38cc489e3f1aeb509736f00da0d139', '2014-08-24 08:09:48', 2, 0, 1, 0, 1, '2014-08-24 08:09:48', '2014-08-24 08:09:48', '2024-08-24 08:09:48')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'bd1acb7061a0c56a8dd50a0e02eb3df8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 111 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:09:48' WHERE `voucher_meta`.`id` = 111[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:48', 1, '7de10ba3eedde9f6cd7b2013bd58666a', '2014-08-24 08:09:48', 111)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 81, `updated_at` = '2014-08-24 08:09:48' WHERE `vouchers`.`id` = 27[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 81) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:48', 81, 'system', 0, '123456', '75e575a5f830e08cd79989fe52b5722d', 0, '2014-08-24 08:09:48', 'issue', '2014-08-24 08:09:48', 'bd1acb7061a0c56a8dd50a0e02eb3df8', '7de10ba3eedde9f6cd7b2013bd58666a')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'bd1acb7061a0c56a8dd50a0e02eb3df8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 111 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:09:48' WHERE `voucher_meta`.`id` = 111
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:48', 1, '9152ea4d888fdd29bfd4320e36c0699b', '2014-08-24 08:09:48', 111)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 81, `updated_at` = '2014-08-24 08:09:48' WHERE `vouchers`.`id` = 28
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 81) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:48', 81, 'system', 0, '123456', '8635ca0ad279dc29f9b71c52178a18ae', 0, '2014-08-24 08:09:48', 'issue', '2014-08-24 08:09:48', 'bd1acb7061a0c56a8dd50a0e02eb3df8', '9152ea4d888fdd29bfd4320e36c0699b')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'bd1acb7061a0c56a8dd50a0e02eb3df8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 111 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 111[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, '04b7e45a674a030691ac37a619f1e12d', '2014-08-24 08:09:49', 111)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 81, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 29[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 81) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 81, 'system', 0, '123456', '236ce747f397befa91220f8413b5ec14', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', 'bd1acb7061a0c56a8dd50a0e02eb3df8', '04b7e45a674a030691ac37a619f1e12d')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 81[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 111 LIMIT 1
  [1m[36m (22.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '5e5096408f197e7c302be65fac6e6305', 0, '123456', 'test', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949036', 1, 0, 'ea724311e8bd40104bac20d137c7c0c5', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949038', 0, 'dc18f33e2b8741f32d4e8433041ced3a', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949040', 2, 0, 'a58ffea195e56143bfd9e4d4ff268ab6', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 113[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ea724311e8bd40104bac20d137c7c0c5'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '71d53c63b9e3b21869f77fe2ac081549', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949051', 1, 0, 'ab5a60794a44e19380443e7fa8bc40b9', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949053', 0, '4f83a47b7623e5330bfc5ff146731d31', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949056', 2, 0, '85a735d46fc1faa2db7040c5f862bd7e', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ab5a60794a44e19380443e7fa8bc40b9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 116 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 116
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, 'f3d939e4cbdd60d3c316c612759ec53d', '2014-08-24 08:09:49', 116)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 83, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 30
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 83) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 83, 'system', 0, '123456', '0de4a4ea47fb6f41c0ce09de7258775c', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', 'ab5a60794a44e19380443e7fa8bc40b9', 'f3d939e4cbdd60d3c316c612759ec53d')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ab5a60794a44e19380443e7fa8bc40b9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 116 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '9992c730ab3e03daf74b4b6587d585e1', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949076', 1, 0, '1eb017f7fd7660f42f13d4a66abbcfc6', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949078', 0, 'b1beadd6627862380e91801a987bd27a', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949080', 2, 0, 'd0b5b21c6ca1099e7443eebe62afd51f', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd0b5b21c6ca1099e7443eebe62afd51f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 121 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 84 AND `vouchers`.`voucher_meta_id` = 121
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 121[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, '54879650fde8e631acc46576f554fb95', '2014-08-24 08:09:49', 121)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 84, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 31[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 84) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 84, 'system', 0, '123456', 'f7836ce4aa374e80c98829b5414db22d', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', 'd0b5b21c6ca1099e7443eebe62afd51f', '54879650fde8e631acc46576f554fb95')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd0b5b21c6ca1099e7443eebe62afd51f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 121 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 84 AND `vouchers`.`voucher_meta_id` = 121
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', 'cd858be5c020ef1189183a9099e64ca2', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949102', 1, 0, '36983baf5faf01cafa7793c49bfcda48', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949104', 0, '3e8aed87ec010fca9c468b5487869579', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949106', 2, 0, '54df11d8a6a3d4b716df438147557dc1', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 122 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 122[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, '4d9164d2307e134714550294ac8e9076', '2014-08-24 08:09:49', 122)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 85, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 32[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 85) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 85, 'system', 0, '123456', '6238f594a0551f9bb661912e272c25b2', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', '36983baf5faf01cafa7793c49bfcda48', '4d9164d2307e134714550294ac8e9076')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 85[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 85  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (122)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 122 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '8be21ffa5464ab3e7e019080a2633624', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949127', 1, 0, '02eae2b53c10b5f5d4354acb9ca8c1f1', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949129', 0, 'cfe9f2cad6788591bd3f880e897259bb', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949131', 2, 0, '578a60bace0465da25130f6ac33eab32', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '02eae2b53c10b5f5d4354acb9ca8c1f1'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 125 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 125
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, '72c68cda3eb73b12760171a66efe6e7d', '2014-08-24 08:09:49', 125)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 86, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 33
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 86) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 86, 'system', 0, '123456', '527af9df0dd284bca04b6620b7329eaf', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', '02eae2b53c10b5f5d4354acb9ca8c1f1', '72c68cda3eb73b12760171a66efe6e7d')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 86
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.3ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 86  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (125)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 125 LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', 'f6ffdfc141f3129cf92bc3cd70c54923', 0, '123456', 'test', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949153', 1, 0, 'fe3ac78faa911279aeb33fb1eaaeabe7', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949156', 0, '64fbd8f0b228ceb2152ab32a100a98ff', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949158', 2, 0, '3ff7da16381503c5c767cb8dc7397a51', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:09:49', '59d7f0a29f15c0dff820161b92294e9e', 0, '1234561', 'test1', '2014-08-24 08:09:49', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '3ff7da16381503c5c767cb8dc7397a51'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 130 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 87 AND `vouchers`.`voucher_meta_id` = 130[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 130
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, 'ec5adeb4ba40f730ef12603c53b9e61c', '2014-08-24 08:09:49', 130)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 87, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 34
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 87) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 87, 'system', 0, '123456', '456f17ed988b079f51d1ace995a87a08', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', '3ff7da16381503c5c767cb8dc7397a51', 'ec5adeb4ba40f730ef12603c53b9e61c')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '3ff7da16381503c5c767cb8dc7397a51'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 130 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 88 AND `vouchers`.`voucher_meta_id` = 130[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 130
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', 1, '520cc4300100ed1a4232002f180bb1df', '2014-08-24 08:09:49', 130)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 88, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 35
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 88) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 88, 'system', 0, '1234561', '82731aa6d203967943145ae958e39dfe', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', '3ff7da16381503c5c767cb8dc7397a51', '520cc4300100ed1a4232002f180bb1df')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 87
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 88[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '9a375159251854be0de06be9652582e3', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949190', 1, 0, '9d2a3f577251cc55a76dd2ebec6b9012', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949193', 0, 'd2be1703318637fdf3cd761b4108542b', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949195', 2, 0, 'ffed84861f75a161e7b416d6fa04f91d', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:49', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:49', '9eda5909330637b27012f7c7bfbc0a4d', 0, '2014-08-24 08:09:49')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 13) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 90, `updated_at` = '2014-08-24 08:09:49' WHERE `merchant_stores`.`id` = 13
  [1m[36m (0.3ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:09:49', 'test_group', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', 'b8a5f820f1be6e08256a441674c32ed6', 0, '112312323', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 91 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 13 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:09:49', 91, 13, 'Merchant::MerchantStore', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 91) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 91 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 13 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 91) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 91 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 91 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 91 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 13 LIMIT 1
  [1m[36m (16.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '175b323b6378171bd0f58133d3739e13', 0, '123456', 'test', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949306', 1, 0, '28dea6f5ca6848844817907ecc856d99', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949308', 0, '17f2ae9ab37876bdfabdf56aaccbdc6d', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949310', 2, 0, 'b9efa310a2d0f4dc66d1da96d88e5e4c', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:49', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:49', '0efc3a7b501baaf763819e3eae61ae5c', 0, '2014-08-24 08:09:49')[0m
  [1m[35mMerchant::MerchantStore Exists (0.4ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 14) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 93, `updated_at` = '2014-08-24 08:09:49' WHERE `merchant_stores`.`id` = 14[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:09:49', 'test_group', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', 'ee221bcafdb2bada1ce42af91a18b038', 0, '112312323', 'test', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 94 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 14 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:09:49', 94, 14, 'Merchant::MerchantStore', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 94) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 94 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 94 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 94 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 14 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '4c96e58277bb4664e31097d9d0217a18', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949347', 1, 0, 'cb7f258bc7d3293feef36d7be97336d0', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949349', 0, '9bf45a4c739884044ef747d4a83826ed', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949351', 2, 0, '009bd6d4c83b4d3642fd4fe4cebe8efa', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:49', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:49', '12886ff535257e8a89a8ae800e65f6de', 0, '2014-08-24 08:09:49')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 15) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 96, `updated_at` = '2014-08-24 08:09:49' WHERE `merchant_stores`.`id` = 15
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:09:49', 'test_group', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '8881efd3fc8a178b2f89a7d708533ed9', 0, '112312323', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 97 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 3 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:09:49', 97, 3, 'Merchant::MerchantGroup', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 97) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 97 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 97 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.3ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 97 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 3 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '986dc7b674424991a3d1436f6290099b', 0, '123456', 'test', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949388', 1, 0, 'a4f11d11d32488ed466bdd7df3bed9bf', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949390', 0, '66361868eba84878739633590c45b073', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949392', 2, 0, '5b6e66bc34f1f039bfea9dfba7fd1692', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:09:49', '111', 'test', 0.01, 'editing', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:09:49', '462f55b7828e6b5bda022689a7003258', 0, '2014-08-24 08:09:49')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 16) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 99, `updated_at` = '2014-08-24 08:09:49' WHERE `merchant_stores`.`id` = 16[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:09:49', 'test_group', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '971030489adad37510676a08cd82d8e9', 0, '112312323', 'test', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 100 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 4 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:09:49', 100, 4, 'Merchant::MerchantGroup', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 100) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 100 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 4 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 100) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 100 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 100 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 100 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 4 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:09:49', 'f16933f68d6e59d702f8d801ca9e911b', 0, '123456', 'test', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949432', 1, 0, 'cb25ceae1f61ced02368c1dc968283cc', '2014-08-24 08:09:49', 1, 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949434', 0, '9dabfe34e2df798e7a3dae64b775edd9', '2014-08-24 08:09:49', 0, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949436', 2, 0, '26006c0aae8c1cc244916360343d6236', '2014-08-24 08:09:49', 2, 0, 1, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.3ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:09:49', '2014-08-24 08:09:49')[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:09:49', '1234', 2, '2014-08-24 08:09:49')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:09:49', '1235', 2, '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824160949461', 0, '8dcb2ffeee194266c5f417ab27c65bd9', '2014-08-24 08:09:49', 0, 2, 0, 1, '2014-08-24 08:09:49', '2014-08-24 08:09:49', '2024-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 146 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 146
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 2 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 2 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 2 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:09:49', `used` = 1 WHERE `sequence_numbers`.`id` = 3
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', '1234', 1, '04ddfe81a8f14d339dc2c642fbf5fb4f', '2014-08-24 08:09:49', 146)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 101, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 36
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 101) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 101, 'system', 0, '123456', '15c52df71c260ba568645bc183f4682c', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', '8dcb2ffeee194266c5f417ab27c65bd9', '1234', '04ddfe81a8f14d339dc2c642fbf5fb4f')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 146 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 146[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 2 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 2 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 2 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:09:49', `used` = 1 WHERE `sequence_numbers`.`id` = 4[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:09:49', '1235', 1, '894e32d86032670de87b69eb64d96eee', '2014-08-24 08:09:49', 146)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 101, `updated_at` = '2014-08-24 08:09:49' WHERE `vouchers`.`id` = 37[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 101) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:09:49', 101, 'system', 0, '123456', '1f0dd2246ce39abab33e47e5fa2670ae', 0, '2014-08-24 08:09:49', 'issue', '2014-08-24 08:09:49', '8dcb2ffeee194266c5f417ab27c65bd9', '1235', '894e32d86032670de87b69eb64d96eee')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 146 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:09:49' WHERE `voucher_meta`.`id` = 146[0m
  [1m[35mMember::Sequence Load (0.3ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 2 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 2 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 2 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '484d87b98ee84c185288ef205bdbe351', 0, '123456', 'test', '2014-08-24 08:09:49', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 102
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:09:49', 102, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:09:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 102  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 14 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:09:49', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 14 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 102 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '4e9190e63981a68df204bf47a6fe434b', 0, '123456', 'test', '2014-08-24 08:09:49', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 103[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:09:49', 103, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 103  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.4ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 15 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.3ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:09:49', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 15 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 103 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:09:49', 103, 'test', '2014-08-24 08:09:49')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 103) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:09:49', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 103 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 103  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 103  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:49', 'dab09b8b3bc3945bc4ffa9fe2224ee55', 0, '123456', 'test', '2014-08-24 08:09:49', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 104[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:09:49', 104, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:09:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 104 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:09:49', '9223097590042a6ce75a37de7e9e4ab4', 0, '123456', 'test', '2014-08-24 08:09:49', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 105 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:11:23', 'f76f262cd9f70240e33dd9baadfd8241', 0, '123456', 'test', '2014-08-24 08:11:23', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 106 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:11:23', '606db1b3247791a8e5add73f9f37a3dd', 0, '123456', 'test', '2014-08-24 08:11:23', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 107
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:11:23', 107, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 107 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:11:23', '846da0b5f7c0df4de9a7e1a69cbf22ae', 0, '123456', 'test', '2014-08-24 08:11:23', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 108
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:11:23', 108, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 108  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 18 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:11:23', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 18 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 108 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:11:23', 108, 'test', '2014-08-24 08:11:23')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 108) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:11:23', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 108 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 108  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 108  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:11:23', '0d1deb5a972cc064b32b1f4f679b97d8', 0, '123456', 'test', '2014-08-24 08:11:23', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 109
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:11:23', 109, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 109  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 19 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:11:23', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 19 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 109 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (15.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', 'da57fe73e591eb2198904aa08073db14', 0, '123456', 'test', '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123751', 1, 0, '1d14d8e1ba7af5c005d0035ed70fa939', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123753', 0, 'ed75a2406d7444fa60ef6416f3e67a19', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123756', 2, 0, '4fb7c46e47557cd1a29b578b8d7d4fad', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ed75a2406d7444fa60ef6416f3e67a19'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 148 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 148[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '87fce4083f4f93770206826d9df81d74', '2014-08-24 08:11:23', 148)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 110, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 38[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 110) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 110, 'system', 0, '123456', 'e15ad4c16ecf6da5c04376cc663d22c5', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', 'ed75a2406d7444fa60ef6416f3e67a19', '87fce4083f4f93770206826d9df81d74')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ed75a2406d7444fa60ef6416f3e67a19'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 148 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 148
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '7b1f91cac09588a4e321fe07a7050e17', '2014-08-24 08:11:23', 148)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 110, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 39
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 110) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 110, 'system', 0, '123456', '16853b26976dc11cc5affe50f31b0367', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', 'ed75a2406d7444fa60ef6416f3e67a19', '7b1f91cac09588a4e321fe07a7050e17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ed75a2406d7444fa60ef6416f3e67a19'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 148 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 148[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '398baeed2c68066e5a2f2c4c5071beeb', '2014-08-24 08:11:23', 148)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 110, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 40[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 110) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 110, 'system', 0, '123456', '676e53f8da912f5661fe8f392df935a8', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', 'ed75a2406d7444fa60ef6416f3e67a19', '398baeed2c68066e5a2f2c4c5071beeb')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 110[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 148 LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', '57a5290f5ccf7d53f545d3efba4235ae', 0, '123456', 'test', '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123826', 1, 0, 'c5ce677f5cf671b6265e422b21bc40f9', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123828', 0, '0ecd472c457d1fc8ab9977bce299a687', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123830', 2, 0, '5a9956d4d061b5eaafd8a1cacc522171', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'c5ce677f5cf671b6265e422b21bc40f9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 150 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 150[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '4a400f1f97f0cfcb1ea94254e95e25ec', '2014-08-24 08:11:23', 150)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 111, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 41[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 111) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 111, 'system', 0, '123456', '49e569c08d299c0d365175a1a47466bf', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', 'c5ce677f5cf671b6265e422b21bc40f9', '4a400f1f97f0cfcb1ea94254e95e25ec')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 111[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.3ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 111  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (150)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 150 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', 'aa987e16bc9e4b81a72363d80dcaa879', 0, '123456', 'test', '2014-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123852', 1, 0, 'd3c0b7019f6106280cd34b23ab95e45d', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123854', 0, 'b2ad4e77ea331f18cb1fc9af4627e1fd', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123856', 2, 0, '3dd731348d9527bc6b38c6cb2e02b3e9', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:11:23', 'd4e7babd53fa5ad82cbebdd6e92f0afd', 0, '1234561', 'test1', '2014-08-24 08:11:23', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '3dd731348d9527bc6b38c6cb2e02b3e9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 155 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 112 AND `vouchers`.`voucher_meta_id` = 155
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 155[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '285e963b49b37f5c4b9d3049ce948b25', '2014-08-24 08:11:23', 155)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 112, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 42[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 112) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 112, 'system', 0, '123456', 'fd57a1f1de6815d4f29ce145d642acee', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', '3dd731348d9527bc6b38c6cb2e02b3e9', '285e963b49b37f5c4b9d3049ce948b25')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '3dd731348d9527bc6b38c6cb2e02b3e9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 155 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 113 AND `vouchers`.`voucher_meta_id` = 155
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 155[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '640b4b11abdc77e9a99e724df54b5a9b', '2014-08-24 08:11:23', 155)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 113, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 43[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 113) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 113, 'system', 0, '1234561', '0a770a0f284f5e4fecf7f466f483a489', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', '3dd731348d9527bc6b38c6cb2e02b3e9', '640b4b11abdc77e9a99e724df54b5a9b')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 112[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 113
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', '9fb7bf615dd97d12782fe95c8f4d4324', 0, '123456', 'test', '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123887', 1, 0, '070fc5dccae93a0b89d18fee859e398a', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123890', 0, '4eb1efaa3aa9be284156fcb82c3ca9b1', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123892', 2, 0, 'f195093a4b4d297dc819325f3646ff3e', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 156[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '070fc5dccae93a0b89d18fee859e398a'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', 'b2185519836c452c7d6f7d6c12bb1a74', 0, '123456', 'test', '2014-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123901', 1, 0, '79a4ca700361fde96c192fca02ed01f9', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123903', 0, '0b3a14fb85f8af17fb4d60ecf77aa36c', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123905', 2, 0, '8eb6a8644204845b6e0b28f0f0560173', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '79a4ca700361fde96c192fca02ed01f9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 159 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 159
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '788ab223ba40170a614cde254865bd04', '2014-08-24 08:11:23', 159)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 115, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 44
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 115) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 115, 'system', 0, '123456', '9b356bf0a345cfcde25b82ddc21189fb', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', '79a4ca700361fde96c192fca02ed01f9', '788ab223ba40170a614cde254865bd04')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '79a4ca700361fde96c192fca02ed01f9'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 159 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', '44a3b917601b3fee100a947aa92cb03d', 0, '123456', 'test', '2014-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123924', 1, 0, 'c6d646f92f9b199a5c4c2947c239e567', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123926', 0, '40f3688a04fa3c9fe08b764a0bc29cfe', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123928', 2, 0, 'e39394c5a80df89728b9d7736e72736c', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e39394c5a80df89728b9d7736e72736c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 164 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 116 AND `vouchers`.`voucher_meta_id` = 164
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 164[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, '142038209ea652ba47ee2fa13ea4c0c6', '2014-08-24 08:11:23', 164)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 116, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 45[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 116) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 116, 'system', 0, '123456', 'effd068f361d83abb192cdc6dac29132', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', 'e39394c5a80df89728b9d7736e72736c', '142038209ea652ba47ee2fa13ea4c0c6')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e39394c5a80df89728b9d7736e72736c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 164 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 116 AND `vouchers`.`voucher_meta_id` = 164
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', 'a439fafdc247b364bcba5afd11a144a4', 0, '123456', 'test', '2014-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123948', 1, 0, '2d4269c5a0fdae9fcb22737ef50c59ba', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123951', 0, 'c0e1a86fb33891d5416227f82fe4731d', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123953', 2, 0, '866a06dc97a509827cd188c4853dc489', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 165 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 165[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:23', 1, 'a93e01e5124aae2493a92c0048cea029', '2014-08-24 08:11:23', 165)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 117, `updated_at` = '2014-08-24 08:11:23' WHERE `vouchers`.`id` = 46[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 117) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:23', 117, 'system', 0, '123456', 'b8e44c472ddb1f97f5fe71f69b1d80e8', 0, '2014-08-24 08:11:23', 'issue', '2014-08-24 08:11:23', '2d4269c5a0fdae9fcb22737ef50c59ba', 'a93e01e5124aae2493a92c0048cea029')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 117[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 117  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (165)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 165 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:23', 'ab36034d1d0c60a663d16f2b258ecefa', 0, '123456', 'test', '2014-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123973', 1, 0, '6379cedf778c155bc52b2f3e3e3dcf80', '2014-08-24 08:11:23', 1, 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123975', 0, '97f9c03d8c0a090782bb41f4c1b9018d', '2014-08-24 08:11:23', 0, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123977', 2, 0, '29e7a10e190274f47a32cd983fbe68b1', '2014-08-24 08:11:23', 2, 0, 1, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:11:23', '2014-08-24 08:11:23')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:11:23', '1234', 3, '2014-08-24 08:11:23')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:11:23', '1235', 3, '2014-08-24 08:11:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161123996', 0, 'a9c7eb0074aa9188e445d3eceb35502d', '2014-08-24 08:11:23', 0, 3, 0, 1, '2014-08-24 08:11:23', '2014-08-24 08:11:23', '2024-08-24 08:11:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 171 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:11:23' WHERE `voucher_meta`.`id` = 171
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 3 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 3 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 3 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:11:24', `used` = 1 WHERE `sequence_numbers`.`id` = 5
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:24', '1234', 1, '4b8038b2aaf4f90095b939c52b733ecf', '2014-08-24 08:11:24', 171)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 118, `updated_at` = '2014-08-24 08:11:24' WHERE `vouchers`.`id` = 47
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 118) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:24', 118, 'system', 0, '123456', '8257b21e7e81f86de52421806197e397', 0, '2014-08-24 08:11:24', 'issue', '2014-08-24 08:11:24', 'a9c7eb0074aa9188e445d3eceb35502d', '1234', '4b8038b2aaf4f90095b939c52b733ecf')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 171 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:11:24' WHERE `voucher_meta`.`id` = 171[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 3 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 3 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 3 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:11:24', `used` = 1 WHERE `sequence_numbers`.`id` = 6[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:11:24', '1235', 1, 'b1b8c60b9f787a7cdf4cfcb341e62287', '2014-08-24 08:11:24', 171)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 118, `updated_at` = '2014-08-24 08:11:24' WHERE `vouchers`.`id` = 48[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 118) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:11:24', 118, 'system', 0, '123456', '10f959132f47f9e2d7a91ae9a1e5f084', 0, '2014-08-24 08:11:24', 'issue', '2014-08-24 08:11:24', 'a9c7eb0074aa9188e445d3eceb35502d', '1235', 'b1b8c60b9f787a7cdf4cfcb341e62287')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 171 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:11:24' WHERE `voucher_meta`.`id` = 171[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 3 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 3 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 3 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', 'b3996f7fe3131f70931b58a18b8ba334', 0, '123456', 'test', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124033', 1, 0, 'c83d09bacf497589f8d04eb0bd622321', '2014-08-24 08:11:24', 1, 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124035', 0, '56d31ed1b5bbe4ff77d65c15ba9d525b', '2014-08-24 08:11:24', 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124037', 2, 0, '663e4f57419a917c7fddf3323838478f', '2014-08-24 08:11:24', 2, 0, 1, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:11:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:11:24', '3d5f39db066e41beefc3ea369b649a56', 0, '2014-08-24 08:11:24')
  [1m[36mMerchant::MerchantStore Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 17) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 120, `updated_at` = '2014-08-24 08:11:24' WHERE `merchant_stores`.`id` = 17
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:11:24', 'test_group', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', '79d7bd791cc1b6e0c4f59d92f12622d9', 0, '112312323', 'test', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 121 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 17 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:11:24', 121, 17, 'Merchant::MerchantStore', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 121) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 121 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 17 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 121) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 121 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 121 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 121 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 17 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 17 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 17 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', 'f0825a4d1c25b1d49f3603c2af9184f9', 0, '123456', 'test', '2014-08-24 08:11:24')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124128', 1, 0, '0ba97581da4079448bfb672d4fd3f8b8', '2014-08-24 08:11:24', 1, 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124130', 0, '7b7979fd9f6d8c1d69f9f87a9f412861', '2014-08-24 08:11:24', 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124133', 2, 0, '516e4e89974a87d89cd20cff65ad8a11', '2014-08-24 08:11:24', 2, 0, 1, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:11:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:11:24', '758f602dfa69feefe7bc76eb5314154c', 0, '2014-08-24 08:11:24')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 18) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 123, `updated_at` = '2014-08-24 08:11:24' WHERE `merchant_stores`.`id` = 18[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:11:24', 'test_group', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', '6ad291c4f5ee8c7bb028f9e0173be694', 0, '112312323', 'test', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 124 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 18 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:11:24', 124, 18, 'Merchant::MerchantStore', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 124) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 124 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 124 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 124 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 18 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 18 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 18 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', 'ab609e3764dd2ca49d645b03effc16fe', 0, '123456', 'test', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (2.8ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124163', 1, 0, '9a3828d0e53c384f97ab1693d7b21bec', '2014-08-24 08:11:24', 1, 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124168', 0, '7f3d9c7fd308f818fe74fa633e80ccfc', '2014-08-24 08:11:24', 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124171', 2, 0, 'd44e817306eba633572fb50fc6e59c0f', '2014-08-24 08:11:24', 2, 0, 1, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:11:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:11:24', '0ce82962000ed24ef06ab24bc28bd75c', 0, '2014-08-24 08:11:24')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 19) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 126, `updated_at` = '2014-08-24 08:11:24' WHERE `merchant_stores`.`id` = 19
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:11:24', 'test_group', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', '1cd0f0b10a8e739ce8af9fc807a690c1', 0, '112312323', 'test', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 127 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 7 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:11:24', 127, 7, 'Merchant::MerchantGroup', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 127) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 127 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 127 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 127 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 7 LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', 'b37ab1af05caa0d098b14b41f99ff90c', 0, '123456', 'test', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124222', 1, 0, '4a8852c4d89f405c457e8cc4565d350c', '2014-08-24 08:11:24', 1, 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124225', 0, 'dd324e3809e9fc829a552fcddb69aa62', '2014-08-24 08:11:24', 0, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161124227', 2, 0, '91ec39258aeedceccfdedb0f8737b1c4', '2014-08-24 08:11:24', 2, 0, 1, 0, 1, '2014-08-24 08:11:24', '2014-08-24 08:11:24', '2024-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:11:24', '111', 'test', 0.01, 'editing', '2014-08-24 08:11:24')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:11:24', '894fa4b88cfeaed92f54c4dd0091552c', 0, '2014-08-24 08:11:24')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 20) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 129, `updated_at` = '2014-08-24 08:11:24' WHERE `merchant_stores`.`id` = 20[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:11:24', 'test_group', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:11:24', '01698839859134548390927e50e6af9f', 0, '112312323', 'test', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 130 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 8 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:11:24', 130, 8, 'Merchant::MerchantGroup', '2014-08-24 08:11:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 130) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 130 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 8 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 130) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 130 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 130 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 130 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 8 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:12:04', 'ff5b1fd6381e525a628353876f6a0ae0', 0, '123456', 'test', '2014-08-24 08:12:04', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 131 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:12:04', '86ceda0982408f7e8693a5242ecad304', 0, '123456', 'test', '2014-08-24 08:12:04', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 132
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:12:04', 132, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:12:04')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 132 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:12:04', '0df5399ca9219ccc14eeb65df19b0a30', 0, '123456', 'test', '2014-08-24 08:12:04', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 133
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:12:04', 133, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:12:04')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 133  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 21 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:12:04', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 21 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 133 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:12:05', 133, 'test', '2014-08-24 08:12:05')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 133) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:12:05', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 133 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 133  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 133  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (1.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'ffc570ca8f2a7cdeea8adb9dd8898886', 0, '123456', 'test', '2014-08-24 08:12:05', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 134
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:12:05', 134, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 134  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 22 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:12:05', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 22 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 134 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (14.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '8f3bb7d2e8184009f4ebe91092bc18f0', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205072', 1, 0, '55be6616cb8a427394c9b0f080c2935c', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205074', 0, '01f2a0fb828ab26e869c2abc5bbcd804', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205076', 2, 0, 'd4c589e0284d87905e1098b36e4d3f4e', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '55be6616cb8a427394c9b0f080c2935c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 184 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 184[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, '27b5289de441fbfd3611387d424cd071', '2014-08-24 08:12:05', 184)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 135, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 49[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 135) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 135, 'system', 0, '123456', 'df29c34bdd2f10551f43293b65bfb936', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '55be6616cb8a427394c9b0f080c2935c', '27b5289de441fbfd3611387d424cd071')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '55be6616cb8a427394c9b0f080c2935c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 184 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'e222d3ab86c5d18a93a0ecc01dd196e8', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205130', 1, 0, 'd4936b162d2d80ca7791653fc7ac3e0a', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205133', 0, '8bf1b37c45acb7f595f2f4b838481435', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205135', 2, 0, '1b7b2148c425cf0af1e4f32c6995e8d8', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 187 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 187
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, '1e5c1dbdefd1214a84fcfe65dace4564', '2014-08-24 08:12:05', 187)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 136, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 50
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 136) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 136, 'system', 0, '123456', 'e91cf264b5ad14abfab41588a398ae18', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', 'd4936b162d2d80ca7791653fc7ac3e0a', '1e5c1dbdefd1214a84fcfe65dace4564')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 136
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 136  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (187)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 187 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '0d4935a108f5ca386a6343dd8bc35dd3', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205156', 1, 0, '0b89b0dde2cc0c3cca0de1ba7dc4a34b', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205159', 0, '1944ff63d55cb501a258b6f0ae329433', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205161', 2, 0, 'b609f738ae2975067949d95860bf1fea', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '1944ff63d55cb501a258b6f0ae329433'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 191 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 191[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, '6b1b3f9e6ccd51d3df40b11440f6b3bd', '2014-08-24 08:12:05', 191)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 137, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 51[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 137) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 137, 'system', 0, '123456', 'f2193f91feccf6f9a39b6209235d16df', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '1944ff63d55cb501a258b6f0ae329433', '6b1b3f9e6ccd51d3df40b11440f6b3bd')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '1944ff63d55cb501a258b6f0ae329433'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 191 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 191
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, 'a2e418b44a4435c1df63c80e8437a2b6', '2014-08-24 08:12:05', 191)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 137, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 52
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 137) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 137, 'system', 0, '123456', '948f1370f2014e4885748bc083e1d2fc', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '1944ff63d55cb501a258b6f0ae329433', 'a2e418b44a4435c1df63c80e8437a2b6')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '1944ff63d55cb501a258b6f0ae329433'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 191 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 191[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, '77505d61d6ce7ccc9aa0d94bdbcc3410', '2014-08-24 08:12:05', 191)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 137, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 53[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 137) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 137, 'system', 0, '123456', 'af2c1b0ba9fa200dccb322e8998dc3e3', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '1944ff63d55cb501a258b6f0ae329433', '77505d61d6ce7ccc9aa0d94bdbcc3410')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 137[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 191 LIMIT 1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'ad9f5aee8d52be4ac8e0d120ede800e1', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205194', 1, 0, '40425fd202000bea95de207d8e534eeb', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205196', 0, 'cf025f17250eeffc5033c60dcf2042e9', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205198', 2, 0, '269ccc299fe67c3401119dce8d096384', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '269ccc299fe67c3401119dce8d096384'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 195 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 138 AND `vouchers`.`voucher_meta_id` = 195[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 195
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, 'fcd62bb5bddc75f27f41efba7fa9403d', '2014-08-24 08:12:05', 195)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 138, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 54
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 138) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 138, 'system', 0, '123456', '2d818038771b47fbd05d248c173341db', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '269ccc299fe67c3401119dce8d096384', 'fcd62bb5bddc75f27f41efba7fa9403d')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '269ccc299fe67c3401119dce8d096384'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 195 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 138 AND `vouchers`.`voucher_meta_id` = 195[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'c455c444e80ebc4091fe58b6e76174fa', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205218', 1, 0, 'f70de5b83aa5f802bec7d4b4741feae3', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205220', 0, 'f800615632c125b96912d75f7a601c44', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205222', 2, 0, '3aa4bf8cf6d825468ac20585c9702899', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 196[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'f70de5b83aa5f802bec7d4b4741feae3'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '5ce82bd2097ef89d8fc1a6f4dfcf68a3', 0, '123456', 'test', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205232', 1, 0, '695ef37ac9c467163aed62dbbb49a3f1', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205234', 0, 'cc5110663a3dc573a3e93b7d24c06e77', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205236', 2, 0, '545355116749c6378ecb08f62133dfa8', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:12:05', 'e3504734fe93453b3265953902bc5ce0', 0, '1234561', 'test1', '2014-08-24 08:12:05', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '545355116749c6378ecb08f62133dfa8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 201 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 140 AND `vouchers`.`voucher_meta_id` = 201
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 201[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, 'bb4050486e546f08f032f0bc7d5695bf', '2014-08-24 08:12:05', 201)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 140, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 55[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 140) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 140, 'system', 0, '123456', '8fe9c58ea34cae00cef10024417c894e', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '545355116749c6378ecb08f62133dfa8', 'bb4050486e546f08f032f0bc7d5695bf')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '545355116749c6378ecb08f62133dfa8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 201 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 141 AND `vouchers`.`voucher_meta_id` = 201
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 201[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, '0ab4f166185b732479620648eb47d295', '2014-08-24 08:12:05', 201)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 141, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 56[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 141) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 141, 'system', 0, '1234561', 'ae5fecf6415cd51a516047a0ad7c5a2d', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', '545355116749c6378ecb08f62133dfa8', '0ab4f166185b732479620648eb47d295')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 140[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 141
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'b2a284304c76e6e57e73d4e344891b47', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205266', 1, 0, 'c4342a47a32a183ac098047d7373eb91', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205268', 0, '694c4e437624c22906ca74286c2c4106', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205270', 2, 0, 'f3444522bfeb0b0ef8fd8ceea23433f1', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'c4342a47a32a183ac098047d7373eb91'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 202 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 202[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', 1, '16954cf882adc81e622dafa4a927c28e', '2014-08-24 08:12:05', 202)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 142, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 57[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 142) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 142, 'system', 0, '123456', '0f5265c6ef2c8d8beca624f6bea970e3', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', 'c4342a47a32a183ac098047d7373eb91', '16954cf882adc81e622dafa4a927c28e')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 142[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 142  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (202)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 202 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '0b960ba086eab474bafe898295b53954', 0, '123456', 'test', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205290', 1, 0, '781fa6c90b7f22641ccd64428d11520b', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205292', 0, 'd8a6200c969ecfd1f575408814fec9a8', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205295', 2, 0, '625ac6c790474b94ce4d9c28c8eb75e7', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:12:05', '2014-08-24 08:12:05')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:12:05', '1234', 4, '2014-08-24 08:12:05')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:12:05', '1235', 4, '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205313', 0, 'bd4e599c9fb33ff79ce25413def03a5f', '2014-08-24 08:12:05', 0, 4, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 208 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 208
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 4 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 4 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 4 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:12:05', `used` = 1 WHERE `sequence_numbers`.`id` = 7
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', '1234', 1, 'e2431d12ea6e9bf2da117dc615006ac6', '2014-08-24 08:12:05', 208)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 143, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 58
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 143) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 143, 'system', 0, '123456', '3faff2220f892546e49ade7d6d62d617', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', 'bd4e599c9fb33ff79ce25413def03a5f', '1234', 'e2431d12ea6e9bf2da117dc615006ac6')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 208 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 208[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 4 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 4 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 4 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:12:05', `used` = 1 WHERE `sequence_numbers`.`id` = 8[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:12:05', '1235', 1, '1f27acfa144c3bb1253d6203236ac118', '2014-08-24 08:12:05', 208)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 143, `updated_at` = '2014-08-24 08:12:05' WHERE `vouchers`.`id` = 59[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 143) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:12:05', 143, 'system', 0, '123456', '770989745561375cec9398cf7ce1a4ee', 0, '2014-08-24 08:12:05', 'issue', '2014-08-24 08:12:05', 'bd4e599c9fb33ff79ce25413def03a5f', '1235', '1f27acfa144c3bb1253d6203236ac118')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 208 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:12:05' WHERE `voucher_meta`.`id` = 208[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 4 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 4 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 4 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '3b46bc944e0f0af78c485cb5e8b494e1', 0, '123456', 'test', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205347', 1, 0, 'df5dfbc6c2e19fc3fed27a9953375ad9', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205349', 0, 'f3b34754d184e3b827a609b1278f23fe', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205351', 2, 0, '85262087d268e64ce4aa11a7a1b9b6b2', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:12:05', '111', 'test', 0.01, 'editing', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:12:05', '3830e43e8189f81e252276229455d717', 0, '2014-08-24 08:12:05')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 21) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 145, `updated_at` = '2014-08-24 08:12:05' WHERE `merchant_stores`.`id` = 21
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:12:05', 'test_group', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '65ad933d14c0937fa9b0e46ed38948ff', 0, '112312323', 'test', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 146 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 9 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:12:05', 146, 9, 'Merchant::MerchantGroup', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 146) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 146 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 9 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 146) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 146 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 146 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 146 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 9 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 9 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 9 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'a6c9b6e842786c41f033250dfa50707b', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205444', 1, 0, '183b13d6456eb5c0783a37d8a8237f7e', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205446', 0, '6b3b694f95715c11835549468e38db9d', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205448', 2, 0, '7603bda7fd0fd374d2305641e3c3dc8a', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:12:05', '111', 'test', 0.01, 'editing', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:12:05', '2e379db8f1b890eeb3cf9bd691ec7c51', 0, '2014-08-24 08:12:05')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 22) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 148, `updated_at` = '2014-08-24 08:12:05' WHERE `merchant_stores`.`id` = 22[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:12:05', 'test_group', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '7133a2d23f625cab509de797c1555176', 0, '112312323', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 149 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 10 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:12:05', 149, 10, 'Merchant::MerchantGroup', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 149) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 149 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 149 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 149 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 10 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 10 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 10 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', 'd7a0c825bbae55e6e0a692c2754e8383', 0, '123456', 'test', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205477', 1, 0, '59a8c51dd6996de0ef545f78048e6b8a', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205479', 0, 'e0417b883a620da1335034b048d53585', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205481', 2, 0, 'dad7bd171a6330cbbb864d440e4d227f', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:12:05', '111', 'test', 0.01, 'editing', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:12:05', 'c0529008696f7b9fd71f9fe1400748da', 0, '2014-08-24 08:12:05')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 23) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 151, `updated_at` = '2014-08-24 08:12:05' WHERE `merchant_stores`.`id` = 23
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:12:05', 'test_group', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '49cf7eaf956647c21e8a6717c0fe372f', 0, '112312323', 'test', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.4ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 152 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 23 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:12:05', 152, 23, 'Merchant::MerchantStore', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 152) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 152 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 152 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 152 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 23 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 23 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 23 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '738d257ad60fe5706e08bcf439c52c03', 0, '123456', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205528', 1, 0, '9059216bbc68eec208bfff8959adacef', '2014-08-24 08:12:05', 1, 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205530', 0, '6a663199de8dd2608761f729308efe67', '2014-08-24 08:12:05', 0, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824161205532', 2, 0, '9e3c5621e3000da4114fd96d79382742', '2014-08-24 08:12:05', 2, 0, 1, 0, 1, '2014-08-24 08:12:05', '2014-08-24 08:12:05', '2024-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:12:05', '111', 'test', 0.01, 'editing', '2014-08-24 08:12:05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:12:05', 'fbd7419c16e284ebd3d94f48ba426c58', 0, '2014-08-24 08:12:05')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 24) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 154, `updated_at` = '2014-08-24 08:12:05' WHERE `merchant_stores`.`id` = 24[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:12:05', 'test_group', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:12:05', '127987d3d71c06c029230e8a51b5df12', 0, '112312323', 'test', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 155 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 24 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:12:05', 155, 24, 'Merchant::MerchantStore', '2014-08-24 08:12:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 155) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 155 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 24 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 155) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 155 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 155 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 155 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 24 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 24 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 24 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:14:05', '111', 'test', 0.01, 'editing', '2014-08-24 08:14:05')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:14:05', 'f669198b30a96f0a91cd6a602e305a6e', 0, '2014-08-24 08:14:05')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 25) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 156, `updated_at` = '2014-08-24 08:14:05' WHERE `merchant_stores`.`id` = 25
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:15:34', '111', 'test', 0.01, 'editing', '2014-08-24 08:15:34')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:15:34', 'ede09fadc49d843c051c1d6b934dfcc0', 0, '2014-08-24 08:15:34')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 26) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 157, `updated_at` = '2014-08-24 08:15:34' WHERE `merchant_stores`.`id` = 26
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:15:34', 26, 'register', 2, '2014-08-24 08:15:34', '2014-08-24 08:15:34', '2024-08-24 08:15:34')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:15:34', 26, 'bind_card', 2, '2014-08-24 08:15:34', '2014-08-24 08:15:34', '2024-08-24 08:15:34')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:15:34', 26, 'transaction', 2, '2014-08-24 08:15:34', '2014-08-24 08:15:34', '2024-08-24 08:15:34')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (12.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:16:11', '111', 'test', 0.01, 'editing', '2014-08-24 08:16:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:16:11', 'bce8e57b21cadca2075252eaa0360638', 0, '2014-08-24 08:16:11')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 27) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 158, `updated_at` = '2014-08-24 08:16:11' WHERE `merchant_stores`.`id` = 27
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:16:11', 27, 'register', 2, '2014-08-24 08:16:11', '2014-08-24 08:16:11', '2024-08-24 08:16:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:16:11', 27, 'bind_card', 2, '2014-08-24 08:16:11', '2014-08-24 08:16:11', '2024-08-24 08:16:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:16:11', 27, 'transaction', 2, '2014-08-24 08:16:11', '2014-08-24 08:16:11', '2024-08-24 08:16:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:16:11', 27, 'none', 1, '2014-08-24 08:16:11', '1976-01-01 00:00:00', '2024-08-24 08:16:11', 3)
  [1m[36mPay::PaymentPlan Load (0.5ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 27 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 27 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 27) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-24 08:16:11' WHERE `merchant_stores`.`id` = 27
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (6, 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 27 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 27 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 27) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 27
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:16:48', '49e89ca0095a14ead1897a1e31889831', 0, '123456', 'test', '2014-08-24 08:16:48')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:16:48', '111', 'test', 0.01, 'editing', '2014-08-24 08:16:48')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:16:48', '85f0edfb391d2daa521fa82190b5e17b', 0, '2014-08-24 08:16:48')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 28) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 160, `updated_at` = '2014-08-24 08:16:48' WHERE `merchant_stores`.`id` = 28
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:16:48', 'test_group', '2014-08-24 08:16:48')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:16:48', 159, 28, 'Merchant::MerchantStore', '2014-08-24 08:16:48')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 159) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 159 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 28 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (29.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:16:48', 'ed0b2754cccd6d23e7a2ad45683cf926', 0, '123456', 'test', '2014-08-24 08:16:48')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:16:48', '111', 'test', 0.01, 'editing', '2014-08-24 08:16:48')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:16:48', 'df7ccf82ce5a1a6d0d4d737acf18aa92', 0, '2014-08-24 08:16:48')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 29) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 162, `updated_at` = '2014-08-24 08:16:48' WHERE `merchant_stores`.`id` = 29[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:16:48', 'test_group', '2014-08-24 08:16:48')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:16:48', 161, 14, 'Merchant::MerchantGroup', '2014-08-24 08:16:48')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 161) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 161 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 14 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:17:38', '111', 'test', 0.01, 'editing', '2014-08-24 08:17:38')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-24 08:17:38', '5cdad54f0326a21ec92fc74198acb156', 0, '2014-08-24 08:17:38', 8000)
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 30) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 163, `updated_at` = '2014-08-24 08:17:38' WHERE `merchant_stores`.`id` = 30
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::MerchantCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 163 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 163  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-24 08:17:38', 163, 'test name', '2014-08-24 08:17:38')[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:17:38', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 163 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.4ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:18:08', '111', 'test', 0.01, 'editing', '2014-08-24 08:18:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:18:08', 'aa901a94b0cae256c2786b5a34ccff7e', 0, '2014-08-24 08:18:08')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 31) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 164, `updated_at` = '2014-08-24 08:18:08' WHERE `merchant_stores`.`id` = 31
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:18:08', 'test_group', '2014-08-24 08:18:08')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (19.9ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:18:26', '111', 'test', 0.01, 'editing', '2014-08-24 08:18:26')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:18:26', '37daa9df24cad82ea1b106f436fccae7', 0, '2014-08-24 08:18:26')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 32) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 165, `updated_at` = '2014-08-24 08:18:26' WHERE `merchant_stores`.`id` = 32
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:18:26', 'test_group', '2014-08-24 08:18:26')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-24 08:18:26', 16, 32, '2014-08-24 08:18:26')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 16) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 16 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 16[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 32 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 32[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 32  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-24 08:19:02', '11', 'test', 0.01, 'editing', '2014-08-24 08:19:02')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-24 08:19:02', '973a285b0d4dac305575f4104bddc315', 0, 'test1', '2014-08-24 08:19:02')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 33[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-24 08:19:02', '2014-08-24 08:19:02')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-24 08:19:13', '11', 'test', 0.01, 'editing', '2014-08-24 08:19:13')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-24 08:19:13', '095b872a921bed47dc3b1980f7b3db12', 0, 'test1', '2014-08-24 08:19:13')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 34[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 167 AND `credit_accounts`.`lock_version` = 0
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 34[0m
  [1m[35mMerchant::MerchantGroupShip Load (0.2ms)[0m  SELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 34
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 34[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 34
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (13.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-24 08:19:13', '2014-08-24 08:19:13')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-24 08:19:23', '11', 'test', 0.01, 'editing', '2014-08-24 08:19:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-24 08:19:23', '4eb9d6e82b05bc87e64fbcb3a44351ad', 0, 'test1', '2014-08-24 08:19:23')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 35[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 168 AND `credit_accounts`.`lock_version` = 0
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 35[0m
  [1m[35mMerchant::MerchantGroupShip Load (0.2ms)[0m  SELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 35
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 35[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 35
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-24 08:19:23', '2014-08-24 08:19:23')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('6c606ca2f66b57c82a7c991ce8f03435', 'core-engine', 'test', '2014-08-24 08:20:18', '0', '2014-08-24 08:20:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '6c606ca2f66b57c82a7c991ce8f03435' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = '6c606ca2f66b57c82a7c991ce8f03435' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '6c606ca2f66b57c82a7c991ce8f03435' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('6b8729b331799c895c071f15335dfd08', 'core-engine', 'test', '2014-08-24 08:20:18', '0', '2014-08-24 08:20:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-24 08:20:18' WHERE `platform_accounts`.`id` = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '6b8729b331799c895c071f15335dfd08' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162126135', 0, '3e0846aade55d1acdfd997541dcc7836', '2014-08-24 08:21:26', 0, 0, 2, '2014-08-24 08:21:26', '2014-08-24 08:21:26', '2024-08-24 08:21:26')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:21:26', 'transaction', 2, '2014-08-24 08:21:26', '2014-08-24 08:21:26', '2024-08-24 08:21:26')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (28.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162126196', 0, '9fc98ac23c547640b2c9929e32b56d6a', '2014-08-24 08:21:26', 0, 0, 2, '2014-08-24 08:21:26', '2014-08-24 08:21:26', '2024-08-24 08:21:26')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:21:26', 'transaction', 2, '2014-08-24 08:21:26', '2014-08-24 08:21:26', '2024-08-24 08:21:26')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162212313', 0, '392b0ea312a622310d163f9be82b51fa', '2014-08-24 08:22:12', 0, 0, 2, '2014-08-24 08:22:12', '2014-08-24 08:22:12', '2024-08-24 08:22:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:22:12', 'transaction', 2, '2014-08-24 08:22:12', '2014-08-24 08:22:12', '2024-08-24 08:22:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-24 08:22:12', 9, '2014-08-24 08:22:12', 223)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 9
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 9  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (223)
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 9  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (223)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162212358', 0, 'fd90063da811ef102de5fdfaf1fc4762', '2014-08-24 08:22:12', 0, 0, 2, '2014-08-24 08:22:12', '2014-08-24 08:22:12', '2024-08-24 08:22:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:22:12', 'transaction', 2, '2014-08-24 08:22:12', '2014-08-24 08:22:12', '2024-08-24 08:22:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-24 08:23:16', '95b54e62c34e6955791b3870e2c7f261', 'roll_back', '2014-08-24 08:23:16', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:24:12', '2014-08-24 08:24:12')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:24:12', '1234', 5, '2014-08-24 08:24:12')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:24:12', '1235', 5, '2014-08-24 08:24:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.3ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 5 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 5 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:24:12', `used` = 1 WHERE `sequence_numbers`.`id` = 9
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 5 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 5 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:24:12', `used` = 1 WHERE `sequence_numbers`.`id` = 10
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 5 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 5 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (23.3ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-24 08:25:07', 1, 0, '2014-08-24 08:25:06', 'none', '2014-08-24 08:25:07')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-24 08:25:07' WHERE (`transaction_logs`.`id` = 2 AND `transaction_logs`.`transaction_datetime` = '2014-08-24 08:25:06')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616305', 1, 0, 'f1f58904c6dc2526d9c4dae90a03218f', '2014-08-24 08:26:16', 10000, 1, 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:26:16' WHERE `voucher_meta`.`id` = 225[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:26:16', 1, 'd6815a286e7307ea029046a59a5ed428', '2014-08-24 08:26:16', 225)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 225 LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:26:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:26:16', '3c935cbcd09c6b2fa6f370b0c5f5124c', 0, '2014-08-24 08:26:16')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 36) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 169, `updated_at` = '2014-08-24 08:26:16' WHERE `merchant_stores`.`id` = 36
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-24 08:26:16', 'test_display', 'test_group', '2014-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616400', 0, '8ed2f552fc713b9386482c77cdd71894', '2014-08-24 08:26:16', 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (18.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616432', 0, '4fdf385b9c9e205885ba7a4370be8790', '2014-08-24 08:26:16', 0, 0, 1, '2014-08-24 08:26:16', '2014-08-24 08:21:16', '2014-08-24 08:31:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616434', 0, '040dbd246b40b74a1275c968220290f5', '2014-08-24 08:26:16', 0, 0, 1, '2014-08-24 08:26:16', '2014-08-24 08:31:16', '2014-08-24 08:21:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616437', 0, 'eaff970a3fa040bc6c44b69268cea90e', '2014-08-24 08:26:16', 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616442', 100, 0, '484974d1bfa898dc8fab16d02376949c', '2014-08-24 08:26:16', 100, 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-24 08:26:16' WHERE `voucher_meta`.`id` = 230
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-24 08:26:16' WHERE `voucher_meta`.`id` = 230[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616448', 0, '0d9b003eaf29fe94b2f9ea61e86bb119', '2014-08-24 08:26:16', 10000, 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:26:16', 'e8c61e6717868a9717b2b6aa308f82a3', 0, '123456', 'test', '2014-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:26:16' WHERE `voucher_meta`.`id` = 231[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:26:16', 1, 'a5962b6a6e4a5d5489d4c1304a493483', '2014-08-24 08:26:16', 231)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 170, `updated_at` = '2014-08-24 08:26:16' WHERE `vouchers`.`id` = 61[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 170) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 170  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (231)[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616475', 0, '2753e7c1cb0743dca49dfd7df2826ba5', '2014-08-24 08:26:16', 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:26:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:26:16', '23e45ed11b02d57b6365689a826c1879', 0, '2014-08-24 08:26:16')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 37) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 171, `updated_at` = '2014-08-24 08:26:16' WHERE `merchant_stores`.`id` = 37
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:26:16', 'test_group', '2014-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162616494', 0, '5aedad951a75b766cc9756ae17a6927d', '2014-08-24 08:26:16', 0, 0, 2, '2014-08-24 08:26:16', '2014-08-24 08:26:16', '2024-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:26:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:26:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:26:16', '03160ec4897be65335de50c7e7ff8ccc', 0, '2014-08-24 08:26:16')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 38) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 172, `updated_at` = '2014-08-24 08:26:16' WHERE `merchant_stores`.`id` = 38
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:26:16', 'test_group', '2014-08-24 08:26:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:26:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:26:59', 'cc41a25b9074e58af0bd494952727cfc', 0, '2014-08-24 08:26:59')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 39) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 173, `updated_at` = '2014-08-24 08:26:59' WHERE `merchant_stores`.`id` = 39
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-24 08:26:59', 'test_display', 'test_group', '2014-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659851', 0, '0d71ba2f2c64eec406e41ea9c80faf2b', '2014-08-24 08:26:59', 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659857', 1, '1ad1c81872b9d3fa049496b684a1ebc1', '2014-08-24 08:26:59', 0, 39, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659861', 2, '7fe78381c54bef038f5ae854f04111c5', '2014-08-24 08:26:59', 0, 20, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (14.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659879', 0, 'f48d1ea0cc6d6c48430fb07350d7bd41', '2014-08-24 08:26:59', 10000, 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:26:59', '65293f77247e5d97ec8efddf780c2a2b', 0, '123456', 'test', '2014-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:26:59' WHERE `voucher_meta`.`id` = 237[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:26:59', 1, '1dc63f594bde3b6e40632bfcd4874bd1', '2014-08-24 08:26:59', 237)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 174, `updated_at` = '2014-08-24 08:26:59' WHERE `vouchers`.`id` = 62[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 174) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 174  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (237)[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659919', 0, '2b3f36b7f44df3db1c0e4b3c80c979e0', '2014-08-24 08:26:59', 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:26:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:26:59', '24604e167dec3d318b9edefca3d4c9b4', 0, '2014-08-24 08:26:59')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 40) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 175, `updated_at` = '2014-08-24 08:26:59' WHERE `merchant_stores`.`id` = 40
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:26:59', 'test_group', '2014-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 40, `updated_at` = '2014-08-24 08:26:59' WHERE `voucher_meta`.`id` = 238[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 238 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 40 LIMIT 1
  [1m[36m (1.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659935', 0, 'af945280bcb5c08f6482996fe31709d3', '2014-08-24 08:26:59', 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:26:59', '111', 'test', 0.01, 'editing', '2014-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:26:59', '461e6d168b4c3c1f0d7faeeb763a2ea7', 0, '2014-08-24 08:26:59')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 41) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 176, `updated_at` = '2014-08-24 08:26:59' WHERE `merchant_stores`.`id` = 41[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:26:59', 'test_group', '2014-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 22, `updated_at` = '2014-08-24 08:26:59' WHERE `voucher_meta`.`id` = 239
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 239 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 22 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659953', 1, 0, '93e3bab20010c32bd5287b02e3d77e25', '2014-08-24 08:26:59', 10000, 1, 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:26:59' WHERE `voucher_meta`.`id` = 240
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:26:59', 1, 'cfc77d31c7037ba7165c1642a9045a85', '2014-08-24 08:26:59', 240)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 240 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659962', 0, '8bf98db7d67823e080d37df1d98dcb28', '2014-08-24 08:26:59', 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659966', 100, 0, 'ff02cbc9f11554581ecd0af875d075ff', '2014-08-24 08:26:59', 100, 0, 0, 2, '2014-08-24 08:26:59', '2014-08-24 08:26:59', '2024-08-24 08:26:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-24 08:26:59' WHERE `voucher_meta`.`id` = 242[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-24 08:26:59' WHERE `voucher_meta`.`id` = 242
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659973', 0, 'be0fe55ce5f959a1bb2dc6f96322198d', '2014-08-24 08:26:59', 0, 0, 1, '2014-08-24 08:26:59', '2014-08-24 08:21:59', '2014-08-24 08:31:59')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162659975', 0, '12a96fa1411aa895f38fff4308d4c1d7', '2014-08-24 08:26:59', 0, 0, 1, '2014-08-24 08:26:59', '2014-08-24 08:31:59', '2014-08-24 08:21:59')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('6d159cba5124023494cc36a7602cad33', 'core-engine', 'test', '2014-08-24 08:27:15', '0', '2014-08-24 08:27:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-24 08:27:15' WHERE `platform_accounts`.`id` = 3
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '6d159cba5124023494cc36a7602cad33' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('63c3cd1b8cde561bab87819a7ee44384', 'core-engine', 'test', '2014-08-24 08:27:15', '0', '2014-08-24 08:27:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '63c3cd1b8cde561bab87819a7ee44384' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = '63c3cd1b8cde561bab87819a7ee44384' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '63c3cd1b8cde561bab87819a7ee44384' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-24 08:27:15', '2014-08-24 08:27:15')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-24 08:27:15', '11', 'test', 0.01, 'editing', '2014-08-24 08:27:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:15', '8758a8fb1a380702d4fa0a19902563ea', 0, 'test1', '2014-08-24 08:27:15')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 42[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 177 AND `credit_accounts`.`lock_version` = 0
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 42[0m
  [1m[35mMerchant::MerchantGroupShip Load (0.2ms)[0m  SELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 42
  [1m[36mMerchant::MarketingRule Load (0.1ms)[0m  [1mSELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 42[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 42
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:15', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-24 08:27:15', '1976-01-01 00:00:00', '2024-08-24 08:27:15', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (18.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:15', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-24 08:27:15', '1976-01-01 00:00:00', '2024-08-24 08:27:15', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:27:15', '2014-08-24 08:27:15')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:27:15', '1234', 6, '2014-08-24 08:27:15')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:27:15', '1235', 6, '2014-08-24 08:27:15')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 6 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 6 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:27:15', `used` = 1 WHERE `sequence_numbers`.`id` = 11[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.3ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 6 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 6 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:27:15', `used` = 1 WHERE `sequence_numbers`.`id` = 12[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.3ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 6 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 6 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:15', 'fc7cf90fdb34ef7d1ac864266a9c437f', 0, '123456', 'test', '2014-08-24 08:27:15')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:15', 178, 0, '1234567812345678', 'bank_card', '2014-08-24 08:27:15')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 178
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 178[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 178  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:15', '9a8f15d10cd7d4bd8d84bb7de980abec', 0, '123456', 'test', '2014-08-24 08:27:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:15', '379c51ea427f01dd5164a92c42a3c31b', 0, '123456', 'test', '2014-08-24 08:27:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:15', 180, 0, '1234567812345678', 'bank_card', '2014-08-24 08:27:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 180  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 24 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-24 08:27:15', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 24 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 24 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-24 08:27:15', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 24 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '127589cc61e2c6b1dcc0019ea1bbda30', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '7420f4819ee26b17122d2318fae47140', 0, '2014-08-24 08:27:16')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 43) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 182, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 43
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 181, 23, 'Merchant::MerchantGroup', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 181) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 181 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 23 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (36.7ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'be2bc539c378b58371c8d7c190da6980', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '745185eb19b5b139d933f98fa70fae77', 0, '2014-08-24 08:27:16')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 44) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 184, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 44[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 183, 44, 'Merchant::MerchantStore', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 183) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 183 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 44 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', 'ea0834f40c905c34decf617ed5eaf563', 0, '2014-08-24 08:27:16')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 45) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 185, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 45
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-24 08:27:16', 25, 45, '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 25) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 25 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 25[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 45 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 45[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 45  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'd217ec50cba9dcd8bac5f495afc2033b', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716172', 1, 0, '88a65ed0918bc3cf70e05644c887e613', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716174', 0, 'bfc4d45b54336ed9f47c4b43498e16b0', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716176', 2, 0, '56eb19a167730bd66bfe635faed2320e', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.4ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '88a65ed0918bc3cf70e05644c887e613'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 245 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 245[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '42f2b69db1f42049f74ee5e50e9ee3a4', '2014-08-24 08:27:16', 245)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 186, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 64[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 186) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 186, 'system', 0, '123456', '0fd9a8c6638da4db87801db07164cb0f', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '88a65ed0918bc3cf70e05644c887e613', '42f2b69db1f42049f74ee5e50e9ee3a4')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 186[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 186  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (245)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 245 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '01c207c5f3aa916837faea469ab876cd', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716227', 1, 0, '494794455d0d328d3802daf65623361d', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716230', 0, 'ccf29017ae230c185d1aad6317729519', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716232', 2, 0, 'a43153e03ed124e7b81eb5a0ae2f0245', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '494794455d0d328d3802daf65623361d'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 248 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 248
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '3f3086d97ab4d31997001c41d7e7f67e', '2014-08-24 08:27:16', 248)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 187, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 65
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 187) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 187, 'system', 0, '123456', '2182e1192fa35972612453d0129f5be5', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '494794455d0d328d3802daf65623361d', '3f3086d97ab4d31997001c41d7e7f67e')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '494794455d0d328d3802daf65623361d'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 248 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'c9738985dd709d6a0dd3d294b08c2516', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716248', 1, 0, '9c3ec442bdb98a231c268a521b652d1f', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716251', 0, 'f7353b7612ceec2f92bb8284721b24bc', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716252', 2, 0, '6a447b07bfb5740318372c7cad5f04c6', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-24 08:27:16', 'f8086e8158501fe43ff153d75ed1ce2c', 0, '1234561', 'test1', '2014-08-24 08:27:16', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6a447b07bfb5740318372c7cad5f04c6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 253 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 188 AND `vouchers`.`voucher_meta_id` = 253
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 253[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '37427f9eba10486c4b4e9736478bd034', '2014-08-24 08:27:16', 253)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 188, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 66[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 188) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 188, 'system', 0, '123456', 'de54573e169932dd42ab9cd7afc86040', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '6a447b07bfb5740318372c7cad5f04c6', '37427f9eba10486c4b4e9736478bd034')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6a447b07bfb5740318372c7cad5f04c6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 253 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 189 AND `vouchers`.`voucher_meta_id` = 253
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 253[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '981deb01b04f002b5a1610cb473f2a12', '2014-08-24 08:27:16', 253)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 189, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 67[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 189) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 189, 'system', 0, '1234561', '7625fa6e7dde5c110ec1c9f0a21a44aa', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '6a447b07bfb5740318372c7cad5f04c6', '981deb01b04f002b5a1610cb473f2a12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 188[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 189
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '570f8a7a456f26b7c4555d60888f033b', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716282', 1, 0, 'fe135d51bacc865230e90b6a134a872b', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716284', 0, '5f0d1e98ab77623cbee5c48dcce2caf5', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716287', 2, 0, '7bc46a36c34381e1231e58503bdd5dfd', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '7bc46a36c34381e1231e58503bdd5dfd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 256 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 190 AND `vouchers`.`voucher_meta_id` = 256[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 256
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, 'a847eec409bbcc6234ed9ecf7e5af01f', '2014-08-24 08:27:16', 256)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 190, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 68
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 190) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 190, 'system', 0, '123456', '72e68000c9d148eb1c36f87e803be52d', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '7bc46a36c34381e1231e58503bdd5dfd', 'a847eec409bbcc6234ed9ecf7e5af01f')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '7bc46a36c34381e1231e58503bdd5dfd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 256 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 190 AND `vouchers`.`voucher_meta_id` = 256[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '57ff1e5a123d4f036c5fce2c28a49f99', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716306', 1, 0, '7a62cefb0bf6668d4a39e4a707ca4348', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716308', 0, 'c8495a0683a66d90cb5681403e064cbe', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716310', 2, 0, 'b3fe0e6256ce7e3dc9051b5d40a66335', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 257[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '7a62cefb0bf6668d4a39e4a707ca4348'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'be48993f170f686c576c5c6a84042880', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716319', 1, 0, '233c114183f550cedc8302ee1d4ad758', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716321', 0, '6201abb2f16ec5232b8d129916b29c7f', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716323', 2, 0, '40d39e48fa64a569fc5fe99a2c65506c', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 260 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 260[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '349721c598c3d438d4d2e9c992aa5782', '2014-08-24 08:27:16', 260)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 192, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 69[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 192) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 192, 'system', 0, '123456', '3d7ec3a6e5c7b4604a19ebb785fdb15d', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '233c114183f550cedc8302ee1d4ad758', '349721c598c3d438d4d2e9c992aa5782')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 192[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 192  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (260)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 260 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '1fd72a58321b8a656678a66c030e21ef', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716343', 1, 0, '554d0165ea210cf28b9073429db1b4fe', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716345', 0, '0b6cc69419e70f370405b3b80783b217', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716347', 2, 0, '073547fbe306254b9352e43573d31101', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '0b6cc69419e70f370405b3b80783b217'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 264 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 264
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '02460356d05af2b003dbc723fc7f47c3', '2014-08-24 08:27:16', 264)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 193, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 70
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 193) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 193, 'system', 0, '123456', 'b516227bb9ddddba28c0ddf515bc061d', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '0b6cc69419e70f370405b3b80783b217', '02460356d05af2b003dbc723fc7f47c3')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '0b6cc69419e70f370405b3b80783b217'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 264 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 264[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, 'ed33f81c5cc7c55dcc787a7a9ca2e77e', '2014-08-24 08:27:16', 264)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 193, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 71[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 193) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.7ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 193, 'system', 0, '123456', 'f50f70e3c26003509b5e29f718c47deb', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '0b6cc69419e70f370405b3b80783b217', 'ed33f81c5cc7c55dcc787a7a9ca2e77e')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '0b6cc69419e70f370405b3b80783b217'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 264 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 264
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', 1, '5501fbc165f902bcc715059c0ae13c4e', '2014-08-24 08:27:16', 264)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 193, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 72
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 193) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 193, 'system', 0, '123456', 'dff5edcc22b225226220499d355e88e0', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', '0b6cc69419e70f370405b3b80783b217', '5501fbc165f902bcc715059c0ae13c4e')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 193
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 264 LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '76ae09e4f7b365c6e6a98e74284557e7', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716384', 1, 0, '7cdffb01361ee42a69387a6b306e8a4d', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716386', 0, '9ebb267742d91144c3b4582e7533b9da', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716389', 2, 0, '757608aafc9234a9dba3a06b00dd5e72', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '41b9bb015754de45e2b080bf9217ee4b', 0, '2014-08-24 08:27:16')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 46) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 195, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 46
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'ef6e425bc471d434aab217e01aebecdf', 0, '112312323', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 196 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 46 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 196, 46, 'Merchant::MerchantStore', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 196) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 196 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 46 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 196) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 196 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 196 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 196 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 46 LIMIT 1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 46 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.4ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 46 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'bf234fc49a7c2218e24b678602f5f198', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716421', 1, 0, '25c615d82b545daad44f45ca8dd4bc0f', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716423', 0, 'eacc574e84551d44a3f763abb289257b', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716425', 2, 0, '149a65eb7c1200c169f6115ffd2de902', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '5400c74bdfef5c8bd0b43d5e0523a29d', 0, '2014-08-24 08:27:16')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 47) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 198, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 47[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '4e495e08ebb0878625bc9673bb487711', 0, '112312323', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 199 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 27 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 199, 27, 'Merchant::MerchantGroup', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 199) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 199 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 199 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 199 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 27 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 27 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 27 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '51e63572fb40d969ffc23fe435bf6dcb', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716455', 1, 0, '30269f7a586fb2dbb6bcbe0d804e72c3', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716457', 0, '348fb2588e5760967a329d8fa3556be0', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716459', 2, 0, 'c90b5b90b65c09c8be362b0620557254', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', 'fa556e8bfcd082d41617baccd93c796c', 0, '2014-08-24 08:27:16')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 48) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 201, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 48
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '0e9ab8389b8d146e97a9a333b5a74351', 0, '112312323', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 202 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 48 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 202, 48, 'Merchant::MerchantStore', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 202) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 202 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 202 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 202 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 48 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 48 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.4ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 48 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '64e14723bbfc0c78bb4baa83e0963af9', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716489', 1, 0, '331d46ccd02daa41ca5f2868298dcf33', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716491', 0, '809336ec3ae50352ee3788c5754aeb71', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716493', 2, 0, '8dbd5668970b9488751871f8f1408c94', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '9eb20c42e0fc72f0bd6378d8452d32d0', 0, '2014-08-24 08:27:16')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 49) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 204, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 49[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'test_group', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '094d50c22b10ded569c80f4574759162', 0, '112312323', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 205 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 29 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 205, 29, 'Merchant::MerchantGroup', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 205) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 205 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 29 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 205) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 205 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 205 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 205 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 29 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 29 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 29 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '50d62fbd85f8bb21eed106b602864eed', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716526', 1, 0, '4fef5726fa52ef3a207117e898de99a9', '2014-08-24 08:27:16', 1, 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716528', 0, '3b8731be8dd7ec154cc83d67afec83b0', '2014-08-24 08:27:16', 0, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716530', 2, 0, 'aa5cb227787a329bd442a146906814b7', '2014-08-24 08:27:16', 2, 0, 1, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.3ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-24 08:27:16', '2014-08-24 08:27:16')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:27:16', '1234', 7, '2014-08-24 08:27:16')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-24 08:27:16', '1235', 7, '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162716541', 0, 'e42c476ecaadb655915a40767e75c7df', '2014-08-24 08:27:16', 0, 7, 0, 1, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 281 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 281
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 7 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 7 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 7 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:27:16', `used` = 1 WHERE `sequence_numbers`.`id` = 13
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', '1234', 1, '6884ff052b0a7503f9ee73f34b82b9af', '2014-08-24 08:27:16', 281)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 206, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 73
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 206) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 206, 'system', 0, '123456', '2cea11a932eedc4745ccad09d7ea111b', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', 'e42c476ecaadb655915a40767e75c7df', '1234', '6884ff052b0a7503f9ee73f34b82b9af')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 281 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 281[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 7 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 7 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (1.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 7 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-24 08:27:16', `used` = 1 WHERE `sequence_numbers`.`id` = 14[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:16', '1235', 1, '4e36d6d8ee3acc95d3593ad98a6c5a04', '2014-08-24 08:27:16', 281)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 206, `updated_at` = '2014-08-24 08:27:16' WHERE `vouchers`.`id` = 74[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 206) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-24 08:27:16', 206, 'system', 0, '123456', '67805da35f8c9d26eb04d57026375a0a', 0, '2014-08-24 08:27:16', 'issue', '2014-08-24 08:27:16', 'e42c476ecaadb655915a40767e75c7df', '1235', '4e36d6d8ee3acc95d3593ad98a6c5a04')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.4ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 281 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-24 08:27:16' WHERE `voucher_meta`.`id` = 281[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 7 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 7 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 7 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'a234796a3adfc82d221c76704cc62ec9', 0, '123456', 'test', '2014-08-24 08:27:16', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 207
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:27:16', 207, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 207  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 25 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 25 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 207 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '20d02e624aa138750c83b655a4e04fea', 0, '123456', 'test', '2014-08-24 08:27:16', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 208[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:27:16', 208, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.4ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 208  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 26 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 26 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 208 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:27:16', 208, 'test', '2014-08-24 08:27:16')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 208) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 208 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 208  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 208  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '7587900cc18f3bef8c50d6623efc6efa', 0, '123456', 'test', '2014-08-24 08:27:16', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 209[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:27:16', 209, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 209 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '7e871f62b093303c2689e551c4d28b52', 0, '123456', 'test', '2014-08-24 08:27:16', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 210 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-24 08:27:16', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-24 08:27:16', '2014-08-24 08:27:16', 'tester')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-24 08:27:16', 'a778540cf817c40dd91a3e5906288711', 'credit_back', '2014-08-24 08:27:16', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-24 08:27:16', '1711f6cc6bb3ddfd043e5bdf00972362', 0, '123456', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 211) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 211 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 211) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 211 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-24 08:27:16', '41fbd0f6eefec5ffd3a8e64ece87e3bb', 0, '123456', 'test', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-24 08:27:16', '41367f525977b8bbd305bc9370617ace', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-24 08:27:16', 'b887dc2405d129c45296576fd3e333c0', 0, '12345611', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '7ab0503faed41cfcbcbb6d00205cb56f', 0, '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '7381360e80b27cf7bed4a8cd66e472f9', 0, '123456', 'test', '2014-08-24 08:27:16', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 216) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 216 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 216 LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'f8ebc15af0471e544c75c2edc8713c62', 0, '123456', 'test', '2014-08-24 08:27:16', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 217) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 217 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 217) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 217 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 217 LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'b80dd85e13f5a6c09334507ffa03c7e7', 0, '123456', 'test', '2014-08-24 08:27:16', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 218) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 218 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 218) LIMIT 1
  [1m[36m (0.3ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 218 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 218 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '80d70c1978b56ece4a44efc0229edcb6', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 219
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 219, 0, '1111111111111111111111', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 219[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'df08af51255b3fbc7f7414d255430007', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 220
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 220, 0, '1111111111111111111110', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 220[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 220, 0, '1111111111111111111111', 'bank_card', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 220
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 220, 0, '1111111111111111111112', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 220[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 220, 0, '1111111111111111111113', 'bank_card', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 220
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 220, 0, '1111111111111111111114', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 220[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '3dba33f6e0b0a153c3c3163973c5ccc0', 0, '123456', 'test', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 221
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-24 08:27:16', 221, 0, '1111111111111111111111', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 221[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-24 08:27:16', 19, 1, '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-24 08:27:16', 19, 1, '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-24 08:27:16', 19, 0, '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (0.2ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.1ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-24 08:27:16', 19, 1, '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-24 08:27:16', '8a7a093c3d1d4871b6b9453cf6866b11', 'roll_back', '2014-08-24 08:27:16', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', '7425369224535fe0792ab9163fcd0db0', 0, '123456', 'test', '2014-08-24 08:27:16', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 222
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:27:16', 222, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 222  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 35 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 35 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 222 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:27:16', 222, 'test', '2014-08-24 08:27:16')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 222) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 222 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 222 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 222) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 222 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-24 08:27:16' WHERE `credit_cashing_applications`.`id` = 11[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 222 LIMIT 1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-24 08:27:16', 'f6a5fb0107379626672699d746d3bbb1', 0, '123456', 'test', '2014-08-24 08:27:16', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 223[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-24 08:27:16', 223, 0, '111111111111111111111', 'bank_card', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 223  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 36 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 36 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 223 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-24 08:27:16', 223, 'test', '2014-08-24 08:27:16')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 223) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 223 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 223 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 223) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-24 08:27:16', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 223 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-24 08:27:16' WHERE `credit_cashing_applications`.`id` = 12
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-24 08:27:16', 223, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', '89078897d5568d0c2302258fb1072336', 0, '2014-08-24 08:27:16', 'credit_cashing', '2014-08-24 08:27:16')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 223 LIMIT 1[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 223  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:16', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:16', '6752b4c9f702924e08a2acc9ce74e846', 0, '2014-08-24 08:27:16')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 50) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 224, `updated_at` = '2014-08-24 08:27:16' WHERE `merchant_stores`.`id` = 50[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:27:16', 50, 'register', 2, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:27:16', 50, 'bind_card', 2, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:27:16', 50, 'transaction', 2, '2014-08-24 08:27:16', '2014-08-24 08:27:16', '2024-08-24 08:27:16')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 50, 'none', 1, '2014-08-24 08:27:17', '1976-01-01 00:00:00', '2024-08-24 08:27:17', 3)[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 50 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 50 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 50) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 50[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (13, 4)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 50 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 50 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 50) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 50[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 4
  [1m[36m (14.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717060', 0, '8b78d4fd67677885aeb6cf93dde1c9b0', '2014-08-24 08:27:17', 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:27:17', 'transaction', 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-24 08:27:17', 14, '2014-08-24 08:27:17', 282)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 14
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 14  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (282)
  [1m[36mMerchant::PostAction Load (0.1ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 14  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (282)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717087', 0, '7282c651396db7f0e71e4023851321c1', '2014-08-24 08:27:17', 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-24 08:27:17', 'transaction', 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:17', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-24 08:27:17', '0675e19ab41dd9d4d6bdadb09e652d64', 0, '2014-08-24 08:27:17', 8000)
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 51) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 225, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 51
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::MerchantCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 225 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 225  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-24 08:27:17', 225, 'test name', '2014-08-24 08:27:17')[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-24 08:27:17', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 225 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717113', 0, '938074513859deba224ea588ff334f89', '2014-08-24 08:27:17', 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717117', 100, 0, 'e4397de770cf597a1dd1c2cd54ef339d', '2014-08-24 08:27:17', 100, 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-24 08:27:17' WHERE `voucher_meta`.`id` = 285[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-24 08:27:17' WHERE `voucher_meta`.`id` = 285
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717124', 0, '69f50b733bc31c87445929321325b8f6', '2014-08-24 08:27:17', 0, 0, 1, '2014-08-24 08:27:17', '2014-08-24 08:22:17', '2014-08-24 08:32:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717126', 0, 'df3aad1ac0a06efc32c0439be5b96ace', '2014-08-24 08:27:17', 0, 0, 1, '2014-08-24 08:27:17', '2014-08-24 08:32:17', '2014-08-24 08:22:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717131', 0, 'f2d0ee422de2bda1922430c123fc8db0', '2014-08-24 08:27:17', 10000, 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-24 08:27:17', '4158e0fcbaca6be72f5353c8871600b7', 0, '123456', 'test', '2014-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-24 08:27:17' WHERE `voucher_meta`.`id` = 288
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:17', 1, '4885374f1aec03699b264cd2dfb4322f', '2014-08-24 08:27:17', 288)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 226, `updated_at` = '2014-08-24 08:27:17' WHERE `vouchers`.`id` = 75
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 226) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::Voucher Load (0.3ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 226  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (288)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:17', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:17', 'd8844e3842cdc32cf239730c84dc846c', 0, '2014-08-24 08:27:17')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 52) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 227, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 52
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:17', 'test_display', 'test_group', '2014-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717160', 0, 'b25de8ef178f99190055db1dbc3a929d', '2014-08-24 08:27:17', 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717164', 1, 'ec61a516d19d0087c9fa9b92b3a2088b', '2014-08-24 08:27:17', 0, 52, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717168', 2, '54ec1a30a637e348adf79851ba3d46e7', '2014-08-24 08:27:17', 0, 30, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717173', 1, 0, '6893b187efd623384e3eb63a45863c2e', '2014-08-24 08:27:17', 10000, 1, 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-24 08:27:17' WHERE `voucher_meta`.`id` = 292[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-24 08:27:17', 1, '8fa6802689d9d7404544222878f954fc', '2014-08-24 08:27:17', 292)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 292 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717184', 0, 'de912e6d702f1ac9ac942089de1b2972', '2014-08-24 08:27:17', 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:17', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:17', '227222d0d8b9c4391c5053a0e61df246', 0, '2014-08-24 08:27:17')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 53) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 228, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 53[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:17', 'test_group', '2014-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 31, `updated_at` = '2014-08-24 08:27:17' WHERE `voucher_meta`.`id` = 293
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 293 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 31 LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140824162717202', 0, '14143c5d4b5a69d3047a9b801e3d965a', '2014-08-24 08:27:17', 0, 0, 2, '2014-08-24 08:27:17', '2014-08-24 08:27:17', '2024-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:17', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:17', '907f66f09cf53ab1143f8a5278c6f132', 0, '2014-08-24 08:27:17')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 54) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 229, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 54
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-24 08:27:17', 'test_group', '2014-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 54, `updated_at` = '2014-08-24 08:27:17' WHERE `voucher_meta`.`id` = 294[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 294 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 54 LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 0.05, 0.1, 'credit_back', 0.03, '2014-08-24 08:27:17', '1976-01-01 00:00:00', '2024-08-24 08:27:17', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`
  [1m[36mPay::CreditBack Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 08:27:17') AND (valid_till >= '2014-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 08:27:17' or valid_till < '2014-08-24 08:27:17')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 08:27:17', '1976-01-01 00:00:00', '2014-08-24 08:26:17', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 08:27:17') AND (valid_till >= '2014-08-24 08:27:17')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 08:27:17' or valid_till < '2014-08-24 08:27:17')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 08:27:17', '2014-08-24 08:26:17', '2014-08-24 08:28:17', 0)
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 08:27:17') AND (valid_till >= '2014-08-24 08:27:17')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 08:27:17' or valid_till < '2014-08-24 08:27:17')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 08:27:17', '2014-08-24 08:28:17', '2014-08-24 08:37:17', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 08:27:17') AND (valid_till >= '2014-08-24 08:27:17')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 08:27:17' or valid_till < '2014-08-24 08:27:17')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-24 08:27:17', '1976-01-01 00:00:00', '2024-08-24 08:27:17', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-24 08:27:17') AND (valid_till >= '2014-08-24 08:27:17')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-24 08:27:17' or valid_till < '2014-08-24 08:27:17')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-24 08:27:17', '111', 'test', 0.01, 'editing', '2014-08-24 08:27:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-24 08:27:17', '302da2d546ae9c7d251d9ce9b93396d4', 0, '2014-08-24 08:27:17')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 55) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 230, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 55
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-24 08:27:17', 0.05, 0.1, 55, 'credit_back', 0.03, 1, '2014-08-24 08:27:17', '2014-08-24 08:26:17', '2014-08-24 08:28:17', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.4ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 55) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-24 08:27:17', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 55) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 55
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-24 08:27:17', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 55) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 55[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-24 08:27:17', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 55) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 55
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-24 08:27:17', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 10[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 55 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 55) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-24 08:27:17' WHERE `merchant_stores`.`id` = 55[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 55 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-24 08:27:17', 1, 0, '2014-08-24 08:27:17', 'none', '2014-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-24 08:27:17' WHERE (`transaction_logs`.`id` = 4 AND `transaction_logs`.`transaction_datetime` = '2014-08-24 08:27:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 02:58:31', 'tester', '$2a$04$VjNazRdfzzd/vcjsDusLR.h55fuelslWNdukFFW/GNsTUBYmA1s.i', 'tester', 'admin', '2014-08-25 02:58:31')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (39.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 02:58:31', 'tester', '$2a$04$FIkKwqShabBe2U3HHswIme0s9R0hbHlwnKlxtYbyI/6UQlcTB0lpS', 'tester', 'admin', '2014-08-25 02:58:31')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 02:58:31', 'tester', '$2a$04$pgwwym3YRPaoepOuoeQ/XO28SsPrIaTZdRU2RuyYbqCmBReNMKInK', 'tester', 'admin', '2014-08-25 02:58:31')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 02:58:31', 'tester', '$2a$04$QDnXTwNEwclT/bJ2r0BO4uDKZ32lSfTX9YgOjC7Q.xrSdZ5DfWHbu', 'tester', 'admin', '2014-08-25 02:58:31')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 03:11:15', 'tester', '$2a$04$2o7q2rTOO7iqU6ffmurBROFsppxcdYP8h4.Ti.6qBm9vSKnxCe7L2', 'tester', 'admin', '2014-08-25 03:11:15')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 03:12:36', 'tester', '$2a$04$EiwNPiC0YnHhrsEy5KzwI.84yi5k6iB4Ob6ETLbq7i.46ZNjOv.46', 'tester', 'admin', '2014-08-25 03:12:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered sessions/_form.html.erb (3.3ms)
  Rendered sessions/new.html.erb (54.7ms)
Completed 500 Internal Server Error in 86ms
  [1m[36m (15.7ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 03:13:02', 'tester', '$2a$04$mj1hut2L/WxTm30scDOshe5M/0ZY.d3PZ0Q1c4O2MQ8YiacpZu9.q', 'tester', 'admin', '2014-08-25 03:13:02')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered sessions/new.html.erb (1.2ms)
Completed 200 OK in 6ms (Views: 5.5ms | ActiveRecord: 0.0ms)
  [1m[36m (15.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-25 08:02:34', '2014-08-25 08:02:34')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (39.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-25 08:02:34', '2014-08-25 08:02:34')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (38.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (142.0ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (15.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1[0m
  [1m[35mSQL (112.4ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-25 08:02:35', '11', 'test', 0.01, 'editing', '2014-08-25 08:02:35')
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:35', '25ee51e39a756770db7933d4ee9d36e5', 0, 'test1', '2014-08-25 08:02:35')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (142.7ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 56
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (44.8ms)[0m  [1mDELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 231 AND `credit_accounts`.`lock_version` = 0[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 56
  [1m[36mMerchant::MerchantGroupShip Load (0.4ms)[0m  [1mSELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 56[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 56
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 56[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (49.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (1.0ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '7a234b6834e4a0c0bec14a19c453d7fb', 0, '123456', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236147', 1, 0, '4cf85307598db1988605e59d6d7f1f04', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236149', 0, '1b11e605d944f1f43db003b1b81247c2', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236151', 2, 0, 'a5a1f90f956cc531fb020aaeefe1fb4b', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.4ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'a5a1f90f956cc531fb020aaeefe1fb4b'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 297 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 232 AND `vouchers`.`voucher_meta_id` = 297[0m
  [1m[35mSQL (36.4ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 297
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '32a6c968ccac372711584db5d1520395', '2014-08-25 08:02:36', 297)[0m
  [1m[35mSQL (0.7ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 232, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 77
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 232) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 232, 'system', 0, '123456', '4cf5792a20e47796f30f882bccbc8086', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', 'a5a1f90f956cc531fb020aaeefe1fb4b', '32a6c968ccac372711584db5d1520395')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'a5a1f90f956cc531fb020aaeefe1fb4b'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 297 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 232 AND `vouchers`.`voucher_meta_id` = 297[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', 'bb58cf840bb92fc79443cd8e6b01c7dd', 0, '123456', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236335', 1, 0, '4421172249ef1e10e8baadcba91e70bb', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236337', 0, '443d1f654f49f00161d0eb8df7df0ae2', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236339', 2, 0, '01b6e29030e6975cccce73adaf79bed6', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-25 08:02:36', '42df966f651b66811816dc564d7cc5e1', 0, '1234561', 'test1', '2014-08-25 08:02:36', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '01b6e29030e6975cccce73adaf79bed6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 300 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 233 AND `vouchers`.`voucher_meta_id` = 300[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 300
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '4ecd7ae169d28065046274a2ca2f6f83', '2014-08-25 08:02:36', 300)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 233, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 78
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 233) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 233, 'system', 0, '123456', 'fc58be26ed8b26bba9fae5f21b85656f', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '01b6e29030e6975cccce73adaf79bed6', '4ecd7ae169d28065046274a2ca2f6f83')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '01b6e29030e6975cccce73adaf79bed6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 300 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 234 AND `vouchers`.`voucher_meta_id` = 300[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 300
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '25e9bb2361f7616bd4e38940a89ad0c0', '2014-08-25 08:02:36', 300)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 234, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 79
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 234) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 234, 'system', 0, '1234561', '77a19011f4f3c25697834770dd478d78', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '01b6e29030e6975cccce73adaf79bed6', '25e9bb2361f7616bd4e38940a89ad0c0')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 233
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 234[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '2e63f70188f16ba58d9094a6d0ee9319', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236368', 1, 0, '0b7ff6163d4de317c19815f577724d14', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236370', 0, '68d89eef763bef69f49f1d96161693da', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236373', 2, 0, 'cb7363f7127645afcaaf27a27d73d65f', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 301 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 301[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, 'c6432ebe0c40fb66d2bc33979add425c', '2014-08-25 08:02:36', 301)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 235, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 80[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 235) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 235, 'system', 0, '123456', '4d694b0eed940f04ff4a7dab08ab5531', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '0b7ff6163d4de317c19815f577724d14', 'c6432ebe0c40fb66d2bc33979add425c')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 235[0m
  [1m[35mTrade::VoucherTransactionLog Load (14.7ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.3ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 235  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (301)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 301 LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '81d76e626743eb7ddffa0050feb8721d', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (21.0ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236410', 1, 0, '5273441e394a7397c24cfc3f15e53df0', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236433', 0, 'b25b1b4af04126e07d9d30add4c075eb', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236435', 2, 0, 'bdfe6eb5c55e13205a360a5a9381653f', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '5273441e394a7397c24cfc3f15e53df0'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 304 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 304
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '8930f6769b48c69a67c1a3522f06bd34', '2014-08-25 08:02:36', 304)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 236, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 81
  [1m[36mMember::IndividualCreditAccount Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 236) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 236, 'system', 0, '123456', 'eb2098743172aae921c27a1bf5f2eda2', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '5273441e394a7397c24cfc3f15e53df0', '8930f6769b48c69a67c1a3522f06bd34')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '5273441e394a7397c24cfc3f15e53df0'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 304 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '22540f7cc572a61af28d281fcd35af2e', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236452', 1, 0, '2bfb4a034423c44062cf25581af25f67', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236454', 0, 'e90dc56fefa741490f6f958cb36bfdd6', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236456', 2, 0, '1f825f2d1e46c66db6dfbff810c109f7', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '2bfb4a034423c44062cf25581af25f67'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 307 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 307
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '05b526389e12660389f11eea2540263a', '2014-08-25 08:02:36', 307)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 237, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 82
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 237) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 237, 'system', 0, '123456', 'a62e4b71b61f052feb4b087260003d62', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '2bfb4a034423c44062cf25581af25f67', '05b526389e12660389f11eea2540263a')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 237
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 237  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (307)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 307 LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '77d76d150c8a192fa4fc92b551ad10ab', 0, '123456', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236477', 1, 0, '9a3100d78318c96aac5c4a76db447cd1', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236479', 0, '8fa5c053d31fe7360a2f3cab000b30b1', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236481', 2, 0, '4c5d79225cc512bc5a8f7ba7d2aca7db', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 310[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '9a3100d78318c96aac5c4a76db447cd1'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '99ed9bf9d6f62993c865a9bb6b11e628', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236491', 1, 0, '8a60e1cb3e347cf9d71cb380bfeff724', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236493', 0, '9054502738503344b8073bf1c49822ad', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236495', 2, 0, 'a36a6397ab019f148516e3bff6c8a09a', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '9054502738503344b8073bf1c49822ad'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 314 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 314
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '79d458daa8de6ef4d8e1629a7a27bc0f', '2014-08-25 08:02:36', 314)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 239, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 83
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 239) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 239, 'system', 0, '123456', '071b533145bc6c0d4b9ece7847ac84d4', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '9054502738503344b8073bf1c49822ad', '79d458daa8de6ef4d8e1629a7a27bc0f')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '9054502738503344b8073bf1c49822ad'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 314 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 314[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '75d3844e6b5b8e2facdd770b53249d7a', '2014-08-25 08:02:36', 314)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 239, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 84[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 239) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 239, 'system', 0, '123456', 'cf5b5aa473a8fe6e8316fb71ab7454fa', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '9054502738503344b8073bf1c49822ad', '75d3844e6b5b8e2facdd770b53249d7a')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '9054502738503344b8073bf1c49822ad'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 314 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 314
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', 1, '7b143ba0ee327fcc3b936f53551352c4', '2014-08-25 08:02:36', 314)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 239, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 85
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 239) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 239, 'system', 0, '123456', '841ec34de8e3a8def1fa10e5dbac929c', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '9054502738503344b8073bf1c49822ad', '7b143ba0ee327fcc3b936f53551352c4')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 239
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 314 LIMIT 1[0m
  [1m[35m (1.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '70d60cf4fa603bcaf7e0f1a304911bb7', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236527', 1, 0, '652d0c2465085219baa7b75578b66919', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236530', 0, '076563d7f62b9460c697071096009f38', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236532', 2, 0, '39020e4ffbf05b15b002b67c16cc0f1d', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:36', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:36', 'f4baaa69a5148c18b0f3dfeaddffa9b3', 0, '2014-08-25 08:02:36')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 57) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 241, `updated_at` = '2014-08-25 08:02:36' WHERE `merchant_stores`.`id` = 57
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:36', 'test_group', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '672e81cef50cd28539df6254a50099b2', 0, '112312323', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 242 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 57 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-25 08:02:36', 242, 57, 'Merchant::MerchantStore', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 242) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 242 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 57 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 242) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 242 LIMIT 1[0m
  [1m[35m (0.6ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 242 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (29.7ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 242 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 57 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 57 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 57 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (18.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '38881ff6edcec85e8371b2343c1361ed', 0, '123456', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236685', 1, 0, '611da9bea27e54e380b1fbfb1d075a08', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236687', 0, '4c5f0029763cf83a6e282300dad932c4', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236689', 2, 0, '6c51b4a7c80d01dc7e04ce516fa9e8e3', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:36', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:36', 'aa15dcc8789739e491d329bee8e8dfa6', 0, '2014-08-25 08:02:36')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 58) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 244, `updated_at` = '2014-08-25 08:02:36' WHERE `merchant_stores`.`id` = 58[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:36', 'test_group', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '16126278bbaaeb85695c1213b5c5cc4a', 0, '112312323', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 245 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 34 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-25 08:02:36', 245, 34, 'Merchant::MerchantGroup', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 245) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 245 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 245 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 245 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 34 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 34 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 34 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', 'f3d0001f575c135a8b106caac918208f', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236723', 1, 0, 'c34980634c1c31408d50929e7191465e', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236725', 0, 'ec577c938b4b317d00dcea0e3565dd78', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236727', 2, 0, '8add58f325454f7866aaf01c4a0c3047', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:36', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:36', 'e5131bb4eb7710559d59fa463f5db8e1', 0, '2014-08-25 08:02:36')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 59) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 247, `updated_at` = '2014-08-25 08:02:36' WHERE `merchant_stores`.`id` = 59
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:36', 'test_group', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '15cbf92ce3c5e660fcda0f897b2d82c8', 0, '112312323', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 248 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 59 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-25 08:02:36', 248, 59, 'Merchant::MerchantStore', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 248) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 248 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 248 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 248 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 59 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 59 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 59 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '1e2af93a88bb9b31f48d49fe28811108', 0, '123456', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236757', 1, 0, '108bd2d89713b655006e9d5885e44e16', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236760', 0, '34c008cf6b198c2aaeccc5c28945c951', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236762', 2, 0, '44192729c8ccce338d2d0056c5a6c07b', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:36', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:36', '3db8307cfc2ac0205264f8f2171973e2', 0, '2014-08-25 08:02:36')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 60) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 250, `updated_at` = '2014-08-25 08:02:36' WHERE `merchant_stores`.`id` = 60[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:36', 'test_group', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '8176d5eda08560e96371efe3c711eea5', 0, '112312323', 'test', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 251 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 36 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-25 08:02:36', 251, 36, 'Merchant::MerchantGroup', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 251) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 251 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 36 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 251) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 251 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 251 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 251 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 36 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 36 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 36 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:36', 'b071ba3be8e923865a329a35d7fefb87', 0, '123456', 'test', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236793', 1, 0, '0787e1f1ca578b26c90d668354f79219', '2014-08-25 08:02:36', 1, 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236795', 0, 'fa6202a0c70640937713b7317207bfc6', '2014-08-25 08:02:36', 0, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236797', 2, 0, 'b38cd3c6c2a9bf65bde7d2f656163798', '2014-08-25 08:02:36', 2, 0, 1, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (30.7ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-25 08:02:36', '2014-08-25 08:02:36')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-25 08:02:36', '1234', 8, '2014-08-25 08:02:36')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-25 08:02:36', '1235', 8, '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160236882', 0, '8eb4a9bfa830f6b8023157be4cd6b420', '2014-08-25 08:02:36', 0, 8, 0, 1, '2014-08-25 08:02:36', '2014-08-25 08:02:36', '2024-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 331 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 331
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 8 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 8 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 8 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-25 08:02:36', `used` = 1 WHERE `sequence_numbers`.`id` = 15
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', '1234', 1, '46e07427259ea78fa0bf4895e3160263', '2014-08-25 08:02:36', 331)[0m
  [1m[35mSQL (1.1ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 252, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 86
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 252) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 252, 'system', 0, '123456', 'a90c726a77ac369211610a3eefa3eb0d', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '8eb4a9bfa830f6b8023157be4cd6b420', '1234', '46e07427259ea78fa0bf4895e3160263')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.6ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 331 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 331[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 8 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 8 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 8 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-25 08:02:36', `used` = 1 WHERE `sequence_numbers`.`id` = 16[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:36', '1235', 1, 'd2152a743331e770e0f231c294cd9a45', '2014-08-25 08:02:36', 331)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 252, `updated_at` = '2014-08-25 08:02:36' WHERE `vouchers`.`id` = 87[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 252) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-25 08:02:36', 252, 'system', 0, '123456', '5879f5e95c9a4e0c912757ea39fcbc41', 0, '2014-08-25 08:02:36', 'issue', '2014-08-25 08:02:36', '8eb4a9bfa830f6b8023157be4cd6b420', '1235', 'd2152a743331e770e0f231c294cd9a45')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 331 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-25 08:02:36' WHERE `voucher_meta`.`id` = 331[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 8 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 8 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 8 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:36', 'bb5ed08cc0381b005fd2696a753719e2', 0, '123456', 'test', '2014-08-25 08:02:36', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 253
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-25 08:02:36', 253, 0, '111111111111111111111', 'bank_card', '2014-08-25 08:02:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 253  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 37 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-25 08:02:36', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 37 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 253 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '0a38e7feba7f797368cfe60cd457ba98', 0, '123456', 'test', '2014-08-25 08:02:36', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 254[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-25 08:02:36', 254, 0, '111111111111111111111', 'bank_card', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 254  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 38 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-25 08:02:36', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 38 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 254 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-25 08:02:36', 254, 'test', '2014-08-25 08:02:36')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 254) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-25 08:02:36', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 254 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 254  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 254  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:36', 'a10169b82b0a78ff906bf6e72cf9cd9d', 0, '123456', 'test', '2014-08-25 08:02:36', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 255[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-25 08:02:36', 255, 0, '111111111111111111111', 'bank_card', '2014-08-25 08:02:36')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 255 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:36', '5c1dd05f8fd859ba2ab18db9879a830e', 0, '123456', 'test', '2014-08-25 08:02:36', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 256 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:37', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:37', '8993f888c39f2ce2872428283b760daa', 0, '2014-08-25 08:02:37')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 61) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 257, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 61[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-25 08:02:37', 61, 'register', 2, '2014-08-25 08:02:37', '2014-08-25 08:02:37', '2024-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-25 08:02:37', 61, 'bind_card', 2, '2014-08-25 08:02:37', '2014-08-25 08:02:37', '2024-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-25 08:02:37', 61, 'transaction', 2, '2014-08-25 08:02:37', '2014-08-25 08:02:37', '2024-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 61, 'none', 1, '2014-08-25 08:02:37', '1976-01-01 00:00:00', '2024-08-25 08:02:37', 3)[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 61 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 61 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 61) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 61[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (18, 11)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPay::PaymentPlan Load (0.3ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 61 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 61 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 61) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 61[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 11
  [1m[36m (30.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:37', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:37', '045b1a19fdcbf3d4705e5fe557f912b7', 0, '2014-08-25 08:02:37')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 62) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 258, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 62
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:37', 'test_group', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-25 08:02:37', 37, 62, '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 37) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 37 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 37[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 62 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 62[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 62  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36m (1.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-25 08:02:37', 1, 0, '2014-08-25 08:02:37', 'none', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (28.7ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (0.6ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-25 08:02:37' WHERE (`transaction_logs`.`id` = 5 AND `transaction_logs`.`transaction_datetime` = '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-25 08:02:37', '0e4a143eba2fa7baa82fb3dec264efb5', 'credit_back', '2014-08-25 08:02:37', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-25 08:02:37', '1976-01-01 00:00:00', '2024-08-25 08:02:37', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-25 08:02:37', '1976-01-01 00:00:00', '2024-08-25 08:02:37', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-25 08:02:37', '2014-08-25 08:02:37')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-25 08:02:37', '1234', 9, '2014-08-25 08:02:37')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-25 08:02:37', '1235', 9, '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 9 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 9 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-25 08:02:37', `used` = 1 WHERE `sequence_numbers`.`id` = 17
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 9 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 9 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-25 08:02:37', `used` = 1 WHERE `sequence_numbers`.`id` = 18
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 9 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 9 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-25 08:02:37', 'c3a87a675c521e66774164b652ca65ca', 'roll_back', '2014-08-25 08:02:37', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-25 08:02:37', '2014-08-25 08:01:37', '2014-08-25 08:03:37', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-25 08:02:37') AND (valid_till >= '2014-08-25 08:02:37')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-25 08:02:37' or valid_till < '2014-08-25 08:02:37')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:37', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:37', 'e6627fdc4d7b639f260118bddefe5716', 0, '2014-08-25 08:02:37')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 63) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 259, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 63[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.05, 0.1, 63, 'credit_back', 0.03, 1, '2014-08-25 08:02:37', '2014-08-25 08:01:37', '2014-08-25 08:03:37', 0)
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 63) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-25 08:02:37', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 15[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 63) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 63[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-25 08:02:37', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 15
  [1m[36mPay::PaymentPlan Load (0.3ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 63) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 63
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.1ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-25 08:02:37', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 15[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 63) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 63[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-25 08:02:37', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 15
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 63 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 63) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 63
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 63 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-25 08:02:37', '1976-01-01 00:00:00', '2024-08-25 08:02:37', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-25 08:02:37') AND (valid_till >= '2014-08-25 08:02:37')[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-25 08:02:37' or valid_till < '2014-08-25 08:02:37')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-25 08:02:37', '2014-08-25 08:03:37', '2014-08-25 08:12:37', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-25 08:02:37') AND (valid_till >= '2014-08-25 08:02:37')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-25 08:02:37' or valid_till < '2014-08-25 08:02:37')
  [1m[36mPay::PaymentPlan Load (0.1ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-25 08:02:37', '1976-01-01 00:00:00', '2014-08-25 08:01:37', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-25 08:02:37') AND (valid_till >= '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-25 08:02:37' or valid_till < '2014-08-25 08:02:37')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-25 08:02:37', 0.05, 0.1, 'credit_back', 0.03, '2014-08-25 08:02:37', '1976-01-01 00:00:00', '2024-08-25 08:02:37', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`[0m
  [1m[35mPay::CreditBack Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-25 08:02:37') AND (valid_till >= '2014-08-25 08:02:37')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-25 08:02:37' or valid_till < '2014-08-25 08:02:37')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:37', 'bab27db8d0d2eff4f88499eb7126db9f', 0, '123456', 'test', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 260
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 260, 0, '1111111111111111111111', 'bank_card', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 260[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:37', 'ddc84fbf908ae2ba142c67c027d7783b', 0, '123456', 'test', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 261[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 261, 0, '1111111111111111111111', 'bank_card', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 261
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:37', '7b6347d2254c0f680fb1b36cf9722819', 0, '123456', 'test', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 262[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 262, 0, '1111111111111111111110', 'bank_card', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 262
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 262, 0, '1111111111111111111111', 'bank_card', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 262[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 262, 0, '1111111111111111111112', 'bank_card', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 262
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 262, 0, '1111111111111111111113', 'bank_card', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 262[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:37', 262, 0, '1111111111111111111114', 'bank_card', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 262
  [1m[36m (30.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-25 08:02:37', '06cca15d0d1515b1fd0b7bebbd235b57', 0, '123456', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 263) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 263 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 263) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 263 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.1ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-25 08:02:37', '4ca3ae8e9824df6b07aaf138d1ae5d88', 0, '123456', 'test', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-25 08:02:37', 'df186aed46a834b91542e3e948b0c3d4', 0, '123456', 'test', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-25 08:02:37', '86be329db13d7c00b03131023d48e7ca', 0, '12345611', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:37', 'a9d7540be32b964392665d3edaf815e9', 0, '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:37', 'dafa59093ed53aae3fda6f676ff70058', 0, '123456', 'test', '2014-08-25 08:02:37', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 268) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 268 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 268) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 268 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 268 LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:37', '88ec93218e4d15e5cc3ae55b9afcd25c', 0, '123456', 'test', '2014-08-25 08:02:37', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 269) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 269 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 269 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:37', 'eca368c3645a7bc97f24f4bdd5eac549', 0, '123456', 'test', '2014-08-25 08:02:37', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 270) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 270 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 270) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 270 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 270 LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:37', '38e21cfb692ecf313bbd8667fe5f7d29', 0, '123456', 'test', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:37', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:37', 'f3a16983a74a5c4ae6a41625c4d76f70', 0, '2014-08-25 08:02:37')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 64) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 272, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 64[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:37', 'test_group', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-25 08:02:37', 271, 38, 'Merchant::MerchantGroup', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 271) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 271 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 38 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:37', '40bc2254742d8cc04f2c2ac02de1d68f', 0, '123456', 'test', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:37', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:37', '71ff445ea6dd747e4df755c3fab6571b', 0, '2014-08-25 08:02:37')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 65) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 274, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 65
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:37', 'test_group', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-25 08:02:37', 273, 65, 'Merchant::MerchantStore', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 273) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 273 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 65 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:37', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:37')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-25 08:02:37', '99cf28aaf9ba87b159979a82a66505a1', 0, '2014-08-25 08:02:37', 8000)[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 66) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 275, `updated_at` = '2014-08-25 08:02:37' WHERE `merchant_stores`.`id` = 66[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::MerchantCreditAccount Load (11.0ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 275 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 275  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-25 08:02:37', 275, 'test name', '2014-08-25 08:02:37')
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-25 08:02:37', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 275 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:02:37', 'tester', '$2a$04$wEFhfaG45dnneIZeeE7MMefvQemot1oUBpb/EuttJinng2sggGW5a', 'tester', 'admin', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:02:37', 'tester', '$2a$04$kKD70CQrI8cAChGVwrwu3eOmUIJH4SG7gTxzyt2E1xuEn8BhGmFjS', 'tester', 'admin', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:02:37', 'tester', '$2a$04$YlH.UZvj2OC3wgfc7BQmQ.nGD5DzHb/6Y4.iErDPlNqWQswMfSIq.', 'tester', 'admin', '2014-08-25 08:02:37')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered shared/_error_notice.html.erb (0.5ms)
Completed 200 OK in 2821ms (Views: 2820.7ms | ActiveRecord: 0.0ms)
  [1m[36m (30.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:02:40', 'tester', '$2a$04$pynvx1iXeo6I6LBOtpqJmuMRH.zX0d7MmV2AX1FuKeClDlLxU3VI6', 'tester', 'admin', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240639', 1, 0, 'e41c53854ec5f5c45be8c4ebdb33b1b5', '2014-08-25 08:02:40', 10000, 1, 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-25 08:02:40' WHERE `voucher_meta`.`id` = 332[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:40', 1, '2542ee83723acd172fb1feff77e17773', '2014-08-25 08:02:40', 332)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 332 LIMIT 1
  [1m[36m (36.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240685', 0, 'a9e881b7888d976f2a68a5fe71a154c5', '2014-08-25 08:02:40', 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:40', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:40', 'caaf83f1f0a9bc33789e9f32f53a720e', 0, '2014-08-25 08:02:40')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 67) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 276, `updated_at` = '2014-08-25 08:02:40' WHERE `merchant_stores`.`id` = 67[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:40', 'test_group', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 40, `updated_at` = '2014-08-25 08:02:40' WHERE `voucher_meta`.`id` = 333
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 333 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 40 LIMIT 1[0m
  [1m[35m (1.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240706', 0, 'b49f8efe93b0b2d2e6b899b4332a99f5', '2014-08-25 08:02:40', 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:40', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:40', 'eb32d0753766b5e28bb07dab9892a1e1', 0, '2014-08-25 08:02:40')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 68) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 277, `updated_at` = '2014-08-25 08:02:40' WHERE `merchant_stores`.`id` = 68
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:40', 'test_group', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 68, `updated_at` = '2014-08-25 08:02:40' WHERE `voucher_meta`.`id` = 334[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 334 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 68 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-25 08:02:40', '111', 'test', 0.01, 'editing', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-25 08:02:40', 'f5c977fa16875b94dfaae4d878866b61', 0, '2014-08-25 08:02:40')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 69) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 278, `updated_at` = '2014-08-25 08:02:40' WHERE `merchant_stores`.`id` = 69
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-25 08:02:40', 'test_display', 'test_group', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240736', 0, '135abd8ff1b5d95db106817f62f41f40', '2014-08-25 08:02:40', 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240739', 1, 'f1ae42f31c7d39241fe24937f267906c', '2014-08-25 08:02:40', 0, 69, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240741', 2, 'f4498704b5c7f42e3d415c10f0f0d7bc', '2014-08-25 08:02:40', 0, 42, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240746', 0, '06c0c1367d62ae54aab7c6a664fa8082', '2014-08-25 08:02:40', 10000, 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:40', '04f5e218d8e8ccf2545a992bd3f901cb', 0, '123456', 'test', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-25 08:02:40' WHERE `voucher_meta`.`id` = 338[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-25 08:02:40', 1, '01e1f8c2c062e7183ca1a11e4e2a9edb', '2014-08-25 08:02:40', 338)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 279, `updated_at` = '2014-08-25 08:02:40' WHERE `vouchers`.`id` = 89[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 279) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.3ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 279  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (338)[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240767', 0, 'f48175a3c7abcf52286df286bff6d596', '2014-08-25 08:02:40', 0, 0, 1, '2014-08-25 08:02:40', '2014-08-25 07:57:40', '2014-08-25 08:07:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240769', 0, 'c9e104a8ee639c9323191c10e7e55cf6', '2014-08-25 08:02:40', 0, 0, 1, '2014-08-25 08:02:40', '2014-08-25 08:07:40', '2014-08-25 07:57:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240773', 0, '26867026f66086ecb4105fd55063d6c5', '2014-08-25 08:02:40', 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240777', 100, 0, '8b1f06fc1d9ba06ab52588562c13d47e', '2014-08-25 08:02:40', 100, 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-25 08:02:40' WHERE `voucher_meta`.`id` = 342[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-25 08:02:40' WHERE `voucher_meta`.`id` = 342
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:40', 'dc9a377ff374a14b4efd59f60043cae7', 0, '123456', 'test', '2014-08-25 08:02:40', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 280
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-25 08:02:40', 280, 0, '111111111111111111111', 'bank_card', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 280  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 47 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 47 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 280 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-25 08:02:40', 280, 'test', '2014-08-25 08:02:40')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 280) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 280 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 280 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 280) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 280 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-25 08:02:40' WHERE `credit_cashing_applications`.`id` = 16[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 280 LIMIT 1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-25 08:02:40', 'b981fa5a8d78a7452649a304b7c8802e', 0, '123456', 'test', '2014-08-25 08:02:40', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 281[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-25 08:02:40', 281, 0, '111111111111111111111', 'bank_card', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 281  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 48 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 48 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 281 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-25 08:02:40', 281, 'test', '2014-08-25 08:02:40')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 281) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 281 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 281 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 281) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 281 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-25 08:02:40' WHERE `credit_cashing_applications`.`id` = 17
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-25 08:02:40', 281, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', '2fbece994388b20d74413ecfc0080ddf', 0, '2014-08-25 08:02:40', 'credit_cashing', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 281 LIMIT 1[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 281  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-25 08:02:40', '2014-08-25 08:02:40', 'tester')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240865', 0, 'bf3cc6f11cad227ee3bac89ef61e57d7', '2014-08-25 08:02:40', 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-25 08:02:40', 'transaction', 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-25 08:02:40', 19, '2014-08-25 08:02:40', 343)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 19
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 19  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (343)
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 19  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (343)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140825160240891', 0, 'aef93281d605c688c0aaf636ebb85e0f', '2014-08-25 08:02:40', 0, 0, 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-25 08:02:40', 'transaction', 2, '2014-08-25 08:02:40', '2014-08-25 08:02:40', '2024-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:40', 'fcfdb4d01f2f5df8c2f6b4213d91c332', 0, '123456', 'test', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:40', 282, 0, '1234567812345678', 'bank_card', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 282  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 49 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 49 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 49 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-25 08:02:40', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 49 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:40', '7457ceabcad68770ffdbd48f895a3cfc', 0, '123456', 'test', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-25 08:02:40', 283, 0, '1234567812345678', 'bank_card', '2014-08-25 08:02:40')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 283[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 283
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 283  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-25 08:02:40', '994ff57a85b7edc4be006bfee46b7849', 0, '123456', 'test', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 3[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM `configurations` WHERE `configurations`.`id` = 3[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 4[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (20.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('7b1bdd6a6642a147d7f5c1c0ad44c902', 'core-engine', 'test', '2014-08-25 08:02:40', '0', '2014-08-25 08:02:40')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-25 08:02:40' WHERE `platform_accounts`.`id` = 5[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (36.5ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '7b1bdd6a6642a147d7f5c1c0ad44c902' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (1.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('6806884e8616fc4c6b5a2b75c986fbc0', 'core-engine', 'test', '2014-08-25 08:02:41', '0', '2014-08-25 08:02:41')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '6806884e8616fc4c6b5a2b75c986fbc0' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = '6806884e8616fc4c6b5a2b75c986fbc0' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '6806884e8616fc4c6b5a2b75c986fbc0' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-25 08:02:41', 19, 1, '2014-08-25 08:02:41')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-25 08:02:41', 19, 1, '2014-08-25 08:02:41')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-25 08:02:41', 19, 0, '2014-08-25 08:02:41')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mBank::CardBin Load (61.2ms)[0m  [1mSELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35mBank::CardBin Load (0.2ms)[0m  SELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-25 08:02:41', 19, 1, '2014-08-25 08:02:41')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.4ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:10:08', 'tester', '$2a$04$6KPEB4mX.RcAT94v3LorBu8F8UpUh4B.qNerpvSgApeXJcqkQRybC', 'tester', 'admin', '2014-08-25 08:10:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (15.3ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:11:28', 'tester', '$2a$04$Sg5M1.akLj.mEtSXLIqSweYT3YHO7wGVJ6cPkOCeLys3GUi29mmRq', 'tester', 'admin', '2014-08-25 08:11:28')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (15.8ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:12:01', 'tester', '$2a$04$BWf6vn./t2c8ixdIIprdZ.w1GRXFVl3G.EGBDADsNwX8nWAXL9gZi', 'tester', 'admin', '2014-08-25 08:12:01')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:12:49', 'tester', '$2a$04$FKKUpLJHmiOo/Q9NESG4KOFKgetli2sS1WKBYmwhokEYlyglvUoeS', 'tester', 'admin', '2014-08-25 08:12:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:12:54', 'tester', '$2a$04$WK6MxEl.w54IasjIP6w2OO1CSkXqAh18h1tHQ6eteE5tyVj7iXXMG', 'tester', 'admin', '2014-08-25 08:12:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:13:09', 'tester', '$2a$04$KMSqNC0bqXIEj.3jSpKd6eNzQFFhZ/AwOvknkdjHhNa24KspBYeFG', 'tester', 'admin', '2014-08-25 08:13:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:13:36', 'tester', '$2a$04$5YuRSWndqLpeQHETmcBX2ue.CZJAhHTD5C/8Hx1NVzzMxbNvOr5Xq', 'tester', 'admin', '2014-08-25 08:13:36')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-25 08:13:51', 'tester', '$2a$04$mWq/etrZpyuBFyEc.KuDEevqoRImrvLjH9sCLYHhcK3I4zPY0f8iO', 'tester', 'admin', '2014-08-25 08:13:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
Processing by SessionsController#destroy as HTML
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (15.9ms)[0m  [1mROLLBACK[0m
DEPRECATION WARNING: set the 'will_paginate.previous_label' key in your i18n locale instead of editing pagination_options (called from /project/didikon/core-system/config/initializers/will_paginate.rb:2:in `<top (required)>')
DEPRECATION WARNING: set the 'will_paginate.next_label' key in your i18n locale instead of editing pagination_options (called from /project/didikon/core-system/config/initializers/will_paginate.rb:3:in `<top (required)>')
  [1m[36mActiveRecord::SchemaMigration Load (83.7ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (54.3ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (53.9ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (114.7ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:26:51', 'test', '$2a$04$31SbuPTbbc8desgyel542.aqYRHudeBrbgqBw46wB5l/47.onC9VG', 'tester', 'dept_manager', '2014-08-26 08:26:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
  Parameters: {"name"=>"1", "merchant_number"=>"1", "status"=>"1"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (29.4ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:27:54', 'test', '$2a$04$dFg3mAR.QAWlLyulxMnAfeDVfRNcHsWf0U9XxamvB0vlrjfnk8RNy', 'tester', 'dept_manager', '2014-08-26 08:27:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:28:13', 'test', '$2a$04$DHbT2bGOzf9fEfYO27OYq.oM7kqXNAJ3.dfslVoAK4tgSYk7b9O.a', 'tester', 'dept_manager', '2014-08-26 08:28:13')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 2ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:34:18', 'test', '$2a$04$mG.By7EfGwevxR2AEBOPDeIXjpSp8paiPmGo8DxARV7uqqqd.PZia', 'tester', 'dept_manager', '2014-08-26 08:34:18')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 2ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:34:25', 'test', '$2a$04$pHESRtF4v/KAvBK9mLaqpOBYg5N3US8exyJ9Atsho0584EZBnc9E.', 'tester', 'dept_manager', '2014-08-26 08:34:25')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 2ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.3ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:35:35', 'test', '$2a$04$8aVXEYXTHq30pjWdYIU./u/czgnnwR3bXtJLm4pR3PZvYE5jN9oZe', 'tester', 'dept_manager', '2014-08-26 08:35:35')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 2ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:35:57', 'test', '$2a$04$XUX25bzgDG.yPpcUUj7ruuI40ldfya.CDDALjowzBFNyJ7XgLELzi', 'tester', 'dept_manager', '2014-08-26 08:35:57')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#create as HTML
  Parameters: {"username"=>"test", "password"=>"[FILTERED]", "image_captcha"=>"fake one"}
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 2ms (ActiveRecord: 0.0ms)
Processing by Merchant::MerchantStoresController#index as HTML
Redirected to http://test.host/
Filter chain halted as :check_login rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.3ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:44:52', 'test', '$2a$04$Yg4sH7h1ty06WNPRfGIrneqVgvWIBQm/Gs.80vAyPBAX54ySTFNY2', 'tester', 'dept_manager', '2014-08-26 08:44:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.2ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` IS NULL  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
Completed 404 Not Found in 25ms
  [1m[35m (15.4ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:45:27', 'test', '$2a$04$daIu1yAov3uy7YFZ5ieIU.GDxoMc51uwY4DXa4ufYKZEF1Vj486VG', 'tester', 'dept_manager', '2014-08-26 08:45:27')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.3ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` IS NULL  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
Completed 404 Not Found in 55909ms
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:46:35', 'test', '$2a$04$dBO28yk3ajk9J/VlH9Ma0.JaKvohhJ2gnwAWFxnq70zImBallUIie', 'tester', 'dept_manager', '2014-08-26 08:46:35')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.4ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 29  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
  Rendered merchant/merchant_stores/_search_form.html.erb (137.5ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.1ms)
  Rendered merchant/merchant_stores/index.html.erb within layouts/application (371.0ms)
  Rendered application/_header.html.erb (1.8ms)
  Rendered application/_sidebar.html.erb (0.9ms)
  Rendered shared/_notice.html.erb (1.3ms)
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:47:24', 'test', '$2a$04$gdiI3QM.dDFCwKRUOTpvm.KuwgzFGtdeqnnWXoIBLV.e4wqIXvUW.', 'tester', 'dept_manager', '2014-08-26 08:47:24')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.3ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 30  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
  Rendered merchant/merchant_stores/_search_form.html.erb (70.6ms)
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered merchant/merchant_stores/index.html.erb within layouts/application (259.4ms)
  Rendered application/_header.html.erb (0.8ms)
  Rendered application/_sidebar.html.erb (0.6ms)
  Rendered shared/_notice.html.erb (0.6ms)
Completed 200 OK in 999ms (Views: 768.1ms | ActiveRecord: 34.5ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:48:52', 'test', '$2a$04$CD4ZLJFFhJQ4HFZexDHNV.DfjH12zl4za5vPJ6VLK6U9HLqiD37le', 'tester', 'dept_manager', '2014-08-26 08:48:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.3ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 31  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
  Rendered merchant/merchant_stores/_search_form.html.erb (61.0ms)
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered merchant/merchant_stores/index.html.erb within layouts/application (230.4ms)
  Rendered application/_header.html.erb (0.6ms)
  Rendered application/_sidebar.html.erb (0.3ms)
  Rendered shared/_notice.html.erb (0.3ms)
Completed 200 OK in 441ms (Views: 371.8ms | ActiveRecord: 35.0ms)
  [1m[36m (69.1ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (25.5ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (16.1ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('7b789c93b42729b97cce2d46fb79bbef', 'core-engine', 'test', '2014-08-26 08:49:07', '0', '2014-08-26 08:49:07')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (15.3ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (134.1ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-26 08:49:07' WHERE `platform_accounts`.`id` = 7
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (21.6ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '7b789c93b42729b97cce2d46fb79bbef' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (41.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('b3d978f5e362f261db01dd05483f6c74', 'core-engine', 'test', '2014-08-26 08:49:07', '0', '2014-08-26 08:49:07')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.3ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'b3d978f5e362f261db01dd05483f6c74' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = 'b3d978f5e362f261db01dd05483f6c74' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'b3d978f5e362f261db01dd05483f6c74' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (71.4ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:07', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:49:07', '1976-01-01 00:00:00', '2014-08-26 08:48:07', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (22.6ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:49:07') AND (valid_till >= '2014-08-26 08:49:07')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:49:07' or valid_till < '2014-08-26 08:49:07')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (15.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:07', 0.05, 0.1, 'credit_back', 0.03, '2014-08-26 08:49:07', '1976-01-01 00:00:00', '2024-08-26 08:49:07', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`
  [1m[36mPay::CreditBack Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:49:07') AND (valid_till >= '2014-08-26 08:49:07')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:49:07' or valid_till < '2014-08-26 08:49:07')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (15.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:07', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:49:07', '2014-08-26 08:50:07', '2014-08-26 08:59:07', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:49:07') AND (valid_till >= '2014-08-26 08:49:07')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:49:07' or valid_till < '2014-08-26 08:49:07')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:07', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:07')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:07', 'd2df3b3d285c216452a685d89091ea89', 0, '2014-08-26 08:49:07')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 70) LIMIT 1[0m
  [1m[35mSQL (20.7ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 285, `updated_at` = '2014-08-26 08:49:07' WHERE `merchant_stores`.`id` = 70
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:07', 0.05, 0.1, 70, 'credit_back', 0.03, 1, '2014-08-26 08:49:07', '2014-08-26 08:48:07', '2014-08-26 08:50:07', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.3ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 70) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:49:07', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 23
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 70) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:49:07' WHERE `merchant_stores`.`id` = 70
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:49:07', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 23[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 70) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:49:07' WHERE `merchant_stores`.`id` = 70[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.1ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:49:07', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 23
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 70) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:49:07' WHERE `merchant_stores`.`id` = 70
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.1ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:49:07', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 23[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 70 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 70) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:49:08' WHERE `merchant_stores`.`id` = 70[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 70 LIMIT 1
  [1m[36m (19.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:08', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:49:08', '2014-08-26 08:48:08', '2014-08-26 08:50:08', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:49:08') AND (valid_till >= '2014-08-26 08:49:08')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:49:08' or valid_till < '2014-08-26 08:49:08')[0m
  [1m[35mPay::PaymentPlan Load (0.1ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:08', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:49:08', '1976-01-01 00:00:00', '2024-08-26 08:49:08', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:49:08') AND (valid_till >= '2014-08-26 08:49:08')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:49:08' or valid_till < '2014-08-26 08:49:08')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (17.7ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:49:08', '2014-08-26 08:49:08')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:49:08', '1234', 10, '2014-08-26 08:49:08')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:49:08', '1235', 10, '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 10 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 10 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:49:08', `used` = 1 WHERE `sequence_numbers`.`id` = 19
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 10 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 10 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:49:08', `used` = 1 WHERE `sequence_numbers`.`id` = 20
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 10 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.1ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 10 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:49:08', 'tester', '$2a$04$g4WlBeajgSI1/q3fd8bciOiLX/TpewHAEWQrJ1iub6ExL1tG5fyPq', 'tester', 'admin', '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (19.1ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:49:08', 'tester', '$2a$04$j0hW8U2XYK3ouOsGDVHzHOp4CT3gp.xkqNYPiT9RuwjwegWB6eA46', 'tester', 'admin', '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[36m (15.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:49:08', 'tester', '$2a$04$VXyR6ZIBY6gOhpR/W4p02./zrX3esBkbpS0uGzHDgNPdij/YfEOIK', 'tester', 'admin', '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:49:08', 'tester', '$2a$04$uZ2a72k6d6hs7sgLt8A2KuCnPAJvB1iGa.ciQxHE.j0uDzG9wrJnS', 'tester', 'admin', '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered shared/_notice.html.erb (0.6ms)
Completed 200 OK in 459ms (Views: 458.8ms | ActiveRecord: 0.0ms)
  [1m[36m (15.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:08', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:08', '2c1f8f15c54dbdbb7f363898d77639af', 0, '2014-08-26 08:49:08')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 71) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 286, `updated_at` = '2014-08-26 08:49:08' WHERE `merchant_stores`.`id` = 71
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:08', 'test_group', '2014-08-26 08:49:08')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-26 08:49:08', 43, 71, '2014-08-26 08:49:08')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 43) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 43 LIMIT 1
  [1m[36m (16.9ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 43[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 71 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 71[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 71  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:49:09', 1, 0, '2014-08-26 08:49:09', 'none', '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (19.9ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (15.7ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-26 08:49:09' WHERE (`transaction_logs`.`id` = 7 AND `transaction_logs`.`transaction_datetime` = '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (9.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:09', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-26 08:49:09', '1976-01-01 00:00:00', '2024-08-26 08:49:09', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:09', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-26 08:49:09', '1976-01-01 00:00:00', '2024-08-26 08:49:09', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (15.0ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:09', '6ada930fef13cd2b29d389f299ed5c2b', 0, '123456', 'test', '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:09', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:09', '4ab7d48b2f71a263968e1c09f1b97cd8', 0, '2014-08-26 08:49:09')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 72) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 288, `updated_at` = '2014-08-26 08:49:09' WHERE `merchant_stores`.`id` = 72[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:09', 'test_group', '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:49:09', 287, 44, 'Merchant::MerchantGroup', '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 287) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 287 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 44 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:09', '51ef5b76bda6d7ceb9b065e0578a5b45', 0, '123456', 'test', '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:09', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:09', 'e5155d6d6c875d56c241e0f62f283547', 0, '2014-08-26 08:49:09')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 73) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 290, `updated_at` = '2014-08-26 08:49:09' WHERE `merchant_stores`.`id` = 73
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:09', 'test_group', '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:49:09', 289, 73, 'Merchant::MerchantStore', '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 289) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 289 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 73 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (21.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-26 08:49:09', 19, 1, '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-26 08:49:09', 19, 1, '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-26 08:49:09', 19, 0, '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mBank::CardBin Load (78.9ms)[0m  [1mSELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35mBank::CardBin Load (0.2ms)[0m  SELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-26 08:49:09', 19, 1, '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (24.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-26 08:49:09', '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-26 08:49:09', '11', 'test', 0.01, 'editing', '2014-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:09', '5278a17bab432ef853f0aed126f2b088', 0, 'test1', '2014-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 74
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (59.6ms)[0m  [1mDELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 291 AND `credit_accounts`.`lock_version` = 0[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 74
  [1m[36mMerchant::MerchantGroupShip Load (0.1ms)[0m  [1mSELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 74[0m
  [1m[35mMerchant::MarketingRule Load (13.1ms)[0m  SELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 74
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 74[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164909891', 0, 'bbd678ecdbe60361b0bd7cac1d52c7bd', '2014-08-26 08:49:09', 0, 0, 2, '2014-08-26 08:49:09', '2014-08-26 08:49:09', '2024-08-26 08:49:09')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:49:09', 'transaction', 2, '2014-08-26 08:49:09', '2014-08-26 08:49:09', '2024-08-26 08:49:09')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-26 08:49:09', 21, '2014-08-26 08:49:09', 345)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 21
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 21  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (345)
  [1m[36mMerchant::PostAction Load (0.1ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 21  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (345)
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164910022', 0, '4d83ef34b5f0dfa8c5883d74aee83adf', '2014-08-26 08:49:10', 0, 0, 2, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:49:10', 'transaction', 2, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:10', '5839d6a45821395c3a85c2dec374f0af', 0, '123456', 'test', '2014-08-26 08:49:10', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 292[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:49:10', 292, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 292  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 51 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.3ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 51 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 292 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:49:10', 292, 'test', '2014-08-26 08:49:10')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 292) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 292 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 292 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 292) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 292 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-26 08:49:10' WHERE `credit_cashing_applications`.`id` = 18
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 292 LIMIT 1
  [1m[36m (21.2ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count[0m
  [1m[35m (34.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:10', '46bcfb2e5bc3a5d7c519b888513c1615', 0, '123456', 'test', '2014-08-26 08:49:10', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 293
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:49:10', 293, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 293  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 52 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.4ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 52 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 293 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:49:10', 293, 'test', '2014-08-26 08:49:10')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 293) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 293 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 293 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 293) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 293 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-26 08:49:10' WHERE `credit_cashing_applications`.`id` = 19[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:49:10', 293, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'd446a9929525fc604eded94c523ea412', 0, '2014-08-26 08:49:10', 'credit_cashing', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 293 LIMIT 1
  [1m[36mTrade::TransactionLog Load (0.6ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 293  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 5
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 5
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 6
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:49:10', 'e5da64dbde47db5dedf7c5f090ffab68', 'roll_back', '2014-08-26 08:49:10', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-26 08:49:10', 'f42bbcfa73896821ac3832f79eb18671', 0, '123456', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 294) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 294 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 294) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 294 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:49:10', '3cfe5dc6f9cebdc5bbea2ea608ab20e8', 0, '123456', 'test', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:49:10', 'dbc02113574c800b4e21835bac9c3013', 0, '123456', 'test', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-26 08:49:10', '8aa2a2447c0e5a1e856c1da2bd76bba8', 0, '12345611', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:10', 'e25c8031ea34dee2220b5d70cba2cbb0', 0, '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:10', 'dc5d70df80b08666c94ec88b6f7e4ea8', 0, '123456', 'test', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 299
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 299, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 299[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:10', 'b2930cc3e9ccb554c1c0b2d1aac88e10', 0, '123456', 'test', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 300
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 300, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 300[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:10', 'f557a82f4e2527d85b5bdba4eab35851', 0, '123456', 'test', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 301[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 301, 0, '1111111111111111111110', 'bank_card', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 301
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 301, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 301[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 301, 0, '1111111111111111111112', 'bank_card', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 301
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 301, 0, '1111111111111111111113', 'bank_card', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 301[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:10', 301, 0, '1111111111111111111114', 'bank_card', '2014-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 301
  [1m[36m (15.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (24.8ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:10', '562de159c19a0af95e92eb8493f2e51f', 0, '123456', 'test', '2014-08-26 08:49:10', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 302) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 302 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 302 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:10', 'eaaf9676fc111fa21ebeed7fa505851b', 0, '123456', 'test', '2014-08-26 08:49:10', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 303) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 303 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 303) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 303 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 303 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:10', 'b87dbf1a234fc9aee9229a4fe318e1c6', 0, '123456', 'test', '2014-08-26 08:49:10', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 304) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 304 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 304) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-26 08:49:10', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 304 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.6ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 304 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:49:10', '296dd37dd439a3f6d68183f39a6d11f5', 'credit_back', '2014-08-26 08:49:10', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:49:10', 'test', '$2a$04$hGGhJrYryRkWCY8Y8BNhmeWrHd4Rqzl88dqezQ2mOV2QsKWT8WTqq', 'tester', 'dept_manager', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.3ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 36  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
  Rendered merchant/merchant_stores/_search_form.html.erb (35.7ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered application/_header.html.erb (0.8ms)
  Rendered application/_sidebar.html.erb (0.6ms)
  Rendered shared/_notice.html.erb (0.1ms)
Completed 200 OK in 147ms (Views: 117.1ms | ActiveRecord: 0.9ms)
  [1m[36m (15.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:10', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:10', '67e96787f682d1e351f764ec60432ccd', 0, '2014-08-26 08:49:10')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 75) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 305, `updated_at` = '2014-08-26 08:49:10' WHERE `merchant_stores`.`id` = 75
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:49:10', 75, 'register', 2, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:49:10', 75, 'bind_card', 2, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:49:10', 75, 'transaction', 2, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:49:10', 75, 'none', 1, '2014-08-26 08:49:10', '1976-01-01 00:00:00', '2024-08-26 08:49:10', 3)
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 75 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 75 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 75) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:49:10' WHERE `merchant_stores`.`id` = 75
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (25, 28)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 75 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 75 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 75) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'
  [1m[36mMerchant::MarketingRule Load (0.1ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 75
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 28[0m
  [1m[35m (16.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-26 08:49:10', '2014-08-26 08:49:10', 'tester')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:10', '276079e5a0fbabd230cce41822c1b5a8', 0, '123456', 'test', '2014-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164910824', 1, 0, '15571c1994e7eaa101cbbb7bdd26c5a6', '2014-08-26 08:49:10', 1, 0, 0, 1, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164910827', 0, 'fb9b5a2de338185b150315d015961b43', '2014-08-26 08:49:10', 0, 0, 1, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164910829', 2, 0, '6e1d93f3ab83b49af674a8674b86b9cb', '2014-08-26 08:49:10', 2, 0, 1, 0, 1, '2014-08-26 08:49:10', '2014-08-26 08:49:10', '2024-08-26 08:49:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'fb9b5a2de338185b150315d015961b43'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 348 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:49:10' WHERE `voucher_meta`.`id` = 348[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:10', 1, 'a0392badfab920f10a6e7434a81e02e0', '2014-08-26 08:49:10', 348)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 306, `updated_at` = '2014-08-26 08:49:10' WHERE `vouchers`.`id` = 90[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 306) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:10', 306, 'system', 0, '123456', 'ea5356eb31fba9f6af338d02f75af21e', 0, '2014-08-26 08:49:10', 'issue', '2014-08-26 08:49:10', 'fb9b5a2de338185b150315d015961b43', 'a0392badfab920f10a6e7434a81e02e0')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'fb9b5a2de338185b150315d015961b43'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 348 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:49:10' WHERE `voucher_meta`.`id` = 348
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:10', 1, '008ebff8589c4643412e7c3de1ba7866', '2014-08-26 08:49:10', 348)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 306, `updated_at` = '2014-08-26 08:49:10' WHERE `vouchers`.`id` = 91
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 306) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:10', 306, 'system', 0, '123456', '7f641d02c6cf4c178859800b75685491', 0, '2014-08-26 08:49:10', 'issue', '2014-08-26 08:49:10', 'fb9b5a2de338185b150315d015961b43', '008ebff8589c4643412e7c3de1ba7866')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'fb9b5a2de338185b150315d015961b43'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 348 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:49:10' WHERE `voucher_meta`.`id` = 348[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:10', 1, 'f94ad6da2dfe1814d4da114f7c1e2768', '2014-08-26 08:49:10', 348)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 306, `updated_at` = '2014-08-26 08:49:10' WHERE `vouchers`.`id` = 92[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 306) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:10', 306, 'system', 0, '123456', 'ca6bee24b1eae07da6b72937cc810be5', 0, '2014-08-26 08:49:10', 'issue', '2014-08-26 08:49:10', 'fb9b5a2de338185b150315d015961b43', 'f94ad6da2dfe1814d4da114f7c1e2768')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 306[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 348 LIMIT 1
  [1m[36m (41.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '1c355329d387f43313bb5d03a611efc9', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911041', 1, 0, '8b7bfbd48a1f23d3a65fe715a1e7eb7b', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911044', 0, 'c38d157fb14ca5787b83d8eaf717faad', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911046', 2, 0, '18cf2e41674fa01f3ab7db46d939856d', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '18cf2e41674fa01f3ab7db46d939856d'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 352 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 307 AND `vouchers`.`voucher_meta_id` = 352[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 352
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, '6f7035d604b7f2f2052da0938c3ec2da', '2014-08-26 08:49:11', 352)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 307, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 93
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 307) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 307, 'system', 0, '123456', '08aecdf294e3f4bb7eded693fd7e32a4', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', '18cf2e41674fa01f3ab7db46d939856d', '6f7035d604b7f2f2052da0938c3ec2da')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '18cf2e41674fa01f3ab7db46d939856d'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 352 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 307 AND `vouchers`.`voucher_meta_id` = 352[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', 'b9c6c67da5c7cf4a629b347083355629', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911068', 1, 0, 'b0eaa407a7c641df50b2d25aaabecedb', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911071', 0, '030a82f4f351768f0c6edeef2e86ea4e', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911072', 2, 0, '740b152e9d610f2490fe199362b42a1b', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'b0eaa407a7c641df50b2d25aaabecedb'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 353 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 353[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, '2e8b7f92f3c8a0d357bf9c5366198a2f', '2014-08-26 08:49:11', 353)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 308, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 94[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 308) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 308, 'system', 0, '123456', '9af64cba58492b391e9e63f796fd1c2a', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', 'b0eaa407a7c641df50b2d25aaabecedb', '2e8b7f92f3c8a0d357bf9c5366198a2f')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 308[0m
  [1m[35mTrade::VoucherTransactionLog Load (1.2ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 308  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (353)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 353 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '7ad8ebd1e9e32412f214c8f92c7f579d', 0, '123456', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911095', 1, 0, 'f7e9cb0d38319ab8e4f0496cf629f6e5', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911098', 0, 'df43013d70e69726c02c14d19c5d7fc5', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911100', 2, 0, 'e87e6697e478beb31ee94f86c501625a', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-26 08:49:11', 'b8114ee1351446a4725a28b7b84cb866', 0, '1234561', 'test1', '2014-08-26 08:49:11', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e87e6697e478beb31ee94f86c501625a'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 358 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 309 AND `vouchers`.`voucher_meta_id` = 358
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 358[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, 'ae5c81acb10d7f1b09e31f5b305763b6', '2014-08-26 08:49:11', 358)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 309, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 95[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 309) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 309, 'system', 0, '123456', '6d2f6c8cc4b26fcf779a0037471e1418', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', 'e87e6697e478beb31ee94f86c501625a', 'ae5c81acb10d7f1b09e31f5b305763b6')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e87e6697e478beb31ee94f86c501625a'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 358 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 310 AND `vouchers`.`voucher_meta_id` = 358
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 358[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, '5aa50ce7f66bfba4ce33be315057cc91', '2014-08-26 08:49:11', 358)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 310, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 96[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 310) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 310, 'system', 0, '1234561', 'bf6184957b34d69d0c47980c858764a1', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', 'e87e6697e478beb31ee94f86c501625a', '5aa50ce7f66bfba4ce33be315057cc91')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 309[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 310
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '31899cc61142262a7c9d8fc4ab0da210', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911130', 1, 0, '03de00ba65bdfb81578bb3046f217866', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911132', 0, '2c8cfdf40758ade03e4eeab3501ea937', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911134', 2, 0, '8f9055fe658d8c8293462a2b929dd56a', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '03de00ba65bdfb81578bb3046f217866'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 359 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 359[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, 'f6da8862ab9b8fbb7c7a7d19f3b00979', '2014-08-26 08:49:11', 359)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 311, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 97[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 311) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 311, 'system', 0, '123456', '4edc20ec5e09c92e0225e6298add82d2', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', '03de00ba65bdfb81578bb3046f217866', 'f6da8862ab9b8fbb7c7a7d19f3b00979')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '03de00ba65bdfb81578bb3046f217866'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 359 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '0b8e348a714b7a48b0569209c119cce8', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911152', 1, 0, 'b174f14a2fdd667180697f33f6b4bde8', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911154', 0, '2285fa839b4b52ca22c79d41e812c7a2', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911156', 2, 0, '317bf3f738426b60860ee31571a3a93d', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 362 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 362
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, 'df9d0d9fc0e179b8af755944e6150f02', '2014-08-26 08:49:11', 362)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 312, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 98
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 312) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 312, 'system', 0, '123456', 'df39266b26dbd6a9203050203deedcd4', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', 'b174f14a2fdd667180697f33f6b4bde8', 'df9d0d9fc0e179b8af755944e6150f02')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 312
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 312  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (362)[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 362 LIMIT 1
  [1m[36m (3.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '83656e6270b540c20051770c96ea4440', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911179', 1, 0, '9e5e9b7470a3df7aee6bc839611b510f', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911181', 0, 'a39e134647e2ca6719579df5464ed4df', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911183', 2, 0, '8a0b12eed6d496de945484112f99e060', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 365[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '9e5e9b7470a3df7aee6bc839611b510f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', 'f9620b4679b34b8e16600fcc01288e3b', 0, '123456', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911193', 1, 0, 'a7bf615d0503049867adc87a06680cf4', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911195', 0, '5e79117aa2af8517280ab0913e5ce2d5', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911198', 2, 0, 'bb3d8ed53e36167252c0ebf674a9d26f', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '87678a77921ebb5445cb0c1b4a16042f', 0, '2014-08-26 08:49:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 76) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 315, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 76
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_group', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '39fdd0749c677eefaf3818b8390a57d2', 0, '112312323', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 316 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 46 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:49:11', 316, 46, 'Merchant::MerchantGroup', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 316) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 316 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 46 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 316) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 316 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 316 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.3ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 316 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 46 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 46 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.4ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 46 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '101cc6a8fad5ccb9f6de46c6ae1fbe7a', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911232', 1, 0, '97fa3a5bde0e38106b9d5777997ef542', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911234', 0, '83f2b8f93f4bb07d27956f746ba9aa91', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911236', 2, 0, '1fdc43d36b339333f4040aaba457a53f', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '4f64766bb60ba26ea3b5d16ff904d60d', 0, '2014-08-26 08:49:11')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 77) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 318, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 77[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_group', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '06b9b7d6cb4c1b4c98bdd6ffc60c2999', 0, '112312323', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 319 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 77 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:49:11', 319, 77, 'Merchant::MerchantStore', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 319) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 319 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 77 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 319) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 319 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 319 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 319 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 77 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 77 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 77 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '94796a5fb7da537a3d4fea288585c465', 0, '123456', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911269', 1, 0, '393e0ccf824c39fc235bcbec4d6810bb', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911271', 0, '0c6f6a6cad7aec5907d52eed09cdefd9', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911273', 2, 0, '09ad1dcddf3bf5c09504923d4c1c1731', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '06a09090518f5f678c4ca83b29c4b30a', 0, '2014-08-26 08:49:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 78) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 321, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 78
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_group', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '5fb698ce3286ea14b5c0c454b1180e91', 0, '112312323', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 322 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 48 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:49:11', 322, 48, 'Merchant::MerchantGroup', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 322) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 322 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 322 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 322 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 48 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 48 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 48 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', 'a2b6389a0896d68d9f0651730c4acf35', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911305', 1, 0, '7e7b1d2498cffe1dffe743a155a476ab', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911307', 0, '08271e4fa8813cc24a4e63d5bd74a2ca', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911309', 2, 0, '802b08d5bd42d83a60b507125f1c5e42', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '1dd78bc2b274b9e5940fb371095471b2', 0, '2014-08-26 08:49:11')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 79) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 324, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 79[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_group', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '25923fecf67cf3208b63af64b83d4f59', 0, '112312323', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 325 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 79 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:49:11', 325, 79, 'Merchant::MerchantStore', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 325) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 325 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 325 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 325 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 79 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 79 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 79 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '53cca2f58ab59a62c16cdc545bdef11f', 0, '123456', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911342', 1, 0, '37332203c05758006873861b1501da1a', '2014-08-26 08:49:11', 1, 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911345', 0, 'eccaaf81334d18f065ae5dd48bf8bc22', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911347', 2, 0, 'd7208b1b9d872dbc69175e7062954425', '2014-08-26 08:49:11', 2, 0, 1, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:49:11', '2014-08-26 08:49:11')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:49:11', '1234', 11, '2014-08-26 08:49:11')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:49:11', '1235', 11, '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911355', 0, '0d13839975d0274203376a4e9d4fc2b4', '2014-08-26 08:49:11', 0, 11, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 383 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 383
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 11 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 11 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 11 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:49:11', `used` = 1 WHERE `sequence_numbers`.`id` = 21
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', '1234', 1, 'ee09a0969fcb1435ff64a6aebf8e2f05', '2014-08-26 08:49:11', 383)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 326, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 99
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 326) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 326, 'system', 0, '123456', 'cd36ba28768d335e75d8ea588242f608', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', '0d13839975d0274203376a4e9d4fc2b4', '1234', 'ee09a0969fcb1435ff64a6aebf8e2f05')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.5ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 383 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 383[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 11 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 11 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 11 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:49:11', `used` = 1 WHERE `sequence_numbers`.`id` = 22[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', '1235', 1, '0dd0e942f7e56b0488567b5502d307d9', '2014-08-26 08:49:11', 383)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 326, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 100[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 326) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:49:11', 326, 'system', 0, '123456', 'c4373f32cb5178e6f7c083544e351875', 0, '2014-08-26 08:49:11', 'issue', '2014-08-26 08:49:11', '0d13839975d0274203376a4e9d4fc2b4', '1235', '0dd0e942f7e56b0488567b5502d307d9')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 383 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 383[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 11 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 11 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 11 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '0ee12ec63d6d49ebe0487bdd08507e7b', 0, '123456', 'test', '2014-08-26 08:49:11', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 327
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:49:11', 327, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 327  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 60 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:49:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 60 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 327 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '0bf535623a1530bd8d2cbe58841c3b42', 0, '123456', 'test', '2014-08-26 08:49:11', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 328[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:49:11', 328, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 328  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 61 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:49:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 61 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 328 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:49:11', 328, 'test', '2014-08-26 08:49:11')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 328) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:49:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 328 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 328  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 328  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '40113501c1e2b2bc6a91e2b37789f392', 0, '123456', 'test', '2014-08-26 08:49:11', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 329[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:49:11', 329, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 329 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '524db31c758d0e1a992dfd932d1f12b4', 0, '123456', 'test', '2014-08-26 08:49:11', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 330 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-26 08:49:11', '2ed59dd8373da726ef2d3644dfa6913f', 0, '2014-08-26 08:49:11', 8000)[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 80) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 331, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 80[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::MerchantCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 331 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 331  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-26 08:49:11', 331, 'test name', '2014-08-26 08:49:11')
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:49:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 331 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-26 08:49:11', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '5b17f306058cd02fb1a574d66ec80199', 0, '123456', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:11', 332, 0, '1234567812345678', 'bank_card', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 332
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 332[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 332  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', 'd5e6c99d00c53bb389c1e57234f0fb03', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:49:11', 333, 0, '1234567812345678', 'bank_card', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 333  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 64 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-26 08:49:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 64 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 64 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-26 08:49:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 64 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', '2d80bd204bba17dd70782026c761ef3a', 0, '123456', 'test', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911508', 0, '5cbd38425e208013ba996771629bd1b4', '2014-08-26 08:49:11', 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '815cd5399711b64039511b97314116d0', 0, '2014-08-26 08:49:11')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 81) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 335, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 81[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_group', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 50, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 384
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 384 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 50 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911526', 0, 'eac48a01d19c65b9ee4a22a53d1d3ee8', '2014-08-26 08:49:11', 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '85793171badebe03d1233b1c8726bcc6', 0, '2014-08-26 08:49:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 82) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 336, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 82
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_group', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 82, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 385[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 385 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 82 LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911545', 0, '81a867872310f04ba87103d05ce99021', '2014-08-26 08:49:11', 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911549', 0, 'b96818a14650c821e6c942dd91d0d8d4', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:44:11', '2014-08-26 08:54:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911551', 0, '3f13ba31860e345743d575018bb9feb3', '2014-08-26 08:49:11', 0, 0, 1, '2014-08-26 08:49:11', '2014-08-26 08:54:11', '2014-08-26 08:44:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911555', 100, 0, '729368cab006d0c618cbfcc89ec3d1a5', '2014-08-26 08:49:11', 100, 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 389
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 389[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911562', 0, 'b93f37e19dd6e09d292e36ec22cb19d0', '2014-08-26 08:49:11', 10000, 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:49:11', 'd9123db5971a1dcd3ecb5e05ac5a08f1', 0, '123456', 'test', '2014-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 390[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, '2fbef6296dc6bf386d61e9abe19ae2c4', '2014-08-26 08:49:11', 390)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 337, `updated_at` = '2014-08-26 08:49:11' WHERE `vouchers`.`id` = 101[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 337) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 337  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (390)[0m
  [1m[35m (6.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:49:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:49:11')
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:49:11', '4da7e06998d1aa479a030aeace2113a9', 0, '2014-08-26 08:49:11')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 83) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 338, `updated_at` = '2014-08-26 08:49:11' WHERE `merchant_stores`.`id` = 83[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-26 08:49:11', 'test_display', 'test_group', '2014-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911595', 0, '66c12595a6d96e774c8a7a828e16e4ee', '2014-08-26 08:49:11', 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911597', 1, '903fc441af7cc66c84c553d077858d7e', '2014-08-26 08:49:11', 0, 83, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911599', 2, 'b9878f8f7a12b7491e2c0a338a6a8d8c', '2014-08-26 08:49:11', 0, 52, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826164911604', 1, 0, 'b88ebdff0e4c4753a34d12ba124f8ae2', '2014-08-26 08:49:11', 10000, 1, 0, 0, 2, '2014-08-26 08:49:11', '2014-08-26 08:49:11', '2024-08-26 08:49:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:49:11' WHERE `voucher_meta`.`id` = 394
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:49:11', 1, '760152a587fbb82df074ee3bd3bb028c', '2014-08-26 08:49:11', 394)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 394 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:21', 'b23febedf90c6e023cb5601b824ef4eb', 0, '123456', 'test', '2014-08-26 08:53:21')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 339[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:21', 339, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:53:21')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 339
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (85.2ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:49', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:49', '90ff0d540c67abaf33cc44b0fc37ef1c', 0, '2014-08-26 08:53:49')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 84) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 340, `updated_at` = '2014-08-26 08:53:49' WHERE `merchant_stores`.`id` = 84
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:53:49', 84, 'register', 2, '2014-08-26 08:53:49', '2014-08-26 08:53:49', '2024-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:53:49', 84, 'bind_card', 2, '2014-08-26 08:53:49', '2014-08-26 08:53:49', '2024-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:53:49', 84, 'transaction', 2, '2014-08-26 08:53:49', '2014-08-26 08:53:49', '2024-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:49', 84, 'none', 1, '2014-08-26 08:53:49', '1976-01-01 00:00:00', '2024-08-26 08:53:49', 3)
  [1m[36mPay::PaymentPlan Load (0.5ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 84 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 84 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 84) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:53:49' WHERE `merchant_stores`.`id` = 84
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (28, 29)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 84 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 84 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 84) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 84
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 29[0m
  [1m[35m (33.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:49', '460a28414593edb121ca912340da83c7', 0, '123456', 'test', '2014-08-26 08:53:49', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 341) LIMIT 1[0m
  [1m[35m (0.3ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 341 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 341) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 341 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 341 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:49', 'bda37fb928f4b3a8a6867b73d83f5fdf', 0, '123456', 'test', '2014-08-26 08:53:49', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 342) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 342 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 342) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 342 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 342 LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:49', '7a0c67e1d11ad909820fbbeddbc3c216', 0, '123456', 'test', '2014-08-26 08:53:49', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 343) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 343 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 343 LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:49', 'd7b1e8904c06f55a0894f825ea30dc37', 0, '123456', 'test', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 344[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 344, 0, '1111111111111111111110', 'bank_card', '2014-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 344
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 344, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 344[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 344, 0, '1111111111111111111112', 'bank_card', '2014-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 344
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 344, 0, '1111111111111111111113', 'bank_card', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 344[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 344, 0, '1111111111111111111114', 'bank_card', '2014-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 344
  [1m[36m (16.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:49', '3274ec387205fb1e0ab69b8ad7613775', 0, '123456', 'test', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 345[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 345, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 345
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (16.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:49', '54009362d4d7bf5c68475e87af48af75', 0, '123456', 'test', '2014-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 346
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:49', 346, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 346[0m
  [1m[35m (46.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-26 08:53:49', '15c7433ee4ee06f2344aec225230fb9a', 0, '123456', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 347) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 347 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 347) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-26 08:53:49', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 347 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.1ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (9.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:53:49', 'e17def1fb32b84c242712c8725e13193', 0, '123456', 'test', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-26 08:53:49', '953b06c18d2e82143cd91b2ac1954964', 0, '12345611', '2014-08-26 08:53:49')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:49', 'b65aeef372f96276e06f79445a332bc1', 0, '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:53:49', 'f4f2c5a5957d67cf7f724edd2b70802a', 0, '123456', 'test', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 7[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 8[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM `configurations` WHERE `configurations`.`id` = 8[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-26 08:53:49', '2014-08-26 08:53:49')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:53:50', '997ad6217e4caacdf449485086f53197', 'credit_back', '2014-08-26 08:53:50', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-26 08:53:50', '2014-08-26 08:53:50', 'tester')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:53:50', 'tester', '$2a$04$0cxP4yzjUltzDywBY2RY5O.ka9jg6Tt/mRx0IPlV6U8gZftHFgLBe', 'tester', 'admin', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:53:50', 'tester', '$2a$04$TTfzcGA8qiVbVAPR5nhxg.NjLG2CELmS3rXevUWXRoTqpg5.RbgtK', 'tester', 'admin', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (21.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:53:50', 'tester', '$2a$04$sGSPV2rwVuWz8omLjGQ/Lux5s0wA502pHY17fTdM6mjsiwRoEbHWe', 'tester', 'admin', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered shared/_notice.html.erb (0.7ms)
Completed 200 OK in 486ms (Views: 485.7ms | ActiveRecord: 0.0ms)
  [1m[36m (15.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:53:50', 'tester', '$2a$04$NCSHKAgfWG60SdIAzux1J.Pvlh3Kd4ngcncp3GvkN0CwjfYzoy7N2', 'tester', 'admin', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:53:50', '68ebf0f61b813a8b97d87815347ddc0a', 'roll_back', '2014-08-26 08:53:50', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:50', '82e4dc2357b44ff54f35176342087089', 0, '123456', 'test', '2014-08-26 08:53:50')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:50', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:50')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:50', '1fe78caa194ad844f6abe29efda60e5a', 0, '2014-08-26 08:53:50')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 85) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 353, `updated_at` = '2014-08-26 08:53:50' WHERE `merchant_stores`.`id` = 85[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:50', 'test_group', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:53:50', 352, 85, 'Merchant::MerchantStore', '2014-08-26 08:53:50')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 352) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 352 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 85 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (32.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:50', 'aa0ac9c72b30edfc88a48a98d6b197df', 0, '123456', 'test', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:50', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:50', '12163594b0d375a6733c6ff3ebc4b268', 0, '2014-08-26 08:53:50')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 86) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 355, `updated_at` = '2014-08-26 08:53:50' WHERE `merchant_stores`.`id` = 86
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:50', 'test_group', '2014-08-26 08:53:50')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:53:50', 354, 54, 'Merchant::MerchantGroup', '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 354) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 354 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 54 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-26 08:53:50', 19, 1, '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-26 08:53:50', 19, 1, '2014-08-26 08:53:50')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-26 08:53:50', 19, 1, '2014-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-26 08:53:50', 19, 0, '2014-08-26 08:53:50')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (0.2ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.2ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165350998', 0, '0a8640b8f8cf5a7f05a9a60835a02a2b', '2014-08-26 08:53:50', 0, 0, 2, '2014-08-26 08:53:50', '2014-08-26 08:53:50', '2024-08-26 08:53:50')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:53:51', 'transaction', 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-26 08:53:51', 29, '2014-08-26 08:53:51', 395)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 29[0m
  [1m[35mMerchant::PostAction Load (0.2ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 29  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (395)[0m
  [1m[35mMerchant::PostAction Load (0.2ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 29  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (395)[0m
  [1m[35m (25.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351049', 0, '7197acd74dbcb145900cc44f3ff964fe', '2014-08-26 08:53:51', 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:53:51', 'transaction', 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-26 08:53:51', '11', 'test', 0.01, 'editing', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:51', 'cfd1632b1277075923f3c1ec11d73874', 0, 'test1', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 87
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 356 AND `credit_accounts`.`lock_version` = 0[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 87
  [1m[36mMerchant::MerchantGroupShip Load (0.3ms)[0m  [1mSELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 87[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 87
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 87[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (22.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-26 08:53:51', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (28.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:51', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:51', '46d9375ff75040015e0628e29d47dc62', 0, '2014-08-26 08:53:51')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 88) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 357, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 88
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:51', 'test_display', 'test_group', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351170', 0, 'ea0b004af988484c80c93bf569028325', '2014-08-26 08:53:51', 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351173', 1, '8dee540bec672ad231d3d66694fd3b89', '2014-08-26 08:53:51', 0, 88, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351178', 2, '95afdc7f782cba21518ee73c270530fe', '2014-08-26 08:53:51', 0, 55, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (13.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351195', 0, 'ea92b4493c8b2d1167c0485fbc4dce21', '2014-08-26 08:53:51', 10000, 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '6662688cba5b5b0794732d8402d0ca5f', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 400[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '32ab2fb4bc6242c66f98cb652aeb851c', '2014-08-26 08:53:51', 400)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 358, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 103[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 358) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 358  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (400)[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351256', 100, 0, '9ea5656dd237e28d07386103a8b78a80', '2014-08-26 08:53:51', 100, 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 401
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 401[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351263', 0, 'df3f6022668eef5455428fb856ef4046', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:48:51', '2014-08-26 08:58:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351265', 0, '26503e045047ed1c670e36a9b8b124b4', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:58:51', '2014-08-26 08:48:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351268', 0, '6265baf48ec4a1daefaefde44423a375', '2014-08-26 08:53:51', 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351272', 1, 0, 'ea2ba9de64e0ccab56a4a6172ee12df9', '2014-08-26 08:53:51', 10000, 1, 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 405
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '7e2b046d30a46b1645d0b6de4676b854', '2014-08-26 08:53:51', 405)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 405 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351280', 0, '9263a8b3ea1f8ef418718561c91811b1', '2014-08-26 08:53:51', 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:51', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:51', '76cca26f7bd33af5bfee894ce3ea22d6', 0, '2014-08-26 08:53:51')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 89) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 359, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 89
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:51', 'test_group', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 89, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 406[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 406 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 89 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351295', 0, '81e1978957523c1ab998cb35feb5c014', '2014-08-26 08:53:51', 0, 0, 2, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:51', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:51', 'b1affd53a7062e21919a6fb4bb3d0156', 0, '2014-08-26 08:53:51')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 90) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 360, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 90[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:51', 'test_group', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 57, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 407
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 407 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 57 LIMIT 1[0m
  [1m[35m (5.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '4f608c4d669a850bcacd5a25d62cdc45', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'b79b42f1c728475e282f3a3248e05f2c', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:51', 362, 0, '1234567812345678', 'bank_card', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 362  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 73 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 73 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 73 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mUPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 73 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'd6d506f5051cc9eb3c46da5d507b1d8f', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:53:51', 363, 0, '1234567812345678', 'bank_card', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 363
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 363[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 363  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'f486200e94ecefb502e5578da744f9a2', 0, '123456', 'test', '2014-08-26 08:53:51', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 364[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:53:51', 364, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 364  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 75 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 75 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.4ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 364 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:53:51', 364, 'test', '2014-08-26 08:53:51')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 364) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 364 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 364 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 364) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 364 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-26 08:53:51' WHERE `credit_cashing_applications`.`id` = 22
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:53:51', 364, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'cee4ff3d408cc228a80a0eae45c5c135', 0, '2014-08-26 08:53:51', 'credit_cashing', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 364 LIMIT 1[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 364  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'f30af8a166086cf98fbd80093a465cc5', 0, '123456', 'test', '2014-08-26 08:53:51', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 365
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:53:51', 365, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 365  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 76 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 76 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 365 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:53:51', 365, 'test', '2014-08-26 08:53:51')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 365) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 365 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.1ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 365 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 365) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 365 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-26 08:53:51' WHERE `credit_cashing_applications`.`id` = 23[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 365 LIMIT 1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:51', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:53:51', '2014-08-26 08:54:51', '2014-08-26 09:03:51', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:53:51') AND (valid_till >= '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:53:51' or valid_till < '2014-08-26 08:53:51')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:51', 0.05, 0.1, 'credit_back', 0.03, '2014-08-26 08:53:51', '1976-01-01 00:00:00', '2024-08-26 08:53:51', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`
  [1m[36mPay::CreditBack Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:53:51') AND (valid_till >= '2014-08-26 08:53:51')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:53:51' or valid_till < '2014-08-26 08:53:51')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:51', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:53:51', '2014-08-26 08:52:51', '2014-08-26 08:54:51', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:53:51') AND (valid_till >= '2014-08-26 08:53:51')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:53:51' or valid_till < '2014-08-26 08:53:51')[0m
  [1m[35mPay::PaymentPlan Load (0.1ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (23.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:51', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:53:51', '1976-01-01 00:00:00', '2014-08-26 08:52:51', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:53:51') AND (valid_till >= '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:53:51' or valid_till < '2014-08-26 08:53:51')[0m
  [1m[35mPay::PaymentPlan Load (0.1ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:51', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:53:51', '1976-01-01 00:00:00', '2024-08-26 08:53:51', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:53:51') AND (valid_till >= '2014-08-26 08:53:51')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:53:51' or valid_till < '2014-08-26 08:53:51')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:51', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:51', '6fff85de88160b82cb52050689d6180e', 0, '2014-08-26 08:53:51')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 91) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 366, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 91
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:51', 0.05, 0.1, 91, 'credit_back', 0.03, 1, '2014-08-26 08:53:51', '2014-08-26 08:52:51', '2014-08-26 08:54:51', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 91) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:53:51', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 35
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 91) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 91
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.1ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:53:51', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 35[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 91) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 91[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:53:51', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 35
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 91) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 91
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:53:51', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 35[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 91 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 91) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 91[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 91 LIMIT 1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:51', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-26 08:53:51', 'b61cc8bb685396e543cbeeeccddd3bd0', 0, '2014-08-26 08:53:51', 8000)
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 92) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 367, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 92
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::MerchantCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 367 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 367  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-26 08:53:51', 367, 'test name', '2014-08-26 08:53:51')[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 367 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:51', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:51', 'f2cdd7254c3f99e3f97abb17cddbef36', 0, '2014-08-26 08:53:51')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 93) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 368, `updated_at` = '2014-08-26 08:53:51' WHERE `merchant_stores`.`id` = 93[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:51', 'test_group', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-26 08:53:51', 58, 93, '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 58) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 58 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 58
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 93 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 93
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 93  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '265e8b3c79db6f3cb30ddfdd91cb8884', 0, '123456', 'test', '2014-08-26 08:53:51', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 369 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'c39b30f86ed22916d7f35fc0098ad8c0', 0, '123456', 'test', '2014-08-26 08:53:51', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 370[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:53:51', 370, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 370 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'f66eb98cfa55861643578bc23a300206', 0, '123456', 'test', '2014-08-26 08:53:51', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 371[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:53:51', 371, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 371  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 78 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 78 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 371 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:53:51', 371, 'test', '2014-08-26 08:53:51')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 371) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 371 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 371  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 371  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'fbe879931d83445dcbd5a253e7b5fcb6', 0, '123456', 'test', '2014-08-26 08:53:51', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 372[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:53:51', 372, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 372  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 79 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:53:51', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 79 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 372 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'd413ba56fc5ca4fa0d4e68d841946941', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351637', 1, 0, '01b4552019f6b623c505549c3d2d03ce', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351639', 0, 'f0149421e9c6519dff2299658ede7d94', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351640', 2, 0, '852af0e05a56c38b654107f2ba99c714', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '01b4552019f6b623c505549c3d2d03ce'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 408 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 408
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '832333beebfb5173d3c241fa2a38ab8e', '2014-08-26 08:53:51', 408)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 373, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 105
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 373) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 373, 'system', 0, '123456', 'd5869c71254dbae48b9ce1605362641c', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '01b4552019f6b623c505549c3d2d03ce', '832333beebfb5173d3c241fa2a38ab8e')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '01b4552019f6b623c505549c3d2d03ce'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 408 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (21.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '2d55337bb6d8de9c7c8427b7f7d104a2', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351733', 1, 0, 'a0c65d8156683c3bc8a91558489e8592', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351735', 0, '642b5506bfd6cf8beaed83395022ac7b', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351737', 2, 0, 'edb74ec786d3401bbeb755657b9b0976', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'a0c65d8156683c3bc8a91558489e8592'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 411 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 411
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, 'b2a137bc3325911d6b3ac33c7b8caa1e', '2014-08-26 08:53:51', 411)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 374, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 106
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 374) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 374, 'system', 0, '123456', '3ac40bf35408f0c644908d509e6a3d33', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', 'a0c65d8156683c3bc8a91558489e8592', 'b2a137bc3325911d6b3ac33c7b8caa1e')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 374
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 374  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (411)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 411 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'b535edfb6cca46d27d90d24fc37af249', 0, '123456', 'test', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351758', 1, 0, 'd5fa5778e423c9d96c7f3bcf0063d40c', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351760', 0, '8a4851d5850bcb12f7a1f0900e1d0fd6', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351763', 2, 0, '0dfbf1df308ef510269418b456ac2104', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8a4851d5850bcb12f7a1f0900e1d0fd6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 415 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 415[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '8d1bdca01758496b60e311c0f048d835', '2014-08-26 08:53:51', 415)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 375, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 107[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 375) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 375, 'system', 0, '123456', '673711978eb18c5c9e3f6c871b06f3eb', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '8a4851d5850bcb12f7a1f0900e1d0fd6', '8d1bdca01758496b60e311c0f048d835')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8a4851d5850bcb12f7a1f0900e1d0fd6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 415 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 415
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, 'faa7438a1035273d5a234d79353e2b39', '2014-08-26 08:53:51', 415)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 375, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 108
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 375) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 375, 'system', 0, '123456', 'bb1305425350b5426418201a5ceeddf2', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '8a4851d5850bcb12f7a1f0900e1d0fd6', 'faa7438a1035273d5a234d79353e2b39')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8a4851d5850bcb12f7a1f0900e1d0fd6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 415 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 415[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '611c9c568b54a906b351b418c13367ae', '2014-08-26 08:53:51', 415)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 375, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 109[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 375) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 375, 'system', 0, '123456', '4c42de37b6006bca15e104973d0fb855', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '8a4851d5850bcb12f7a1f0900e1d0fd6', '611c9c568b54a906b351b418c13367ae')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 375[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 415 LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'f67674b1a8db9975f60a69a3d1f056ae', 0, '123456', 'test', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351797', 1, 0, '664b63ab0b0ce618eb1ceb03f322eb11', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351799', 0, '43c4d252a24e19e8691a03b61139235c', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351801', 2, 0, '2e0c7793e0308514a2571de5f11b3fad', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 417[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '664b63ab0b0ce618eb1ceb03f322eb11'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '1b35999255d58243f5944184885b4129', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351811', 1, 0, 'b23c94328a7343d105b1920ef83bdd50', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351813', 0, '463b578059b3f823e51f34111437867b', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351815', 2, 0, '2ffdcc409ff949f0d40d11c7f0b293a5', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 420 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 420[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, 'df4798e135e8e618128115ff9d9dadc0', '2014-08-26 08:53:51', 420)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 377, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 110[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 377) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 377, 'system', 0, '123456', '6a8885d439c00c87a1bf63976fe4d57d', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', 'b23c94328a7343d105b1920ef83bdd50', 'df4798e135e8e618128115ff9d9dadc0')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 377[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 377  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (420)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 420 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'c7baaa7a6f4ee9f9e19b81209e32af48', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351834', 1, 0, '85165cc844b7e31ae38fe532c016056f', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351836', 0, '4e6a7c72fde9d5311f25fdc53dacec05', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351838', 2, 0, '8e6eba39dfd7acf95d54799e5dcc360f', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8e6eba39dfd7acf95d54799e5dcc360f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 425 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 378 AND `vouchers`.`voucher_meta_id` = 425
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 425[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '1f54f463b6c052f024d893a7888da8d3', '2014-08-26 08:53:51', 425)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 378, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 111[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 378) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 378, 'system', 0, '123456', '14e0c6fdb253c4b45164b7e048225da3', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '8e6eba39dfd7acf95d54799e5dcc360f', '1f54f463b6c052f024d893a7888da8d3')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8e6eba39dfd7acf95d54799e5dcc360f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 425 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 378 AND `vouchers`.`voucher_meta_id` = 425
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '08f1d496cc7fb739f2fbe09b9114f518', 0, '123456', 'test', '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351858', 1, 0, '2f78fdf20eab10b916f05977efbf90a6', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351860', 0, 'bad76c4a7b8ee8392d0cc1c755fd1195', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351862', 2, 0, '18c07f9d380859761fb2bbc01733faaf', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-26 08:53:51', '8f9c5c4517a6368f1d8df1afb7511c45', 0, '1234561', 'test1', '2014-08-26 08:53:51', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '18c07f9d380859761fb2bbc01733faaf'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 428 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 379 AND `vouchers`.`voucher_meta_id` = 428
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 428[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '73e5e0cd370480736b26fc23815d9472', '2014-08-26 08:53:51', 428)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 379, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 112[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 379) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 379, 'system', 0, '123456', '12dad398f0bfee86b41a2e34e85006f9', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '18c07f9d380859761fb2bbc01733faaf', '73e5e0cd370480736b26fc23815d9472')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '18c07f9d380859761fb2bbc01733faaf'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 428 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 380 AND `vouchers`.`voucher_meta_id` = 428
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 428[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', 1, '59b711d92d8689a824624a471b93dfc5', '2014-08-26 08:53:51', 428)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 380, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 113[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 380) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 380, 'system', 0, '1234561', '2281b84720e80e74b0dc6b6aaed2429b', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '18c07f9d380859761fb2bbc01733faaf', '59b711d92d8689a824624a471b93dfc5')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 379[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 380
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', '430faaa3ec55c13789e306c9e73076fa', 0, '123456', 'test', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351895', 1, 0, '740e542205f8b1440e0e319f8936542c', '2014-08-26 08:53:51', 1, 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351897', 0, 'e98961ed63564734a115ac2854702992', '2014-08-26 08:53:51', 0, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351899', 2, 0, 'd04b1db60a942af371ba5dc95e81a6a8', '2014-08-26 08:53:51', 2, 0, 1, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:53:51', '2014-08-26 08:53:51')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:53:51', '1234', 12, '2014-08-26 08:53:51')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:53:51', '1235', 12, '2014-08-26 08:53:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165351965', 0, '56649d9e48f65d2811311035620a4a5b', '2014-08-26 08:53:51', 0, 12, 0, 1, '2014-08-26 08:53:51', '2014-08-26 08:53:51', '2024-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 432 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 432[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 12 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 12 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 12 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:53:51', `used` = 1 WHERE `sequence_numbers`.`id` = 23[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', '1234', 1, 'a26a22b3e19342883089e5e491538dea', '2014-08-26 08:53:51', 432)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 381, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 114[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 381) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 381, 'system', 0, '123456', 'daff3d0b3235c92e4cbaebff15848578', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '56649d9e48f65d2811311035620a4a5b', '1234', 'a26a22b3e19342883089e5e491538dea')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 432 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 432
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 12 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 12 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 12 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:53:51', `used` = 1 WHERE `sequence_numbers`.`id` = 24
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:53:51', '1235', 1, '4e11bc89b3d7af92628734ef867c4d9c', '2014-08-26 08:53:51', 432)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 381, `updated_at` = '2014-08-26 08:53:51' WHERE `vouchers`.`id` = 115
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 381) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:53:51', 381, 'system', 0, '123456', 'f09a9358cd1a96744bfd9565553f1450', 0, '2014-08-26 08:53:51', 'issue', '2014-08-26 08:53:51', '56649d9e48f65d2811311035620a4a5b', '1235', '4e11bc89b3d7af92628734ef867c4d9c')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 432 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:53:51' WHERE `voucher_meta`.`id` = 432
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 12 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 12 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 12 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:51', 'b6491c01f5a3b6dade095e2d4ba578f9', 0, '123456', 'test', '2014-08-26 08:53:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352001', 1, 0, '232964b3489284acda974600e7f6c93e', '2014-08-26 08:53:52', 1, 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352003', 0, '3114ead95fdf234350a244879647513e', '2014-08-26 08:53:52', 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352005', 2, 0, '4d40765a9e577df3fb79eeff87e78c1c', '2014-08-26 08:53:52', 2, 0, 1, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:52', '36db7e270166d188ef300240b225da9e', 0, '2014-08-26 08:53:52')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 94) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 383, `updated_at` = '2014-08-26 08:53:52' WHERE `merchant_stores`.`id` = 94[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:52', 'test_group', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', '3dece68921721932c50319ef89b48dd3', 0, '112312323', 'test', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 384 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 59 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:53:52', 384, 59, 'Merchant::MerchantGroup', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 384) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 384 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 59 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 384) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 384 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 384 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 384 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 59 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 59 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 59 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', 'ba20cdb56341b476ceac4b5ca8cc768b', 0, '123456', 'test', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352037', 1, 0, '89d6594ab032a683a6ab69e2e036aa94', '2014-08-26 08:53:52', 1, 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352040', 0, 'b55d0ad64fb21ed5110b8b640297b151', '2014-08-26 08:53:52', 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352042', 2, 0, '520f5124f0050658c075b2c0b3245702', '2014-08-26 08:53:52', 2, 0, 1, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:52', '36226af47472169628a029ce47d8bf1e', 0, '2014-08-26 08:53:52')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 95) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 386, `updated_at` = '2014-08-26 08:53:52' WHERE `merchant_stores`.`id` = 95
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:52', 'test_group', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', '3fc530966aeb533729923f7572d7a8fc', 0, '112312323', 'test', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 387 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 95 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:53:52', 387, 95, 'Merchant::MerchantStore', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 387) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 387 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 95 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 387) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 387 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 387 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 387 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 95 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 95 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 95 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', '690da7086d8704ecee6c47337c927f5b', 0, '123456', 'test', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352075', 1, 0, '50f11d2f6ca3dfe265450a0cb929ed37', '2014-08-26 08:53:52', 1, 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352077', 0, '71a78ec691f76e659c07d9ef57fc00c2', '2014-08-26 08:53:52', 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352079', 2, 0, 'c46f344afaff97d5165a504d86abbb52', '2014-08-26 08:53:52', 2, 0, 1, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:52', 'b97e436b5e9a7836c955580bb752bde2', 0, '2014-08-26 08:53:52')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 96) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 389, `updated_at` = '2014-08-26 08:53:52' WHERE `merchant_stores`.`id` = 96[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:52', 'test_group', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', '9b8a10b3decfb70f22954d10660fc9c7', 0, '112312323', 'test', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 390 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 96 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:53:52', 390, 96, 'Merchant::MerchantStore', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 390) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 390 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 390 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 390 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 96 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 96 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 96 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (11.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', '0715ebe5b52cc153f3342eb69ddaa205', 0, '123456', 'test', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352120', 1, 0, 'cbcf3c181fc3fcca19e4e8811ce48f1a', '2014-08-26 08:53:52', 1, 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352122', 0, '1bef123c67f84ce3702bfad5efccb65f', '2014-08-26 08:53:52', 0, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165352124', 2, 0, 'd54f0a8dc95a1ef1c8c3ac7777e2eb39', '2014-08-26 08:53:52', 2, 0, 1, 0, 1, '2014-08-26 08:53:52', '2014-08-26 08:53:52', '2024-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:53:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:53:52', 'c5eaf5c58137dbcbd5f34e0dfe31e235', 0, '2014-08-26 08:53:52')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 97) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 392, `updated_at` = '2014-08-26 08:53:52' WHERE `merchant_stores`.`id` = 97
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:53:52', 'test_group', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:53:52', '2032056e785835d4446a9b6c4a14c554', 0, '112312323', 'test', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 393 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 62 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:53:52', 393, 62, 'Merchant::MerchantGroup', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 393) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 393 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 393 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 393 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 62 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 62 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 62 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('061c8401f3ef51b19e3191ee2566dd96', 'core-engine', 'test', '2014-08-26 08:53:52', '0', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.3ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '061c8401f3ef51b19e3191ee2566dd96' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = '061c8401f3ef51b19e3191ee2566dd96' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '061c8401f3ef51b19e3191ee2566dd96' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('97b590f2ed072c41372098e490a66c9f', 'core-engine', 'test', '2014-08-26 08:53:52', '0', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-26 08:53:52' WHERE `platform_accounts`.`id` = 10
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '97b590f2ed072c41372098e490a66c9f' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:53:52', 'test', '$2a$04$AaCN4R6kLRa2Mo96zyJuzOye9F1k3Gep1VSPztlYuMBGtLZHKYwz2', 'tester', 'dept_manager', '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.4ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 41  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
  Rendered merchant/merchant_stores/_search_form.html.erb (66.6ms)
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered application/_header.html.erb (0.7ms)
  Rendered application/_sidebar.html.erb (0.6ms)
  Rendered shared/_notice.html.erb (0.1ms)
Completed 200 OK in 231ms (Views: 189.1ms | ActiveRecord: 1.0ms)
  [1m[36m (15.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:53:52', '2014-08-26 08:53:52')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:53:52', '1234', 13, '2014-08-26 08:53:52')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:53:52', '1235', 13, '2014-08-26 08:53:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 13 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 13 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:53:52', `used` = 1 WHERE `sequence_numbers`.`id` = 25
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 13 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 13 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:53:52', `used` = 1 WHERE `sequence_numbers`.`id` = 26
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 13 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 13 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:52', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-26 08:53:52', '1976-01-01 00:00:00', '2024-08-26 08:53:52', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:53:52', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-26 08:53:52', '1976-01-01 00:00:00', '2024-08-26 08:53:52', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (4.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:53:52', 1, 0, '2014-08-26 08:53:52', 'none', '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (0.4ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-26 08:53:52' WHERE (`transaction_logs`.`id` = 10 AND `transaction_logs`.`transaction_datetime` = '2014-08-26 08:53:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165417095', 0, '73e09a324acf8da52079000623e9848a', '2014-08-26 08:54:17', 10000, 0, 0, 2, '2014-08-26 08:54:17', '2014-08-26 08:54:17', '2024-08-26 08:54:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:17', 'f8c9e3ff9a24fcbe2c7d94af31c5676d', 0, '123456', 'test', '2014-08-26 08:54:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:54:17' WHERE `voucher_meta`.`id` = 445[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:17', 1, '67b8f2791486e7a23a6968c603eaf2fb', '2014-08-26 08:54:17', 445)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 394, `updated_at` = '2014-08-26 08:54:17' WHERE `vouchers`.`id` = 116[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 394) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 394  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (445)[0m
  [1m[35m (42.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:17', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:17', '0c8124cd8b670b20e0b99afd5298e70a', 0, '2014-08-26 08:54:17')[0m
  [1m[35mMerchant::MerchantStore Exists (2.9ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 98) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 395, `updated_at` = '2014-08-26 08:54:17' WHERE `merchant_stores`.`id` = 98[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:17', 'test_display', 'test_group', '2014-08-26 08:54:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165417898', 0, '9235f3e2b696e89d78949ee84dcb0df2', '2014-08-26 08:54:17', 0, 0, 2, '2014-08-26 08:54:17', '2014-08-26 08:54:17', '2024-08-26 08:54:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165417901', 1, 'f0545394274204844e1fdf52a44221fd', '2014-08-26 08:54:17', 0, 98, 0, 2, '2014-08-26 08:54:17', '2014-08-26 08:54:17', '2024-08-26 08:54:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165417905', 2, 'b8a9aa386c26adf1bac658d28d8b50bf', '2014-08-26 08:54:17', 0, 63, 0, 2, '2014-08-26 08:54:17', '2014-08-26 08:54:17', '2024-08-26 08:54:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (19.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165417929', 0, '78bb126f6da372acb199c4d2955f7684', '2014-08-26 08:54:17', 0, 0, 2, '2014-08-26 08:54:17', '2014-08-26 08:54:17', '2024-08-26 08:54:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:17', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:17')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:17', '124a679a1ce4640a289c0fcf67fd5bcd', 0, '2014-08-26 08:54:17')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 99) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 396, `updated_at` = '2014-08-26 08:54:17' WHERE `merchant_stores`.`id` = 99
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:17', 'test_group', '2014-08-26 08:54:17')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 99, `updated_at` = '2014-08-26 08:54:17' WHERE `voucher_meta`.`id` = 449[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (9.4ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 449 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 99 LIMIT 1
  [1m[36m (86.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418041', 0, '28038405629d7e68ce238bf6c774a176', '2014-08-26 08:54:18', 0, 0, 2, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:18', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:18', '9fd2f77bda6a72b90be99b8472b3ebe9', 0, '2014-08-26 08:54:18')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 100) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 397, `updated_at` = '2014-08-26 08:54:18' WHERE `merchant_stores`.`id` = 100[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:18', 'test_group', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 65, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 450
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 450 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 65 LIMIT 1[0m
  [1m[35m (21.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418080', 1, 0, 'b56df71b29d1dca9cf3578d1f6d8f597', '2014-08-26 08:54:18', 10000, 1, 0, 0, 2, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 451
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '09b3752e13e21e3dedc3010a644d38e1', '2014-08-26 08:54:18', 451)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 451 LIMIT 1[0m
  [1m[35m (15.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418153', 0, '5eace1186f8c433bfdf3a85d5c10e931', '2014-08-26 08:54:18', 0, 0, 2, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418158', 100, 0, 'd6b1f4907df76e896fe259df0aa7521a', '2014-08-26 08:54:18', 100, 0, 0, 2, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 453[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 453
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (21.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418187', 0, 'd0e07f397e0dcf20102f01587accd9e3', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:49:18', '2014-08-26 08:59:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418189', 0, '0dc866e3bdced56c82a25e1c3276f982', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:59:18', '2014-08-26 08:49:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:18', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-26 08:54:18', '1976-01-01 00:00:00', '2024-08-26 08:54:18', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:18', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-26 08:54:18', '1976-01-01 00:00:00', '2024-08-26 08:54:18', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 9[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.4ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 10[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `configurations` WHERE `configurations`.`id` = 10[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:54:18', 'c630570b269f35cc99cd67893d1ada6a', 'roll_back', '2014-08-26 08:54:18', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-26 08:54:18', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '6b9faa61124175e7872363c9a57bc3ae', 0, '123456', 'test', '2014-08-26 08:54:18', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 398 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:18', 'f9007575ebbcbc99f43d78179d5b708d', 0, '123456', 'test', '2014-08-26 08:54:18', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 399[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:54:18', 399, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 399 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '5a99497392eb9831a82dc296b541ad48', 0, '123456', 'test', '2014-08-26 08:54:18', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 400[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:54:18', 400, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 400  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 81 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:54:18', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 81 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 400 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:54:18', 400, 'test', '2014-08-26 08:54:18')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 400) LIMIT 1
  [1m[36m (0.3ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:54:18', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 400 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 400  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 400  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '6e8a1f8b67533b76caefa1dacef26978', 0, '123456', 'test', '2014-08-26 08:54:18', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 401[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:54:18', 401, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 401  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 82 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:54:18', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 82 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 401 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '6bb028b9b030312cbf5e184db740b115', 0, '123456', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418403', 1, 0, 'e0544f1022d6494a466235b0c0609938', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418406', 0, '5666d3d6741d530bb9d5603f1cac08ad', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418408', 2, 0, '06411e4efbfe94298b2bc47d13508794', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 456
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e0544f1022d6494a466235b0c0609938'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', 'ec80a9c0f9333a5f0a972190006666b1', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418445', 1, 0, '6fe2685b5590d32cf70d372ffb5f0b3b', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418447', 0, '39cb7a8c9a04979825e81db96c5dfc56', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418449', 2, 0, '3b66aca8427eb96cacd2be9ede783bc0', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '39cb7a8c9a04979825e81db96c5dfc56'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 460 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 460[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, 'eba6d3eb390a3447dce809fb22db8acc', '2014-08-26 08:54:18', 460)
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 403, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 118[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 403) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 403, 'system', 0, '123456', '0364074d58d7afde94772fecc85c5a52', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '39cb7a8c9a04979825e81db96c5dfc56', 'eba6d3eb390a3447dce809fb22db8acc')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '39cb7a8c9a04979825e81db96c5dfc56'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 460 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 460
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '935bf7cd135ba0f073e6eb7e3b638833', '2014-08-26 08:54:18', 460)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 403, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 119
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 403) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 403, 'system', 0, '123456', '1ac9aa0d4cff171b841b6ca724130fd7', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '39cb7a8c9a04979825e81db96c5dfc56', '935bf7cd135ba0f073e6eb7e3b638833')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '39cb7a8c9a04979825e81db96c5dfc56'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 460 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 460[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '6418055f8d6b5eb8c7732c0e4bbe135c', '2014-08-26 08:54:18', 460)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 403, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 120[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 403) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 403, 'system', 0, '123456', '455f0d76a6ab495d2a04ed521c91b69a', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '39cb7a8c9a04979825e81db96c5dfc56', '6418055f8d6b5eb8c7732c0e4bbe135c')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 403[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 460 LIMIT 1
  [1m[36m (1.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '9bca425d5cd21bc4970aa6f5131c50dd', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418500', 1, 0, 'fa475e5bb2cbb5d3beb95cd9afea24f9', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418502', 0, '98b8e490cfb413fb84001807d3280a2b', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418504', 2, 0, 'ef0696e97ca0848a3497ea1d9e27b3c9', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 462 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 462
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '67bd5b86e69bd1485ad6287897208e5b', '2014-08-26 08:54:18', 462)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 404, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 121
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 404) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 404, 'system', 0, '123456', 'c644541c33981a5a2a02d17874573bcc', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', 'fa475e5bb2cbb5d3beb95cd9afea24f9', '67bd5b86e69bd1485ad6287897208e5b')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 404
  [1m[36mTrade::VoucherTransactionLog Load (0.5ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 404  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (462)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 462 LIMIT 1
  [1m[36m (1.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '434e36163c677370b98d145cef20d62b', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418531', 1, 0, '378bd3ca41fe093c816aa6aec8838622', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418533', 0, '96a0a8e25640b9463682eb7c43b16830', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418535', 2, 0, '8ce75a60614667d5498de5b4bbfd651c', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-26 08:54:18', '928feb6d2fce569abf59836ae1cacfb2', 0, '1234561', 'test1', '2014-08-26 08:54:18', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8ce75a60614667d5498de5b4bbfd651c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 467 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 405 AND `vouchers`.`voucher_meta_id` = 467[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 467
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '322e3a10d4864090137416a04ef015bb', '2014-08-26 08:54:18', 467)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 405, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 122
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 405) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 405, 'system', 0, '123456', '73b748d62c9ea76266fbf53bff2b0c7e', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '8ce75a60614667d5498de5b4bbfd651c', '322e3a10d4864090137416a04ef015bb')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '8ce75a60614667d5498de5b4bbfd651c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 467 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 406 AND `vouchers`.`voucher_meta_id` = 467[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 467
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, 'a194fa28c6d96ff5d8be88d92624264b', '2014-08-26 08:54:18', 467)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 406, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 123
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 406) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 406, 'system', 0, '1234561', '7569ad74ae9a442ad2be11c05b64ccaa', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '8ce75a60614667d5498de5b4bbfd651c', 'a194fa28c6d96ff5d8be88d92624264b')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 405
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 406[0m
  [1m[35m (1.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '33af53be33dbe4273825223bd3fe2637', 0, '123456', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418565', 1, 0, '69d32e4cb17f7687c7d5084413e5d295', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418567', 0, 'c6a3215d430d54f99f8fb3169d05b9a9', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418570', 2, 0, 'e5b81c90f35a9718134fa4dfa997790b', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '69d32e4cb17f7687c7d5084413e5d295'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 468 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 468
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '9b1b25f3ff940049d2f8bb78fa36c014', '2014-08-26 08:54:18', 468)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 407, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 124
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 407) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 407, 'system', 0, '123456', '95ba65b1b9663b7fb5b1c1cf45a02570', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '69d32e4cb17f7687c7d5084413e5d295', '9b1b25f3ff940049d2f8bb78fa36c014')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '69d32e4cb17f7687c7d5084413e5d295'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 468 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '687b4a75aa493830bd2234f3839601f2', 0, '123456', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418626', 1, 0, '20dcf8452d74944446b20444cf009cb2', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418629', 0, '0ab6d17047e9f6676a96ac4dc28046a5', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418631', 2, 0, 'ae7a08999f912e6046b34a0bb4b8e20f', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ae7a08999f912e6046b34a0bb4b8e20f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 473 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 408 AND `vouchers`.`voucher_meta_id` = 473
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 473[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, '07cbb2b0ba8a50b36e0c273cb5bb233c', '2014-08-26 08:54:18', 473)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 408, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 125[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 408) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 408, 'system', 0, '123456', '2f18a9e3b6ee9ccf46da3d3c910499f1', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', 'ae7a08999f912e6046b34a0bb4b8e20f', '07cbb2b0ba8a50b36e0c273cb5bb233c')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'ae7a08999f912e6046b34a0bb4b8e20f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 473 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 408 AND `vouchers`.`voucher_meta_id` = 473
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', 'eae8dfcba648d0a1ce76526f58cd8a1c', 0, '123456', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418650', 1, 0, '1f2059814847440bf0d5d3e0fda81a61', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418652', 0, 'fcac7bcd73fbd4674786ef2e1665cd8a', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418655', 2, 0, '4ad6bf4e10d422ef5f7cd4e81118202b', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '1f2059814847440bf0d5d3e0fda81a61'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 474 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 474
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', 1, 'c8c1bd8673e19eda268d49c3c2ecaeb0', '2014-08-26 08:54:18', 474)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 409, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 126
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 409) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 409, 'system', 0, '123456', 'cd70c95f16ecfe07c2d37ac1076ae974', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '1f2059814847440bf0d5d3e0fda81a61', 'c8c1bd8673e19eda268d49c3c2ecaeb0')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 409
  [1m[36mTrade::VoucherTransactionLog Load (0.6ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 409  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (474)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 474 LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', 'c1ab01d85314bb88a1c8d4e2ea8f5b89', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418681', 1, 0, 'cd6244b469aca64be7ec4af106e5dd0e', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418683', 0, '3d0a634b88990fe19b032c689b8b089b', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418685', 2, 0, '59ff11b676640dd195b8acb88150795b', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:54:18', '2014-08-26 08:54:18')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:54:18', '1234', 14, '2014-08-26 08:54:18')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:54:18', '1235', 14, '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418736', 0, '58fff7e4011da877ab4bec0b7cb0c8c6', '2014-08-26 08:54:18', 0, 14, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 480 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 480[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 14 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 14 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 14 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:54:18', `used` = 1 WHERE `sequence_numbers`.`id` = 27[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', '1234', 1, '52abc1d63bfed6b56fde6140940e89e7', '2014-08-26 08:54:18', 480)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 410, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 127[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 410) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 410, 'system', 0, '123456', '91e9a1ac69d0d9824cfd80d6ceb69159', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '58fff7e4011da877ab4bec0b7cb0c8c6', '1234', '52abc1d63bfed6b56fde6140940e89e7')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mTrade::VoucherTransactionLog Load (0.5ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 480 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 480
  [1m[36mMember::Sequence Load (0.3ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 14 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 14 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 14 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:54:18', `used` = 1 WHERE `sequence_numbers`.`id` = 28
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:54:18', '1235', 1, 'db3096f8a738ccf0cbec70d0a0143d20', '2014-08-26 08:54:18', 480)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 410, `updated_at` = '2014-08-26 08:54:18' WHERE `vouchers`.`id` = 128
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 410) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:54:18', 410, 'system', 0, '123456', '6f473b5b8950357d5d75f3e795ae6af1', 0, '2014-08-26 08:54:18', 'issue', '2014-08-26 08:54:18', '58fff7e4011da877ab4bec0b7cb0c8c6', '1235', 'db3096f8a738ccf0cbec70d0a0143d20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 480 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:54:18' WHERE `voucher_meta`.`id` = 480
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 14 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 14 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 14 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '0a814dc59a937c38876f972af9c97b69', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418776', 1, 0, '7abca91689450a10a6ea238a1ce3d9f5', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418778', 0, '60b100c2ce61eaaa0f0f512eb96d404f', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418781', 2, 0, 'a2d19edc2a3d79f19791c861c24967d5', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:18', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:18', 'c37201ca790570fb73271c659b0834d8', 0, '2014-08-26 08:54:18')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 101) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 412, `updated_at` = '2014-08-26 08:54:18' WHERE `merchant_stores`.`id` = 101[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:18', 'test_group', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', 'c7955ce8282cc664529ecd819410d909', 0, '112312323', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 413 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 101 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:54:18', 413, 101, 'Merchant::MerchantStore', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 413) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 413 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 413 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 413 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 101 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 101 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 101 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '3e430fe54ce69d6bfca30414cb9c015d', 0, '123456', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418853', 1, 0, '19491f0bab044f2c3b402881cdc603a7', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418855', 0, '1307479156ae8d862e09636d258121c3', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418857', 2, 0, '8619a23090ae27db4c2e5b8231f068bb', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:18', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:18', '6e5e007c2d06b949ff29c27538090939', 0, '2014-08-26 08:54:18')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 102) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 415, `updated_at` = '2014-08-26 08:54:18' WHERE `merchant_stores`.`id` = 102
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:18', 'test_group', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '414bd025687055299a2d71e184063fad', 0, '112312323', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 416 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 67 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:54:18', 416, 67, 'Merchant::MerchantGroup', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 416) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 416 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 416 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 416 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 67 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 67 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 67 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', 'd196471b82e4b4a0c4da626bd13b9982', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418891', 1, 0, 'bba32a4b1e1e304e9f6209829932eba5', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418893', 0, '9985ec6f9d732b3bc08e17062b200eec', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418895', 2, 0, '1bba80b872e7dcd8bd877b77fa256558', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:18', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:18', 'fd487da5a85fc924b7f9e0664761f4ee', 0, '2014-08-26 08:54:18')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 103) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 418, `updated_at` = '2014-08-26 08:54:18' WHERE `merchant_stores`.`id` = 103[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:18', 'test_group', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '844a64c4875d8af2ae59d58a0eb5df52', 0, '112312323', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 419 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 103 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:54:18', 419, 103, 'Merchant::MerchantStore', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 419) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 419 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 103 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 419) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.1ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 419 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 419 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.6ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 419 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 103 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 103 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 103 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '2328a46ae5c7b723980a0cdc8a60677d', 0, '123456', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418929', 1, 0, 'dc116f0a4a7849eb5c0b7b6d33ad98b3', '2014-08-26 08:54:18', 1, 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418931', 0, '912a5cca96d14485bf21c0ca7225b71a', '2014-08-26 08:54:18', 0, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165418933', 2, 0, '279ef08e40ef35dfce2afb4548aa6acb', '2014-08-26 08:54:18', 2, 0, 1, 0, 1, '2014-08-26 08:54:18', '2014-08-26 08:54:18', '2024-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:18', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:18', '1a3cc8e7071b2f015d734553415f5bb8', 0, '2014-08-26 08:54:18')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 104) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 421, `updated_at` = '2014-08-26 08:54:18' WHERE `merchant_stores`.`id` = 104
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:18', 'test_group', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:18', '459dc0880f562ab6d116e1fb6c5eafd5', 0, '112312323', 'test', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 422 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 69 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:54:18', 422, 69, 'Merchant::MerchantGroup', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 422) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 422 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 69 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 422) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 422 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 422 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 422 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 69 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 69 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 69 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:54:18', 'c27deb05e4bd487b216a1bfde48c428d', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-26 08:54:18', 'a788777351b98c75ffb8775aa770846e', 0, '12345611', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:18', 'c5e02ac1085e77dc272a6028cdaa5320', 0, '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:54:18', '5fe2969958214bf665702807b66e29fe', 0, '123456', 'test', '2014-08-26 08:54:18')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-26 08:54:18', '3028d2d9bddda4b33711e9d828031851', 0, '123456', '2014-08-26 08:54:18')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 427) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-26 08:54:18', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 427 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 427) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-26 08:54:18', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 427 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:19', '2c3fe3b0bb330349a744eba42a518c25', 0, '123456', 'test', '2014-08-26 08:54:19', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 428) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:54:19', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 428 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 428 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:19', '382aa255cc8527cef7b04ac91824a589', 0, '123456', 'test', '2014-08-26 08:54:19', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 429) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:54:19', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 429 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 429) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-26 08:54:19', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 429 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 429 LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:19', '4d62ddceb6be7bef193861a8efb9f615', 0, '123456', 'test', '2014-08-26 08:54:19', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 430) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:54:19', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 430 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 430) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:54:19', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 430 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 430 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (4.5ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:19', '3564a592e8ac25b9fd81385763a82710', 0, '123456', 'test', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 431
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.4ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 431, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 431[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:19', 'a38ae6b5ebc773c7aa906b24f387b446', 0, '123456', 'test', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 432
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 432, 0, '1111111111111111111110', 'bank_card', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 432[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 432, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 432
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 432, 0, '1111111111111111111112', 'bank_card', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 432[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 432, 0, '1111111111111111111113', 'bank_card', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 432
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 432, 0, '1111111111111111111114', 'bank_card', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 432[0m
  [1m[35m (31.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:19', 'd0e3db0a148fd4416c33469d957a471b', 0, '123456', 'test', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 433
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:19', 433, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 433[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (15.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:19', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:54:19', '1976-01-01 00:00:00', '2014-08-26 08:53:19', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:54:19') AND (valid_till >= '2014-08-26 08:54:19')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:54:19' or valid_till < '2014-08-26 08:54:19')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:19', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:54:19', '2014-08-26 08:53:19', '2014-08-26 08:55:19', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:54:19') AND (valid_till >= '2014-08-26 08:54:19')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:54:19' or valid_till < '2014-08-26 08:54:19')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:19', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:54:19', '1976-01-01 00:00:00', '2024-08-26 08:54:19', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:54:19') AND (valid_till >= '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:54:19' or valid_till < '2014-08-26 08:54:19')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:19', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:54:19', '2014-08-26 08:55:19', '2014-08-26 09:04:19', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:54:19') AND (valid_till >= '2014-08-26 08:54:19')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:54:19' or valid_till < '2014-08-26 08:54:19')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:19', 0.05, 0.1, 'credit_back', 0.03, '2014-08-26 08:54:19', '1976-01-01 00:00:00', '2024-08-26 08:54:19', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`
  [1m[36mPay::CreditBack Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:54:19') AND (valid_till >= '2014-08-26 08:54:19')
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:54:19' or valid_till < '2014-08-26 08:54:19')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:19', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:19', '81e99a31e6427bc849ac2c5bdc2104db', 0, '2014-08-26 08:54:19')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 105) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 434, `updated_at` = '2014-08-26 08:54:19' WHERE `merchant_stores`.`id` = 105
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:19', 0.05, 0.1, 105, 'credit_back', 0.03, 1, '2014-08-26 08:54:19', '2014-08-26 08:53:19', '2014-08-26 08:55:19', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.4ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 105) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:54:19', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 45
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 105) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:54:19' WHERE `merchant_stores`.`id` = 105
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:54:19', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 45[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 105) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:54:19' WHERE `merchant_stores`.`id` = 105[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:54:19', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 45
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 105) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:54:19' WHERE `merchant_stores`.`id` = 105
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:54:19', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 45[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 105 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 105) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:54:19' WHERE `merchant_stores`.`id` = 105[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 105 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-26 08:54:19', '2014-08-26 08:54:19', 'tester')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:54:19', 'test', '$2a$04$7s6cZ48JyLZr15KNQMbrX.sPFLQEUKvJbFo8jsH/XBE/ZtoGOoVk6', 'tester', 'dept_manager', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[35mUsers::SystemUser Load (0.3ms)[0m  SELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 42  ORDER BY `system_users`.`id` ASC LIMIT 1
  Rendered merchant/merchant_stores/_search_form.html.erb (68.1ms)
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0[0m
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered merchant/merchant_stores/index.html.erb within layouts/application (103.8ms)
  Rendered application/_header.html.erb (0.7ms)
  Rendered application/_sidebar.html.erb (0.7ms)
  Rendered shared/_notice.html.erb (0.6ms)
Completed 200 OK in 430ms (Views: 390.7ms | ActiveRecord: 0.9ms)
  [1m[35m (15.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165419830', 0, '52963b57e213eb31b4f4cde6d93eee82', '2014-08-26 08:54:19', 0, 0, 2, '2014-08-26 08:54:19', '2014-08-26 08:54:19', '2024-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:54:19', 'transaction', 2, '2014-08-26 08:54:19', '2014-08-26 08:54:19', '2024-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-26 08:54:19', 31, '2014-08-26 08:54:19', 493)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 31[0m
  [1m[35mMerchant::PostAction Load (0.2ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 31  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (493)[0m
  [1m[35mMerchant::PostAction Load (0.2ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 31  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (493)[0m
  [1m[35m (37.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165419907', 0, 'ce760fd9b3557577804374b4d5b2ed50', '2014-08-26 08:54:19', 0, 0, 2, '2014-08-26 08:54:19', '2014-08-26 08:54:19', '2024-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:54:19', 'transaction', 2, '2014-08-26 08:54:19', '2014-08-26 08:54:19', '2024-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:19', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:19', '3dfb4105d494e84f5f2ec2d92f3e4717', 0, '2014-08-26 08:54:19')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 106) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 435, `updated_at` = '2014-08-26 08:54:19' WHERE `merchant_stores`.`id` = 106[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:19', 'test_group', '2014-08-26 08:54:19')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-26 08:54:19', 70, 106, '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 70) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 70 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 70
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 106 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 106
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 106  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:54:19', '2014-08-26 08:54:19')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:54:19', '1234', 15, '2014-08-26 08:54:19')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:54:19', '1235', 15, '2014-08-26 08:54:19')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 15 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 15 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:54:19', `used` = 1 WHERE `sequence_numbers`.`id` = 29[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.3ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 15 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 15 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:54:19', `used` = 1 WHERE `sequence_numbers`.`id` = 30[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 15 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.1ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 15 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-26 08:54:20', 19, 1, '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-26 08:54:20', 19, 1, '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-26 08:54:20', 19, 1, '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-26 08:54:20', 19, 0, '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (0.2ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.1ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (30.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:54:20', '9718c873c656be629b183ef4e28b9e4b', 'credit_back', '2014-08-26 08:54:20', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (16.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('b3273de2fb21378ad9eddcc23d23e831', 'core-engine', 'test', '2014-08-26 08:54:20', '0', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'b3273de2fb21378ad9eddcc23d23e831' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.1ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = 'b3273de2fb21378ad9eddcc23d23e831' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'b3273de2fb21378ad9eddcc23d23e831' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('94db4b00e1fa960dbf2f228734e55b2c', 'core-engine', 'test', '2014-08-26 08:54:20', '0', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-26 08:54:20' WHERE `platform_accounts`.`id` = 12
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '94db4b00e1fa960dbf2f228734e55b2c' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:54:20', 1, 0, '2014-08-26 08:54:20', 'none', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (0.5ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-26 08:54:20' WHERE (`transaction_logs`.`id` = 11 AND `transaction_logs`.`transaction_datetime` = '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (42.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:20', '45780700c6a3e9bfa4d14dea764dbb6c', 0, '123456', 'test', '2014-08-26 08:54:20', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 436
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:54:20', 436, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 436  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 90 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 90 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 436 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:54:20', 436, 'test', '2014-08-26 08:54:20')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 436) LIMIT 1[0m
  [1m[35m (0.3ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 436 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 436 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 436) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 436 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-26 08:54:20' WHERE `credit_cashing_applications`.`id` = 27[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:54:20', 436, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'b2d8ac9f1e44afa80eff0d7190c2d8b3', 0, '2014-08-26 08:54:20', 'credit_cashing', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 436 LIMIT 1
  [1m[36mTrade::TransactionLog Load (0.5ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 436  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:54:20', '4c25f9de32f43ee56a2e3a83e270559c', 0, '123456', 'test', '2014-08-26 08:54:20', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 437[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:54:20', 437, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 437  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 91 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 91 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 437 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:54:20', 437, 'test', '2014-08-26 08:54:20')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 437) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 437 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.1ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 437 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 437) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 437 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-26 08:54:20' WHERE `credit_cashing_applications`.`id` = 28
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 437 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:20', '66daa6a9f84b16ffafa41e5579c5c2b2', 0, '123456', 'test', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:20', 438, 0, '1234567812345678', 'bank_card', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 438
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 438[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 438  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:20', 'cc53f70c9a738a1a32f16aa7775fb018', 0, '123456', 'test', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:20', 'c63afa739eaad52195133e2869d1392c', 0, '123456', 'test', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:54:20', 440, 0, '1234567812345678', 'bank_card', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 440  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 93 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.3ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 93 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 93 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 93 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:20', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-26 08:54:20', '637c39a744d7bb67fe2379ead83ff551', 0, '2014-08-26 08:54:20', 8000)
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 107) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 441, `updated_at` = '2014-08-26 08:54:20' WHERE `merchant_stores`.`id` = 107
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::MerchantCreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 441 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 441  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-26 08:54:20', 441, 'test name', '2014-08-26 08:54:20')[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:54:20', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 441 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:20', '296d2d63b9fbdc0f062f41e1de0eeb64', 0, '123456', 'test', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:20', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:20', '08e6a600310edacae7724fd1ea060738', 0, '2014-08-26 08:54:20')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 108) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 443, `updated_at` = '2014-08-26 08:54:20' WHERE `merchant_stores`.`id` = 108[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:20', 'test_group', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:54:20', 442, 108, 'Merchant::MerchantStore', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 442) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 442 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 108 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:54:20', '0c810eae999850c74a58a97bf299eea4', 0, '123456', 'test', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:20', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:20', '3d1b1864cff641a58faf384b67113581', 0, '2014-08-26 08:54:20')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 109) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 445, `updated_at` = '2014-08-26 08:54:20' WHERE `merchant_stores`.`id` = 109
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:54:20', 'test_group', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:54:20', 444, 72, 'Merchant::MerchantGroup', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 444) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 444 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 72 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:54:20', '111', 'test', 0.01, 'editing', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:20', '2b2919cc8dfbda9e421b2e19caa55d02', 0, '2014-08-26 08:54:20')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 110) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 446, `updated_at` = '2014-08-26 08:54:20' WHERE `merchant_stores`.`id` = 110[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:54:20', 110, 'register', 2, '2014-08-26 08:54:20', '2014-08-26 08:54:20', '2024-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:54:20', 110, 'bind_card', 2, '2014-08-26 08:54:20', '2014-08-26 08:54:20', '2024-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:54:20', 110, 'transaction', 2, '2014-08-26 08:54:20', '2014-08-26 08:54:20', '2024-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:54:20', 110, 'none', 1, '2014-08-26 08:54:20', '1976-01-01 00:00:00', '2024-08-26 08:54:20', 3)[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 110 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 110 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 110) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:54:20' WHERE `merchant_stores`.`id` = 110[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (35, 46)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPay::PaymentPlan Load (0.3ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 110 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 110 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 110) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 110[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 46
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-26 08:54:20', '11', 'test', 0.01, 'editing', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-26 08:54:20', '8cc98755a3d081aaacf50bc392eff729', 0, 'test1', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 111[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 447 AND `credit_accounts`.`lock_version` = 0
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 111[0m
  [1m[35mMerchant::MerchantGroupShip Load (0.2ms)[0m  SELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 111
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 111[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 111
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-26 08:54:20', '2014-08-26 08:54:20')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:54:20', 'tester', '$2a$04$LDUaoQt5DuWgJ0cHyjyOTOBWM./e3OS1Affi88R0vyeeNf528zUXC', 'tester', 'admin', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#new as HTML
  Rendered shared/_notice.html.erb (0.1ms)
Completed 200 OK in 23ms (Views: 23.2ms | ActiveRecord: 0.0ms)
  [1m[35m (15.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:54:20', 'tester', '$2a$04$0AX.Ztojw0AubXVfl3n0hOZr1SqFs3rGK2tPzAfcwIc1mosIhpkM2', 'tester', 'admin', '2014-08-26 08:54:20')
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:54:20', 'tester', '$2a$04$Mf6zFiVUo/keBgGx2.EToeOFNIRC8Ttq0715fHpWm6tsH7VIGFQw.', 'tester', 'admin', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:54:20', 'tester', '$2a$04$1GTtPySSfOKmSoW9FkgefOx.a4Wc9HiwAQPQP4cvldtEOe7qUZ782', 'tester', 'admin', '2014-08-26 08:54:20')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:10', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:10', '864e3785c012f379564486a3d090e4fc', 0, '2014-08-26 08:55:10')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 112) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 448, `updated_at` = '2014-08-26 08:55:10' WHERE `merchant_stores`.`id` = 112
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:55:10', 112, 'register', 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:55:10', 112, 'bind_card', 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:55:10', 112, 'transaction', 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:10', 112, 'none', 1, '2014-08-26 08:55:10', '1976-01-01 00:00:00', '2024-08-26 08:55:10', 3)
  [1m[36mPay::PaymentPlan Load (0.3ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 112 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 112 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 112) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:55:10' WHERE `merchant_stores`.`id` = 112
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (38, 47)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 112 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 112 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 112) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'
  [1m[36mMerchant::MarketingRule Load (0.2ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'
  [1m[36mMerchant::MarketingRule Load (0.1ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'
  [1m[36mMerchant::MarketingRule Load (0.1ms)[0m  [1mSELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 112
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 47[0m
  [1m[35m (22.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:55:10', 'tester', '$2a$04$agbfzZ8XSKvbKSq5o5n.lOOcb89pv5TAzdMWpBtFOEbcG76Gk0d5C', 'tester', 'admin', '2014-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:55:10', 'tester', '$2a$04$42GKF4FtWG5PmstqzrFEW.0ljI85pyhNP5kV2jl8SkgMJTv.p.StO', 'tester', 'admin', '2014-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#new as HTML
  Rendered shared/_notice.html.erb (0.5ms)
Completed 200 OK in 24ms (Views: 24.3ms | ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:55:10', 'tester', '$2a$04$0hYe.ttXnl93n5kaV/9ag.UKlE.SXVCsg6QDW/Eo4Aj26ouctrELO', 'tester', 'admin', '2014-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:55:10', 'tester', '$2a$04$nStZmrTjsHKLPfVE1hqtvuWwASC8LrVguLVRzXolPE00gMA0VO9UC', 'tester', 'admin', '2014-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#destroy as HTML
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:55:10', '79cd41b1bac8c2a2bd3dc4fd1673770c', 'roll_back', '2014-08-26 08:55:10', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165510796', 0, '66ff34b7c35f12ee731519e583143272', '2014-08-26 08:55:10', 0, 0, 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:55:10', 'transaction', 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-26 08:55:10', 39, '2014-08-26 08:55:10', 495)
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 39
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 39  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (495)
  [1m[36mMerchant::PostAction Load (0.2ms)[0m  [1mSELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 39  ORDER BY `post_actions`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (495)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165510850', 0, '8a59ca0c5f2c528a4aff767a9679e3c0', '2014-08-26 08:55:10', 0, 0, 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:55:10', 'transaction', 2, '2014-08-26 08:55:10', '2014-08-26 08:55:10', '2024-08-26 08:55:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (13.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:55:10', 'test', '$2a$04$GI1DsZOTRMfyfq8KmhGEUOhZN5KBwuEPXnqUlmOYzbQhYgegaLSue', 'tester', 'dept_manager', '2014-08-26 08:55:10')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[36mUsers::SystemUser Load (0.3ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 51  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
  Rendered merchant/merchant_stores/_search_form.html.erb (34.5ms)
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered application/_header.html.erb (0.7ms)
  Rendered application/_sidebar.html.erb (0.5ms)
  Rendered shared/_notice.html.erb (0.1ms)
Completed 200 OK in 277ms (Views: 188.4ms | ActiveRecord: 0.9ms)
  [1m[36m (18.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:11', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:55:11', '1976-01-01 00:00:00', '2024-08-26 08:55:11', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:55:11') AND (valid_till >= '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:55:11' or valid_till < '2014-08-26 08:55:11')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:11', 0.05, 0.1, 'credit_back', 0.03, '2014-08-26 08:55:11', '1976-01-01 00:00:00', '2024-08-26 08:55:11', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`
  [1m[36mPay::CreditBack Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:55:11') AND (valid_till >= '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:55:11' or valid_till < '2014-08-26 08:55:11')[0m
  [1m[35mPay::PaymentPlan Load (0.1ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:11', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:55:11', '1976-01-01 00:00:00', '2014-08-26 08:54:11', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:55:11') AND (valid_till >= '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:55:11' or valid_till < '2014-08-26 08:55:11')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:11', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:55:11', '2014-08-26 08:54:11', '2014-08-26 08:56:11', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:55:11') AND (valid_till >= '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:55:11' or valid_till < '2014-08-26 08:55:11')[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', 'b214f1b95d6ff44370029bee93e8224f', 0, '2014-08-26 08:55:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 113) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 449, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 113
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:11', 0.05, 0.1, 113, 'credit_back', 0.03, 1, '2014-08-26 08:55:11', '2014-08-26 08:54:11', '2014-08-26 08:56:11', 0)[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 113) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:55:11', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 52
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 113) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 113
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:55:11', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 52[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 113) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 113[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.1ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:55:11', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 52
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 113) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 113
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:55:11', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 52[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 113 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 113) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 113[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 113 LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:11', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:55:11', '2014-08-26 08:56:11', '2014-08-26 09:05:11', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:55:11') AND (valid_till >= '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:55:11' or valid_till < '2014-08-26 08:55:11')[0m
  [1m[35mPay::PaymentPlan Load (0.1ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('8c0b504390701d95e5282ba2e0ebe673', 'core-engine', 'test', '2014-08-26 08:55:11', '0', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-26 08:55:11' WHERE `platform_accounts`.`id` = 13
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '8c0b504390701d95e5282ba2e0ebe673' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('af9efe315fed1f7c652a9f41ec614480', 'core-engine', 'test', '2014-08-26 08:55:11', '0', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.1ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'af9efe315fed1f7c652a9f41ec614480' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.1ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = 'af9efe315fed1f7c652a9f41ec614480' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.1ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'af9efe315fed1f7c652a9f41ec614480' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', 'c623eedb1bfdf4770b65fc9450b07485', 0, '2014-08-26 08:55:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 114) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 450, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 114
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'test_group', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-26 08:55:11', 73, 114, '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 73) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 73 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 73[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 114 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 114[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 114  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', 'c9f6caccd951212f040ca6b6053b47e9', 0, '123456', 'test', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', '67a7e8b961643228ee4b0d28d19c5b73', 0, '2014-08-26 08:55:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 115) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 452, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 115
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'test_group', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:55:11', 451, 74, 'Merchant::MerchantGroup', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 451) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 451 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 74 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '9b802dc085429ac782f3411f8de7a1b3', 0, '123456', 'test', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', '7835b5d8f8935439245bc74f1b9d5630', 0, '2014-08-26 08:55:11')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 116) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 454, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 116[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'test_group', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:55:11', 453, 116, 'Merchant::MerchantStore', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 453) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 453 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 116 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.3ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:55:11', '2014-08-26 08:55:11')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:55:11', '1234', 16, '2014-08-26 08:55:11')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:55:11', '1235', 16, '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 16 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 16 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:55:11', `used` = 1 WHERE `sequence_numbers`.`id` = 31
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 16 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 16 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:55:11', `used` = 1 WHERE `sequence_numbers`.`id` = 32
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 16 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 16 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 11
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 11
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 12
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', 'f1d45d3800f3e973592329642173c742', 0, '123456', 'test', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 455[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 455, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 455
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (14.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '3a81dac3edd300c7826bb19911c25cb1', 0, '123456', 'test', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 456
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 456, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 456[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '82fb23d85eb7eb24c3ed61bfb6bb17c2', 0, '123456', 'test', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 457
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 457, 0, '1111111111111111111110', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 457[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 457, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 457
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 457, 0, '1111111111111111111112', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 457[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 457, 0, '1111111111111111111113', 'bank_card', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 457
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 457, 0, '1111111111111111111114', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 457[0m
  [1m[35m (31.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-26 08:55:11', '6d45b31c11480c37b404f1019c39d9e1', 0, '123456', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.1ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 458) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 458 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 458) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 458 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:55:11', 'a3a328cc36811ddc5a5af0ace0b8d943', 0, '123456', 'test', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'a22315151e89eadd28a41a0098911477', 0, '12345611', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', '567afb96c22daf831120c497335d9eee', 0, '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:55:11', 'cde9ccf85d688c35d8495a15d3dee492', 0, '123456', 'test', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:11', 'd89f854bd1ac5eaac47c1c908fee8684', 0, '123456', 'test', '2014-08-26 08:55:11', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 463) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 463 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 463) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 463 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 463 LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '0cac2989e42b0197e304727d7acc8e21', 0, '123456', 'test', '2014-08-26 08:55:11', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 464) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 464 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 464 LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '6bf89ccb2e989e0c9d1a4319203d71bc', 0, '123456', 'test', '2014-08-26 08:55:11', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 465) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 465 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 465) LIMIT 1[0m
  [1m[35m (0.3ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 465 AND `credit_accounts`.`lock_version` = 1)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 465 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-26 08:55:11', 19, 1, '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-26 08:55:11', 19, 1, '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-26 08:55:11', 19, 0, '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (0.3ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.2ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-26 08:55:11', 19, 1, '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '7c7bca74d8853c55a62a4835b557eda8', 0, '123456', 'test', '2014-08-26 08:55:11', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 466[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:55:11', 466, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 466  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 101 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 101 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 466 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:55:11', 466, 'test', '2014-08-26 08:55:11')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 466) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 466 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 466 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 466) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 466 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-26 08:55:11' WHERE `credit_cashing_applications`.`id` = 30
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 466 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count[0m
  [1m[35m (1.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '69dedd5b78af7f360fe9a1648a7eb6fe', 0, '123456', 'test', '2014-08-26 08:55:11', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 467
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:55:11', 467, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 467  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 102 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 102 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 467 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:55:11', 467, 'test', '2014-08-26 08:55:11')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 467) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 467 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 467 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 467) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 467 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-26 08:55:11' WHERE `credit_cashing_applications`.`id` = 31[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:55:11', 467, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', '38f81ac7eeecbecba6a527c6a3af00a5', 0, '2014-08-26 08:55:11', 'credit_cashing', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 467 LIMIT 1
  [1m[36mTrade::TransactionLog Load (0.5ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 467  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-26 08:55:11', '2014-08-26 08:55:11', 'tester')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-26 08:55:11', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-26 08:55:11', '11', 'test', 0.01, 'editing', '2014-08-26 08:55:11')
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', 'f3bec15567ff340a2cd580ad548924f4', 0, 'test1', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 117
  [1m[36m (2.5ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 468 AND `credit_accounts`.`lock_version` = 0[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 117
  [1m[36mMerchant::MerchantGroupShip Load (0.2ms)[0m  [1mSELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 117[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 117
  [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 117[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-26 08:55:11', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (1.8ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-26 08:55:11', 'cb38bf10ab36320ef8cfae19bad98bb6', 0, '2014-08-26 08:55:11', 8000)[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 118) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 469, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 118[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::MerchantCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 469 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 469  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-26 08:55:11', 469, 'test name', '2014-08-26 08:55:11')
  [1m[36m (0.3ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 469 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', 'd4e0fbe6c88ba9db2f3924d8a50b4987', 0, '123456', 'test', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 470, 0, '1234567812345678', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 470  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 103 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 103 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 103 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.3ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-26 08:55:11', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 103 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '26dedaf6e96d516426c77a57a9a3531e', 0, '123456', 'test', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:55:11', 471, 0, '1234567812345678', 'bank_card', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 471[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 471
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 471  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', '60970efd6512a796a73c24ae65d3c735', 0, '123456', 'test', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511887', 0, '23ef7714794d12d7b0ab3ac7289210dc', '2014-08-26 08:55:11', 0, 0, 2, '2014-08-26 08:55:11', '2014-08-26 08:55:11', '2024-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', '711516a7659d46be6d117e0425ccc688', 0, '2014-08-26 08:55:11')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 119) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 473, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 119
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'test_group', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_group_id` = 76, `updated_at` = '2014-08-26 08:55:11' WHERE `voucher_meta`.`id` = 497[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 497 LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 76 LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511904', 0, 'dc7aee358deae1c44c0d93f5057b52da', '2014-08-26 08:55:11', 0, 0, 2, '2014-08-26 08:55:11', '2014-08-26 08:55:11', '2024-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', '5d6c4a417ba712bd107a7e4fc283901a', 0, '2014-08-26 08:55:11')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 120) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 474, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 120[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'test_group', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_store_id` = 120, `updated_at` = '2014-08-26 08:55:11' WHERE `voucher_meta`.`id` = 498
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 498 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 120 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511922', 0, '16625c91abdd3b504d84816840d0c233', '2014-08-26 08:55:11', 0, 0, 1, '2014-08-26 08:55:11', '2014-08-26 08:50:11', '2014-08-26 09:00:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511924', 0, '0e964d2104968c202ec2e044ed7c9ac5', '2014-08-26 08:55:11', 0, 0, 1, '2014-08-26 08:55:11', '2014-08-26 09:00:11', '2014-08-26 08:50:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511928', 0, '0cade40ef4a1260a3bc3e001e6cee309', '2014-08-26 08:55:11', 0, 0, 2, '2014-08-26 08:55:11', '2014-08-26 08:55:11', '2024-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511931', 100, 0, 'd9ed13941cc3b40d1084cb26e94745b4', '2014-08-26 08:55:11', 100, 0, 0, 2, '2014-08-26 08:55:11', '2014-08-26 08:55:11', '2024-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-26 08:55:11' WHERE `voucher_meta`.`id` = 502[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-26 08:55:11' WHERE `voucher_meta`.`id` = 502
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511938', 0, '7db5c3931cd1ef4fea5e079fc5efae4f', '2014-08-26 08:55:11', 10000, 0, 0, 2, '2014-08-26 08:55:11', '2014-08-26 08:55:11', '2024-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:11', 'e9319a8e894cafd52972279f7fd9d47d', 0, '123456', 'test', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:55:11' WHERE `voucher_meta`.`id` = 503
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:11', 1, '0e7a81e89d77c61764a50f887877476f', '2014-08-26 08:55:11', 503)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 475, `updated_at` = '2014-08-26 08:55:11' WHERE `vouchers`.`id` = 129
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 475) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 475  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (503)
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511980', 1, 0, '70319cae45265712846c5d443248a1f8', '2014-08-26 08:55:11', 10000, 1, 0, 0, 2, '2014-08-26 08:55:11', '2014-08-26 08:55:11', '2024-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:55:11' WHERE `voucher_meta`.`id` = 504[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:11', 1, '62a18a91d806d9696da31e9143fcb9b7', '2014-08-26 08:55:11', 504)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 504 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:11', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:11', 'c16da4e6d870ab50202fb78cb684486f', 0, '2014-08-26 08:55:11')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 121) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 476, `updated_at` = '2014-08-26 08:55:11' WHERE `merchant_stores`.`id` = 121
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:11', 'test_display', 'test_group', '2014-08-26 08:55:11')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165511999', 0, '94a17268d59010cd716b8a0de5f7516d', '2014-08-26 08:55:12', 0, 0, 2, '2014-08-26 08:55:12', '2014-08-26 08:55:11', '2024-08-26 08:55:11')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512002', 1, '66bdd372b4737125c65031abea0a6686', '2014-08-26 08:55:12', 0, 121, 0, 2, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512004', 2, '87fc7e20f4265a1a22f167809576b3dc', '2014-08-26 08:55:12', 0, 78, 0, 2, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '82559d200c7830191c8dbe8955c02fc2', 0, '123456', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512013', 1, 0, 'abc579cb2292cec31cb8f87be9e4ec45', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512016', 0, 'da3bc8b6ff1237e3445800befaa90e92', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512019', 2, 0, 'ee304af2815c482605ca62ad59f4f947', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 508 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 508
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, 'd4697bc34d1a26b2d8d35bcd5e4b694a', '2014-08-26 08:55:12', 508)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 477, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 131
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 477) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 477, 'system', 0, '123456', '49ae549eb0ecfa92526cd1d713519418', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', 'abc579cb2292cec31cb8f87be9e4ec45', 'd4697bc34d1a26b2d8d35bcd5e4b694a')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 477
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.3ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 477  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (508)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 508 LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'fe69ac2592dcc34f2a5f5a8d5866242c', 0, '123456', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512057', 1, 0, '2e4a060662340cde7a02468e7cbd63e8', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512060', 0, 'd04e72fde42a8b5a08ec753af52e6c26', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512061', 2, 0, 'c9688b3a5c8cf8dce2eac469c88444dd', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '2e4a060662340cde7a02468e7cbd63e8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 511 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 511[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, '44e49698b05c2f8c26885cfe1fcad17a', '2014-08-26 08:55:12', 511)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 478, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 132[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 478) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 478, 'system', 0, '123456', '8acce56d422739a05b10188a26b56c6c', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '2e4a060662340cde7a02468e7cbd63e8', '44e49698b05c2f8c26885cfe1fcad17a')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 478[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 478  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (511)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 511 LIMIT 1[0m
  [1m[35m (1.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'e160440839f27294dbda2d3ba866d925', 0, '123456', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512084', 1, 0, '6d75fe7ee828fb18ff3f3c8cf53517b8', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512086', 0, '5ab15a2604e39e6b560a1c0d6b688b25', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512088', 2, 0, '009ba56397d4ebc0c83104b9daf81e49', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6d75fe7ee828fb18ff3f3c8cf53517b8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 514 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 514
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, '72f9abaaf35d26a7ca6b5053ecdf8ef0', '2014-08-26 08:55:12', 514)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 479, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 133
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 479) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 479, 'system', 0, '123456', '410e24301342db617da18890d639679e', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '6d75fe7ee828fb18ff3f3c8cf53517b8', '72f9abaaf35d26a7ca6b5053ecdf8ef0')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6d75fe7ee828fb18ff3f3c8cf53517b8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 514 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '28dd51b6d2b32d4644cb5c6bafd2d0ab', 0, '123456', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512106', 1, 0, '46966ecc0ac407413d0e8ccce794f3d2', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512108', 0, '4a4a975f9a867568296a7d1acb482ada', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512110', 2, 0, 'e851b74ea5778067c3400f96f881e646', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e851b74ea5778067c3400f96f881e646'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 519 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 480 AND `vouchers`.`voucher_meta_id` = 519
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 519[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, 'f4b96fee3538faa8d21bd5e4983e546c', '2014-08-26 08:55:12', 519)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 480, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 134[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 480) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 480, 'system', 0, '123456', '55d87694fc229a1cfa194d0cfdef3190', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', 'e851b74ea5778067c3400f96f881e646', 'f4b96fee3538faa8d21bd5e4983e546c')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e851b74ea5778067c3400f96f881e646'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 519 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 480 AND `vouchers`.`voucher_meta_id` = 519
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '76178d78c1e1ba1f40b9eb8da6ed531c', 0, '123456', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512131', 1, 0, 'ecd37da9cfc4c09d072cb8d08828a044', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512133', 0, 'ebe0a8fee47add47184cca51ce14f987', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512135', 2, 0, 'c9229b62980e72f3999e68a1779b17c8', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-26 08:55:12', 'cbd0a049e1b70ef1b27900adb388a7a9', 0, '1234561', 'test1', '2014-08-26 08:55:12', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'c9229b62980e72f3999e68a1779b17c8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 522 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 481 AND `vouchers`.`voucher_meta_id` = 522
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 522[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, '9912e5c451a1736e3d7258b3e282eb58', '2014-08-26 08:55:12', 522)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 481, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 135[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 481) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 481, 'system', 0, '123456', '83b19f3c99be168b77b8abd19be7d01d', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', 'c9229b62980e72f3999e68a1779b17c8', '9912e5c451a1736e3d7258b3e282eb58')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'c9229b62980e72f3999e68a1779b17c8'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 522 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 482 AND `vouchers`.`voucher_meta_id` = 522
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 522[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, '82765b318dc57688f04cbb9f13f532d3', '2014-08-26 08:55:12', 522)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 482, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 136[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 482) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 482, 'system', 0, '1234561', '8a69a92115ff1955be4c6bf9bf2a1a14', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', 'c9229b62980e72f3999e68a1779b17c8', '82765b318dc57688f04cbb9f13f532d3')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 481[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 482
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'e0c4aa57601339dc10afbbfcfd7ff98f', 0, '123456', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512170', 1, 0, '9350fc4ef561b0f63d93f9bf299428f7', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512173', 0, '852832f3f0adee97c962cece99d28834', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512175', 2, 0, 'ab34541d6ecd505c28a6f6818cbaccd8', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '852832f3f0adee97c962cece99d28834'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 524 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 524[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, '2edaabe40a3aa857e6480d3b260295db', '2014-08-26 08:55:12', 524)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 483, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 137[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 483) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 483, 'system', 0, '123456', 'b49674fd8d45c8520f946655ab18ecb8', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '852832f3f0adee97c962cece99d28834', '2edaabe40a3aa857e6480d3b260295db')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '852832f3f0adee97c962cece99d28834'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 524 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 524
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, 'cc66ada12478bcf9707add0e6f7e3e22', '2014-08-26 08:55:12', 524)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 483, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 138
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 483) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 483, 'system', 0, '123456', 'c11966906cf7403c288323a5692504a6', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '852832f3f0adee97c962cece99d28834', 'cc66ada12478bcf9707add0e6f7e3e22')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '852832f3f0adee97c962cece99d28834'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 524 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 524[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', 1, '5e38a3c362d185f48dfd082e749a158b', '2014-08-26 08:55:12', 524)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 483, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 139[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 483) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 483, 'system', 0, '123456', '702fd48b887023a916bdabee186d1198', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '852832f3f0adee97c962cece99d28834', '5e38a3c362d185f48dfd082e749a158b')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 483[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 524 LIMIT 1
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'efad9cce631409add981abf3ba831c57', 0, '123456', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512211', 1, 0, '51ca62d03ef6c84757c84097d3792bb7', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512213', 0, '70f5530c3ef1d6b985bb643afe18e415', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512215', 2, 0, 'beea3af07937e1b4ce2f7be41a5a6838', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 526[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '51ca62d03ef6c84757c84097d3792bb7'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '1da0fdcebaad362de915b76be085f2ae', 0, '123456', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512225', 1, 0, 'e4f6098e408326026d205e554332d181', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512227', 0, '2ad5bc607b7964d3ff2a7cbc42dcf672', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512229', 2, 0, '3066bc1da0ca2ae1ebf1650647b1e4d3', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:12', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:12')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:12', '669c564ebb8686289408408bd2eb90b6', 0, '2014-08-26 08:55:12')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 122) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 486, `updated_at` = '2014-08-26 08:55:12' WHERE `merchant_stores`.`id` = 122
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:12', 'test_group', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '48ecb6899fc017ee9cab11d518e250ff', 0, '112312323', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 487 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 122 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:55:12', 487, 122, 'Merchant::MerchantStore', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 487) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 487 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 122 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 487) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 487 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 487 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 487 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 122 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 122 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 122 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '1eb8bbb71ecc1cdacc08960405fc597b', 0, '123456', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512262', 1, 0, '08cc2902f0efbd5e5c99db6f7c2c90b3', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512265', 0, '40d299b739214bf3410aa0456a2e128f', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512267', 2, 0, 'eecd28f2cc7fcf59a0d9916c55f0a1ce', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:12', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:12', '74035f21068269001b63515004235bbb', 0, '2014-08-26 08:55:12')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 123) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 489, `updated_at` = '2014-08-26 08:55:12' WHERE `merchant_stores`.`id` = 123[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:12', 'test_group', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '3be880b6731b7ea7872c4bf0192bb807', 0, '112312323', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 490 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 123 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:55:12', 490, 123, 'Merchant::MerchantStore', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 490) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 490 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 490 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 490 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 123 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 123 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 123 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'd2f19f5859da0e1e4961a25fc7e3dc70', 0, '123456', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512296', 1, 0, '97cd81a80369e120781984e80413b8b2', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512298', 0, '09497a4b16f4afe8419aa97b355619ab', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512300', 2, 0, 'fec9f5bb885d7c237303ff7d2d0a57d1', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:12', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:12', '8bf12488fbe008b921a12ac9e40a9737', 0, '2014-08-26 08:55:12')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 124) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 492, `updated_at` = '2014-08-26 08:55:12' WHERE `merchant_stores`.`id` = 124
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:12', 'test_group', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '57a7ea1dad733ca9a31ce60c263e61a7', 0, '112312323', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 493 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 81 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:55:12', 493, 81, 'Merchant::MerchantGroup', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 493) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 493 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 493 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.3ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 493 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 81 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 81 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 81 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '1c27972519185bfc53afa23d31dec612', 0, '123456', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512331', 1, 0, '5077868672418dde080d4348e6b415b8', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512333', 0, 'e0b122e9f8f9e218a881c58ea9ec85b5', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512336', 2, 0, '19c448689e04e9b41b957ce2d4f1d501', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:55:12', '111', 'test', 0.01, 'editing', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:55:12', 'c4ef31d74c9c3039dbbde73809eb8bd9', 0, '2014-08-26 08:55:12')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 125) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 495, `updated_at` = '2014-08-26 08:55:12' WHERE `merchant_stores`.`id` = 125[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:55:12', 'test_group', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '496ab2110707865631b6251eb6e80d16', 0, '112312323', 'test', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 496 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 82 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:55:12', 496, 82, 'Merchant::MerchantGroup', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 496) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 496 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 82 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 496) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 496 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 496 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 496 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 82 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 82 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 82 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (5.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'b923fcf953aec77d2b15401447e1bfc8', 0, '123456', 'test', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512389', 1, 0, '4b9d5ab4224214855902387a7232b045', '2014-08-26 08:55:12', 1, 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512391', 0, '11600c775b2035e06c1b75b8954d37db', '2014-08-26 08:55:12', 0, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512393', 2, 0, '966747f4623ff8c288e9d708f3ec40ab', '2014-08-26 08:55:12', 2, 0, 1, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:55:12', '2014-08-26 08:55:12')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:55:12', '1234', 17, '2014-08-26 08:55:12')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:55:12', '1235', 17, '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165512399', 0, '7dace348b9fb5d97b4b40ac01285a9d2', '2014-08-26 08:55:12', 0, 17, 0, 1, '2014-08-26 08:55:12', '2014-08-26 08:55:12', '2024-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 544 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 544
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 17 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 17 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 17 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:55:12', `used` = 1 WHERE `sequence_numbers`.`id` = 33
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', '1234', 1, '12d35e3f4b48370a6eb88e4b77d2df35', '2014-08-26 08:55:12', 544)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 497, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 140
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 497) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 497, 'system', 0, '123456', '90eca848303070737966cfe3a0dc8eee', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '7dace348b9fb5d97b4b40ac01285a9d2', '1234', '12d35e3f4b48370a6eb88e4b77d2df35')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 544 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 544[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 17 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 17 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 17 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:55:12', `used` = 1 WHERE `sequence_numbers`.`id` = 34[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:55:12', '1235', 1, '6d1c8e3483e821bd23b1a74d0802b96e', '2014-08-26 08:55:12', 544)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 497, `updated_at` = '2014-08-26 08:55:12' WHERE `vouchers`.`id` = 141[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 497) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:55:12', 497, 'system', 0, '123456', '86b247bb1187de578f80cd5a193d0b9e', 0, '2014-08-26 08:55:12', 'issue', '2014-08-26 08:55:12', '7dace348b9fb5d97b4b40ac01285a9d2', '1235', '6d1c8e3483e821bd23b1a74d0802b96e')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 544 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:55:12' WHERE `voucher_meta`.`id` = 544[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 17 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 17 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 17 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '0d3fcb6b7931383ae3ac9cbbcd858de5', 0, '123456', 'test', '2014-08-26 08:55:12', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 498
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:55:12', 498, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 498  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 105 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:55:12', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 105 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 498 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:12', 'a67dd7307541e2c8628b0fe5e95898b7', 0, '123456', 'test', '2014-08-26 08:55:12', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 499[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:55:12', 499, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 499  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 106 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:55:12', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 106 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 499 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:55:12', 499, 'test', '2014-08-26 08:55:12')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 499) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:55:12', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 499 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 499  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 499  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '8c7d5bd06287634a57062400c324693d', 0, '123456', 'test', '2014-08-26 08:55:12', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 500[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:55:12', 500, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:55:12')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 500 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:55:12', '2e159524be1a092d400a4aa1bb088915', 0, '123456', 'test', '2014-08-26 08:55:12', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 501 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:12', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-26 08:55:12', '1976-01-01 00:00:00', '2024-08-26 08:55:12', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:55:12', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-26 08:55:12', '1976-01-01 00:00:00', '2024-08-26 08:55:12', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:55:12', 1, 0, '2014-08-26 08:55:12', 'none', '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count
  [1m[36mTrade::TransactionLog Load (0.4ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-26 08:55:12' WHERE (`transaction_logs`.`id` = 14 AND `transaction_logs`.`transaction_datetime` = '2014-08-26 08:55:12')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:55:12', 'cc074b684190c31901d241c30e8ca63d', 'credit_back', '2014-08-26 08:55:12', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:56:05', 'tester', '$2a$04$z5sIh.sSBToxZLTvi4TEdeg./r/AqPLyDBsUUtzIEER3XNb1mQKEu', 'tester', 'admin', '2014-08-26 08:56:05')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 17986ms (ActiveRecord: 0.0ms)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:04', 'tester', '$2a$04$KplXPygIy49hVxZZqMHGXORqG9s9FEUYKO5hhIjmgiVWCFOO/xI9O', 'tester', 'admin', '2014-08-26 08:59:04')[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "image_captcha"=>"1111"}
Redirected to http://test.host/
Completed 302 Found in 8180ms (ActiveRecord: 0.0ms)
  [1m[36m (34.7ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.3ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:38', 'tester', '$2a$04$SKYh3R7t.aCf5owRqlS8tOtii8W86KNPKbISrHrGAObIhDYtS/EZ2', 'tester', 'admin', '2014-08-26 08:59:38')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "captcha"=>"1111"}
  [1m[36mUsers::SystemUser Load (0.3ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`name` = 'tester'  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
failed to log activity log, exception: undefined method `[]' for nil:NilClass
Redirected to http://test.host/merchant/merchant_stores
Completed 302 Found in 25ms (ActiveRecord: 0.3ms)
  [1m[35m (11.7ms)[0m  ROLLBACK
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:59:51', 1, 0, '2014-08-26 08:59:51', 'none', '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count[0m
  [1m[35mTrade::TransactionLog Load (0.6ms)[0m  SELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-26 08:59:51' WHERE (`transaction_logs`.`id` = 15 AND `transaction_logs`.`transaction_datetime` = '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 13[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.2ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `configurations` (`key`) VALUES ('referer_rate')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 14[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM `configurations` WHERE `configurations`.`id` = 14[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::Configuration Load (0.1ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-26 08:59:51', '11', 'test', 0.01, 'editing', '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (3.5ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:51', '4bcc5c24bbcb8dce5a01285da4203b69', 0, 'test1', '2014-08-26 08:59:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 126
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 502 AND `credit_accounts`.`lock_version` = 0[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 126
  [1m[36mMerchant::MerchantGroupShip Load (0.3ms)[0m  [1mSELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 126[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 126
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 126[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (18.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-26 08:59:51', '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-26 08:59:51', 19, 1, '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-26 08:59:51', 19, 1, '2014-08-26 08:59:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-26 08:59:51', 19, 1, '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-26 08:59:51', 19, 0, '2014-08-26 08:59:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mBank::CardBin Load (0.2ms)[0m  [1mSELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35mBank::CardBin Load (0.1ms)[0m  SELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:59:51', '1418e7dd429dbfb22ffd727dae7d2047', 'credit_back', '2014-08-26 08:59:51', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:51', 'test', '$2a$04$NjXB1xwJxZYTmLqlobTAuO6JlXQdeh4FxTOivx/EpIuilvgbdPMhq', 'tester', 'dept_manager', '2014-08-26 08:59:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[35mUsers::SystemUser Load (0.3ms)[0m  SELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 55  ORDER BY `system_users`.`id` ASC LIMIT 1
  Rendered merchant/merchant_stores/_search_form.html.erb (52.0ms)
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0[0m
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered merchant/merchant_stores/index.html.erb within layouts/application (92.6ms)
  Rendered application/_header.html.erb (0.8ms)
  Rendered application/_sidebar.html.erb (0.6ms)
  Rendered shared/_notice.html.erb (0.6ms)
Completed 200 OK in 419ms (Views: 367.6ms | ActiveRecord: 0.9ms)
  [1m[35m (14.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 08:59:52', 'c8a3cb4258ff5cb1d775f39cccd8aa2f', 'roll_back', '2014-08-26 08:59:52', NULL)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `transactions`[0m
  [1m[35mTrade::Transaction Load (0.2ms)[0m  SELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-26 08:59:52', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-26 08:59:52', 'de1ac8d8d34cf9fc22428a836b85cbda', 0, '2014-08-26 08:59:52', 8000)[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 127) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 503, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 127[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::MerchantCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 503 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 503  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-26 08:59:52', 503, 'test name', '2014-08-26 08:59:52')
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 503 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (18.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'tester', '$2a$04$IgluOWDNv38GZl2W9o3nG.P8VwhXnjFS5Hlzg2yUzuVYWSZmmFp22', 'tester', 'admin', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'tester', '$2a$04$msFmWn/cN/dgMat7/WUp0e9u1urg/rpj9sNZhBCbDHruwRRXmtE9K', 'tester', 'admin', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered shared/_notice.html.erb (0.1ms)
Completed 200 OK in 19ms (Views: 18.5ms | ActiveRecord: 0.0ms)
  [1m[36m (15.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'tester', '$2a$04$Ha3O5KnqGxygY0slQtGi9.pdwIsW2vHHKOsDzpIerZ5ku5a30y1Fy', 'tester', 'admin', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#destroy as HTML
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'tester', '$2a$04$NdPzwVXabb74MkEijlsaeOmB4TbcOPzrlE5OMUDeufZHYsHXa8d6q', 'tester', 'admin', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "captcha"=>"1111"}
  [1m[36mUsers::SystemUser Load (0.2ms)[0m  [1mSELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`name` = 'tester'  ORDER BY `system_users`.`id` ASC LIMIT 1[0m
failed to log activity log, exception: undefined method `[]' for nil:NilClass
Redirected to http://test.host/merchant/merchant_stores
Completed 302 Found in 3ms (ActiveRecord: 0.2ms)
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:52', '92eb573bc09eeeb73c545e624261b864', 0, '2014-08-26 08:59:52')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 128) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 504, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 128[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:59:52', 128, 'register', 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:59:52', 128, 'bind_card', 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:59:52', 128, 'transaction', 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 128, 'none', 1, '2014-08-26 08:59:52', '1976-01-01 00:00:00', '2024-08-26 08:59:52', 3)[0m
  [1m[35mPay::PaymentPlan Load (0.4ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 128 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 128 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 128) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 128[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (43, 56)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 128 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 128 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 128) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'[0m
  [1m[35mMerchant::MarketingRule Load (0.3ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 128[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 56
  [1m[36m (16.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', '4fe26b8b280b2f649d123f7e02de892b', 0, '123456', 'test', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 505, 0, '1234567812345678', 'bank_card', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 505  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 108 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 108 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 108 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 108 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', '6aa50747146b89f6d53ff8a2ebe9dfb8', 0, '123456', 'test', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 506, 0, '1234567812345678', 'bank_card', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 506[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 506
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 506  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', 'a7f1a17ce5f224509006d75325add83c', 0, '123456', 'test', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', 'd7ea5934d3e7f09b5830a69586d855ec', 0, '123456', 'test', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 508
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 508, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 508[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', 'ff1fba507364a35c99081be134400d1b', 0, '123456', 'test', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 509[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 509, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 509
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', 'd92127868ca5f4cc1830c23f1fa1b1ec', 0, '123456', 'test', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 510[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 510, 0, '1111111111111111111110', 'bank_card', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 510
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 510, 0, '1111111111111111111111', 'bank_card', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 510[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 510, 0, '1111111111111111111112', 'bank_card', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 510
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 510, 0, '1111111111111111111113', 'bank_card', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 510[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 08:59:52', 510, 0, '1111111111111111111114', 'bank_card', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 510
  [1m[36m (32.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:59:52', 'd2d07643ce02594912d803693e1f00f1', 0, '123456', 'test', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 08:59:52', '4264998346a5fc60cc1a0782db502b42', 0, '123456', 'test', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'b466a0eadf677bdceb89cab8a9e3b24c', 0, '12345611', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:52', '62049b8ddb0ab66ef5a66e3655820ddc', 0, '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-26 08:59:52', 'fa47c80039b4c03a50fd6688a9a68beb', 0, '123456', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 515) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 515 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 515) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  UPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 515 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:52', '2b00cd5e5b98bb7a016c04b780ee97eb', 0, '123456', 'test', '2014-08-26 08:59:52', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 516) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 516 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 516) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 516 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 516 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:52', 'e4ed2cbf978d5e4e1afb28f594863ffe', 0, '123456', 'test', '2014-08-26 08:59:52', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 517) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 517 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 517 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:52', 'b9ff6b12e41d3e3e60b221a90dd1522c', 0, '123456', 'test', '2014-08-26 08:59:52', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 518) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 518 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 518) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-26 08:59:52', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 518 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 518 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-26 08:59:52', '1976-01-01 00:00:00', '2024-08-26 08:59:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-26 08:59:52', '1976-01-01 00:00:00', '2024-08-26 08:59:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:59:52', '2014-08-26 08:59:52')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:59:52', '1234', 18, '2014-08-26 08:59:52')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:59:52', '1235', 18, '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 18 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 18 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:59:52', `used` = 1 WHERE `sequence_numbers`.`id` = 35[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 18 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 18 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:59:52', `used` = 1 WHERE `sequence_numbers`.`id` = 36[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 18 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 18 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165952780', 0, '173648912bff4862003c22b28d80f25e', '2014-08-26 08:59:52', 0, 0, 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:59:52', 'transaction', 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-26 08:59:52', 44, '2014-08-26 08:59:52', 545)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 44[0m
  [1m[35mMerchant::PostAction Load (0.2ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 44  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (545)[0m
  [1m[35mMerchant::PostAction Load (0.1ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 44  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (545)[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165952806', 0, 'e53b96219f0d601806c75eb214e6b877', '2014-08-26 08:59:52', 0, 0, 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 08:59:52', 'transaction', 2, '2014-08-26 08:59:52', '2014-08-26 08:59:52', '2024-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', '528032061f0cf6060a80cd1a45f6c249', 0, '123456', 'test', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:52', 'b422c2412744e5f0a7afd00245425417', 0, '2014-08-26 08:59:52')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 129) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 520, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 129[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'test_group', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:59:52', 519, 129, 'Merchant::MerchantStore', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 519) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 519 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 129 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:52', '9ad60969838a496247d60f3f22eea42e', 0, '123456', 'test', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:52', '4e43bc3cc4b5a0742ff4ec548def7eb5', 0, '2014-08-26 08:59:52')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 130) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 522, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 130
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:52', 'test_group', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:59:52', 521, 84, 'Merchant::MerchantGroup', '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 521) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 521 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 84 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (10.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:59:52', '1976-01-01 00:00:00', '2014-08-26 08:58:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:59:52') AND (valid_till >= '2014-08-26 08:59:52')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:59:52' or valid_till < '2014-08-26 08:59:52')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:59:52', '2014-08-26 09:00:52', '2014-08-26 09:09:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:59:52') AND (valid_till >= '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:59:52' or valid_till < '2014-08-26 08:59:52')
  [1m[36mPay::PaymentPlan Load (0.1ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:59:52', '1976-01-01 00:00:00', '2024-08-26 08:59:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:59:52') AND (valid_till >= '2014-08-26 08:59:52')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:59:52' or valid_till < '2014-08-26 08:59:52')
  [1m[36mPay::PaymentPlan Load (0.1ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 08:59:52', '2014-08-26 08:58:52', '2014-08-26 09:00:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:59:52') AND (valid_till >= '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:59:52' or valid_till < '2014-08-26 08:59:52')
  [1m[36mPay::PaymentPlan Load (0.1ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.05, 0.1, 'credit_back', 0.03, '2014-08-26 08:59:52', '1976-01-01 00:00:00', '2024-08-26 08:59:52', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`[0m
  [1m[35mPay::CreditBack Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 08:59:52') AND (valid_till >= '2014-08-26 08:59:52')[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 08:59:52' or valid_till < '2014-08-26 08:59:52')
  [1m[36mPay::PaymentPlan Load (0.1ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:52', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:52', '4c9cc0910ed72bdeb81865be3f5e296f', 0, '2014-08-26 08:59:52')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 131) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 523, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 131[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 08:59:52', 0.05, 0.1, 131, 'credit_back', 0.03, 1, '2014-08-26 08:59:52', '2014-08-26 08:58:52', '2014-08-26 09:00:52', 0)
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 131) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:59:52', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 64[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 131) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 131[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:59:52', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 64
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 131) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 131
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:59:52', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 64[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 131) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 131[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 08:59:52', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 64
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 131 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 131) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 08:59:52' WHERE `merchant_stores`.`id` = 131
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 131 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '541b3fecee52b12fd7b24d4ce5edc78a', 0, '123456', 'test', '2014-08-26 08:59:53', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 524
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:59:53', 524, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 524  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 117 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 117 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 524 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:59:53', 524, 'test', '2014-08-26 08:59:53')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 524) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 524 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.1ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 524 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 524) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 524 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-26 08:59:53' WHERE `credit_cashing_applications`.`id` = 35[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 08:59:53', 524, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'ae1685aba00705a56d27750c366c6bf6', 0, '2014-08-26 08:59:53', 'credit_cashing', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 524 LIMIT 1
  [1m[36mTrade::TransactionLog Load (0.8ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 524  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'b31736a64af8b4da8a3aae041d1506f3', 0, '123456', 'test', '2014-08-26 08:59:53', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 525[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:59:53', 525, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 525  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 118 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 118 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 525 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:59:53', 525, 'test', '2014-08-26 08:59:53')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 525) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 525 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.1ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.1ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 525 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 525) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 525 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-26 08:59:53' WHERE `credit_cashing_applications`.`id` = 36
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 525 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '41e6a36179d3865030df4807475cc633', 0, '2014-08-26 08:59:53')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 132) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 526, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 132[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-26 08:59:53', 85, 132, '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 85) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 85 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 85
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 132 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 132
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 132  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-26 08:59:53', '2014-08-26 08:59:53', 'tester')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '279e761886faf2c5485c6e6802304ebd', 0, '123456', 'test', '2014-08-26 08:59:53', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 527 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'b3e9a1e8b7ad5bd8c55ddc668c89212b', 0, '123456', 'test', '2014-08-26 08:59:53', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 528
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:59:53', 528, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 528 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'c9b719328875c6483c930e50f6266534', 0, '123456', 'test', '2014-08-26 08:59:53', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 529
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:59:53', 529, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 529  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 120 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 120 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 529 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 08:59:53', 529, 'test', '2014-08-26 08:59:53')
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 529) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 529 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `credit_cashing_applications`
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 529  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 529  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '95b5c869b7d5e0e83462138fcc2594f5', 0, '123456', 'test', '2014-08-26 08:59:53', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 530
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 08:59:53', 530, 0, '111111111111111111111', 'bank_card', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.3ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 530  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 121 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 08:59:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 121 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 530 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'dce7dde79dbe1d14f6f4142cdf27e0da', 0, '123456', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953144', 1, 0, '0b5e3828505f5e4476832f159c87efdd', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953146', 0, '1254acb669a177d8a217a732793ac115', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953148', 2, 0, '4d1c6eba35134d92f7311be2f4feb9d0', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 547[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '0b5e3828505f5e4476832f159c87efdd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '799af10144826e1600861f756543811b', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953157', 1, 0, 'e88fb5c68cedeb7d5c36808c3e5c2ecd', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953159', 0, '7fb8e2aa2146c19ba895d634f093c433', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953161', 2, 0, 'c69d0a671c4f462bb813657d2dbb3c15', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e88fb5c68cedeb7d5c36808c3e5c2ecd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 550 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 550
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, '11271499bd96daad49cd4e17c757cb63', '2014-08-26 08:59:53', 550)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 532, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 142
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 532) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 532, 'system', 0, '123456', '08c1c522a7af49ee554f165efc589bd7', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', 'e88fb5c68cedeb7d5c36808c3e5c2ecd', '11271499bd96daad49cd4e17c757cb63')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'e88fb5c68cedeb7d5c36808c3e5c2ecd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 550 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '05cfacbb2fd122647262e4c1b4feb3f5', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953205', 1, 0, '1c8c4a054a9fffe8dfca9c9ab54ff922', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953208', 0, '6d226bad233f426ca7b15e1ed5c7688b', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953210', 2, 0, 'cff4fadd9792e734d878d8078f2496e5', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 553 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 553[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, 'c2cf95fe832cf1a2330dda07b522126d', '2014-08-26 08:59:53', 553)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 533, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 143[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 533) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 533, 'system', 0, '123456', '1e419ea8cc0bacff0efa22983606fb8a', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '1c8c4a054a9fffe8dfca9c9ab54ff922', 'c2cf95fe832cf1a2330dda07b522126d')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 533[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 533  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (553)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 553 LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'da4f4b614cb864302aea7a10da6b74ea', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953229', 1, 0, 'ed41a322d0fe3b32abd1e139867c15c1', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953231', 0, '473e0e79a94997b421f53c43269e13f1', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953233', 2, 0, '02597945ce806836d97abd1c22800c1e', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '473e0e79a94997b421f53c43269e13f1'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 557 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 557
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, 'c2e690c17c26199cd67f09aefcbfd284', '2014-08-26 08:59:53', 557)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 534, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 144
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 534) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 534, 'system', 0, '123456', '719b794150ca38ff42589a22ce09a001', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '473e0e79a94997b421f53c43269e13f1', 'c2e690c17c26199cd67f09aefcbfd284')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '473e0e79a94997b421f53c43269e13f1'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 557 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 557[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, 'd1100dfae9deca6ac65a53a60d7da542', '2014-08-26 08:59:53', 557)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 534, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 145[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 534) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 534, 'system', 0, '123456', '38f04d21867c0aa0f66854bb06f883c3', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '473e0e79a94997b421f53c43269e13f1', 'd1100dfae9deca6ac65a53a60d7da542')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.3ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '473e0e79a94997b421f53c43269e13f1'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 557 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 557
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, '3e66500d9b4acfbc19442944333338af', '2014-08-26 08:59:53', 557)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 534, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 146
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 534) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 534, 'system', 0, '123456', '6fa4318647b24037d58ef1555c856d05', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '473e0e79a94997b421f53c43269e13f1', '3e66500d9b4acfbc19442944333338af')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 534
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 557 LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '79efd86146c338536e245d71d9f67635', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953266', 1, 0, '419318b3a112188c79dd79ecfc60ac08', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953268', 0, '5c4b22793c8c1605bbff00e602bc8c85', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953271', 2, 0, '2d7c1dd6e0367dda8d94b75b9d72b7e1', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '419318b3a112188c79dd79ecfc60ac08'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 559 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 559
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, '83c612d0b4243af7cc9b4f02ab22aba9', '2014-08-26 08:59:53', 559)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 535, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 147
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 535) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 535, 'system', 0, '123456', '4f302873d4ee813b2c5c889adc44cc54', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '419318b3a112188c79dd79ecfc60ac08', '83c612d0b4243af7cc9b4f02ab22aba9')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 535
  [1m[36mTrade::VoucherTransactionLog Load (0.4ms)[0m  [1mSELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::Voucher Load (0.2ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 535  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (559)[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 559 LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'f16964a19ee318dce803a3887903e906', 0, '123456', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953292', 1, 0, '854cd81b4c68e655279cf354bd3b60a5', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953294', 0, 'd1a0e3b0032726f5dbad83e8f338a504', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953296', 2, 0, '116d3826adab3d948337a49bf271c5e6', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-26 08:59:53', '6dfce13d8a3d0a83928d44a1d889f9e5', 0, '1234561', 'test1', '2014-08-26 08:59:53', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '116d3826adab3d948337a49bf271c5e6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 564 LIMIT 1 FOR UPDATE
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 536 AND `vouchers`.`voucher_meta_id` = 564[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 564
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, 'cf301562d5f39009737ca9fe99b4129d', '2014-08-26 08:59:53', 564)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 536, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 148
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 536) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 536, 'system', 0, '123456', '8e572714bf82dbf4d5ef8db3026a3857', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '116d3826adab3d948337a49bf271c5e6', 'cf301562d5f39009737ca9fe99b4129d')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '116d3826adab3d948337a49bf271c5e6'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 564 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 537 AND `vouchers`.`voucher_meta_id` = 564[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 564
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, '7dd51903b006ad33c35983a6c37281ba', '2014-08-26 08:59:53', 564)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 537, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 149
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 537) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 537, 'system', 0, '1234561', '477df26918c3aaf649a86282c2413ad9', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '116d3826adab3d948337a49bf271c5e6', '7dd51903b006ad33c35983a6c37281ba')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 536
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 537[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'c19b3b561c5dea60f98523aa8440e05c', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953328', 1, 0, 'c0bd68bc69c28b92a0abb0857b1e2bfe', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953330', 0, 'f3ee4cf8ed7928d977abb4a7f035e321', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953332', 2, 0, '0b8f910979ce962b4c0d26d379a3f5ec', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '0b8f910979ce962b4c0d26d379a3f5ec'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 567 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 538 AND `vouchers`.`voucher_meta_id` = 567
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 567[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, '38d970e01a0a859dda7c1694f2ebd02e', '2014-08-26 08:59:53', 567)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 538, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 150[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 538) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 538, 'system', 0, '123456', '343b0a7878d35660ed93762274fa64de', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', '0b8f910979ce962b4c0d26d379a3f5ec', '38d970e01a0a859dda7c1694f2ebd02e')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '0b8f910979ce962b4c0d26d379a3f5ec'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 567 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 538 AND `vouchers`.`voucher_meta_id` = 567
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'ed378d0913226468bce6408196cac178', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953352', 1, 0, 'eb3f27abbfa430189daf211612e03afa', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953355', 0, '7a8b738c2f865d070cefa32fc744334c', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953357', 2, 0, 'd2feea58186506fa6556a80666f2f3dc', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 08:59:53', '2014-08-26 08:59:53')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:59:53', '1234', 19, '2014-08-26 08:59:53')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 08:59:53', '1235', 19, '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953364', 0, 'd8c95367ea45360b7ab08a6084cda202', '2014-08-26 08:59:53', 0, 19, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 571 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 571
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 19 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 19 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 19 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:59:53', `used` = 1 WHERE `sequence_numbers`.`id` = 37
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', '1234', 1, '2ce196542203755b17e9c8751a3a3ba4', '2014-08-26 08:59:53', 571)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 539, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 151
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 539) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 539, 'system', 0, '123456', '35a5cc4c4379d3a50a16d89ddd3aeacc', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', 'd8c95367ea45360b7ab08a6084cda202', '1234', '2ce196542203755b17e9c8751a3a3ba4')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 571 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 571[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 19 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 19 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 19 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 08:59:53', `used` = 1 WHERE `sequence_numbers`.`id` = 38[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', '1235', 1, '4cac39f2e171c6d059c2d12090f144d7', '2014-08-26 08:59:53', 571)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 539, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 152[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 539) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 08:59:53', 539, 'system', 0, '123456', '4e77a933479ce9561c2ee0c983b80dc0', 0, '2014-08-26 08:59:53', 'issue', '2014-08-26 08:59:53', 'd8c95367ea45360b7ab08a6084cda202', '1235', '4cac39f2e171c6d059c2d12090f144d7')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 571 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 571[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 19 LIMIT 1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 19 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 19 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'd0f6cc3b16d06d2405692288b10b7874', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953398', 1, 0, 'ca1e380d3c0dc0d37ee32ac29d4325d5', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953400', 0, 'fc641a26a2d14a455b41cdd853b54db7', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953402', 2, 0, 'cb713017216bb98142ef03f2050e5f3d', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '20cf939b86611e94e5fc39a3ae95f02a', 0, '2014-08-26 08:59:53')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 133) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 541, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 133
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'ea13fd17f907ade5880654f198b5b29b', 0, '112312323', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 542 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 86 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:59:53', 542, 86, 'Merchant::MerchantGroup', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 542) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 542 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 542 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 542 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 86 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 86 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 86 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '73670fdc7f3157edb1d711938b8b9307', 0, '123456', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953443', 1, 0, 'f55049447047f87c16ed2c4b18d9c47b', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953446', 0, 'e2fa2846dc7169fc4ec2d036f6d724b5', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953449', 2, 0, '3ce6cf68ad0e2ddea1220cd05b461a83', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '24aa87a1e15d938b73b0f58a4c1f5d70', 0, '2014-08-26 08:59:53')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 134) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 544, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 134[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '412ba527fb25a98510de545a4b8d56df', 0, '112312323', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 545 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 134 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:59:53', 545, 134, 'Merchant::MerchantStore', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 545) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 545 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 545 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.4ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 545 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 134 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 134 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 134 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '3eb308ec133f29746c04113a98848b1c', 0, '123456', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953480', 1, 0, '1497c58c6900f4ee8b1219de1796462c', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953482', 0, '75be117ee5db32a5555d6f1272c41734', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953484', 2, 0, 'efcbfa87404915d463136a6809617622', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '9127199ae397733ef0980d3732ff7448', 0, '2014-08-26 08:59:53')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 135) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 547, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 135
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', '67c53a1c6497b93d21095c0271b0014e', 0, '112312323', 'test', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 548 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 88 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:59:53', 548, 88, 'Merchant::MerchantGroup', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 548) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 548 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 88 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 548) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 548 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 548 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.2ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 548 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 88 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 88 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 88 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'e9ef4c24f6895a6b9ec8f697934eac1c', 0, '123456', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953518', 1, 0, 'd46fc541c4a2a7e163347bd36ac18bb9', '2014-08-26 08:59:53', 1, 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953520', 0, '859dc96525d036ac4aa32ccebc9d52f2', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953522', 2, 0, '103b3102572d484b1ae915f9568c341f', '2014-08-26 08:59:53', 2, 0, 1, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', 'ae1ca9354e6c8fbed4e8e18d061d8d26', 0, '2014-08-26 08:59:53')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 136) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 550, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 136[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'd88df8d1b1ed51ff3e1bd7d41eae25b7', 0, '112312323', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 551 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 136 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 08:59:53', 551, 136, 'Merchant::MerchantStore', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 551) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 551 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 136 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 551) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 551 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 551 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 551 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 136 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 136 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 136 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953553', 0, '2f311355ee8a0e46f458f5ec1988e809', '2014-08-26 08:59:53', 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '759b9ac6d014d3e60baecf762080b604', 0, '2014-08-26 08:59:53')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 137) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 552, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 137
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 137, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 584[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 584 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 137 LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953572', 0, '4a42f5261be98c7dfad1f3919f9ec547', '2014-08-26 08:59:53', 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '03e098ad2f84445a96e82528ba5cfd4b', 0, '2014-08-26 08:59:53')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 138) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 553, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 138[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_group', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 91, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 585
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 585 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 91 LIMIT 1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953590', 0, '86e6537c1f4c1b8f8a009a5e972926ea', '2014-08-26 08:59:53', 10000, 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 08:59:53', 'd196f1a33ae2aab1b67a2558bf574f57', 0, '123456', 'test', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 586
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, 'efa9c197a0a06d58321c12342a9f447f', '2014-08-26 08:59:53', 586)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 554, `updated_at` = '2014-08-26 08:59:53' WHERE `vouchers`.`id` = 153
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 554) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 554  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (586)
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953605', 0, '0af4e2275a6742d595b01d486ff2c542', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 08:54:53', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953608', 0, 'fcdaf17a1ea15b7a119c9c668c7daf18', '2014-08-26 08:59:53', 0, 0, 1, '2014-08-26 08:59:53', '2014-08-26 09:04:53', '2014-08-26 08:54:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953611', 0, '72f653215eb8c3acb773e251530e15f3', '2014-08-26 08:59:53', 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953615', 100, 0, 'e9be3bf260f39c5bc3f2f8e3a85cc108', '2014-08-26 08:59:53', 100, 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 590
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 590[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (1.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 08:59:53', '111', 'test', 0.01, 'editing', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 08:59:53', '20937f821a617e4d2eb908ac07da06ce', 0, '2014-08-26 08:59:53')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 139) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 555, `updated_at` = '2014-08-26 08:59:53' WHERE `merchant_stores`.`id` = 139
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-26 08:59:53', 'test_display', 'test_group', '2014-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953632', 0, '9b6d4def5a5b79eee6c08bb60e09ebf4', '2014-08-26 08:59:53', 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953634', 1, '17440bbaf81910ce810b33564e573455', '2014-08-26 08:59:53', 0, 139, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953636', 2, '5acd6e80dc26f384721708ac4b3a7861', '2014-08-26 08:59:53', 0, 92, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826165953641', 1, 0, '0ac144b130e90ef95adaa9b0bab93934', '2014-08-26 08:59:53', 10000, 1, 0, 0, 2, '2014-08-26 08:59:53', '2014-08-26 08:59:53', '2024-08-26 08:59:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 08:59:53' WHERE `voucher_meta`.`id` = 594[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 08:59:53', 1, '7202ba452c3dc8463653b1a6e41418c3', '2014-08-26 08:59:53', 594)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 594 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('9c0a054d6328baff7d576515397f5b7d', 'core-engine', 'test', '2014-08-26 08:59:53', '0', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '9c0a054d6328baff7d576515397f5b7d' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = '9c0a054d6328baff7d576515397f5b7d' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '9c0a054d6328baff7d576515397f5b7d' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('f7eed03eea6aca1615d916d0618437b3', 'core-engine', 'test', '2014-08-26 08:59:53', '0', '2014-08-26 08:59:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-26 08:59:53' WHERE `platform_accounts`.`id` = 16
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'f7eed03eea6aca1615d916d0618437b3' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1mSELECT `schema_migrations`.* FROM `schema_migrations`[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '303c0af2f3b0ece1423d17ab81446120', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:51', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:51', '5360dc159cae2ea15e6afd67a737171c', 0, '2014-08-26 09:04:51')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 140) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 557, `updated_at` = '2014-08-26 09:04:51' WHERE `merchant_stores`.`id` = 140
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:51', 'test_group', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 09:04:51', 556, 93, 'Merchant::MerchantGroup', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 556) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 556 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 93 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35m (39.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'da6d87e5123b870f46140c808f21ff9d', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:51', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:51', '836bf0f81c6cf24f4cc79be9ac442b01', 0, '2014-08-26 09:04:51')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 141) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 559, `updated_at` = '2014-08-26 09:04:51' WHERE `merchant_stores`.`id` = 141[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:51', 'test_group', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 09:04:51', 558, 141, 'Merchant::MerchantStore', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 558) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 558 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 141 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36m (2.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'bd8743541ac561f00bb0d39194582092', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451481', 1, 0, '75bf68d513ebe855821fcfb29f3a2c85', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451484', 0, '445c5895fb36f97e5a769c7a044ba2bd', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451485', 2, 0, '17a6d039cb7269d345c31d82db1fb358', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '445c5895fb36f97e5a769c7a044ba2bd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 596 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 596[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '7696ee4c0ff9f3c3706434e421acdd62', '2014-08-26 09:04:51', 596)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 560, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 155[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 560) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 560, 'system', 0, '123456', '4957eba294c5c2aa460ed43f72ebd4a0', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '445c5895fb36f97e5a769c7a044ba2bd', '7696ee4c0ff9f3c3706434e421acdd62')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '445c5895fb36f97e5a769c7a044ba2bd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 596 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 596
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '44b9b06b826ff236ae562726f2e96d0a', '2014-08-26 09:04:51', 596)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 560, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 156
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 560) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 560, 'system', 0, '123456', 'e556bc334d71ec384aeaa48cdf971194', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '445c5895fb36f97e5a769c7a044ba2bd', '44b9b06b826ff236ae562726f2e96d0a')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '445c5895fb36f97e5a769c7a044ba2bd'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 596 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 596[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, 'c007b21838bd0dff92799de8330c3fdb', '2014-08-26 09:04:51', 596)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 560, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 157[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 560) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 560, 'system', 0, '123456', '0a4f2fe647a0fc598c9e9aa1bd7fed19', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '445c5895fb36f97e5a769c7a044ba2bd', 'c007b21838bd0dff92799de8330c3fdb')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 560[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 596 LIMIT 1
  [1m[36m (12.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '740a2d9cca19b1b57c27615c61abf4c3', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451613', 1, 0, '6364ab514b8453b9809d160a948043b2', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451615', 0, 'de0d526eaeb53c22bf52a5bee3dda924', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451617', 2, 0, '411b5f8c58844333a41d115290efda48', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '411b5f8c58844333a41d115290efda48'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 600 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 561 AND `vouchers`.`voucher_meta_id` = 600[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 600
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '15e9ac6ed857eed93fe96c75610f77c1', '2014-08-26 09:04:51', 600)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 561, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 158
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 561) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 561, 'system', 0, '123456', 'e7e46dc79782652d425dac57d92225b5', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '411b5f8c58844333a41d115290efda48', '15e9ac6ed857eed93fe96c75610f77c1')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.3ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '411b5f8c58844333a41d115290efda48'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 600 LIMIT 1 FOR UPDATE
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 561 AND `vouchers`.`voucher_meta_id` = 600[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (16.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '3318fd2d5d94612b1a2f59d49aaa5047', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451669', 1, 0, 'b941e46f47662fd23d3c6900c4962e4a', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451672', 0, 'c507806461e71891cef030e05649d6a5', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451674', 2, 0, '1612070a86703d8cb38504b6278e5396', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'b941e46f47662fd23d3c6900c4962e4a'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 601 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 601[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '6581c48b1e78f135d7a4509c72d96d77', '2014-08-26 09:04:51', 601)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 562, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 159[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 562) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 562, 'system', 0, '123456', '233194ccd25834690e276967bb1a07d9', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', 'b941e46f47662fd23d3c6900c4962e4a', '6581c48b1e78f135d7a4509c72d96d77')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 562[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 562  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (601)
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 601 LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '32503b5218d4d21a7c09ffd3daa75136', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451693', 1, 0, 'c9a89d3ac147e660742f808c35250290', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451695', 0, '47d4674b65cd87b12b5ca323d8a080ba', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451697', 2, 0, '144030c258a3922da6544f518402a6cb', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 604 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 604[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '70eafa5ec13d851027349b028888a820', '2014-08-26 09:04:51', 604)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 563, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 160[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 563) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 563, 'system', 0, '123456', 'c269ef9dcdd728b81c0889b93388faae', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', 'c9a89d3ac147e660742f808c35250290', '70eafa5ec13d851027349b028888a820')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 563[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.4ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36mMember::Voucher Load (0.2ms)[0m  [1mSELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 563  ORDER BY `vouchers`.`id` ASC LIMIT 1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (604)
  [1m[36mMember::VoucherMeta Load (0.1ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 604 LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '417e1e1a3ac276eeddd42c7937587880', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451716', 1, 0, '5ad79749991d8b1a41f6dd23c4ace7f2', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451717', 0, 'a00b219a31dd91726eddaef444e7e689', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451719', 2, 0, '6a1558f4d4c690a89c964696b7a07d1c', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '1234561' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'testa', '2014-08-26 09:04:51', 'fde775c7a28cd078e8b83a83571097a6', 0, '1234561', 'test1', '2014-08-26 09:04:51', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6a1558f4d4c690a89c964696b7a07d1c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 609 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 564 AND `vouchers`.`voucher_meta_id` = 609
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 1, `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 609[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '0d8a35fc78f0b1694d365282ed5fcfe9', '2014-08-26 09:04:51', 609)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 564, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 161[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 564) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 564, 'system', 0, '123456', 'a56ad9b47f6bfef1aaec5bb8ab56a4b1', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '6a1558f4d4c690a89c964696b7a07d1c', '0d8a35fc78f0b1694d365282ed5fcfe9')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = '6a1558f4d4c690a89c964696b7a07d1c'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 609 LIMIT 1 FOR UPDATE[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 565 AND `vouchers`.`voucher_meta_id` = 609
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 2, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 609[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, '16ff7eff9bc66c605d4e4d7d48f1bf5b', '2014-08-26 09:04:51', 609)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 565, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 162[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '1234561' AND `credit_accounts`.`id` != 565) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 565, 'system', 0, '1234561', 'db83b9785b9d99ab2babbbede5f321f9', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '6a1558f4d4c690a89c964696b7a07d1c', '16ff7eff9bc66c605d4e4d7d48f1bf5b')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 564[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 565
  [1m[36m (1.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'dfc358b9fbf76e194aba7a9cdbc3fc32', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451752', 1, 0, 'cd71546a32a7255ec9741ad63dc7f87f', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451754', 0, '37c8f665988f4f844957ebdf93a7c14e', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451756', 2, 0, '5e79e802ed4014a330358ab6d3d47281', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `status` = 2, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 610[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'cd71546a32a7255ec9741ad63dc7f87f'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '78a7d765b95c9221ae8afd8e1888ddb2', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451764', 1, 0, 'd00bc4d3ae4b74f5c1f2a5f4af51d5bc', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451766', 0, '8eebd55f93bf1e61463f7c0bbe34a985', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451768', 2, 0, 'f3b8776e8df7a6b1db17a966a945ebe5', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd00bc4d3ae4b74f5c1f2a5f4af51d5bc'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 613 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 613
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', 1, 'e8aa67d22e6ad6954860fdd7efa7bdc7', '2014-08-26 09:04:51', 613)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 567, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 163
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 567) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 567, 'system', 0, '123456', '0d911d9a2660677ac82c166e00d8d576', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', 'd00bc4d3ae4b74f5c1f2a5f4af51d5bc', 'e8aa67d22e6ad6954860fdd7efa7bdc7')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.4ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`code` = 'd00bc4d3ae4b74f5c1f2a5f4af51d5bc'  ORDER BY `voucher_meta`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 613 LIMIT 1 FOR UPDATE
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '814d3469870afe5bb95ed1dc349b3c45', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451786', 1, 0, '012834748917ebd1303c19ae25860273', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451788', 0, '6d3d83bd61c87cf9867e1566b2989cd4', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451790', 2, 0, '0df25acd7d9906e7ea4993f965e54d13', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:51', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:51', '03f3b13ba38f593577b8506f3288ccda', 0, '2014-08-26 09:04:51')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 142) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 569, `updated_at` = '2014-08-26 09:04:51' WHERE `merchant_stores`.`id` = 142
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:51', 'test_group', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'c290e0735686ce0c3ca41fa5803e9d6a', 0, '112312323', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 570 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 95 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 09:04:51', 570, 95, 'Merchant::MerchantGroup', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 570) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 570 LIMIT 1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 570 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.4ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 570 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 95 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 95 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.3ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 95 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (8.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.2ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'aeae1e32e600e94bedea5d6969734c59', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451829', 1, 0, 'ca985ae45a8ddff8404b138d7854a4a3', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451832', 0, 'cc008f65bc969f22832fa365b263ca28', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451834', 2, 0, 'c28e1cf4065c1bc2b786427989104625', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:51', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:51', '860225e528646984c909ba9dd0a0571f', 0, '2014-08-26 09:04:51')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 143) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 572, `updated_at` = '2014-08-26 09:04:51' WHERE `merchant_stores`.`id` = 143[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:51', 'test_group', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'ba6d7eb47d46a8c35dd21ce0da13a49e', 0, '112312323', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 573 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 143 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 09:04:51', 573, 143, 'Merchant::MerchantStore', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 573) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 573 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 143 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 573) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 573 LIMIT 1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 573 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 573 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 143 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 143 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 143 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '0bb196458511919ba93b8953fe834728', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451866', 1, 0, '72cc23713679198e6167f13c249b5af1', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451868', 0, 'ffd9d18e654443d7b4927f22cc05e07f', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451870', 2, 0, '66ee9a8dc2c1df2c8fd8c73fbd378fd6', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.4ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:51', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:51', '3c4ec65a556be0a371b3aa77fbdc750c', 0, '2014-08-26 09:04:51')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 144) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 575, `updated_at` = '2014-08-26 09:04:51' WHERE `merchant_stores`.`id` = 144
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:51', 'test_group', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '862bc950c1809105f0ed41aa13f08324', 0, '112312323', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 576 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 97 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 09:04:51', 576, 97, 'Merchant::MerchantGroup', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 576) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 576 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup' AND `merchant_groups`.`id` = 97 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 576) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 576 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 576 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'
  [1m[36mMerchant::MerchantGroup Load (0.3ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `member_ships` ON `merchant_groups`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 576 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `merchant_groups`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantGroup Load (0.3ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 97 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 97 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 97 AND `member_ships`.`member_group_type` = 'Merchant::MerchantGroup'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (1.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'abad587f14f9682d53265d60563c6fc5', 0, '123456', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451900', 1, 0, '9d36f2d3e34f7c0d68588b275c553af3', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451903', 0, 'f0b89c666fd2a869ed31f3f1787d4e24', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451906', 2, 0, 'd875eb17003514374f3f3a6bc537c53a', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:51', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:51', '4c2d78bc73963d4ebd525d42727756df', 0, '2014-08-26 09:04:51')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 145) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 578, `updated_at` = '2014-08-26 09:04:51' WHERE `merchant_stores`.`id` = 145[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.1ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:51', 'test_group', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '112312323' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', 'ccaceafb70369738784120a2909c108a', 0, '112312323', 'test', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 579 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore' AND `merchant_stores`.`id` = 145 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `member_ships` (`created_at`, `credit_account_id`, `member_group_id`, `member_group_type`, `updated_at`) VALUES ('2014-08-26 09:04:51', 579, 145, 'Merchant::MerchantStore', '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '112312323' AND `credit_accounts`.`id` != 579) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 579 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 579 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores` INNER JOIN `member_ships` ON `merchant_stores`.`id` = `member_ships`.`member_group_id` WHERE `member_ships`.`credit_account_id` = 579 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 145 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 145 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'
  [1m[36mMember::CreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts` INNER JOIN `member_ships` ON `credit_accounts`.`id` = `member_ships`.`credit_account_id` WHERE `member_ships`.`member_group_id` = 145 AND `member_ships`.`member_group_type` = 'Merchant::MerchantStore'  ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (1.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:51', '64fe53a578714fac99a499c657a71513', 0, '123456', 'test', '2014-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451935', 1, 0, '8546b7845b34c59e9eeee968a841a057', '2014-08-26 09:04:51', 1, 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451937', 0, 'ccc81e8b3a38aa1f5de3fcc1b45bec20', '2014-08-26 09:04:51', 0, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `limit_per_account`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451939', 2, 0, '25ee9ae88314402e33928c890878f4f0', '2014-08-26 09:04:51', 2, 0, 1, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::Sequence Exists (0.2ms)[0m  SELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 09:04:51', '2014-08-26 09:04:51')[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 09:04:51', '1234', 20, '2014-08-26 09:04:51')
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 09:04:51', '1235', 20, '2014-08-26 09:04:51')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `sequence_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170451988', 0, '45a3379e7b1e8f10ec08cecd2c38af68', '2014-08-26 09:04:51', 0, 20, 0, 1, '2014-08-26 09:04:51', '2014-08-26 09:04:51', '2024-08-26 09:04:51')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 631 LIMIT 1 FOR UPDATE[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 09:04:51' WHERE `voucher_meta`.`id` = 631
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 20 LIMIT 1[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 20 LIMIT 1 FOR UPDATE
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 20 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 09:04:51', `used` = 1 WHERE `sequence_numbers`.`id` = 39
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:51', '1234', 1, 'f107197172de7e469c1d1980594e5256', '2014-08-26 09:04:51', 631)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `vouchers` SET `credit_account_id` = 580, `updated_at` = '2014-08-26 09:04:51' WHERE `vouchers`.`id` = 164
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 580) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:51', 580, 'system', 0, '123456', '906fe6494395cf7a666cdccb4b4ed6a9', 0, '2014-08-26 09:04:51', 'issue', '2014-08-26 09:04:51', '45a3379e7b1e8f10ec08cecd2c38af68', '1234', 'f107197172de7e469c1d1980594e5256')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mTrade::VoucherTransactionLog Load (0.6ms)[0m  SELECT  `voucher_transaction_logs`.* FROM `voucher_transaction_logs`   ORDER BY `voucher_transaction_logs`.`transaction_datetime` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 631 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 2, `updated_at` = '2014-08-26 09:04:52' WHERE `voucher_meta`.`id` = 631[0m
  [1m[35mMember::Sequence Load (0.2ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 20 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 20 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 20 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 09:04:52', `used` = 1 WHERE `sequence_numbers`.`id` = 40[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `sequence_number`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:52', '1235', 1, '4cd143cdf4cbf93fb845eebbed7196a6', '2014-08-26 09:04:52', 631)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 580, `updated_at` = '2014-08-26 09:04:52' WHERE `vouchers`.`id` = 165[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 580) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_transaction_logs` (`created_at`, `credit_account_id`, `issue_event`, `issuer_type`, `mobile`, `ref_id`, `settler_type`, `transaction_datetime`, `transaction_type`, `updated_at`, `voucher_meta_code`, `voucher_sequence_number`, `voucher_unique_id`) VALUES ('2014-08-26 09:04:52', 580, 'system', 0, '123456', '37be17ce4a02682d9b00350c3c7f37d5', 0, '2014-08-26 09:04:52', 'issue', '2014-08-26 09:04:52', '45a3379e7b1e8f10ec08cecd2c38af68', '1235', '4cd143cdf4cbf93fb845eebbed7196a6')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.2ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 631 LIMIT 1 FOR UPDATE
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 3, `updated_at` = '2014-08-26 09:04:52' WHERE `voucher_meta`.`id` = 631[0m
  [1m[35mMember::Sequence Load (0.1ms)[0m  SELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 20 LIMIT 1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 20 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 20 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (48.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:52', 'c0a975435dff79ba31fcaa7eef6857d2', 0, '123456', 'test', '2014-08-26 09:04:52', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 581
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 09:04:52', 581, 0, '111111111111111111111', 'bank_card', '2014-08-26 09:04:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 581  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 122 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 09:04:52', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 122 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 581 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (4.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:52', 'd82c468986c1097b5009286444e773a7', 0, '123456', 'test', '2014-08-26 09:04:52', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 582[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (19.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 09:04:52', 582, 0, '111111111111111111111', 'bank_card', '2014-08-26 09:04:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 582  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 123 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 09:04:52', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 123 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 582 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 09:04:52', 582, 'test', '2014-08-26 09:04:52')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 582) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 09:04:52', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 582 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 582  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 582  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:52', '118249d63751d20ecfafe2da924b8e6d', 0, '123456', 'test', '2014-08-26 09:04:52', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 583[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 09:04:52', 583, 0, '111111111111111111111', 'bank_card', '2014-08-26 09:04:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 583 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:52', 'd7406717212a72baa2155087093ec65f', 0, '123456', 'test', '2014-08-26 09:04:52', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 584 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `transaction_logs` (`created_at`, `log_type`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 09:04:52', 1, 0, '2014-08-26 09:04:52', 'none', '2014-08-26 09:04:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 1) subquery_for_count[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`  WHERE `transaction_logs`.`log_type` = 0) subquery_for_count
  [1m[36mTrade::TransactionLog Load (0.5ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `transaction_logs` SET `merchant_rate` = 0.05, `updated_at` = '2014-08-26 09:04:52' WHERE (`transaction_logs`.`id` = 17 AND `transaction_logs`.`transaction_datetime` = '2014-08-26 09:04:52')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 09:04:52', '2480a5b8192565b232a376f5dd827cd6', 'credit_back', '2014-08-26 09:04:52', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'test' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 09:04:52', 'test', '$2a$04$VsvHtSu7b24krOZ/DeRX4OjNhA/Ey1j4A6Ld7X/CUzaCtnGYIKKKe', 'tester', 'dept_manager', '2014-08-26 09:04:52')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by Merchant::MerchantStoresController#index as HTML
  [1m[35mUsers::SystemUser Load (0.3ms)[0m  SELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`id` = 60  ORDER BY `system_users`.`id` ASC LIMIT 1
  Rendered merchant/merchant_stores/_search_form.html.erb (50.0ms)
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `merchant_stores`
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`created_at` DESC LIMIT 20 OFFSET 0[0m
  Rendered merchant/merchant_stores/_merchant_store.html.erb (0.0ms)
  Rendered merchant/merchant_stores/index.html.erb within layouts/application (125.9ms)
  Rendered application/_header.html.erb (0.8ms)
  Rendered application/_sidebar.html.erb (0.6ms)
  Rendered shared/_notice.html.erb (0.7ms)
Completed 200 OK in 541ms (Views: 501.4ms | ActiveRecord: 1.0ms)
  [1m[35m (15.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:53', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`, `usable_credit`) VALUES ('merchant', '2014-08-26 09:04:53', 'd5b9e4dda489b6c4d162118f0c80395a', 0, '2014-08-26 09:04:53', 8000)[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 146) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 585, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 146[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::MerchantCreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 585 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`credit_account_id` = 585  ORDER BY `merchant_stores`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '23123', 'test bank', '2014-08-26 09:04:53', 585, 'test name', '2014-08-26 09:04:53')
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('merchant') AND (`credit_accounts`.`id` = 585 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `credit_cashing_applications`[0m
  [1m[35mMember::CreditCashingApplication Load (0.1ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `activity_logs` (`created_at`, `updated_at`, `user_name`) VALUES ('2014-08-26 09:04:53', '2014-08-26 09:04:53', 'tester')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170453162', 0, '5bfacf8fcd4d867c9d4304e677381f44', '2014-08-26 09:04:53', 0, 0, 2, '2014-08-26 09:04:53', '2014-08-26 09:04:53', '2024-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 09:04:53', 'transaction', 2, '2014-08-26 09:04:53', '2014-08-26 09:04:53', '2024-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `post_actions` (`action_type`, `created_at`, `marketing_rule_id`, `updated_at`, `voucher_meta_id`) VALUES ('issue_voucher', '2014-08-26 09:04:53', 46, '2014-08-26 09:04:53', 632)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 46[0m
  [1m[35mMerchant::PostAction Load (0.2ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 46  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (632)[0m
  [1m[35mMerchant::PostAction Load (0.1ms)[0m  SELECT  `post_actions`.* FROM `post_actions`  WHERE `post_actions`.`marketing_rule_id` = 46  ORDER BY `post_actions`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (632)[0m
  [1m[35m (42.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170453250', 0, '4c4abf574e660023243e555c0dc4d2ea', '2014-08-26 09:04:53', 0, 0, 2, '2014-08-26 09:04:53', '2014-08-26 09:04:53', '2024-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 09:04:53', 'transaction', 2, '2014-08-26 09:04:53', '2014-08-26 09:04:53', '2024-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 09:04:53', 'tester', '$2a$04$AyovXN2BY4JI7tqtFhD3HOEBFpi59MxNa/GaSzyBBL7.SoGDiBk8.', 'tester', 'admin', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]"}
Redirected to http://test.host/
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUsers::SystemUser Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 09:04:53', 'tester', '$2a$04$dcvzqbf/Wjs1OuVODWk.C.r.pNqbbnhB3h9jEF57t2lKUrKfeOP/y', 'tester', 'admin', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by SessionsController#create as HTML
  Parameters: {"username"=>"tester", "password"=>"[FILTERED]", "captcha"=>"1111"}
  [1m[35mUsers::SystemUser Load (0.3ms)[0m  SELECT  `system_users`.* FROM `system_users`  WHERE `system_users`.`name` = 'tester'  ORDER BY `system_users`.`id` ASC LIMIT 1
failed to log activity log, exception: undefined method `[]' for nil:NilClass
Redirected to http://test.host/merchant/merchant_stores
Completed 302 Found in 3ms (ActiveRecord: 0.3ms)
  [1m[36m (34.0ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 09:04:53', 'tester', '$2a$04$4YrKJIxCLoL6fVph.diqwez7qeJvN/d8C5TfKwDzscO1qP.ht3LMC', 'tester', 'admin', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#destroy as HTML
Redirected to http://test.host/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUsers::SystemUser Exists (0.2ms)[0m  SELECT  1 AS one FROM `system_users`  WHERE `system_users`.`name` = BINARY 'tester' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `system_users` (`created_at`, `name`, `password_digest`, `real_name`, `role_name`, `updated_at`) VALUES ('2014-08-26 09:04:53', 'tester', '$2a$04$WNvrTuhQsCUFnYDhVK2Tx.wgd2WjkQDQZpeCMJMpje1o2Q8mCMkNi', 'tester', 'admin', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Processing by SessionsController#new as HTML
  Rendered shared/_notice.html.erb (0.1ms)
Completed 200 OK in 41ms (Views: 41.1ms | ActiveRecord: 0.0ms)
  [1m[36m (14.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:53', 'ce04e47d3b17a2c0b71a3db28a1f4bf0', 0, '123456', 'test', '2014-08-26 09:04:53', 8000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 586[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 09:04:53', 586, 0, '111111111111111111111', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 586  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 125 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 125 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 586 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 09:04:53', 586, 'test', '2014-08-26 09:04:53')[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 586) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 586 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::CreditCashingApplication Load (0.2ms)[0m  [1mSELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 586 LIMIT 1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 586) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 8000, `locked_credit` = 0, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 586 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 201, `updated_at` = '2014-08-26 09:04:53' WHERE `credit_cashing_applications`.`id` = 40
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 586 LIMIT 1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(count_column) FROM (SELECT 1 AS count_column FROM `transaction_logs`) subquery_for_count[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '9dd4ba55645ea39ef4980a635d22a0ba', 0, '123456', 'test', '2014-08-26 09:04:53', 8000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 587
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`bank_name`, `card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('test_bank', 'debit', '2014-08-26 09:04:53', 587, 0, '111111111111111111111', 'bank_card', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 587  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '111111111111111111111' AND `payment_media`.`id` != 126 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `payment_media` SET `cashing_card` = 1, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 126 AND `payment_media`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 587 AND `payment_media`.`cashing_card` = 1  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_cashing_applications` (`amount`, `bank_card`, `bank_name`, `created_at`, `credit_account_id`, `real_name`, `updated_at`) VALUES (5000, '111111111111111111111', 'test_bank', '2014-08-26 09:04:53', 587, 'test', '2014-08-26 09:04:53')
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 587) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 3000, `locked_credit` = 5000, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 587 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditCashingApplication Load (0.2ms)[0m  SELECT  `credit_cashing_applications`.* FROM `credit_cashing_applications`   ORDER BY `credit_cashing_applications`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`id` = 587 LIMIT 1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 587) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 5000, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 587 AND `credit_accounts`.`lock_version` = 1)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `credit_cashing_applications` SET `comment` = 'test', `status` = 301, `updated_at` = '2014-08-26 09:04:53' WHERE `credit_cashing_applications`.`id` = 41[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transaction_logs` (`created_at`, `credit_account_id`, `credit_delta`, `customer_name`, `log_type`, `matched_bank`, `media_num`, `media_type`, `mobile`, `ref_id`, `status`, `transaction_datetime`, `transaction_type`, `updated_at`) VALUES ('2014-08-26 09:04:53', 587, -5000, 'test', 0, 'test_bank', '111111111111111111111', 'bank_card', '123456', 'c6bd38c9c512cecf90fcc40d9e3645f3', 0, '2014-08-26 09:04:53', 'credit_cashing', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 587 LIMIT 1
  [1m[36mTrade::TransactionLog Load (0.5ms)[0m  [1mSELECT  `transaction_logs`.* FROM `transaction_logs`   ORDER BY `transaction_logs`.`transaction_datetime` ASC LIMIT 1[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 587  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `transactions` (`created_at`, `ref_id`, `transaction_type`, `updated_at`, `voucher_info`) VALUES ('2014-08-26 09:04:53', '13347cc8fef5094566b9e7a5df30177a', 'roll_back', '2014-08-26 09:04:53', NULL)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `transactions`
  [1m[36mTrade::Transaction Load (0.2ms)[0m  [1mSELECT  `transactions`.* FROM `transactions`   ORDER BY `transactions`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 09:04:53', '1976-01-01 00:00:00', '2014-08-26 09:03:53', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 09:04:53') AND (valid_till >= '2014-08-26 09:04:53')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 09:04:53' or valid_till < '2014-08-26 09:04:53')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:53', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:53', '72f3ce73a2f0be317e1bd90565bb35d9', 0, '2014-08-26 09:04:53')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 147) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 588, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 147[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `merchant_store_id`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.05, 0.1, 147, 'credit_back', 0.03, 1, '2014-08-26 09:04:53', '2014-08-26 09:03:53', '2014-08-26 09:05:53', 0)
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 147) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 09:04:53', `voucher_status` = 1 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 66[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 147) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 147[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 09:04:53', `voucher_status` = 2 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 66
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 147) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 147
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `payment_plans` SET `updated_at` = '2014-08-26 09:04:53', `voucher_status` = 3 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 66[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 147) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `accept_own_voucher` = 1, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 147[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `payment_plans` SET `updated_at` = '2014-08-26 09:04:53', `voucher_status` = 0 WHERE `payment_plans`.`plan_type` IN ('credit_back') AND `payment_plans`.`id` = 66
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 147 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 147) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `accept_global_voucher` = 0, `accept_own_voucher` = 0, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 147
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1
  [1m[36mMerchant::MerchantStore Load (0.2ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 147 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.05, 0.1, 'credit_back', 0.03, '2014-08-26 09:04:53', '1976-01-01 00:00:00', '2024-08-26 09:04:53', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`[0m
  [1m[35mPay::CreditBack Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('credit_back')  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 09:04:53') AND (valid_till >= '2014-08-26 09:04:53')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 09:04:53' or valid_till < '2014-08-26 09:04:53')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 09:04:53', '2014-08-26 09:05:53', '2014-08-26 09:14:53', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 09:04:53') AND (valid_till >= '2014-08-26 09:04:53')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 09:04:53' or valid_till < '2014-08-26 09:04:53')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 09:04:53', '2014-08-26 09:03:53', '2014-08-26 09:05:53', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 09:04:53') AND (valid_till >= '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 09:04:53' or valid_till < '2014-08-26 09:04:53')
  [1m[36mPay::PaymentPlan Load (0.1ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (26.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `customer_rate`, `merchant_rate`, `plan_type`, `referer_rate`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.05, 0.1, 'credit_back', 0.03, 1, '2014-08-26 09:04:53', '1976-01-01 00:00:00', '2024-08-26 09:04:53', 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`status` = 1 AND (valid_from <= '2014-08-26 09:04:53') AND (valid_till >= '2014-08-26 09:04:53')[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE (status =0 or valid_from > '2014-08-26 09:04:53' or valid_till < '2014-08-26 09:04:53')
  [1m[36mPay::PaymentPlan Load (0.2ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`   ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35m (16.0ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `sequences`  WHERE `sequences`.`name` IS NULL LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `sequences` (`created_at`, `updated_at`) VALUES ('2014-08-26 09:04:53', '2014-08-26 09:04:53')
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 09:04:53', '1234', 21, '2014-08-26 09:04:53')[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `sequence_numbers` (`created_at`, `number`, `sequence_id`, `updated_at`) VALUES ('2014-08-26 09:04:53', '1235', 21, '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 21 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 21 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 09:04:53', `used` = 1 WHERE `sequence_numbers`.`id` = 41[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1234'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.2ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 21 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.3ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 21 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `sequence_numbers` SET `updated_at` = '2014-08-26 09:04:53', `used` = 1 WHERE `sequence_numbers`.`id` = 42[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::SequenceNumber Load (0.2ms)[0m  [1mSELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`number` = '1235'  ORDER BY `sequence_numbers`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::Sequence Load (0.1ms)[0m  [1mSELECT  `sequences`.* FROM `sequences`  WHERE `sequences`.`id` = 21 LIMIT 1 FOR UPDATE[0m
  [1m[35mMember::SequenceNumber Load (0.2ms)[0m  SELECT  `sequence_numbers`.* FROM `sequence_numbers`  WHERE `sequence_numbers`.`sequence_id` = 21 AND `sequence_numbers`.`used` = 0  ORDER BY `sequence_numbers`.`number` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.4ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '372e5e44dcb7ca71ddfa893b41874cc0', 0, '123456', 'test', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 589
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 589, 0, '1111111111111111111111', 'bank_card', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 589[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (22.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '49ce25bdce935af7c081dda3d6581da8', 0, '123456', 'test', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 590[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 590, 0, '1111111111111111111111', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 590
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '345ee74c1019fa837dc49f9c3873ba27', 0, '123456', 'test', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 591[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111110' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 591, 0, '1111111111111111111110', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 591
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111111' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 591, 0, '1111111111111111111111', 'bank_card', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 591[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111112' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 591, 0, '1111111111111111111112', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 591
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.2ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111113' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 591, 0, '1111111111111111111113', 'bank_card', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 591[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1111111111111111111114' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 591, 0, '1111111111111111111114', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 591
  [1m[36m (15.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 09:04:53', 'be01ea7efa1eb71de65de095ff79343d', 0, '123456', 'test', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('individual', '2014-08-26 09:04:53', '410b95ee7077b4f0d4ef8dcd860deb7b', 0, '123456', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::CreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 593) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `total_credit` = 100, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 593 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 593) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `total_credit` = 50, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 593 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36mMember::CreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`   ORDER BY `credit_accounts`.`id` ASC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'testa', '2014-08-26 09:04:53', '6dd85be47cf4e3634dc4539c75fab520', 0, '123456', 'test', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('2014-08-26 09:04:53', '25c0c9eaace230d5e2c66ed778ac2cb8', 0, '12345611', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:53', '33bb6dc7187a603b417295f989d82cbb', 0, '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '3eccd42bdb370dd597eeb37f49d96d31', 0, '123456', 'test', '2014-08-26 09:04:53', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 597) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 597 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.4ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 597) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 1000, `locked_credit` = 0, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 597 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.2ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 597 LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:53', 'e56bc4932ca0c33d6015304fa07e32d8', 0, '123456', 'test', '2014-08-26 09:04:53', 1000)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 598) LIMIT 1[0m
  [1m[35m (0.2ms)[0m  UPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 598 AND `credit_accounts`.`lock_version` = 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Load (0.2ms)[0m  SELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 598 LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`, `usable_credit`) VALUES ('individual', 'test', '2014-08-26 09:04:53', 'ef94c2d3f2a5d592193345cd6e5af1bc', 0, '123456', 'test', '2014-08-26 09:04:53', 1000)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 599) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `usable_credit` = 600, `locked_credit` = 400, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 599 AND `credit_accounts`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 599) LIMIT 1
  [1m[36m (0.2ms)[0m  [1mUPDATE `credit_accounts` SET `locked_credit` = 0, `cashed_credit` = 400, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 2 WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`id` = 599 AND `credit_accounts`.`lock_version` = 1)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Load (0.3ms)[0m  [1mSELECT  `credit_accounts`.* FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`id` = 599 LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '7eb0ec2e547d8644adea0634b7c667ac', 0, '123456', 'test', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 600, 0, '1234567812345678', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::BankCard Load (0.3ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 600  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 134 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.3ms)[0m  [1mUPDATE `payment_media` SET `credit_earned` = 50, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 134 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::PaymentMedia Exists (0.3ms)[0m  SELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`id` != 134 AND `payment_media`.`media_type` = 'bank_card') LIMIT 1
  [1m[36m (0.3ms)[0m  [1mUPDATE `payment_media` SET `credit_earned` = 100, `updated_at` = '2014-08-26 09:04:53', `lock_version` = 1 WHERE `payment_media`.`media_type` IN ('bank_card') AND (`payment_media`.`id` = 134 AND `payment_media`.`lock_version` = 0)[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36mMember::BankCard Load (0.2ms)[0m  [1mSELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card')  ORDER BY `payment_media`.`id` ASC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:53', '98c4e45790bbebaaf0a4d92f900373bb', 0, '123456', 'test', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::PaymentMedia Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `payment_media`  WHERE (`payment_media`.`media_num` = BINARY '1234567812345678' AND `payment_media`.`media_type` = 'bank_card') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_media` (`card_type`, `created_at`, `credit_account_id`, `lock_version`, `media_num`, `media_type`, `updated_at`) VALUES ('debit', '2014-08-26 09:04:53', 601, 0, '1234567812345678', 'bank_card', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 601
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `payment_media`  WHERE `payment_media`.`credit_account_id` = 601[0m
  [1m[35mMember::BankCard Load (0.2ms)[0m  SELECT  `payment_media`.* FROM `payment_media`  WHERE `payment_media`.`media_type` IN ('bank_card') AND `payment_media`.`credit_account_id` = 601  ORDER BY `payment_media`.`id` ASC LIMIT 1
  [1m[36m (0.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:53', 'a6965f45b3aa86d88b35986e5a5e01d6', 0, '123456', 'test', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('7495e9419591c1b91593caf5b70a7d7a', 'core-engine', 'test', '2014-08-26 09:04:53', '0', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `platform_accounts` SET `status` = '1', `updated_at` = '2014-08-26 09:04:53' WHERE `platform_accounts`.`id` = 17
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Load (0.2ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '7495e9419591c1b91593caf5b70a7d7a' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSystem::PlatformAccount Exists (0.2ms)[0m  SELECT  1 AS one FROM `platform_accounts`  WHERE `platform_accounts`.`account_name` = BINARY 'test' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `platform_accounts` (`access_key`, `access_target`, `account_name`, `created_at`, `status`, `updated_at`) VALUES ('7354eb844753cff5bc7cfbe1e2950aa5', 'core-engine', 'test', '2014-08-26 09:04:53', '0', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mSystem::PlatformAccount Load (0.2ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = 'wrong' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.1ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '7354eb844753cff5bc7cfbe1e2950aa5' and access_target = 'core-interface' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36mSystem::PlatformAccount Load (0.1ms)[0m  [1mSELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'wrong' and access_key = '7354eb844753cff5bc7cfbe1e2950aa5' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1[0m
  [1m[35mSystem::PlatformAccount Load (0.1ms)[0m  SELECT  `platform_accounts`.`account_name` FROM `platform_accounts`  WHERE (account_name = 'test' and access_key = '7354eb844753cff5bc7cfbe1e2950aa5' and access_target = 'core-engine' and status =0)  ORDER BY `platform_accounts`.`id` ASC LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_amount`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 1000, 'cash', 1, 'bank_discount', 1, '2014-08-26 09:04:53', '1976-01-01 00:00:00', '2024-08-26 09:04:53', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `payment_plans` (`created_at`, `discount_rate`, `discount_type`, `minimal_money_amount`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:53', 0.1, 'rate', 1, 'bank_discount', 1, '2014-08-26 09:04:53', '1976-01-01 00:00:00', '2024-08-26 09:04:53', 0)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`plan_type` IN ('bank_discount')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:53', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:53', '7e8e67d7946f087c06eac539aa5b6008', 0, '2014-08-26 09:04:53')
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 148) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 603, `updated_at` = '2014-08-26 09:04:53' WHERE `merchant_stores`.`id` = 148
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:53', 'test_group', '2014-08-26 09:04:53')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_group_ships` (`created_at`, `merchant_group_id`, `merchant_store_id`, `updated_at`) VALUES ('2014-08-26 09:04:53', 99, 148, '2014-08-26 09:04:53')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE (`merchant_groups`.`name` = BINARY 'test_group' AND `merchant_groups`.`id` != 99) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Load (0.1ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 99 LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores` INNER JOIN `merchant_group_ships` ON `merchant_stores`.`id` = `merchant_group_ships`.`merchant_store_id` WHERE `merchant_group_ships`.`merchant_group_id` = 99[0m
  [1m[35mMerchant::MerchantStore Load (0.3ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 148 LIMIT 1
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 148[0m
  [1m[35mMerchant::MerchantGroup Load (0.2ms)[0m  SELECT  `merchant_groups`.* FROM `merchant_groups` INNER JOIN `merchant_group_ships` ON `merchant_groups`.`id` = `merchant_group_ships`.`merchant_group_id` WHERE `merchant_group_ships`.`merchant_store_id` = 148  ORDER BY `merchant_groups`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.3ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 15
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  DELETE FROM `configurations` WHERE `configurations`.`id` = 15
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.1ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (14.4ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSystem::Configuration Load (0.3ms)[0m  [1mSELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `configurations` (`key`) VALUES ('referer_rate')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE `configurations` SET `value` = '0.3' WHERE `configurations`.`id` = 16
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mSystem::Configuration Load (0.2ms)[0m  SELECT  `configurations`.* FROM `configurations`  WHERE `configurations`.`key` = 'referer_rate'  ORDER BY `configurations`.`id` ASC LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `acquirer_org` (`acquirer_name`, `created_at`, `updated_at`) VALUES ('cangjingkong', '2014-08-26 09:04:54', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `acquirer_org` (`acquirer_code`, `acquirer_name`, `created_at`, `updated_at`) VALUES ('123', 'cangjingkong', '2014-08-26 09:04:54', '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '123' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '11' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, '2014-08-26 09:04:54', '11', 'test', 0.01, 'editing', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `mobile`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:54', '03cd11c32cc1f649970ed5755e9d1ef0', 0, 'test1', '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Load (0.3ms)[0m  [1mSELECT  `merchant_stores`.* FROM `merchant_stores`   ORDER BY `merchant_stores`.`id` ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 149
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `credit_accounts` WHERE `credit_accounts`.`account_type` IN ('merchant') AND `credit_accounts`.`id` = 604 AND `credit_accounts`.`lock_version` = 0[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 149
  [1m[36mMerchant::MerchantGroupShip Load (0.2ms)[0m  [1mSELECT `merchant_group_ships`.* FROM `merchant_group_ships`  WHERE `merchant_group_ships`.`merchant_store_id` = 149[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 149
  [1m[36mSQL (0.2ms)[0m  [1mDELETE FROM `merchant_stores` WHERE `merchant_stores`.`id` = 149[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `merchant_stores`[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('merchant')
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb1', '0011', 1, '2014-08-26 09:04:54', 19, 1, '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('12345', 'ccb2', '0012', 2, '2014-08-26 09:04:54', 19, 1, '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('123456', 'ccb3', '0013', 3, '2014-08-26 09:04:54', 19, 0, '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mBank::CardBin Load (0.3ms)[0m  SELECT * FROM card_bins WHERE '123457777' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1
  [1m[36mBank::CardBin Load (0.2ms)[0m  [1mSELECT * FROM card_bins WHERE '123456666' like concat(bank_bin,'%') ORDER BY length(bank_bin) DESC LIMIT 1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `card_bins` (`bank_bin`, `bank_name`, `card_code`, `card_type`, `created_at`, `length`, `organization`, `updated_at`) VALUES ('1234', 'ccb', '0011', 1, '2014-08-26 09:04:54', 19, 1, '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:54', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:54', 'f947a9b406ef07ac4c2fec37e0e5e82e', 0, '2014-08-26 09:04:54')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 150) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 605, `updated_at` = '2014-08-26 09:04:54' WHERE `merchant_stores`.`id` = 150
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `display_name`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:54', 'test_display', 'test_group', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454131', 0, 'ace15ff7063af3693571b0f280cc3ddd', '2014-08-26 09:04:54', 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_store_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454135', 1, '7bb1456e4f3efe5dd2aeb9ce115956bc', '2014-08-26 09:04:54', 0, 150, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `merchant_group_id`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454150', 2, '58d007614e36cd43c7113c698f9f9981', '2014-08-26 09:04:54', 0, 100, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454155', 0, '026b232435de974f00b81f9dc6a54ee1', '2014-08-26 09:04:54', 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:54', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:54', 'a09a0071706c14440f787169325fb5f3', 0, '2014-08-26 09:04:54')[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 151) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 606, `updated_at` = '2014-08-26 09:04:54' WHERE `merchant_stores`.`id` = 151[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantGroup Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:54', 'test_group', '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `merchant_group_id` = 101, `updated_at` = '2014-08-26 09:04:54' WHERE `voucher_meta`.`id` = 637
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::VoucherMeta Load (0.1ms)[0m  SELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 637 LIMIT 1
  [1m[36mMerchant::MerchantGroup Load (0.1ms)[0m  [1mSELECT  `merchant_groups`.* FROM `merchant_groups`  WHERE `merchant_groups`.`id` = 101 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454172', 0, '10b5bccbc9160cd3fcfcf9e4556d18cb', '2014-08-26 09:04:54', 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMerchant::MerchantStore Exists (0.2ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:54', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:54', 'ec5ac6fb4937baf891e4b864147f4714', 0, '2014-08-26 09:04:54')
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 152) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `merchant_stores` SET `credit_account_id` = 607, `updated_at` = '2014-08-26 09:04:54' WHERE `merchant_stores`.`id` = 152
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantGroup Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_groups`  WHERE `merchant_groups`.`name` = BINARY 'test_group' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_groups` (`created_at`, `name`, `updated_at`) VALUES ('2014-08-26 09:04:54', 'test_group', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `merchant_store_id` = 152, `updated_at` = '2014-08-26 09:04:54' WHERE `voucher_meta`.`id` = 638[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 638 LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Load (0.2ms)[0m  SELECT  `merchant_stores`.* FROM `merchant_stores`  WHERE `merchant_stores`.`id` = 152 LIMIT 1
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `denomination`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454190', 0, '67480cdd79e97d38e6e91952552f6ea8', '2014-08-26 09:04:54', 10000, 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMember::IndividualCreditAccount Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND `credit_accounts`.`mobile` = BINARY '123456' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `credit_accounts` (`account_type`, `address`, `created_at`, `external_id`, `lock_version`, `mobile`, `name`, `updated_at`) VALUES ('individual', 'test', '2014-08-26 09:04:54', 'fc2b1ff8ddbd78d4dcfdecb37c934daf', 0, '123456', 'test', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `issued_count` = 1, `updated_at` = '2014-08-26 09:04:54' WHERE `voucher_meta`.`id` = 639[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:54', 1, '30adb159473d8be9fdbd6fa8d4003fe0', '2014-08-26 09:04:54', 639)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `vouchers` SET `credit_account_id` = 608, `updated_at` = '2014-08-26 09:04:54' WHERE `vouchers`.`id` = 166[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mMember::IndividualCreditAccount Exists (0.3ms)[0m  SELECT  1 AS one FROM `credit_accounts`  WHERE `credit_accounts`.`account_type` IN ('individual') AND (`credit_accounts`.`mobile` = BINARY '123456' AND `credit_accounts`.`id` != 608) LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mMember::Voucher Load (0.3ms)[0m  SELECT  `vouchers`.* FROM `vouchers`  WHERE `vouchers`.`credit_account_id` = 608  ORDER BY `vouchers`.`id` ASC LIMIT 1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` IN (639)[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `denomination`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454207', 1, 0, '19eeeb7c294ae987a059ca70a544bbfb', '2014-08-26 09:04:54', 10000, 1, 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = 0, `issued_count` = 1, `updated_at` = '2014-08-26 09:04:54' WHERE `voucher_meta`.`id` = 640
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `vouchers` (`created_at`, `status`, `unique_id`, `updated_at`, `voucher_meta_id`) VALUES ('2014-08-26 09:04:54', 1, 'a7606a8c32011d980bf8096a06665b15', '2014-08-26 09:04:54', 640)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mMember::VoucherMeta Load (0.2ms)[0m  [1mSELECT  `voucher_meta`.* FROM `voucher_meta`  WHERE `voucher_meta`.`id` = 640 LIMIT 1[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454216', 0, 'd577a4571766d8897102da1f4c15f4a7', '2014-08-26 09:04:54', 0, 0, 1, '2014-08-26 09:04:54', '2014-08-26 08:59:54', '2014-08-26 09:09:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454219', 0, '40ec3d1341a68e94a722c9505e94cb6a', '2014-08-26 09:04:54', 0, 0, 1, '2014-08-26 09:04:54', '2014-08-26 09:09:54', '2014-08-26 08:59:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `voucher_meta` (`aliases`, `applicable_type`, `code`, `created_at`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454223', 0, 'c6418155601c9ef6f674fe0e21be9fe6', '2014-08-26 09:04:54', 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `voucher_meta` (`aliases`, `amount_left`, `applicable_type`, `code`, `created_at`, `initial_amount`, `issuer_type`, `settler_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('20140826170454228', 100, 0, '872fe5300df29a0722caddc4b0b717ed', '2014-08-26 09:04:54', 100, 0, 0, 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE `voucher_meta` SET `amount_left` = 50, `initial_amount` = 50, `updated_at` = '2014-08-26 09:04:54' WHERE `voucher_meta`.`id` = 644[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE `voucher_meta` SET `amount_left` = -1, `initial_amount` = -1, `updated_at` = '2014-08-26 09:04:54' WHERE `voucher_meta`.`id` = 644
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mMerchant::MerchantStore Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE `merchant_stores`.`merchant_number` = BINARY '111' LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `merchant_stores` (`accept_global_voucher`, `clearance_account_bank`, `clearance_account_name`, `clearance_account_num`, `created_at`, `merchant_number`, `name`, `standard_rate`, `status`, `updated_at`) VALUES (0, 'test bank', 'test name', '23123', '2014-08-26 09:04:54', '111', 'test', 0.01, 'editing', '2014-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `credit_accounts` (`account_type`, `created_at`, `external_id`, `lock_version`, `updated_at`) VALUES ('merchant', '2014-08-26 09:04:54', '4a7136526e6189da5f9c520b38275d7c', 0, '2014-08-26 09:04:54')[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 153) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE `merchant_stores` SET `credit_account_id` = 609, `updated_at` = '2014-08-26 09:04:54' WHERE `merchant_stores`.`id` = 153[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 09:04:54', 153, 'register', 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 09:04:54', 153, 'bind_card', 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `marketing_rules` (`created_at`, `merchant_store_id`, `rule_type`, `status`, `updated_at`, `valid_from`, `valid_till`) VALUES ('2014-08-26 09:04:54', 153, 'transaction', 2, '2014-08-26 09:04:54', '2014-08-26 09:04:54', '2024-08-26 09:04:54')
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO `payment_plans` (`created_at`, `merchant_store_id`, `plan_type`, `status`, `updated_at`, `valid_from`, `valid_till`, `voucher_status`) VALUES ('2014-08-26 09:04:54', 153, 'none', 1, '2014-08-26 09:04:54', '1976-01-01 00:00:00', '2024-08-26 09:04:54', 3)[0m
  [1m[35mPay::PaymentPlan Load (0.3ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 153 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mPay::PaymentPlan Load (0.5ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 153 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mMerchant::MerchantStore Exists (0.3ms)[0m  SELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 153) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE `merchant_stores` SET `accept_global_voucher` = 1, `accept_own_voucher` = 1, `updated_at` = '2014-08-26 09:04:54' WHERE `merchant_stores`.`id` = 153[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `marketing_rules_payment_plans` (`marketing_rule_id`, `payment_plan_id`) VALUES (50, 73)
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPay::PaymentPlan Load (0.3ms)[0m  [1mSELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 153 AND (voucher_status = 3 or  voucher_status = 2)  ORDER BY `payment_plans`.`id` ASC LIMIT 1[0m
  [1m[35mPay::PaymentPlan Load (0.2ms)[0m  SELECT  `payment_plans`.* FROM `payment_plans`  WHERE `payment_plans`.`merchant_store_id` = 153 AND (voucher_status = 3 or  voucher_status = 1)  ORDER BY `payment_plans`.`id` ASC LIMIT 1
  [1m[36mMerchant::MerchantStore Exists (0.3ms)[0m  [1mSELECT  1 AS one FROM `merchant_stores`  WHERE (`merchant_stores`.`merchant_number` = BINARY '111' AND `merchant_stores`.`id` != 153) LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'transaction'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'[0m
  [1m[35mMerchant::MarketingRule Load (0.1ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'register'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'[0m
  [1m[35mMerchant::MarketingRule Load (0.2ms)[0m  SELECT  `marketing_rules`.* FROM `marketing_rules`  WHERE `marketing_rules`.`rule_type` = 'bind_card'  ORDER BY `marketing_rules`.`id` ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM `marketing_rules`  WHERE `marketing_rules`.`merchant_store_id` = 153[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM `marketing_rules` INNER JOIN `marketing_rules_payment_plans` ON `marketing_rules`.`id` = `marketing_rules_payment_plans`.`marketing_rule_id` WHERE `marketing_rules`.`rule_type` = 'transaction' AND `marketing_rules_payment_plans`.`payment_plan_id` = 73
  [1m[36m (0.8ms)[0m  [1mROLLBACK[0m
